<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Linear regression model with spatial dependency for the Irish pH data | Introduction to spatial-temporal data anlysis using R</title>
  <meta name="description" content="11 Linear regression model with spatial dependency for the Irish pH data | Introduction to spatial-temporal data anlysis using R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Linear regression model with spatial dependency for the Irish pH data | Introduction to spatial-temporal data anlysis using R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Linear regression model with spatial dependency for the Irish pH data | Introduction to spatial-temporal data anlysis using R" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-09-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Chapter11.html"/>
<link rel="next" href="sessioninfo.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="Chapter0.html"><a href="Chapter0.html"><i class="fa fa-check"></i>0. パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="Chapter2.html"><a href="Chapter2.html"><i class="fa fa-check"></i><b>1</b> Recognizing statistical dependency</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Chapter2.html"><a href="Chapter2.html#pseudoreplication"><i class="fa fa-check"></i><b>1.1</b> Pseudoreplication</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="Chapter2.html"><a href="Chapter2.html#疑似反復とは"><i class="fa fa-check"></i><b>1.1.1</b> 疑似反復とは</a></li>
<li class="chapter" data-level="1.1.2" data-path="Chapter2.html"><a href="Chapter2.html#時空間的な疑似反復"><i class="fa fa-check"></i><b>1.1.2</b> 時空間的な疑似反復</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="Chapter2.html"><a href="Chapter2.html#s1-2"><i class="fa fa-check"></i><b>1.2</b> Linear regression applied to spatial data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="Chapter2.html"><a href="Chapter2.html#visualization"><i class="fa fa-check"></i><b>1.2.1</b> Visualization</a></li>
<li class="chapter" data-level="1.2.2" data-path="Chapter2.html"><a href="Chapter2.html#dependency"><i class="fa fa-check"></i><b>1.2.2</b> Dependency</a></li>
<li class="chapter" data-level="1.2.3" data-path="Chapter2.html"><a href="Chapter2.html#fit-the-model"><i class="fa fa-check"></i><b>1.2.3</b> Fit the model</a></li>
<li class="chapter" data-level="1.2.4" data-path="Chapter2.html"><a href="Chapter2.html#model-validation"><i class="fa fa-check"></i><b>1.2.4</b> Model validation</a>
<ul>
<li class="chapter" data-level="1.2.4.1" data-path="Chapter2.html"><a href="Chapter2.html#check-homogeinity-and-model-misfit"><i class="fa fa-check"></i><b>1.2.4.1</b> Check homogeinity and model misfit</a></li>
</ul></li>
<li class="chapter" data-level="1.2.5" data-path="Chapter2.html"><a href="Chapter2.html#check-spatial-dependence"><i class="fa fa-check"></i><b>1.2.5</b> Check spatial dependence</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="Chapter2.html"><a href="Chapter2.html#s2-2"><i class="fa fa-check"></i><b>1.3</b> GAM applied to temporal data</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="Chapter2.html"><a href="Chapter2.html#subnivium-temperature-data"><i class="fa fa-check"></i><b>1.3.1</b> Subnivium temperature data</a></li>
<li class="chapter" data-level="1.3.2" data-path="Chapter2.html"><a href="Chapter2.html#sources-of-dependency"><i class="fa fa-check"></i><b>1.3.2</b> Sources of dependency</a></li>
<li class="chapter" data-level="1.3.3" data-path="Chapter2.html"><a href="Chapter2.html#the-model"><i class="fa fa-check"></i><b>1.3.3</b> The model</a></li>
<li class="chapter" data-level="1.3.4" data-path="Chapter2.html"><a href="Chapter2.html#model-validation-1"><i class="fa fa-check"></i><b>1.3.4</b> Model validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chapter3.html"><a href="Chapter3.html"><i class="fa fa-check"></i><b>2</b> Time series and GLS</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Chapter3.html"><a href="Chapter3.html#ospreys"><i class="fa fa-check"></i><b>2.1</b> Ospreys</a></li>
<li class="chapter" data-level="2.2" data-path="Chapter3.html"><a href="Chapter3.html#covariance-and-correlation-coefficients"><i class="fa fa-check"></i><b>2.2</b> Covariance and correlation coefficients</a></li>
<li class="chapter" data-level="2.3" data-path="Chapter3.html"><a href="Chapter3.html#linear-regression-models"><i class="fa fa-check"></i><b>2.3</b> Linear regression models</a></li>
<li class="chapter" data-level="2.4" data-path="Chapter3.html"><a href="Chapter3.html#focusing-on-the-residual-covariance-matrix"><i class="fa fa-check"></i><b>2.4</b> Focusing on the residual covariance matrix</a></li>
<li class="chapter" data-level="2.5" data-path="Chapter3.html"><a href="Chapter3.html#dependency-and-the-covariance-matrix"><i class="fa fa-check"></i><b>2.5</b> Dependency and the covariance matrix</a></li>
<li class="chapter" data-level="2.6" data-path="Chapter3.html"><a href="Chapter3.html#dealing-with-temporal-dependency"><i class="fa fa-check"></i><b>2.6</b> Dealing with temporal dependency</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="Chapter3.html"><a href="Chapter3.html#adelie-penguins"><i class="fa fa-check"></i><b>2.6.1</b> Adelie penguins</a></li>
<li class="chapter" data-level="2.6.2" data-path="Chapter3.html"><a href="Chapter3.html#do-we-have-dependency"><i class="fa fa-check"></i><b>2.6.2</b> Do we have dependency?</a></li>
<li class="chapter" data-level="2.6.3" data-path="Chapter3.html"><a href="Chapter3.html#formulation-of-the-linear-regression-model"><i class="fa fa-check"></i><b>2.6.3</b> Formulation of the linear regression model</a></li>
<li class="chapter" data-level="2.6.4" data-path="Chapter3.html"><a href="Chapter3.html#application-of-the-linear-regression-model"><i class="fa fa-check"></i><b>2.6.4</b> Application of the linear regression model</a></li>
<li class="chapter" data-level="2.6.5" data-path="Chapter3.html"><a href="Chapter3.html#formulation-of-the-gls-model"><i class="fa fa-check"></i><b>2.6.5</b> Formulation of the GLS model</a></li>
<li class="chapter" data-level="2.6.6" data-path="Chapter3.html"><a href="Chapter3.html#implementation-using-the-gls-function"><i class="fa fa-check"></i><b>2.6.6</b> Implementation using the gls function</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="Chapter3.html"><a href="Chapter3.html#multiple-time-series"><i class="fa fa-check"></i><b>2.7</b> Multiple time series</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chapter4.html"><a href="Chapter4.html"><i class="fa fa-check"></i><b>3</b> Spatial data and GLS</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Chapter4.html"><a href="Chapter4.html#variogram-models-for-spatial-dependency"><i class="fa fa-check"></i><b>3.1</b> Variogram models for spatial dependency</a></li>
<li class="chapter" data-level="3.2" data-path="Chapter4.html"><a href="Chapter4.html#application-on-the-irish-ph-data"><i class="fa fa-check"></i><b>3.2</b> Application on the Irish pH data</a></li>
<li class="chapter" data-level="3.3" data-path="Chapter4.html"><a href="Chapter4.html#s4-3"><i class="fa fa-check"></i><b>3.3</b> Matern correlation function</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chapter5.html"><a href="Chapter5.html"><i class="fa fa-check"></i><b>4</b> Linear mixed-effects models and dependency</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Chapter5.html"><a href="Chapter5.html#white-storks"><i class="fa fa-check"></i><b>4.1</b> White Storks</a></li>
<li class="chapter" data-level="4.2" data-path="Chapter5.html"><a href="Chapter5.html#considering-the-data-wrongly-as-one-way-nested"><i class="fa fa-check"></i><b>4.2</b> Considering the data (wrongly) as one-way nested</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="Chapter5.html"><a href="Chapter5.html#model-formulation"><i class="fa fa-check"></i><b>4.2.1</b> model formulation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="Chapter5.html"><a href="Chapter5.html#fitting-the-one-way-nested-model-using-lmer"><i class="fa fa-check"></i><b>4.3</b> Fitting the one-way nested model using lmer</a></li>
<li class="chapter" data-level="4.4" data-path="Chapter5.html"><a href="Chapter5.html#model-validation-2"><i class="fa fa-check"></i><b>4.4</b> Model validation</a></li>
<li class="chapter" data-level="4.5" data-path="Chapter5.html"><a href="Chapter5.html#sketching-the-fitted-value"><i class="fa fa-check"></i><b>4.5</b> Sketching the fitted value</a></li>
<li class="chapter" data-level="4.6" data-path="Chapter5.html"><a href="Chapter5.html#considering-the-data-correctly-as-two-way-nested"><i class="fa fa-check"></i><b>4.6</b> Considering the data (correctly) as two-way nested</a></li>
<li class="chapter" data-level="4.7" data-path="Chapter5.html"><a href="Chapter5.html#differences-with-the-ar1-process-approach"><i class="fa fa-check"></i><b>4.7</b> Differences with the AR1 process approach</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Chapter6.html"><a href="Chapter6.html"><i class="fa fa-check"></i><b>5</b> Modelling space explicitly</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Chapter6.html"><a href="Chapter6.html#model-formulation-1"><i class="fa fa-check"></i><b>5.1</b> Model formulation</a></li>
<li class="chapter" data-level="5.2" data-path="Chapter6.html"><a href="Chapter6.html#s6-2"><i class="fa fa-check"></i><b>5.2</b> Covariance matrix of the spatial random effect</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="Chapter6.html"><a href="Chapter6.html#simulation-study"><i class="fa fa-check"></i><b>5.2.1</b> Simulation study</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="Chapter6.html"><a href="Chapter6.html#spatial-temporal-correlation"><i class="fa fa-check"></i><b>5.3</b> Spatial-temporal correlation</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="Chapter6.html"><a href="Chapter6.html#simulation-study-continued"><i class="fa fa-check"></i><b>5.3.1</b> Simulation study (continued)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Chapter7.html"><a href="Chapter7.html"><i class="fa fa-check"></i><b>6</b> Introduction to Bayesian statistics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Chapter7.html"><a href="Chapter7.html#why-go-bayesian"><i class="fa fa-check"></i><b>6.1</b> Why go Bayesian?</a></li>
<li class="chapter" data-level="6.2" data-path="Chapter7.html"><a href="Chapter7.html#s7-2"><i class="fa fa-check"></i><b>6.2</b> General probability rules</a></li>
<li class="chapter" data-level="6.3" data-path="Chapter7.html"><a href="Chapter7.html#s7-3"><i class="fa fa-check"></i><b>6.3</b> The mean of a distribution</a></li>
<li class="chapter" data-level="6.4" data-path="Chapter7.html"><a href="Chapter7.html#bayes-theorem-again"><i class="fa fa-check"></i><b>6.4</b> Bayes theorem again</a></li>
<li class="chapter" data-level="6.5" data-path="Chapter7.html"><a href="Chapter7.html#s7-5"><i class="fa fa-check"></i><b>6.5</b> Conjugate priors</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="Chapter7.html"><a href="Chapter7.html#likelihood-function"><i class="fa fa-check"></i><b>6.5.1</b> Likelihood function</a></li>
<li class="chapter" data-level="6.5.2" data-path="Chapter7.html"><a href="Chapter7.html#priors"><i class="fa fa-check"></i><b>6.5.2</b> Priors</a></li>
<li class="chapter" data-level="6.5.3" data-path="Chapter7.html"><a href="Chapter7.html#posterior-distribution"><i class="fa fa-check"></i><b>6.5.3</b> Posterior distribution</a></li>
<li class="chapter" data-level="6.5.4" data-path="Chapter7.html"><a href="Chapter7.html#diffuse-prior"><i class="fa fa-check"></i><b>6.5.4</b> Diffuse prior</a></li>
<li class="chapter" data-level="6.5.5" data-path="Chapter7.html"><a href="Chapter7.html#informative-prior"><i class="fa fa-check"></i><b>6.5.5</b> Informative prior</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="Chapter7.html"><a href="Chapter7.html#markov-chain-monte-carlo-simulation"><i class="fa fa-check"></i><b>6.6</b> Markov chain Monte Carlo simulation</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="Chapter7.html"><a href="Chapter7.html#underlying-idea"><i class="fa fa-check"></i><b>6.6.1</b> underlying idea</a></li>
<li class="chapter" data-level="6.6.2" data-path="Chapter7.html"><a href="Chapter7.html#simple-example-of-mcmc-algorithm"><i class="fa fa-check"></i><b>6.6.2</b> Simple example of MCMC algorithm</a></li>
<li class="chapter" data-level="6.6.3" data-path="Chapter7.html"><a href="Chapter7.html#methods-in-mcmc"><i class="fa fa-check"></i><b>6.6.3</b> Methods in MCMC</a></li>
<li class="chapter" data-level="6.6.4" data-path="Chapter7.html"><a href="Chapter7.html#flowchart-for-running-a-model-in-stan"><i class="fa fa-check"></i><b>6.6.4</b> Flowchart for running a model in Stan</a>
<ul>
<li class="chapter" data-level="6.6.4.1" data-path="Chapter7.html"><a href="Chapter7.html#preparing-the-data-for-stan"><i class="fa fa-check"></i><b>6.6.4.1</b> Preparing the data for Stan</a></li>
<li class="chapter" data-level="6.6.4.2" data-path="Chapter7.html"><a href="Chapter7.html#decide-model-formulation-and-priors"><i class="fa fa-check"></i><b>6.6.4.2</b> Decide model formulation and priors</a></li>
<li class="chapter" data-level="6.6.4.3" data-path="Chapter7.html"><a href="Chapter7.html#preparing-stan-file"><i class="fa fa-check"></i><b>6.6.4.3</b> Preparing stan file</a></li>
<li class="chapter" data-level="6.6.4.4" data-path="Chapter7.html"><a href="Chapter7.html#initial-values"><i class="fa fa-check"></i><b>6.6.4.4</b> Initial values</a></li>
</ul></li>
<li class="chapter" data-level="6.6.5" data-path="Chapter7.html"><a href="Chapter7.html#running-model-in-stan"><i class="fa fa-check"></i><b>6.6.5</b> Running model in Stan</a></li>
<li class="chapter" data-level="6.6.6" data-path="Chapter7.html"><a href="Chapter7.html#assess-mixing"><i class="fa fa-check"></i><b>6.6.6</b> Assess mixing</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="Chapter7.html"><a href="Chapter7.html#integrated-nested-laplace-approximation"><i class="fa fa-check"></i><b>6.7</b> Integrated nested Laplace approximation</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="Chapter7.html"><a href="Chapter7.html#joint-posterior-distribution"><i class="fa fa-check"></i><b>6.7.1</b> Joint posterior distribution</a></li>
<li class="chapter" data-level="6.7.2" data-path="Chapter7.html"><a href="Chapter7.html#marginal-distributions"><i class="fa fa-check"></i><b>6.7.2</b> Marginal distributions</a></li>
<li class="chapter" data-level="6.7.3" data-path="Chapter7.html"><a href="Chapter7.html#back-to-high-school"><i class="fa fa-check"></i><b>6.7.3</b> Back to high school</a></li>
<li class="chapter" data-level="6.7.4" data-path="Chapter7.html"><a href="Chapter7.html#inla"><i class="fa fa-check"></i><b>6.7.4</b> INLA</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="Chapter7.html"><a href="Chapter7.html#examples-using-r-inla"><i class="fa fa-check"></i><b>6.8</b> Examples using R-INLA</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="Chapter7.html"><a href="Chapter7.html#s7-8-1"><i class="fa fa-check"></i><b>6.8.1</b> Posterior summary</a></li>
<li class="chapter" data-level="6.8.2" data-path="Chapter7.html"><a href="Chapter7.html#posterior-marginal-distributions"><i class="fa fa-check"></i><b>6.8.2</b> Posterior marginal distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="Chapter7.html"><a href="Chapter7.html#追記"><i class="fa fa-check"></i><b>6.9</b> 追記</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Chapter8.html"><a href="Chapter8.html"><i class="fa fa-check"></i><b>7</b> Multiple linear regression in R-INLA</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Chapter8.html"><a href="Chapter8.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="Chapter8.html"><a href="Chapter8.html#data-exploration"><i class="fa fa-check"></i><b>7.2</b> Data exploration</a></li>
<li class="chapter" data-level="7.3" data-path="Chapter8.html"><a href="Chapter8.html#linear-regression-result"><i class="fa fa-check"></i><b>7.3</b> Linear regression result</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="Chapter8.html"><a href="Chapter8.html#executing-the-model-in-rinla"><i class="fa fa-check"></i><b>7.3.1</b> Executing the model in R=INLA</a></li>
<li class="chapter" data-level="7.3.2" data-path="Chapter8.html"><a href="Chapter8.html#output-for-betas"><i class="fa fa-check"></i><b>7.3.2</b> Output for betas</a>
<ul>
<li class="chapter" data-level="7.3.2.1" data-path="Chapter8.html"><a href="Chapter8.html#numerical-output-for-the-betas"><i class="fa fa-check"></i><b>7.3.2.1</b> Numerical output for the betas</a></li>
<li class="chapter" data-level="7.3.2.2" data-path="Chapter8.html"><a href="Chapter8.html#graphical-output-for-the-betas"><i class="fa fa-check"></i><b>7.3.2.2</b> Graphical output for the betas</a></li>
</ul></li>
<li class="chapter" data-level="7.3.3" data-path="Chapter8.html"><a href="Chapter8.html#output-for-hyperparameters"><i class="fa fa-check"></i><b>7.3.3</b> Output for hyperparameters</a>
<ul>
<li class="chapter" data-level="7.3.3.1" data-path="Chapter8.html"><a href="Chapter8.html#numerical-output-for-hyper-parameters"><i class="fa fa-check"></i><b>7.3.3.1</b> Numerical output for hyper parameters</a></li>
<li class="chapter" data-level="7.3.3.2" data-path="Chapter8.html"><a href="Chapter8.html#graphical-output-for-the-hyperparameters"><i class="fa fa-check"></i><b>7.3.3.2</b> Graphical output for the hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="7.3.4" data-path="Chapter8.html"><a href="Chapter8.html#fitted-model"><i class="fa fa-check"></i><b>7.3.4</b> Fitted model</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="Chapter8.html"><a href="Chapter8.html#model-validation-3"><i class="fa fa-check"></i><b>7.4</b> Model validation</a></li>
<li class="chapter" data-level="7.5" data-path="Chapter8.html"><a href="Chapter8.html#model-selection"><i class="fa fa-check"></i><b>7.5</b> Model selection</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="Chapter8.html"><a href="Chapter8.html#what-should-we-do"><i class="fa fa-check"></i><b>7.5.1</b> What should we do?</a></li>
<li class="chapter" data-level="7.5.2" data-path="Chapter8.html"><a href="Chapter8.html#usind-the-dic"><i class="fa fa-check"></i><b>7.5.2</b> Usind the DIC</a>
<ul>
<li class="chapter" data-level="7.5.2.1" data-path="Chapter8.html"><a href="Chapter8.html#effective-number-of-parameters"><i class="fa fa-check"></i><b>7.5.2.1</b> Effective number of parameters</a></li>
<li class="chapter" data-level="7.5.2.2" data-path="Chapter8.html"><a href="Chapter8.html#dic-related-output"><i class="fa fa-check"></i><b>7.5.2.2</b> DIC related output</a></li>
<li class="chapter" data-level="7.5.2.3" data-path="Chapter8.html"><a href="Chapter8.html#model-selection-using-dic"><i class="fa fa-check"></i><b>7.5.2.3</b> Model selection using DIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5.3" data-path="Chapter8.html"><a href="Chapter8.html#waic"><i class="fa fa-check"></i><b>7.5.3</b> WAIC</a></li>
<li class="chapter" data-level="7.5.4" data-path="Chapter8.html"><a href="Chapter8.html#out-of-sample-prediction"><i class="fa fa-check"></i><b>7.5.4</b> Out of sample prediction</a></li>
<li class="chapter" data-level="7.5.5" data-path="Chapter8.html"><a href="Chapter8.html#posterior-predictive-check"><i class="fa fa-check"></i><b>7.5.5</b> Posterior predictive check</a>
<ul>
<li class="chapter" data-level="7.5.5.1" data-path="Chapter8.html"><a href="Chapter8.html#zuur-2017の方法"><i class="fa fa-check"></i><b>7.5.5.1</b> Zuur (2017)の方法</a></li>
<li class="chapter" data-level="7.5.5.2" data-path="Chapter8.html"><a href="Chapter8.html#s8-5-5-2"><i class="fa fa-check"></i><b>7.5.5.2</b> 正しい方法</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="Chapter8.html"><a href="Chapter8.html#s8-6"><i class="fa fa-check"></i><b>7.6</b> Visualizing the model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Chapter9.html"><a href="Chapter9.html"><i class="fa fa-check"></i><b>8</b> Mixed effects modelling in R-INLA to analysis otolith data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Chapter9.html"><a href="Chapter9.html#otoliths-in-plaice"><i class="fa fa-check"></i><b>8.1</b> Otoliths in plaice</a></li>
<li class="chapter" data-level="8.2" data-path="Chapter9.html"><a href="Chapter9.html#model-formulation-2"><i class="fa fa-check"></i><b>8.2</b> Model formulation</a></li>
<li class="chapter" data-level="8.3" data-path="Chapter9.html"><a href="Chapter9.html#dependency-1"><i class="fa fa-check"></i><b>8.3</b> Dependency</a></li>
<li class="chapter" data-level="8.4" data-path="Chapter9.html"><a href="Chapter9.html#data-exploration-1"><i class="fa fa-check"></i><b>8.4</b> Data exploration</a></li>
<li class="chapter" data-level="8.5" data-path="Chapter9.html"><a href="Chapter9.html#running-the-model-in-r-inla"><i class="fa fa-check"></i><b>8.5</b> Running the model in R-INLA</a></li>
<li class="chapter" data-level="8.6" data-path="Chapter9.html"><a href="Chapter9.html#model-validation-4"><i class="fa fa-check"></i><b>8.6</b> Model validation</a></li>
<li class="chapter" data-level="8.7" data-path="Chapter9.html"><a href="Chapter9.html#model-selection-1"><i class="fa fa-check"></i><b>8.7</b> Model selection</a></li>
<li class="chapter" data-level="8.8" data-path="Chapter9.html"><a href="Chapter9.html#model-interpretation"><i class="fa fa-check"></i><b>8.8</b> Model interpretation</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="Chapter9.html"><a href="Chapter9.html#option-1-for-prediction-adding-extra-data"><i class="fa fa-check"></i><b>8.8.1</b> Option 1 for prediction: Adding extra data</a></li>
<li class="chapter" data-level="8.8.2" data-path="Chapter9.html"><a href="Chapter9.html#s9-8-2"><i class="fa fa-check"></i><b>8.8.2</b> Option 2 for prediction: Using the <code>inla.make.lincombs</code></a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="Chapter9.html"><a href="Chapter9.html#multiple-random-effects"><i class="fa fa-check"></i><b>8.9</b> Multiple random effects</a></li>
<li class="chapter" data-level="8.10" data-path="Chapter9.html"><a href="Chapter9.html#changin-prior-of-fixed-parameters"><i class="fa fa-check"></i><b>8.10</b> Changin prior of fixed parameters</a></li>
<li class="chapter" data-level="8.11" data-path="Chapter9.html"><a href="Chapter9.html#changing-priors-of-hyperparameters"><i class="fa fa-check"></i><b>8.11</b> Changing priors of hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Chapter10.html"><a href="Chapter10.html"><i class="fa fa-check"></i><b>9</b> Poisson, negative binomial, binomial and g amma GLMs in R-INLA</a>
<ul>
<li class="chapter" data-level="9.1" data-path="Chapter10.html"><a href="Chapter10.html#poisson-and-negative-binomial-glms-in-r-inla"><i class="fa fa-check"></i><b>9.1</b> Poisson and negative binomial GLMs in R-INLA</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="Chapter10.html"><a href="Chapter10.html#introduction-1"><i class="fa fa-check"></i><b>9.1.1</b> Introduction</a></li>
<li class="chapter" data-level="9.1.2" data-path="Chapter10.html"><a href="Chapter10.html#data-exploration-2"><i class="fa fa-check"></i><b>9.1.2</b> Data exploration</a></li>
<li class="chapter" data-level="9.1.3" data-path="Chapter10.html"><a href="Chapter10.html#poisson-glm-an-r-inla"><i class="fa fa-check"></i><b>9.1.3</b> Poisson GLM an R-INLA</a>
<ul>
<li class="chapter" data-level="9.1.3.1" data-path="Chapter10.html"><a href="Chapter10.html#checking-overdispersion"><i class="fa fa-check"></i><b>9.1.3.1</b> Checking overdispersion</a></li>
</ul></li>
<li class="chapter" data-level="9.1.4" data-path="Chapter10.html"><a href="Chapter10.html#negative-binomial-glm-in-r-inla"><i class="fa fa-check"></i><b>9.1.4</b> Negative binomial GLM in R-INLA</a></li>
<li class="chapter" data-level="9.1.5" data-path="Chapter10.html"><a href="Chapter10.html#model-selection-for-the-nb-glm"><i class="fa fa-check"></i><b>9.1.5</b> Model selection for the NB GLM</a></li>
<li class="chapter" data-level="9.1.6" data-path="Chapter10.html"><a href="Chapter10.html#visualization-of-the-nb-glm"><i class="fa fa-check"></i><b>9.1.6</b> Visualization of the NB GLM</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="Chapter10.html"><a href="Chapter10.html#bernoulli-and-binomial-glm"><i class="fa fa-check"></i><b>9.2</b> Bernoulli and binomial GLM</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="Chapter10.html"><a href="Chapter10.html#bernoulli-glm"><i class="fa fa-check"></i><b>9.2.1</b> Bernoulli GLM</a></li>
<li class="chapter" data-level="9.2.2" data-path="Chapter10.html"><a href="Chapter10.html#model-selection-with-the-marginal-likelihood"><i class="fa fa-check"></i><b>9.2.2</b> 10.2.2 Model selection with the marginal likelihood</a></li>
<li class="chapter" data-level="9.2.3" data-path="Chapter10.html"><a href="Chapter10.html#binomial-glm"><i class="fa fa-check"></i><b>9.2.3</b> Binomial GLM</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="Chapter10.html"><a href="Chapter10.html#gamma-glm"><i class="fa fa-check"></i><b>9.3</b> Gamma GLM</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Chapter11.html"><a href="Chapter11.html"><i class="fa fa-check"></i><b>10</b> Matern correlation and SPDE</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Chapter11.html"><a href="Chapter11.html#continuous-gaussian-field"><i class="fa fa-check"></i><b>10.1</b> Continuous Gaussian field</a></li>
<li class="chapter" data-level="10.2" data-path="Chapter11.html"><a href="Chapter11.html#models-that-we-have-in-mind"><i class="fa fa-check"></i><b>10.2</b> Models that we have in mind</a></li>
<li class="chapter" data-level="10.3" data-path="Chapter11.html"><a href="Chapter11.html#matern-correlation"><i class="fa fa-check"></i><b>10.3</b> Matern correlation</a></li>
<li class="chapter" data-level="10.4" data-path="Chapter11.html"><a href="Chapter11.html#spde-approach"><i class="fa fa-check"></i><b>10.4</b> SPDE approach</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="Chapter11.html"><a href="Chapter11.html#mesh"><i class="fa fa-check"></i><b>10.4.1</b> Mesh</a></li>
<li class="chapter" data-level="10.4.2" data-path="Chapter11.html"><a href="Chapter11.html#finite-element-approach"><i class="fa fa-check"></i><b>10.4.2</b> Finite element approach</a></li>
<li class="chapter" data-level="10.4.3" data-path="Chapter11.html"><a href="Chapter11.html#simulation-study-with-five-points"><i class="fa fa-check"></i><b>10.4.3</b> Simulation study with five points</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="Chapter11.html"><a href="Chapter11.html#weighting-factors-again"><i class="fa fa-check"></i><b>10.5</b> Weighting factors … again</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Chapter12.html"><a href="Chapter12.html"><i class="fa fa-check"></i><b>11</b> Linear regression model with spatial dependency for the Irish pH data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Chapter12.html"><a href="Chapter12.html#introduction-2"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="Chapter12.html"><a href="Chapter12.html#model-formulation-3"><i class="fa fa-check"></i><b>11.2</b> Model formulation</a></li>
<li class="chapter" data-level="11.3" data-path="Chapter12.html"><a href="Chapter12.html#linear-regression-results"><i class="fa fa-check"></i><b>11.3</b> Linear regression results</a></li>
<li class="chapter" data-level="11.4" data-path="Chapter12.html"><a href="Chapter12.html#model-validation-5"><i class="fa fa-check"></i><b>11.4</b> Model validation</a></li>
<li class="chapter" data-level="11.5" data-path="Chapter12.html"><a href="Chapter12.html#adding-spatial-correlation-to-the-model"><i class="fa fa-check"></i><b>11.5</b> Adding spatial correlation to the model</a></li>
<li class="chapter" data-level="11.6" data-path="Chapter12.html"><a href="Chapter12.html#defining-the-mesh-for-the-irish-ph-data"><i class="fa fa-check"></i><b>11.6</b> Defining the mesh for the Irish pH data</a></li>
<li class="chapter" data-level="11.7" data-path="Chapter12.html"><a href="Chapter12.html#define-the-weight-factor-aik"><i class="fa fa-check"></i><b>11.7</b> Define the weight factor aik</a></li>
<li class="chapter" data-level="11.8" data-path="Chapter12.html"><a href="Chapter12.html#define-the-spde"><i class="fa fa-check"></i><b>11.8</b> Define the SPDE</a></li>
<li class="chapter" data-level="11.9" data-path="Chapter12.html"><a href="Chapter12.html#define-the-spatial-field"><i class="fa fa-check"></i><b>11.9</b> Define the spatial field</a></li>
<li class="chapter" data-level="11.10" data-path="Chapter12.html"><a href="Chapter12.html#define-the-stack"><i class="fa fa-check"></i><b>11.10</b> Define the stack</a></li>
<li class="chapter" data-level="11.11" data-path="Chapter12.html"><a href="Chapter12.html#define-the-formula-for-the-spatial-model"><i class="fa fa-check"></i><b>11.11</b> Define the formula for the spatial model</a></li>
<li class="chapter" data-level="11.12" data-path="Chapter12.html"><a href="Chapter12.html#execute-the-spatial-model-in-r"><i class="fa fa-check"></i><b>11.12</b> Execute the spatial model in R</a></li>
<li class="chapter" data-level="11.13" data-path="Chapter12.html"><a href="Chapter12.html#results"><i class="fa fa-check"></i><b>11.13</b> Results</a></li>
<li class="chapter" data-level="11.14" data-path="Chapter12.html"><a href="Chapter12.html#model-selection-2"><i class="fa fa-check"></i><b>11.14</b> Model selection</a></li>
<li class="chapter" data-level="11.15" data-path="Chapter12.html"><a href="Chapter12.html#model-validation-6"><i class="fa fa-check"></i><b>11.15</b> Model validation</a></li>
<li class="chapter" data-level="11.16" data-path="Chapter12.html"><a href="Chapter12.html#model-interpretation-1"><i class="fa fa-check"></i><b>11.16</b> Model interpretation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to spatial-temporal data anlysis using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-regression-model-with-spatial-dependency-for-the-irish-ph-data" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">11</span> Linear regression model with spatial dependency for the Irish pH data<a href="Chapter12.html#linear-regression-model-with-spatial-dependency-for-the-irish-ph-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>本章では、前章で学んだ手法を実際の空間データに適用して分析を行う。</p>
<div id="introduction-2" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Introduction<a href="Chapter12.html#introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>用いるのは第<a href="Chapter2.html#c2">1</a>章で用いた、アイルランドの257の川において、川の<code>pH</code>が<code>SDI</code>(Sodium Dominance Index; 陽イオン中のナトリウムイオン)と関連しているかを、緯度(<code>Altitude</code>)やその場所が森林化されているか(<code>Forested</code>)も考慮したうえで調べた <span class="citation">Cruikshanks et al. (<a href="#ref-Cruikshanks2006">2006</a>)</span> のデータである。第<a href="Chapter2.html#c2">1</a>章では、地理的に近いデータほど類似しており、疑似反復の問題を避けるためには空間的相関を考慮したモデルを適用する必要があることを確認した。</p>
</div>
<div id="model-formulation-3" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Model formulation<a href="Chapter12.html#model-formulation-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>まず、空間的な相関を考慮しないモデルとして以下のモデルを考える。2次の交互作用項と3次の交互作用項をすべて含んでいる。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;pH_i \sim N(\mu_i, \sigma^2)\\
&amp;E(pH_i) = \mu_i \; and \; var(pH_i) = \sigma^2\\
&amp;\mu_i = \alpha + \beta_1 \times SDI_i + \beta_2 \times logAltitude_i + \beta_3 + Forested_i \\
&amp; \;\;\;\;\;\;\;\; + \beta_4 \times SDI_i \times LogAltitude_i + \beta_5 \times SDI_i \times Forested_i + \\
&amp; \;\;\;\;\;\;\;\; + \beta_6 \times LogAltitude_i \times Forested_i \\
&amp; \;\;\;\;\;\;\;\; + \beta_7 \times LogAltitude_i \times Forested_i
\end{aligned}
\]</span></p>
</div>
<div id="linear-regression-results" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Linear regression results<a href="Chapter12.html#linear-regression-results" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>それでは、<code>INLA</code>で上記のモデルを実行する。</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="Chapter12.html#cb319-1" tabindex="-1"></a>iph <span class="sc">%&gt;%</span> </span>
<span id="cb319-2"><a href="Chapter12.html#cb319-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logAlt =</span> <span class="fu">log10</span>(Altitude)) <span class="sc">%&gt;%</span> </span>
<span id="cb319-3"><a href="Chapter12.html#cb319-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fForested =</span> <span class="fu">fct_relevel</span>(fForested,<span class="st">&quot;yes&quot;</span>,<span class="st">&quot;no&quot;</span>))<span class="ot">-&gt;</span> iph</span>
<span id="cb319-4"><a href="Chapter12.html#cb319-4" tabindex="-1"></a></span>
<span id="cb319-5"><a href="Chapter12.html#cb319-5" tabindex="-1"></a>m12_1 <span class="ot">&lt;-</span> <span class="fu">inla</span>(pH <span class="sc">~</span> logAlt<span class="sc">*</span>SDI<span class="sc">*</span>fForested,</span>
<span id="cb319-6"><a href="Chapter12.html#cb319-6" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb319-7"><a href="Chapter12.html#cb319-7" tabindex="-1"></a>              <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb319-8"><a href="Chapter12.html#cb319-8" tabindex="-1"></a>              <span class="at">data =</span> iph)</span></code></pre></div>
<p>結果は以下の通り。3-way interactionは95%確信区間に0を含んでおり、</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="Chapter12.html#cb320-1" tabindex="-1"></a>m12_1<span class="sc">$</span>summary.fixed <span class="sc">%&gt;%</span> </span>
<span id="cb320-2"><a href="Chapter12.html#cb320-2" tabindex="-1"></a>  <span class="fu">select</span>(mean, sd, <span class="st">&quot;0.025quant&quot;</span>, <span class="st">&quot;0.975quant&quot;</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["0.025quant"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["0.975quant"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"8.251961408","2":"0.764594876","3":"6.75097836","4":"9.752981404","_rn_":"(Intercept)"},{"1":"0.105519318","2":"0.390053867","3":"-0.66021775","4":"0.871237590","_rn_":"logAlt"},{"1":"-0.028039422","2":"0.017161281","3":"-0.06172970","4":"0.005650075","_rn_":"SDI"},{"1":"1.785039908","2":"2.062506142","3":"-2.26402934","4":"5.833847933","_rn_":"fForestedyes"},{"1":"0.001777926","2":"0.008600042","3":"-0.01510491","4":"0.018661153","_rn_":"logAlt:SDI"},{"1":"-0.880867657","2":"1.008174320","3":"-2.85996723","4":"1.098359165","_rn_":"logAlt:fForestedyes"},{"1":"-0.008004224","2":"0.036972846","3":"-0.08058400","4":"0.064580069","_rn_":"SDI:fForestedyes"},{"1":"0.003493397","2":"0.017871602","3":"-0.03159175","4":"0.038576352","_rn_":"logAlt:SDI:fForestedyes"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br/></p>
<p>ハイパーパラメータの要約統計量は以下の通り。ここでは、<span class="math inline">\(\sigma\)</span>について情報を算出した。</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="Chapter12.html#cb321-1" tabindex="-1"></a>tau <span class="ot">&lt;-</span> m12_1<span class="sc">$</span>marginals.hyperpar<span class="sc">$</span><span class="st">`</span><span class="at">Precision for the Gaussian observations</span><span class="st">`</span></span>
<span id="cb321-2"><a href="Chapter12.html#cb321-2" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">inla.tmarginal</span>(<span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(x), tau)</span>
<span id="cb321-3"><a href="Chapter12.html#cb321-3" tabindex="-1"></a></span>
<span id="cb321-4"><a href="Chapter12.html#cb321-4" tabindex="-1"></a>sigma_summary <span class="ot">&lt;-</span> <span class="fu">inla.qmarginal</span>(<span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>), sigma) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">t</span>()</span>
<span id="cb321-5"><a href="Chapter12.html#cb321-5" tabindex="-1"></a><span class="fu">colnames</span>(sigma_summary) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;0.025quant&quot;</span>, <span class="st">&quot;0.5quant&quot;</span>, <span class="st">&quot;0.975quant&quot;</span>)</span>
<span id="cb321-6"><a href="Chapter12.html#cb321-6" tabindex="-1"></a></span>
<span id="cb321-7"><a href="Chapter12.html#cb321-7" tabindex="-1"></a>sigma_summary</span></code></pre></div>
<pre><code>##   0.025quant  0.5quant 0.975quant
## .  0.3408095 0.3743001  0.4136209</code></pre>
</div>
<div id="model-validation-5" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> Model validation<a href="Chapter12.html#model-validation-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>続いて、モデル診断を行う。</p>
<p>まず、残差と予測値、残差と共変量の関係を調べたら問題はなかった。これは第<a href="Chapter2.html#c2">1</a>と一緒である。</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="Chapter12.html#cb323-1" tabindex="-1"></a>fitted <span class="ot">&lt;-</span> m12_1<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb323-2"><a href="Chapter12.html#cb323-2" tabindex="-1"></a>resid <span class="ot">&lt;-</span> iph<span class="sc">$</span>pH <span class="sc">-</span> fitted</span>
<span id="cb323-3"><a href="Chapter12.html#cb323-3" tabindex="-1"></a></span>
<span id="cb323-4"><a href="Chapter12.html#cb323-4" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">fitted =</span> fitted,</span>
<span id="cb323-5"><a href="Chapter12.html#cb323-5" tabindex="-1"></a>           <span class="at">resid =</span> resid) <span class="sc">%&gt;%</span> </span>
<span id="cb323-6"><a href="Chapter12.html#cb323-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> fitted, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb323-7"><a href="Chapter12.html#cb323-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb323-8"><a href="Chapter12.html#cb323-8" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb323-9"><a href="Chapter12.html#cb323-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb323-10"><a href="Chapter12.html#cb323-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb323-11"><a href="Chapter12.html#cb323-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Fitted values&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>) <span class="ot">-&gt;</span> p1</span>
<span id="cb323-12"><a href="Chapter12.html#cb323-12" tabindex="-1"></a></span>
<span id="cb323-13"><a href="Chapter12.html#cb323-13" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">SDI =</span> iph<span class="sc">$</span>SDI,</span>
<span id="cb323-14"><a href="Chapter12.html#cb323-14" tabindex="-1"></a>           <span class="at">resid =</span> resid) <span class="sc">%&gt;%</span> </span>
<span id="cb323-15"><a href="Chapter12.html#cb323-15" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> SDI, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb323-16"><a href="Chapter12.html#cb323-16" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb323-17"><a href="Chapter12.html#cb323-17" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb323-18"><a href="Chapter12.html#cb323-18" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb323-19"><a href="Chapter12.html#cb323-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb323-20"><a href="Chapter12.html#cb323-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;SDI&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>) <span class="ot">-&gt;</span> p2</span>
<span id="cb323-21"><a href="Chapter12.html#cb323-21" tabindex="-1"></a></span>
<span id="cb323-22"><a href="Chapter12.html#cb323-22" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">SDI =</span> iph<span class="sc">$</span>logAlt,</span>
<span id="cb323-23"><a href="Chapter12.html#cb323-23" tabindex="-1"></a>           <span class="at">resid =</span> resid) <span class="sc">%&gt;%</span> </span>
<span id="cb323-24"><a href="Chapter12.html#cb323-24" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> SDI, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb323-25"><a href="Chapter12.html#cb323-25" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb323-26"><a href="Chapter12.html#cb323-26" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb323-27"><a href="Chapter12.html#cb323-27" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb323-28"><a href="Chapter12.html#cb323-28" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb323-29"><a href="Chapter12.html#cb323-29" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Log(Altitude)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>) <span class="ot">-&gt;</span> p3</span>
<span id="cb323-30"><a href="Chapter12.html#cb323-30" tabindex="-1"></a></span>
<span id="cb323-31"><a href="Chapter12.html#cb323-31" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">forested =</span> iph<span class="sc">$</span>fForested,</span>
<span id="cb323-32"><a href="Chapter12.html#cb323-32" tabindex="-1"></a>           <span class="at">resid =</span> resid) <span class="sc">%&gt;%</span> </span>
<span id="cb323-33"><a href="Chapter12.html#cb323-33" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> forested, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb323-34"><a href="Chapter12.html#cb323-34" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb323-35"><a href="Chapter12.html#cb323-35" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb323-36"><a href="Chapter12.html#cb323-36" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb323-37"><a href="Chapter12.html#cb323-37" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Forested&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>) <span class="ot">-&gt;</span> p4</span>
<span id="cb323-38"><a href="Chapter12.html#cb323-38" tabindex="-1"></a></span>
<span id="cb323-39"><a href="Chapter12.html#cb323-39" tabindex="-1"></a>(p1 <span class="sc">+</span> p2)<span class="sc">/</span>(p3<span class="sc">+</span>p4)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-234-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>続いて、バリオグラムを確認する。第<a href="Chapter2.html#c2">1</a>章で確認したときと同様、やはり空間的な相関が存在することがわかる。</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="Chapter12.html#cb324-1" tabindex="-1"></a>vario_12_1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">resid =</span> resid,</span>
<span id="cb324-2"><a href="Chapter12.html#cb324-2" tabindex="-1"></a>                        <span class="at">Easting.km =</span> iph<span class="sc">$</span>Easting<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb324-3"><a href="Chapter12.html#cb324-3" tabindex="-1"></a>                        <span class="at">Northing.km =</span> iph<span class="sc">$</span>Northing<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb324-4"><a href="Chapter12.html#cb324-4" tabindex="-1"></a></span>
<span id="cb324-5"><a href="Chapter12.html#cb324-5" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">coordinates</span>(vario_12_1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Easting.km&quot;</span>, <span class="st">&quot;Northing.km&quot;</span>)</span>
<span id="cb324-6"><a href="Chapter12.html#cb324-6" tabindex="-1"></a></span>
<span id="cb324-7"><a href="Chapter12.html#cb324-7" tabindex="-1"></a>vario_12_1 <span class="sc">%&gt;%</span> </span>
<span id="cb324-8"><a href="Chapter12.html#cb324-8" tabindex="-1"></a>  <span class="fu">variogram</span>(resid <span class="sc">~</span> Easting.km <span class="sc">+</span> Northing.km, <span class="at">data =</span> .,</span>
<span id="cb324-9"><a href="Chapter12.html#cb324-9" tabindex="-1"></a>            <span class="do">## 0が南北方向、90が東西方向</span></span>
<span id="cb324-10"><a href="Chapter12.html#cb324-10" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>),</span>
<span id="cb324-11"><a href="Chapter12.html#cb324-11" tabindex="-1"></a>            <span class="at">cressie =</span> <span class="cn">TRUE</span>,</span>
<span id="cb324-12"><a href="Chapter12.html#cb324-12" tabindex="-1"></a>            <span class="at">cutoff =</span> <span class="dv">150</span>,</span>
<span id="cb324-13"><a href="Chapter12.html#cb324-13" tabindex="-1"></a>            <span class="at">width =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb324-14"><a href="Chapter12.html#cb324-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> gamma))<span class="sc">+</span></span>
<span id="cb324-15"><a href="Chapter12.html#cb324-15" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> np))<span class="sc">+</span></span>
<span id="cb324-16"><a href="Chapter12.html#cb324-16" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb324-17"><a href="Chapter12.html#cb324-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb324-18"><a href="Chapter12.html#cb324-18" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span> dir.hor,</span>
<span id="cb324-19"><a href="Chapter12.html#cb324-19" tabindex="-1"></a>                 <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb324-20"><a href="Chapter12.html#cb324-20" tabindex="-1"></a>                 <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;North-South&quot;</span>,</span>
<span id="cb324-21"><a href="Chapter12.html#cb324-21" tabindex="-1"></a>                                          <span class="st">&quot;90&quot;</span> <span class="ot">=</span> <span class="st">&quot;East-West&quot;</span>)),</span>
<span id="cb324-22"><a href="Chapter12.html#cb324-22" tabindex="-1"></a>                 <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb324-23"><a href="Chapter12.html#cb324-23" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;semivariogram&quot;</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-235-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="adding-spatial-correlation-to-the-model" class="section level2 hasAnchor" number="11.5">
<h2><span class="header-section-number">11.5</span> Adding spatial correlation to the model<a href="Chapter12.html#adding-spatial-correlation-to-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>それでは、空間的な相関を考慮したモデルを実行する。モデル式は以下の通り。先ほどとの唯一の違いは<span class="math inline">\(u_i\)</span>が入っている点である。まず、<span class="math inline">\(u_i\)</span>は正規分布に従っており、ガウス場である。続いて、その分散共分散行列はマルコフ過程に従う(隣り合う観測値のみが相関する)。このとき、<span class="math inline">\(u_i\)</span>はガウスマルコフランダム場(GMRF)である。<span class="math inline">\(\bf{\Sigma}\)</span>はMatern関数を用いて表現される。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;pH_i \sim N(\mu_i, \sigma^2)\\
&amp;E(pH_i) = \mu_i \; and \; var(pH_i) = \sigma^2\\
&amp;\mu_i = \alpha + \beta_1 \times SDI_i + \beta_2 \times logAltitude_i + \beta_3 + Forested_i \\
&amp; \;\;\;\;\;\;\;\; + \beta_4 \times SDI_i \times LogAltitude_i + \beta_5 \times SDI_i \times Forested_i + \\
&amp; \;\;\;\;\;\;\;\; + \beta_6 \times LogAltitude_i \times Forested_i \\
&amp; \;\;\;\;\;\;\;\; + \beta_7 \times LogAltitude_i \times Forested_i + u_i\\
&amp;u_i \sim GMRF(0,\bf{\Sigma})
\end{aligned}
\]</span></p>
<p>Matern関数のパラメータは、確率偏微分方程式(SPDE)を解くことで求められる。これを解くため、サンプリング空間に多くの三角形から成るメッシュが作られる。最後に、有限要素アプローチ(finite element approach)で各頂点について<span class="math inline">\(w_k\)</span>が得られ、これをもとに<span class="math inline">\(u_i\)</span>の事後分布が得られる。</p>
<p><code>INLA</code>で上記のようなことを行うには、以下のステップを踏む。</p>
<ol style="list-style-type: decimal">
<li>メッシュを作成する。<br />
</li>
<li>各頂点の重みづけ因子<span class="math inline">\(a_{ik}\)</span>を定義する。<br />
</li>
<li>確率偏微分方程式(SPDE)を定義する。<br />
</li>
<li>ランダム場を定義する。<br />
</li>
<li>メッシュのどの点で応答変数と共変量を得たか、またランダム効果などがあればメッシュのどの点にあるかを<code>INLA</code>に伝える。<br />
</li>
<li>モデル式を決める。<br />
</li>
<li><code>INLA</code>で空間モデルを実行する。</li>
</ol>
</div>
<div id="defining-the-mesh-for-the-irish-ph-data" class="section level2 hasAnchor" number="11.6">
<h2><span class="header-section-number">11.6</span> Defining the mesh for the Irish pH data<a href="Chapter12.html#defining-the-mesh-for-the-irish-ph-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ここでは、アイルランドの河川データに対してメッシュを作成する。まず、データの座標をkmに直す。</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="Chapter12.html#cb325-1" tabindex="-1"></a>iph <span class="sc">%&gt;%</span> </span>
<span id="cb325-2"><a href="Chapter12.html#cb325-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Easting.km =</span> Easting<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb325-3"><a href="Chapter12.html#cb325-3" tabindex="-1"></a>         <span class="at">Northing.km =</span> Northing<span class="sc">/</span><span class="dv">1000</span>) <span class="ot">-&gt;</span> iph</span></code></pre></div>
<p>2つの場所間の距離<span class="math inline">\(||s_i - s_j||\)</span>のヒストグラムと、距離の累積割合を示したのが図<a href="Chapter12.html#fig:dist-iph">11.1</a>である。図<a href="Chapter12.html#fig:dist-iph">11.1</a>Bは、50%以上の観測値が200km以内でサンプリングされたことを示している。</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="Chapter12.html#cb326-1" tabindex="-1"></a>dist_iph <span class="ot">&lt;-</span> <span class="fu">dist</span>(<span class="fu">cbind</span>(iph<span class="sc">$</span>Easting.km, iph<span class="sc">$</span>Northing.km)) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb326-2"><a href="Chapter12.html#cb326-2" tabindex="-1"></a><span class="fu">diag</span>(dist_iph) <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb326-3"><a href="Chapter12.html#cb326-3" tabindex="-1"></a>dist_iph.vec <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(dist_iph) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb326-4"><a href="Chapter12.html#cb326-4" tabindex="-1"></a></span>
<span id="cb326-5"><a href="Chapter12.html#cb326-5" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">dist =</span> dist_iph.vec) <span class="sc">%&gt;%</span> </span>
<span id="cb326-6"><a href="Chapter12.html#cb326-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dist))<span class="sc">+</span></span>
<span id="cb326-7"><a href="Chapter12.html#cb326-7" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="dv">0</span>,</span>
<span id="cb326-8"><a href="Chapter12.html#cb326-8" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb326-9"><a href="Chapter12.html#cb326-9" tabindex="-1"></a>                 <span class="at">binwidth =</span> <span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb326-10"><a href="Chapter12.html#cb326-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb326-11"><a href="Chapter12.html#cb326-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb326-12"><a href="Chapter12.html#cb326-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;A&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Distances between sites&quot;</span>,</span>
<span id="cb326-13"><a href="Chapter12.html#cb326-13" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span>) <span class="ot">-&gt;</span> p1</span>
<span id="cb326-14"><a href="Chapter12.html#cb326-14" tabindex="-1"></a></span>
<span id="cb326-15"><a href="Chapter12.html#cb326-15" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">sort</span>(dist_iph.vec),</span>
<span id="cb326-16"><a href="Chapter12.html#cb326-16" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(dist_iph.vec)<span class="sc">/</span><span class="fu">length</span>(dist_iph.vec)) <span class="sc">%&gt;%</span> </span>
<span id="cb326-17"><a href="Chapter12.html#cb326-17" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb326-18"><a href="Chapter12.html#cb326-18" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb326-19"><a href="Chapter12.html#cb326-19" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb326-20"><a href="Chapter12.html#cb326-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb326-21"><a href="Chapter12.html#cb326-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;B&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Distances between sites&quot;</span>,</span>
<span id="cb326-22"><a href="Chapter12.html#cb326-22" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cumlutive proportion&quot;</span>) <span class="ot">-&gt;</span> p2</span>
<span id="cb326-23"><a href="Chapter12.html#cb326-23" tabindex="-1"></a></span>
<span id="cb326-24"><a href="Chapter12.html#cb326-24" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:dist-iph"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/dist-iph-1.png" alt="A: Histogram of distances between sites in the simulation study. B: Cumulative proportion versus distance between sites." width="960" />
<p class="caption">
図11.1: A: Histogram of distances between sites in the simulation study. B: Cumulative proportion versus distance between sites.
</p>
</div>
<p><br/></p>
<p>メッシュは以下のように作成する。<code>max.edge</code>はメッシュの内側と外側の辺の最大の長さをそれぞれ指定する。これが小さいほどメッシュ内の三角形の数は多くなる。作成したメッシュは図<a href="Chapter12.html#fig:mesh-iph">11.2</a>の1行目の一番左である。 　　</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="Chapter12.html#cb327-1" tabindex="-1"></a>mesh12_1 <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">loc =</span> <span class="fu">cbind</span>(iph<span class="sc">$</span>Easting.km, iph<span class="sc">$</span>Northing.km),</span>
<span id="cb327-2"><a href="Chapter12.html#cb327-2" tabindex="-1"></a>                         <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">10</span>),</span>
<span id="cb327-3"><a href="Chapter12.html#cb327-3" tabindex="-1"></a>                         <span class="at">cutoff =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>メッシュは太い線で内側と外側に分けられている(図<a href="Chapter12.html#fig:mesh-iph">11.2</a>)。メッシュは<span class="math inline">\(w_k\)</span>を計算するのに用いられ、アルゴリズムはその過程で近傍の情報を利用する。もし三角形が調査地の端に位置しているとすると、近傍の三角形が少なくなるので頂点の<span class="math inline">\(w_k\)</span>のばらつきが大きくなってしまう可能性がある。これを避けるため、メッシュの外側のエリアが使われる。このエリアは2つの太い線に囲われる領域で、サンプリングポイントが存在しない(図<a href="Chapter12.html#fig:mesh-iph">11.2</a>)。外側のエリアは内側のエリアに先ほどの問題が生じないようにする緩衝領域だと考えることができる。<code>offset</code>というオプションを用いると、外側と内側のエリアの範囲を調整することができる。一般的に、外側のエリアはレンジ(空間相関がなくなる距離)よりも広いことが推奨されている。</p>
<p><code>cutoff</code>オプションは、その距離より近いサンプリングポイント同士が1つの頂点に入れ替えられることを示す。以下、<code>max.edge</code>と<code>cutoff</code>に様々な値を割り当てたメッシュを作成し、図<a href="Chapter12.html#fig:mesh-iph">11.2</a>に示した。</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="Chapter12.html#cb328-1" tabindex="-1"></a>Loc <span class="ot">&lt;-</span> <span class="fu">cbind</span>(iph<span class="sc">$</span>Easting.km, iph<span class="sc">$</span>Northing.km)</span>
<span id="cb328-2"><a href="Chapter12.html#cb328-2" tabindex="-1"></a></span>
<span id="cb328-3"><a href="Chapter12.html#cb328-3" tabindex="-1"></a>mesh12_2 <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">loc =</span> Loc,</span>
<span id="cb328-4"><a href="Chapter12.html#cb328-4" tabindex="-1"></a>                         <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">10</span>),</span>
<span id="cb328-5"><a href="Chapter12.html#cb328-5" tabindex="-1"></a>                         <span class="at">cutoff =</span> <span class="dv">10</span>)</span>
<span id="cb328-6"><a href="Chapter12.html#cb328-6" tabindex="-1"></a></span>
<span id="cb328-7"><a href="Chapter12.html#cb328-7" tabindex="-1"></a>mesh12_3 <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">loc =</span> Loc,</span>
<span id="cb328-8"><a href="Chapter12.html#cb328-8" tabindex="-1"></a>                         <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">50</span>))</span>
<span id="cb328-9"><a href="Chapter12.html#cb328-9" tabindex="-1"></a></span>
<span id="cb328-10"><a href="Chapter12.html#cb328-10" tabindex="-1"></a>mesh12_4 <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">loc =</span> Loc,</span>
<span id="cb328-11"><a href="Chapter12.html#cb328-11" tabindex="-1"></a>                         <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="dv">75</span>,<span class="dv">75</span>),</span>
<span id="cb328-12"><a href="Chapter12.html#cb328-12" tabindex="-1"></a>                         <span class="at">cutoff =</span> <span class="dv">1</span>)</span>
<span id="cb328-13"><a href="Chapter12.html#cb328-13" tabindex="-1"></a></span>
<span id="cb328-14"><a href="Chapter12.html#cb328-14" tabindex="-1"></a>mesh12_5 <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">loc =</span> Loc,</span>
<span id="cb328-15"><a href="Chapter12.html#cb328-15" tabindex="-1"></a>                         <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">50</span>),</span>
<span id="cb328-16"><a href="Chapter12.html#cb328-16" tabindex="-1"></a>                         <span class="at">cutoff =</span> <span class="dv">1</span>)</span>
<span id="cb328-17"><a href="Chapter12.html#cb328-17" tabindex="-1"></a></span>
<span id="cb328-18"><a href="Chapter12.html#cb328-18" tabindex="-1"></a>mesh12_6 <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">loc =</span> Loc,</span>
<span id="cb328-19"><a href="Chapter12.html#cb328-19" tabindex="-1"></a>                         <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">80</span>),</span>
<span id="cb328-20"><a href="Chapter12.html#cb328-20" tabindex="-1"></a>                         <span class="at">cutoff =</span> <span class="dv">1</span>)</span>
<span id="cb328-21"><a href="Chapter12.html#cb328-21" tabindex="-1"></a></span>
<span id="cb328-22"><a href="Chapter12.html#cb328-22" tabindex="-1"></a>mesh12_7 <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">loc =</span> Loc,</span>
<span id="cb328-23"><a href="Chapter12.html#cb328-23" tabindex="-1"></a>                         <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">120</span>),</span>
<span id="cb328-24"><a href="Chapter12.html#cb328-24" tabindex="-1"></a>                         <span class="at">cutoff =</span> <span class="dv">1</span>)</span>
<span id="cb328-25"><a href="Chapter12.html#cb328-25" tabindex="-1"></a></span>
<span id="cb328-26"><a href="Chapter12.html#cb328-26" tabindex="-1"></a>mesh12_8 <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">loc =</span> Loc,</span>
<span id="cb328-27"><a href="Chapter12.html#cb328-27" tabindex="-1"></a>                         <span class="at">max.edge =</span> <span class="fu">c</span>(<span class="dv">150</span>,<span class="dv">150</span>),</span>
<span id="cb328-28"><a href="Chapter12.html#cb328-28" tabindex="-1"></a>                         <span class="at">cutoff =</span> <span class="dv">1</span>)</span>
<span id="cb328-29"><a href="Chapter12.html#cb328-29" tabindex="-1"></a></span>
<span id="cb328-30"><a href="Chapter12.html#cb328-30" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb328-31"><a href="Chapter12.html#cb328-31" tabindex="-1"></a></span>
<span id="cb328-32"><a href="Chapter12.html#cb328-32" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>){</span>
<span id="cb328-33"><a href="Chapter12.html#cb328-33" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="fu">get</span>(<span class="fu">paste</span>(<span class="st">&#39;mesh12_&#39;</span>, i, <span class="at">sep =</span> <span class="st">&#39;&#39;</span>)), <span class="at">main =</span> <span class="st">&quot;&quot;</span>,<span class="at">asp=</span><span class="dv">1</span>)</span>
<span id="cb328-34"><a href="Chapter12.html#cb328-34" tabindex="-1"></a>    <span class="fu">points</span>(Loc, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span>
<span id="cb328-35"><a href="Chapter12.html#cb328-35" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mesh-iph"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/mesh-iph-1.png" alt="Various meshes. Top row from left to right: meshes 1 to 3. Middle row from left to right: meshes 4 to 6. Bottom row from left to right: meshes 7 to 9." width="960" />
<p class="caption">
図11.2: Various meshes. Top row from left to right: meshes 1 to 3. Middle row from left to right: meshes 4 to 6. Bottom row from left to right: meshes 7 to 9.
</p>
</div>
<p><br/></p>
<p>各メッシュの頂点の数は以下の通り。</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="Chapter12.html#cb329-1" tabindex="-1"></a><span class="fu">c</span>(mesh12_1<span class="sc">$</span>n, mesh12_2<span class="sc">$</span>n, mesh12_3<span class="sc">$</span>n, mesh12_4<span class="sc">$</span>n, mesh12_5<span class="sc">$</span>n, mesh12_6<span class="sc">$</span>n, mesh12_7<span class="sc">$</span>n, mesh12_8<span class="sc">$</span>n)</span></code></pre></div>
<pre><code>## [1] 4982 4856  649  523  737  528  515  515</code></pre>
<p>他のアプローチとしては、すべてのサンプリングポイントが境界領域内にあるように境界領域を指定することである。</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="Chapter12.html#cb331-1" tabindex="-1"></a>bound <span class="ot">&lt;-</span> <span class="fu">inla.nonconvex.hull</span>(Loc)</span>
<span id="cb331-2"><a href="Chapter12.html#cb331-2" tabindex="-1"></a></span>
<span id="cb331-3"><a href="Chapter12.html#cb331-3" tabindex="-1"></a>mesh12_9 <span class="ot">&lt;-</span> <span class="fu">inla.mesh.2d</span>(<span class="at">loc =</span> Loc,</span>
<span id="cb331-4"><a href="Chapter12.html#cb331-4" tabindex="-1"></a>                         <span class="at">boundary =</span> bound,</span>
<span id="cb331-5"><a href="Chapter12.html#cb331-5" tabindex="-1"></a>                         <span class="at">max.edge =</span> <span class="dv">50</span>,</span>
<span id="cb331-6"><a href="Chapter12.html#cb331-6" tabindex="-1"></a>                         <span class="at">cutoff =</span> <span class="dv">5</span>)</span>
<span id="cb331-7"><a href="Chapter12.html#cb331-7" tabindex="-1"></a></span>
<span id="cb331-8"><a href="Chapter12.html#cb331-8" tabindex="-1"></a><span class="fu">plot</span>(mesh12_9, <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">asp=</span><span class="dv">1</span>)</span>
<span id="cb331-9"><a href="Chapter12.html#cb331-9" tabindex="-1"></a><span class="fu">points</span>(Loc, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-239-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>メッシュの選択には、確率偏微分方程式(SPDE)の近似の精度と計算時間のトレードオフがある。700-800の頂点しかない場合は計算が数秒で終わるが、4000-5000個あると数分かかる。一般的にはまず700-800の頂点を持つメッシュで最初の分析を行い、最終的な結果はより多くの頂点を持つメッシュで示す。ひとまず、ここでは737個の頂点があるメッシュ<code>mesh12_5</code>を用いて分析する。</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="Chapter12.html#cb332-1" tabindex="-1"></a><span class="fu">plot</span>(mesh12_5, <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">asp=</span><span class="dv">1</span>)</span>
<span id="cb332-2"><a href="Chapter12.html#cb332-2" tabindex="-1"></a><span class="fu">points</span>(Loc, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-240-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="define-the-weight-factor-aik" class="section level2 hasAnchor" number="11.7">
<h2><span class="header-section-number">11.7</span> Define the weight factor aik<a href="Chapter12.html#define-the-weight-factor-aik" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>メッシュ<code>mesh12_5</code>は737個の頂点があるので、分析の結果737個の<span class="math inline">\(w_k\)</span>(<span class="math inline">\(w_1,w_2,\dots, w_{731}\)</span>)の事後分布を得る。また、データは210個あるので、<span class="math inline">\(u_i\)</span>(<span class="math inline">\(u_1, u_2, \dots. u_{210}\)</span>)も201個ある。メッシュの種類によって各サンプリングポイントはメッシュの三角形内か頂点に配置されるが、今回選択したメッシュ(<code>mesh12_5</code>)では頂点にある。つまり今回の場合は<span class="math inline">\(s_i\)</span>がk番目の頂点にあるとき、<span class="math inline">\(u_i\)</span>は<span class="math inline">\(w_k\)</span>と一致する。一方で、もし<span class="math inline">\(s_i\)</span>が三角形内にあるのであれば、<span class="math inline">\(u_i\)</span>はその三角形の頂点<span class="math inline">\(w_k\)</span>の重みづけ平均になる(第<a href="Chapter11.html#c11">10</a>章、式<a href="Chapter11.html#eq:fma">(10.7)</a>参照)。</p>
<p><span class="math display" id="eq:fma3">\[
u_i = \Sigma_{k=1}^{731} a_{ik} \times w_k \tag{11.1}
\]</span></p>
<p><span class="math inline">\(a_{ik}\)</span>は重みづけ関数と呼ばれる。Rでは以下のように確認できる。例えば、<span class="math inline">\(a_{1k}\)</span>は以下のようになる。</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="Chapter12.html#cb333-1" tabindex="-1"></a>A12_5 <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.A</span>(mesh12_5, <span class="at">loc =</span> Loc)</span>
<span id="cb333-2"><a href="Chapter12.html#cb333-2" tabindex="-1"></a></span>
<span id="cb333-3"><a href="Chapter12.html#cb333-3" tabindex="-1"></a>A12_5[<span class="dv">1</span>,]</span></code></pre></div>
<pre><code>##   [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [38] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0
##  [75] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [112] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [149] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [186] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [223] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [260] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [297] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [334] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [371] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [408] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [445] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [482] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [519] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [556] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [593] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [630] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [667] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [704] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</code></pre>
</div>
<div id="define-the-spde" class="section level2 hasAnchor" number="11.8">
<h2><span class="header-section-number">11.8</span> Define the SPDE<a href="Chapter12.html#define-the-spde" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>空間相関を持つランダム切片<span class="math inline">\(u_i\)</span>で、その分散共分散行列がMatern関数で表現されるとき、SPDEは以下のように定義できる。<code>alpha = 2</code>はMatern関数のパラメータ<span class="math inline">\(\nu\)</span>が1であることを示す(式<a href="Chapter11.html#eq:SPDE2">(10.6)</a>を参照)。</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="Chapter12.html#cb335-1" tabindex="-1"></a>spde <span class="ot">&lt;-</span> <span class="fu">inla.spde2.matern</span>(mesh12_5, <span class="at">alpha =</span> <span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="define-the-spatial-field" class="section level2 hasAnchor" number="11.9">
<h2><span class="header-section-number">11.9</span> Define the spatial field<a href="Chapter12.html#define-the-spatial-field" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>続いて、ランダム切片の行列<span class="math inline">\(\bf{u}\)</span>を求めるためのリストを作成する。<span class="math inline">\(\bf{u}\)</span>は<span class="math inline">\(\bf{A}\)</span>と<span class="math inline">\(\bf{w}\)</span>を以下のように定義するとき、<span class="math inline">\(\bf{u} = \bf{A} \times \bf{w}\)</span>と書ける。<span class="math inline">\(\bf{w}\)</span>は<code>INLA</code>で推定する必要がある。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\bf{A} =
\begin{pmatrix}
a_{1,1} &amp; a_{1,2} &amp; \cdots &amp; a_{1,737} \\
\vdots &amp; \ddots &amp; &amp; \vdots \\
a_{210,1} &amp; a_{210,2} &amp; \cdots &amp; a_{210,737}
\end{pmatrix} \\
&amp;\bf{w} = (w_1, w_2, \dots, w_{737})
\end{aligned}
\]</span></p>
<p><span class="math inline">\(\bf{w}\)</span>は<code>INLA</code>で推定する必要がある。これは以下のようにできる。<code>w.index</code>中の<code>w</code>は1から737の数字を含む。<code>w.group</code>と<code>w.repl</code>については時空間モデルを実行するときに解説する。</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="Chapter12.html#cb336-1" tabindex="-1"></a>w.index <span class="ot">&lt;-</span> <span class="fu">inla.spde.make.index</span>(</span>
<span id="cb336-2"><a href="Chapter12.html#cb336-2" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">&#39;w&#39;</span>,</span>
<span id="cb336-3"><a href="Chapter12.html#cb336-3" tabindex="-1"></a>  <span class="at">n.spde =</span> spde<span class="sc">$</span>n.spde,</span>
<span id="cb336-4"><a href="Chapter12.html#cb336-4" tabindex="-1"></a>  <span class="at">n.group =</span> <span class="dv">1</span>,</span>
<span id="cb336-5"><a href="Chapter12.html#cb336-5" tabindex="-1"></a>  <span class="at">n.repl =</span> <span class="dv">1</span>)</span>
<span id="cb336-6"><a href="Chapter12.html#cb336-6" tabindex="-1"></a></span>
<span id="cb336-7"><a href="Chapter12.html#cb336-7" tabindex="-1"></a><span class="fu">str</span>(w.index)</span></code></pre></div>
<pre><code>## List of 3
##  $ w      : int [1:737] 1 2 3 4 5 6 7 8 9 10 ...
##  $ w.group: int [1:737] 1 1 1 1 1 1 1 1 1 1 ...
##  $ w.repl : int [1:737] 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div id="define-the-stack" class="section level2 hasAnchor" number="11.10">
<h2><span class="header-section-number">11.10</span> Define the stack<a href="Chapter12.html#define-the-stack" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>続いて、メッシュのどの点で応答変数と共変量を得たかを<code>INLA</code>に伝える必要がある。Rでは、<code>inla.stack</code>関数を用いてこれを行う。これについて理解するため、まずモデルをマトリックス形式で書く。</p>
<p><span class="math display">\[
\mu_i = \alpha + \Sigma_{j = 1}^7 \beta_j X_{ij} + u_i
\]</span></p>
<p><span class="math inline">\(X_{ij}\)</span>は交互作用項を含む説明変数(<span class="math inline">\(SDI_i,LogAltitude_i, \dots, SDI_i \times LogAltitude_i \times Forested_i\)</span>)を含む。また、式<a href="Chapter12.html#eq:fma3">(11.1)</a>よりこの式は以下のように変形できる。</p>
<p><span class="math display">\[
\mu_i = \alpha + \Sigma_{j = 1}^7 \beta_j X_{ij} + \Sigma_{k=1}^{731} a_{ik} \times w_k
\]</span></p>
<p>行列式で書くと以下のように書ける。<br />
<span class="math display" id="eq:m12-2">\[
\bf{X} = 1 \times \alpha + \bf{X \times \beta} + \bf{A \times w} \tag{11.2}
\]</span></p>
<p>ハイパーパラメータは<code>pH</code>が得られる正規分布の標準偏差<span class="math inline">\(\sigma\)</span>、Matern関数の<span class="math inline">\(\kappa\)</span>と<span class="math inline">\(u_i\)</span>の分散共分散行列の<span class="math inline">\(\sigma_u\)</span>、そして<span class="math inline">\(\bf{w}\)</span>である。式<a href="Chapter12.html#eq:m12-2">(11.2)</a>を実行するためには、<code>INLA</code>に<code>inla.stack</code>関数で3つの要素を与える必要がある。</p>
<p>一つ目は共変量を含む行列<span class="math inline">\(\bf{X}\)</span>で、以下のように作成する。</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="Chapter12.html#cb338-1" tabindex="-1"></a>Xm <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> logAlt <span class="sc">*</span> SDI <span class="sc">*</span> fForested, </span>
<span id="cb338-2"><a href="Chapter12.html#cb338-2" tabindex="-1"></a>                   <span class="at">data =</span> iph)</span>
<span id="cb338-3"><a href="Chapter12.html#cb338-3" tabindex="-1"></a></span>
<span id="cb338-4"><a href="Chapter12.html#cb338-4" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Alt          =</span> Xm[,<span class="dv">2</span>],</span>
<span id="cb338-5"><a href="Chapter12.html#cb338-5" tabindex="-1"></a>                <span class="at">SDI          =</span> Xm[,<span class="dv">3</span>],</span>
<span id="cb338-6"><a href="Chapter12.html#cb338-6" tabindex="-1"></a>                <span class="at">fFor         =</span> Xm[,<span class="dv">4</span>],</span>
<span id="cb338-7"><a href="Chapter12.html#cb338-7" tabindex="-1"></a>                <span class="at">Alt.SDI      =</span> Xm[,<span class="dv">5</span>],</span>
<span id="cb338-8"><a href="Chapter12.html#cb338-8" tabindex="-1"></a>                <span class="at">Alt.fFor     =</span> Xm[,<span class="dv">6</span>],</span>
<span id="cb338-9"><a href="Chapter12.html#cb338-9" tabindex="-1"></a>                <span class="at">SDI.fFor     =</span> Xm[,<span class="dv">7</span>],</span>
<span id="cb338-10"><a href="Chapter12.html#cb338-10" tabindex="-1"></a>                <span class="at">Alt.SDI.fFor =</span> Xm[,<span class="dv">8</span>])</span></code></pre></div>
<p>それでは、<code>inla.stack</code>関数で<code>INLA</code>に情報を与える。これで作られたオブジェクトは”stack”といわれる。<code>A</code>のリストはガウス場への射影行列で、<code>effects</code>の各要素に対応している。</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="Chapter12.html#cb339-1" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(iph)</span>
<span id="cb339-2"><a href="Chapter12.html#cb339-2" tabindex="-1"></a></span>
<span id="cb339-3"><a href="Chapter12.html#cb339-3" tabindex="-1"></a>StackFit <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(</span>
<span id="cb339-4"><a href="Chapter12.html#cb339-4" tabindex="-1"></a>             <span class="at">tag =</span> <span class="st">&quot;Fit&quot;</span>,</span>
<span id="cb339-5"><a href="Chapter12.html#cb339-5" tabindex="-1"></a>             <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> iph<span class="sc">$</span>pH),  </span>
<span id="cb339-6"><a href="Chapter12.html#cb339-6" tabindex="-1"></a>               <span class="at">A =</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">1</span>, A12_5),                  </span>
<span id="cb339-7"><a href="Chapter12.html#cb339-7" tabindex="-1"></a>               <span class="at">effects =</span> <span class="fu">list</span>(   </span>
<span id="cb339-8"><a href="Chapter12.html#cb339-8" tabindex="-1"></a>                  <span class="at">Intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>, N),</span>
<span id="cb339-9"><a href="Chapter12.html#cb339-9" tabindex="-1"></a>                  <span class="at">X =</span> X,</span>
<span id="cb339-10"><a href="Chapter12.html#cb339-10" tabindex="-1"></a>                  <span class="at">w =</span> w.index))</span></code></pre></div>
</div>
<div id="define-the-formula-for-the-spatial-model" class="section level2 hasAnchor" number="11.11">
<h2><span class="header-section-number">11.11</span> Define the formula for the spatial model<a href="Chapter12.html#define-the-formula-for-the-spatial-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>それでは、以下で空間相関のあるモデルとないモデルをフィットする。煩雑になるので、モデル式はあらかじめ作っておく。</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="Chapter12.html#cb340-1" tabindex="-1"></a><span class="do">## 空間相関なし</span></span>
<span id="cb340-2"><a href="Chapter12.html#cb340-2" tabindex="-1"></a>f2a <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Alt  <span class="sc">+</span> SDI <span class="sc">+</span> fFor <span class="sc">+</span> </span>
<span id="cb340-3"><a href="Chapter12.html#cb340-3" tabindex="-1"></a>           Alt.SDI <span class="sc">+</span> Alt.fFor <span class="sc">+</span> SDI.fFor <span class="sc">+</span> </span>
<span id="cb340-4"><a href="Chapter12.html#cb340-4" tabindex="-1"></a>           Alt.SDI.fFor</span>
<span id="cb340-5"><a href="Chapter12.html#cb340-5" tabindex="-1"></a></span>
<span id="cb340-6"><a href="Chapter12.html#cb340-6" tabindex="-1"></a><span class="do">## 空間相関あり</span></span>
<span id="cb340-7"><a href="Chapter12.html#cb340-7" tabindex="-1"></a>f2b <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Alt  <span class="sc">+</span> SDI <span class="sc">+</span> fFor <span class="sc">+</span> </span>
<span id="cb340-8"><a href="Chapter12.html#cb340-8" tabindex="-1"></a>           Alt.SDI <span class="sc">+</span> Alt.fFor <span class="sc">+</span> SDI.fFor <span class="sc">+</span> </span>
<span id="cb340-9"><a href="Chapter12.html#cb340-9" tabindex="-1"></a>           Alt.SDI.fFor <span class="sc">+</span> <span class="fu">f</span>(w, <span class="at">model =</span> spde)</span></code></pre></div>
</div>
<div id="execute-the-spatial-model-in-r" class="section level2 hasAnchor" number="11.12">
<h2><span class="header-section-number">11.12</span> Execute the spatial model in R<a href="Chapter12.html#execute-the-spatial-model-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>それでは、モデルを実行する。</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="Chapter12.html#cb341-1" tabindex="-1"></a>m12_2a <span class="ot">&lt;-</span> <span class="fu">inla</span>(f2a,</span>
<span id="cb341-2"><a href="Chapter12.html#cb341-2" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb341-3"><a href="Chapter12.html#cb341-3" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">inla.stack.data</span>(StackFit),</span>
<span id="cb341-4"><a href="Chapter12.html#cb341-4" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb341-5"><a href="Chapter12.html#cb341-5" tabindex="-1"></a>                                      <span class="at">waic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb341-6"><a href="Chapter12.html#cb341-6" tabindex="-1"></a>               <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">inla.stack.A</span>(StackFit)))</span>
<span id="cb341-7"><a href="Chapter12.html#cb341-7" tabindex="-1"></a></span>
<span id="cb341-8"><a href="Chapter12.html#cb341-8" tabindex="-1"></a>m12_2b <span class="ot">&lt;-</span> <span class="fu">inla</span>(f2b,</span>
<span id="cb341-9"><a href="Chapter12.html#cb341-9" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb341-10"><a href="Chapter12.html#cb341-10" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">inla.stack.data</span>(StackFit),</span>
<span id="cb341-11"><a href="Chapter12.html#cb341-11" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb341-12"><a href="Chapter12.html#cb341-12" tabindex="-1"></a>                                      <span class="at">waic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb341-13"><a href="Chapter12.html#cb341-13" tabindex="-1"></a>               <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">inla.stack.A</span>(StackFit)))</span></code></pre></div>
<p>DICとWAICを用いてモデル比較を行うと、空間相関を考慮した方がはるかにいいことが分かる。</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="Chapter12.html#cb342-1" tabindex="-1"></a>waic12_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(m12_2a<span class="sc">$</span>waic<span class="sc">$</span>waic, m12_2b<span class="sc">$</span>waic<span class="sc">$</span>waic)</span>
<span id="cb342-2"><a href="Chapter12.html#cb342-2" tabindex="-1"></a>dic12_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(m12_2a<span class="sc">$</span>dic<span class="sc">$</span>dic, m12_2b<span class="sc">$</span>dic<span class="sc">$</span>dic)</span>
<span id="cb342-3"><a href="Chapter12.html#cb342-3" tabindex="-1"></a>modelcomp12_2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(waic12_2, dic12_2)</span>
<span id="cb342-4"><a href="Chapter12.html#cb342-4" tabindex="-1"></a><span class="fu">rownames</span>(modelcomp12_2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Gaussian lm&quot;</span>, <span class="st">&quot;Gaussian lm + SPDE&quot;</span>)</span>
<span id="cb342-5"><a href="Chapter12.html#cb342-5" tabindex="-1"></a></span>
<span id="cb342-6"><a href="Chapter12.html#cb342-6" tabindex="-1"></a>modelcomp12_2</span></code></pre></div>
<pre><code>##                    waic12_2  dic12_2
## Gaussian lm        196.9916 194.5744
## Gaussian lm + SPDE 127.7375 124.2912</code></pre>
</div>
<div id="results" class="section level2 hasAnchor" number="11.13">
<h2><span class="header-section-number">11.13</span> Results<a href="Chapter12.html#results" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ハイパーパラメータ以外の結果は以下の通り。</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="Chapter12.html#cb344-1" tabindex="-1"></a>m12_2a<span class="sc">$</span>summary.fixed[,<span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;sd&quot;</span>,<span class="st">&quot;0.025quant&quot;</span>,<span class="st">&quot;0.975quant&quot;</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb344-2"><a href="Chapter12.html#cb344-2" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span><span class="fu">round</span>(.,<span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb344-3"><a href="Chapter12.html#cb344-3" tabindex="-1"></a>  <span class="fu">bind_cols</span>(m12_2b<span class="sc">$</span>summary.fixed[,<span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;sd&quot;</span>,<span class="st">&quot;0.025quant&quot;</span>,<span class="st">&quot;0.975quant&quot;</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb344-4"><a href="Chapter12.html#cb344-4" tabindex="-1"></a>              <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span><span class="fu">round</span>(.,<span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb344-5"><a href="Chapter12.html#cb344-5" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="st">&quot; mean&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot; sd&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot; 0.025quant&quot;</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">&quot; 0.975quanr&quot;</span> <span class="ot">=</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb344-6"><a href="Chapter12.html#cb344-6" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">align =</span> <span class="st">&quot;lcccccccc&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb344-7"><a href="Chapter12.html#cb344-7" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;空間相関なし&quot;</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">&quot;空間相関有り&quot;</span> <span class="ot">=</span> <span class="dv">4</span>)) </span></code></pre></div>
<table>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
空間相関なし
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
空間相関有り
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
mean
</th>
<th style="text-align:center;">
sd
</th>
<th style="text-align:center;">
0.025quant
</th>
<th style="text-align:center;">
0.975quant
</th>
<th style="text-align:center;">
mean
</th>
<th style="text-align:center;">
sd
</th>
<th style="text-align:center;">
0.025quant
</th>
<th style="text-align:center;">
0.975quanr
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:left;">
8.247
</td>
<td style="text-align:center;">
0.764
</td>
<td style="text-align:center;">
6.747
</td>
<td style="text-align:center;">
9.748
</td>
<td style="text-align:center;">
8.928
</td>
<td style="text-align:center;">
0.706
</td>
<td style="text-align:center;">
7.541
</td>
<td style="text-align:center;">
10.312
</td>
</tr>
<tr>
<td style="text-align:left;">
Alt
</td>
<td style="text-align:left;">
0.108
</td>
<td style="text-align:center;">
0.390
</td>
<td style="text-align:center;">
-0.658
</td>
<td style="text-align:center;">
0.873
</td>
<td style="text-align:center;">
-0.245
</td>
<td style="text-align:center;">
0.350
</td>
<td style="text-align:center;">
-0.932
</td>
<td style="text-align:center;">
0.443
</td>
</tr>
<tr>
<td style="text-align:left;">
SDI
</td>
<td style="text-align:left;">
-0.028
</td>
<td style="text-align:center;">
0.017
</td>
<td style="text-align:center;">
-0.062
</td>
<td style="text-align:center;">
0.006
</td>
<td style="text-align:center;">
-0.044
</td>
<td style="text-align:center;">
0.016
</td>
<td style="text-align:center;">
-0.076
</td>
<td style="text-align:center;">
-0.012
</td>
</tr>
<tr>
<td style="text-align:left;">
fFor
</td>
<td style="text-align:left;">
1.790
</td>
<td style="text-align:center;">
2.062
</td>
<td style="text-align:center;">
-2.259
</td>
<td style="text-align:center;">
5.839
</td>
<td style="text-align:center;">
0.852
</td>
<td style="text-align:center;">
1.775
</td>
<td style="text-align:center;">
-2.633
</td>
<td style="text-align:center;">
4.336
</td>
</tr>
<tr>
<td style="text-align:left;">
Alt.SDI
</td>
<td style="text-align:left;">
0.002
</td>
<td style="text-align:center;">
0.009
</td>
<td style="text-align:center;">
-0.015
</td>
<td style="text-align:center;">
0.019
</td>
<td style="text-align:center;">
0.010
</td>
<td style="text-align:center;">
0.008
</td>
<td style="text-align:center;">
-0.005
</td>
<td style="text-align:center;">
0.026
</td>
</tr>
<tr>
<td style="text-align:left;">
Alt.fFor
</td>
<td style="text-align:left;">
-0.883
</td>
<td style="text-align:center;">
1.008
</td>
<td style="text-align:center;">
-2.862
</td>
<td style="text-align:center;">
1.096
</td>
<td style="text-align:center;">
-0.335
</td>
<td style="text-align:center;">
0.873
</td>
<td style="text-align:center;">
-2.048
</td>
<td style="text-align:center;">
1.379
</td>
</tr>
<tr>
<td style="text-align:left;">
SDI.fFor
</td>
<td style="text-align:left;">
-0.008
</td>
<td style="text-align:center;">
0.037
</td>
<td style="text-align:center;">
-0.081
</td>
<td style="text-align:center;">
0.064
</td>
<td style="text-align:center;">
0.006
</td>
<td style="text-align:center;">
0.032
</td>
<td style="text-align:center;">
-0.057
</td>
<td style="text-align:center;">
0.068
</td>
</tr>
<tr>
<td style="text-align:left;">
Alt.SDI.fFor
</td>
<td style="text-align:left;">
0.004
</td>
<td style="text-align:center;">
0.018
</td>
<td style="text-align:center;">
-0.032
</td>
<td style="text-align:center;">
0.039
</td>
<td style="text-align:center;">
-0.005
</td>
<td style="text-align:center;">
0.015
</td>
<td style="text-align:center;">
-0.035
</td>
<td style="text-align:center;">
0.025
</td>
</tr>
</tbody>
</table>
<p><br/></p>
<p>事後平均と95%確信区間を図示すると以下のようになる。そこまで大きい違いはないので、空間的相関を表すランダム効果の効果はそこまで大きくないのかもしれない。</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="Chapter12.html#cb345-1" tabindex="-1"></a>m12_2a<span class="sc">$</span>summary.fixed[,<span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;0.025quant&quot;</span>,<span class="st">&quot;0.975quant&quot;</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb345-2"><a href="Chapter12.html#cb345-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;m12_2a&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb345-3"><a href="Chapter12.html#cb345-3" tabindex="-1"></a>  <span class="fu">rownames_as_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb345-4"><a href="Chapter12.html#cb345-4" tabindex="-1"></a>  <span class="fu">bind_rows</span>(m12_2b<span class="sc">$</span>summary.fixed[,<span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;0.025quant&quot;</span>,<span class="st">&quot;0.975quant&quot;</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb345-5"><a href="Chapter12.html#cb345-5" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;m12_2b&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb345-6"><a href="Chapter12.html#cb345-6" tabindex="-1"></a>              <span class="fu">rownames_as_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb345-7"><a href="Chapter12.html#cb345-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> mean))<span class="sc">+</span></span>
<span id="cb345-8"><a href="Chapter12.html#cb345-8" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="st">`</span><span class="at">0.025quant</span><span class="st">`</span>, <span class="at">ymax =</span> <span class="st">`</span><span class="at">0.975quant</span><span class="st">`</span>),</span>
<span id="cb345-9"><a href="Chapter12.html#cb345-9" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb345-10"><a href="Chapter12.html#cb345-10" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb345-11"><a href="Chapter12.html#cb345-11" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span> <span class="dv">0</span>,</span>
<span id="cb345-12"><a href="Chapter12.html#cb345-12" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb345-13"><a href="Chapter12.html#cb345-13" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>parameter, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb345-14"><a href="Chapter12.html#cb345-14" tabindex="-1"></a>                 <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-250-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>続いて、ハイパーパラメータの結果を見ていく。推定の結果、<span class="math inline">\(\kappa\)</span>と<span class="math inline">\(\sigma_u\)</span>の事後平均はそれぞれ0.0319と0.2804であることが分かった。レンジの事後平均は105.61である。</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="Chapter12.html#cb346-1" tabindex="-1"></a>SpFi.w <span class="ot">&lt;-</span> <span class="fu">inla.spde2.result</span>(<span class="at">inla =</span> m12_2b,</span>
<span id="cb346-2"><a href="Chapter12.html#cb346-2" tabindex="-1"></a>                          <span class="at">name =</span> <span class="st">&quot;w&quot;</span>,</span>
<span id="cb346-3"><a href="Chapter12.html#cb346-3" tabindex="-1"></a>                          <span class="at">spde =</span> spde,</span>
<span id="cb346-4"><a href="Chapter12.html#cb346-4" tabindex="-1"></a>                          <span class="at">do.transfer =</span> <span class="cn">TRUE</span>)</span>
<span id="cb346-5"><a href="Chapter12.html#cb346-5" tabindex="-1"></a></span>
<span id="cb346-6"><a href="Chapter12.html#cb346-6" tabindex="-1"></a><span class="do">## Kappa</span></span>
<span id="cb346-7"><a href="Chapter12.html#cb346-7" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="fu">inla.emarginal</span>(<span class="cf">function</span>(x) x, SpFi.w<span class="sc">$</span>marginals.kappa[[<span class="dv">1</span>]])</span>
<span id="cb346-8"><a href="Chapter12.html#cb346-8" tabindex="-1"></a>kappa</span></code></pre></div>
<pre><code>## [1] 0.03180548</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="Chapter12.html#cb348-1" tabindex="-1"></a><span class="do">##sigma</span></span>
<span id="cb348-2"><a href="Chapter12.html#cb348-2" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">inla.emarginal</span>(<span class="cf">function</span>(x) <span class="fu">sqrt</span>(x), SpFi.w<span class="sc">$</span>marginals.variance.nominal[[<span class="dv">1</span>]])  </span>
<span id="cb348-3"><a href="Chapter12.html#cb348-3" tabindex="-1"></a>sigma</span></code></pre></div>
<pre><code>## [1] 0.2804851</code></pre>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="Chapter12.html#cb350-1" tabindex="-1"></a><span class="do">## range  </span></span>
<span id="cb350-2"><a href="Chapter12.html#cb350-2" tabindex="-1"></a>range <span class="ot">=</span> <span class="fu">inla.emarginal</span>(<span class="cf">function</span>(x) x, SpFi.w<span class="sc">$</span>marginals.range.nominal[[<span class="dv">1</span>]])</span>
<span id="cb350-3"><a href="Chapter12.html#cb350-3" tabindex="-1"></a>range</span></code></pre></div>
<pre><code>## [1] 105.7647</code></pre>
<p><span class="math inline">\(\kappa\)</span>が分かればMatern関数を描写することができる。</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="Chapter12.html#cb352-1" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">dist</span>(mesh12_5<span class="sc">$</span>loc[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]))</span>
<span id="cb352-2"><a href="Chapter12.html#cb352-2" tabindex="-1"></a>d.vec <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(D), <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb352-3"><a href="Chapter12.html#cb352-3" tabindex="-1"></a>corM <span class="ot">&lt;-</span> (kappa<span class="sc">*</span>d.vec)<span class="sc">*</span><span class="fu">besselK</span>(kappa<span class="sc">*</span>d.vec,<span class="dv">1</span>)</span>
<span id="cb352-4"><a href="Chapter12.html#cb352-4" tabindex="-1"></a>corM[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb352-5"><a href="Chapter12.html#cb352-5" tabindex="-1"></a></span>
<span id="cb352-6"><a href="Chapter12.html#cb352-6" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Distance =</span> d.vec,</span>
<span id="cb352-7"><a href="Chapter12.html#cb352-7" tabindex="-1"></a>           <span class="at">Correlation =</span> corM) <span class="sc">%&gt;%</span> </span>
<span id="cb352-8"><a href="Chapter12.html#cb352-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Distance, <span class="at">y =</span> Correlation))<span class="sc">+</span></span>
<span id="cb352-9"><a href="Chapter12.html#cb352-9" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb352-10"><a href="Chapter12.html#cb352-10" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> range,</span>
<span id="cb352-11"><a href="Chapter12.html#cb352-11" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb352-12"><a href="Chapter12.html#cb352-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb352-13"><a href="Chapter12.html#cb352-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-252-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p><span class="math inline">\(w_k\)</span>の事後平均は以下のように求めることができる。</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="Chapter12.html#cb353-1" tabindex="-1"></a>w.pm <span class="ot">&lt;-</span> m12_2b<span class="sc">$</span>summary.random<span class="sc">$</span>w<span class="sc">$</span>mean</span></code></pre></div>
<p>この<span class="math inline">\(w_k\)</span>の事後平均をランダムガウス場に図示することができる。</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="Chapter12.html#cb354-1" tabindex="-1"></a>w.proj <span class="ot">&lt;-</span> <span class="fu">inla.mesh.projector</span>(mesh12_5)</span>
<span id="cb354-2"><a href="Chapter12.html#cb354-2" tabindex="-1"></a></span>
<span id="cb354-3"><a href="Chapter12.html#cb354-3" tabindex="-1"></a>w.pm100_100 <span class="ot">&lt;-</span><span class="fu">inla.mesh.project</span>(w.proj, w.pm)</span>
<span id="cb354-4"><a href="Chapter12.html#cb354-4" tabindex="-1"></a></span>
<span id="cb354-5"><a href="Chapter12.html#cb354-5" tabindex="-1"></a><span class="fu">expand.grid</span>(<span class="at">x =</span> w.proj<span class="sc">$</span>x,</span>
<span id="cb354-6"><a href="Chapter12.html#cb354-6" tabindex="-1"></a>           <span class="at">y =</span> w.proj<span class="sc">$</span>y) <span class="sc">%&gt;%</span> </span>
<span id="cb354-7"><a href="Chapter12.html#cb354-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">z =</span> <span class="fu">as.vector</span>(w.pm100_100)) <span class="ot">-&gt;</span> grid</span>
<span id="cb354-8"><a href="Chapter12.html#cb354-8" tabindex="-1"></a></span>
<span id="cb354-9"><a href="Chapter12.html#cb354-9" tabindex="-1"></a><span class="fu">ggplot</span>(grid,</span>
<span id="cb354-10"><a href="Chapter12.html#cb354-10" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb354-11"><a href="Chapter12.html#cb354-11" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">fill =</span> z))<span class="sc">+</span></span>
<span id="cb354-12"><a href="Chapter12.html#cb354-12" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">high =</span> <span class="fu">muted</span>(<span class="st">&quot;lightblue&quot;</span>), <span class="at">low =</span> <span class="fu">muted</span>(<span class="st">&quot;pink&quot;</span>), <span class="at">mid =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb354-13"><a href="Chapter12.html#cb354-13" tabindex="-1"></a>                       <span class="at">midpoint =</span> <span class="sc">-</span><span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb354-14"><a href="Chapter12.html#cb354-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Easting.km, <span class="at">y =</span> Northing.km),</span>
<span id="cb354-15"><a href="Chapter12.html#cb354-15" tabindex="-1"></a>             <span class="at">data =</span> iph,</span>
<span id="cb354-16"><a href="Chapter12.html#cb354-16" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb354-17"><a href="Chapter12.html#cb354-17" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb354-18"><a href="Chapter12.html#cb354-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb354-19"><a href="Chapter12.html#cb354-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Easting(km)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Northing(km)&quot;</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-254-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="model-selection-2" class="section level2 hasAnchor" number="11.14">
<h2><span class="header-section-number">11.14</span> Model selection<a href="Chapter12.html#model-selection-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>WAICとDICを用いて、モデルに改善が見られなくなるまで1つずつ説明変数/交互作用項を除いていくという作業(<code>step</code>関数と同じ作業)を行っていく。まず、3次の交互作用項と2次の交互作用項を一つずつ除いたものを比較する。</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="Chapter12.html#cb355-1" tabindex="-1"></a><span class="do">## 3-way interractionなし  </span></span>
<span id="cb355-2"><a href="Chapter12.html#cb355-2" tabindex="-1"></a>f2c <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Alt  <span class="sc">+</span> SDI <span class="sc">+</span> fFor <span class="sc">+</span> </span>
<span id="cb355-3"><a href="Chapter12.html#cb355-3" tabindex="-1"></a>           Alt.SDI <span class="sc">+</span> Alt.fFor <span class="sc">+</span> SDI.fFor <span class="sc">+</span> <span class="fu">f</span>(w, <span class="at">model =</span> spde)</span>
<span id="cb355-4"><a href="Chapter12.html#cb355-4" tabindex="-1"></a></span>
<span id="cb355-5"><a href="Chapter12.html#cb355-5" tabindex="-1"></a>Xc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Alt          =</span> Xm[,<span class="dv">2</span>],</span>
<span id="cb355-6"><a href="Chapter12.html#cb355-6" tabindex="-1"></a>                <span class="at">SDI          =</span> Xm[,<span class="dv">3</span>],</span>
<span id="cb355-7"><a href="Chapter12.html#cb355-7" tabindex="-1"></a>                <span class="at">fFor         =</span> Xm[,<span class="dv">4</span>],</span>
<span id="cb355-8"><a href="Chapter12.html#cb355-8" tabindex="-1"></a>                <span class="at">Alt.SDI      =</span> Xm[,<span class="dv">5</span>],</span>
<span id="cb355-9"><a href="Chapter12.html#cb355-9" tabindex="-1"></a>                <span class="at">Alt.fFor     =</span> Xm[,<span class="dv">6</span>],</span>
<span id="cb355-10"><a href="Chapter12.html#cb355-10" tabindex="-1"></a>                <span class="at">SDI.fFor     =</span> Xm[,<span class="dv">7</span>])</span>
<span id="cb355-11"><a href="Chapter12.html#cb355-11" tabindex="-1"></a></span>
<span id="cb355-12"><a href="Chapter12.html#cb355-12" tabindex="-1"></a>StackFitc <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(</span>
<span id="cb355-13"><a href="Chapter12.html#cb355-13" tabindex="-1"></a>             <span class="at">tag =</span> <span class="st">&quot;Fit&quot;</span>,</span>
<span id="cb355-14"><a href="Chapter12.html#cb355-14" tabindex="-1"></a>             <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> iph<span class="sc">$</span>pH),  </span>
<span id="cb355-15"><a href="Chapter12.html#cb355-15" tabindex="-1"></a>               <span class="at">A =</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">1</span>, A12_5),                  </span>
<span id="cb355-16"><a href="Chapter12.html#cb355-16" tabindex="-1"></a>               <span class="at">effects =</span> <span class="fu">list</span>(   </span>
<span id="cb355-17"><a href="Chapter12.html#cb355-17" tabindex="-1"></a>                  <span class="at">Intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>, N),</span>
<span id="cb355-18"><a href="Chapter12.html#cb355-18" tabindex="-1"></a>                  <span class="at">X =</span> Xc,</span>
<span id="cb355-19"><a href="Chapter12.html#cb355-19" tabindex="-1"></a>                  <span class="at">w =</span> w.index))</span>
<span id="cb355-20"><a href="Chapter12.html#cb355-20" tabindex="-1"></a></span>
<span id="cb355-21"><a href="Chapter12.html#cb355-21" tabindex="-1"></a>m12_2c <span class="ot">&lt;-</span> <span class="fu">inla</span>(f2c,</span>
<span id="cb355-22"><a href="Chapter12.html#cb355-22" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb355-23"><a href="Chapter12.html#cb355-23" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">inla.stack.data</span>(StackFitc),</span>
<span id="cb355-24"><a href="Chapter12.html#cb355-24" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb355-25"><a href="Chapter12.html#cb355-25" tabindex="-1"></a>                                      <span class="at">waic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb355-26"><a href="Chapter12.html#cb355-26" tabindex="-1"></a>               <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">inla.stack.A</span>(StackFitc)))</span>
<span id="cb355-27"><a href="Chapter12.html#cb355-27" tabindex="-1"></a></span>
<span id="cb355-28"><a href="Chapter12.html#cb355-28" tabindex="-1"></a><span class="do">## SDI.fForなし  </span></span>
<span id="cb355-29"><a href="Chapter12.html#cb355-29" tabindex="-1"></a>f2d <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Alt  <span class="sc">+</span> SDI <span class="sc">+</span> fFor <span class="sc">+</span> </span>
<span id="cb355-30"><a href="Chapter12.html#cb355-30" tabindex="-1"></a>           Alt.SDI <span class="sc">+</span> Alt.fFor <span class="sc">+</span> <span class="fu">f</span>(w, <span class="at">model =</span> spde)</span>
<span id="cb355-31"><a href="Chapter12.html#cb355-31" tabindex="-1"></a></span>
<span id="cb355-32"><a href="Chapter12.html#cb355-32" tabindex="-1"></a>Xd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Alt          =</span> Xm[,<span class="dv">2</span>],</span>
<span id="cb355-33"><a href="Chapter12.html#cb355-33" tabindex="-1"></a>                <span class="at">SDI          =</span> Xm[,<span class="dv">3</span>],</span>
<span id="cb355-34"><a href="Chapter12.html#cb355-34" tabindex="-1"></a>                <span class="at">fFor         =</span> Xm[,<span class="dv">4</span>],</span>
<span id="cb355-35"><a href="Chapter12.html#cb355-35" tabindex="-1"></a>                <span class="at">Alt.SDI      =</span> Xm[,<span class="dv">5</span>],</span>
<span id="cb355-36"><a href="Chapter12.html#cb355-36" tabindex="-1"></a>                <span class="at">Alt.fFor     =</span> Xm[,<span class="dv">6</span>])</span>
<span id="cb355-37"><a href="Chapter12.html#cb355-37" tabindex="-1"></a></span>
<span id="cb355-38"><a href="Chapter12.html#cb355-38" tabindex="-1"></a>StackFitd <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(</span>
<span id="cb355-39"><a href="Chapter12.html#cb355-39" tabindex="-1"></a>             <span class="at">tag =</span> <span class="st">&quot;Fit&quot;</span>,</span>
<span id="cb355-40"><a href="Chapter12.html#cb355-40" tabindex="-1"></a>             <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> iph<span class="sc">$</span>pH),  </span>
<span id="cb355-41"><a href="Chapter12.html#cb355-41" tabindex="-1"></a>               <span class="at">A =</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">1</span>, A12_5),                  </span>
<span id="cb355-42"><a href="Chapter12.html#cb355-42" tabindex="-1"></a>               <span class="at">effects =</span> <span class="fu">list</span>(   </span>
<span id="cb355-43"><a href="Chapter12.html#cb355-43" tabindex="-1"></a>                  <span class="at">Intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>, N),</span>
<span id="cb355-44"><a href="Chapter12.html#cb355-44" tabindex="-1"></a>                  <span class="at">X =</span> Xd,</span>
<span id="cb355-45"><a href="Chapter12.html#cb355-45" tabindex="-1"></a>                  <span class="at">w =</span> w.index))</span>
<span id="cb355-46"><a href="Chapter12.html#cb355-46" tabindex="-1"></a></span>
<span id="cb355-47"><a href="Chapter12.html#cb355-47" tabindex="-1"></a>m12_2d <span class="ot">&lt;-</span> <span class="fu">inla</span>(f2d,</span>
<span id="cb355-48"><a href="Chapter12.html#cb355-48" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb355-49"><a href="Chapter12.html#cb355-49" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">inla.stack.data</span>(StackFitd),</span>
<span id="cb355-50"><a href="Chapter12.html#cb355-50" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb355-51"><a href="Chapter12.html#cb355-51" tabindex="-1"></a>                                      <span class="at">waic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb355-52"><a href="Chapter12.html#cb355-52" tabindex="-1"></a>               <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">inla.stack.A</span>(StackFitd)))</span>
<span id="cb355-53"><a href="Chapter12.html#cb355-53" tabindex="-1"></a></span>
<span id="cb355-54"><a href="Chapter12.html#cb355-54" tabindex="-1"></a><span class="do">## Alt.fForなし</span></span>
<span id="cb355-55"><a href="Chapter12.html#cb355-55" tabindex="-1"></a>f2e <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Alt  <span class="sc">+</span> SDI <span class="sc">+</span> fFor <span class="sc">+</span> </span>
<span id="cb355-56"><a href="Chapter12.html#cb355-56" tabindex="-1"></a>           Alt.SDI <span class="sc">+</span>  SDI.fFor <span class="sc">+</span> <span class="fu">f</span>(w, <span class="at">model =</span> spde)</span>
<span id="cb355-57"><a href="Chapter12.html#cb355-57" tabindex="-1"></a></span>
<span id="cb355-58"><a href="Chapter12.html#cb355-58" tabindex="-1"></a>Xe <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Alt          =</span> Xm[,<span class="dv">2</span>],</span>
<span id="cb355-59"><a href="Chapter12.html#cb355-59" tabindex="-1"></a>                <span class="at">SDI          =</span> Xm[,<span class="dv">3</span>],</span>
<span id="cb355-60"><a href="Chapter12.html#cb355-60" tabindex="-1"></a>                <span class="at">fFor         =</span> Xm[,<span class="dv">4</span>],</span>
<span id="cb355-61"><a href="Chapter12.html#cb355-61" tabindex="-1"></a>                <span class="at">Alt.SDI      =</span> Xm[,<span class="dv">5</span>],</span>
<span id="cb355-62"><a href="Chapter12.html#cb355-62" tabindex="-1"></a>                <span class="at">SDI.fFor     =</span> Xm[,<span class="dv">7</span>])</span>
<span id="cb355-63"><a href="Chapter12.html#cb355-63" tabindex="-1"></a></span>
<span id="cb355-64"><a href="Chapter12.html#cb355-64" tabindex="-1"></a>StackFite <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(</span>
<span id="cb355-65"><a href="Chapter12.html#cb355-65" tabindex="-1"></a>             <span class="at">tag =</span> <span class="st">&quot;Fit&quot;</span>,</span>
<span id="cb355-66"><a href="Chapter12.html#cb355-66" tabindex="-1"></a>             <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> iph<span class="sc">$</span>pH),  </span>
<span id="cb355-67"><a href="Chapter12.html#cb355-67" tabindex="-1"></a>               <span class="at">A =</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">1</span>, A12_5),                  </span>
<span id="cb355-68"><a href="Chapter12.html#cb355-68" tabindex="-1"></a>               <span class="at">effects =</span> <span class="fu">list</span>(   </span>
<span id="cb355-69"><a href="Chapter12.html#cb355-69" tabindex="-1"></a>                  <span class="at">Intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>, N),</span>
<span id="cb355-70"><a href="Chapter12.html#cb355-70" tabindex="-1"></a>                  <span class="at">X =</span> Xe,</span>
<span id="cb355-71"><a href="Chapter12.html#cb355-71" tabindex="-1"></a>                  <span class="at">w =</span> w.index))</span>
<span id="cb355-72"><a href="Chapter12.html#cb355-72" tabindex="-1"></a></span>
<span id="cb355-73"><a href="Chapter12.html#cb355-73" tabindex="-1"></a>m12_2e <span class="ot">&lt;-</span> <span class="fu">inla</span>(f2e,</span>
<span id="cb355-74"><a href="Chapter12.html#cb355-74" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb355-75"><a href="Chapter12.html#cb355-75" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">inla.stack.data</span>(StackFite),</span>
<span id="cb355-76"><a href="Chapter12.html#cb355-76" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb355-77"><a href="Chapter12.html#cb355-77" tabindex="-1"></a>                                      <span class="at">waic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb355-78"><a href="Chapter12.html#cb355-78" tabindex="-1"></a>               <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">inla.stack.A</span>(StackFite)))</span>
<span id="cb355-79"><a href="Chapter12.html#cb355-79" tabindex="-1"></a></span>
<span id="cb355-80"><a href="Chapter12.html#cb355-80" tabindex="-1"></a><span class="do">## Alt.SDIなし</span></span>
<span id="cb355-81"><a href="Chapter12.html#cb355-81" tabindex="-1"></a>f2f <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Alt  <span class="sc">+</span> SDI <span class="sc">+</span> fFor <span class="sc">+</span> </span>
<span id="cb355-82"><a href="Chapter12.html#cb355-82" tabindex="-1"></a>           Alt.fFor <span class="sc">+</span> SDI.fFor <span class="sc">+</span> <span class="fu">f</span>(w, <span class="at">model =</span> spde)</span>
<span id="cb355-83"><a href="Chapter12.html#cb355-83" tabindex="-1"></a></span>
<span id="cb355-84"><a href="Chapter12.html#cb355-84" tabindex="-1"></a>Xf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Alt          =</span> Xm[,<span class="dv">2</span>],</span>
<span id="cb355-85"><a href="Chapter12.html#cb355-85" tabindex="-1"></a>                <span class="at">SDI          =</span> Xm[,<span class="dv">3</span>],</span>
<span id="cb355-86"><a href="Chapter12.html#cb355-86" tabindex="-1"></a>                <span class="at">fFor         =</span> Xm[,<span class="dv">4</span>],</span>
<span id="cb355-87"><a href="Chapter12.html#cb355-87" tabindex="-1"></a>                <span class="at">Alt.fFor     =</span> Xm[,<span class="dv">6</span>],</span>
<span id="cb355-88"><a href="Chapter12.html#cb355-88" tabindex="-1"></a>                <span class="at">SDI.fFor     =</span> Xm[,<span class="dv">7</span>])</span>
<span id="cb355-89"><a href="Chapter12.html#cb355-89" tabindex="-1"></a></span>
<span id="cb355-90"><a href="Chapter12.html#cb355-90" tabindex="-1"></a>StackFitf <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(</span>
<span id="cb355-91"><a href="Chapter12.html#cb355-91" tabindex="-1"></a>             <span class="at">tag =</span> <span class="st">&quot;Fit&quot;</span>,</span>
<span id="cb355-92"><a href="Chapter12.html#cb355-92" tabindex="-1"></a>             <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> iph<span class="sc">$</span>pH),  </span>
<span id="cb355-93"><a href="Chapter12.html#cb355-93" tabindex="-1"></a>               <span class="at">A =</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">1</span>, A12_5),                  </span>
<span id="cb355-94"><a href="Chapter12.html#cb355-94" tabindex="-1"></a>               <span class="at">effects =</span> <span class="fu">list</span>(   </span>
<span id="cb355-95"><a href="Chapter12.html#cb355-95" tabindex="-1"></a>                  <span class="at">Intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>, N),</span>
<span id="cb355-96"><a href="Chapter12.html#cb355-96" tabindex="-1"></a>                  <span class="at">X =</span> Xf,</span>
<span id="cb355-97"><a href="Chapter12.html#cb355-97" tabindex="-1"></a>                  <span class="at">w =</span> w.index))</span>
<span id="cb355-98"><a href="Chapter12.html#cb355-98" tabindex="-1"></a></span>
<span id="cb355-99"><a href="Chapter12.html#cb355-99" tabindex="-1"></a>m12_2f <span class="ot">&lt;-</span> <span class="fu">inla</span>(f2f,</span>
<span id="cb355-100"><a href="Chapter12.html#cb355-100" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb355-101"><a href="Chapter12.html#cb355-101" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">inla.stack.data</span>(StackFitf),</span>
<span id="cb355-102"><a href="Chapter12.html#cb355-102" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb355-103"><a href="Chapter12.html#cb355-103" tabindex="-1"></a>                                      <span class="at">waic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb355-104"><a href="Chapter12.html#cb355-104" tabindex="-1"></a>               <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">inla.stack.A</span>(StackFitf)))</span></code></pre></div>
<p>その結果、3次の交互作用項と2次の交互作用項<code>Alt.SDI</code>を含まないモデルが最もWAICが低いことが分かった。一方で、DICは3次の交互作用のみを含まないモデルが最も低い。ここでは、<code>m12_2f</code>を採用することにする。</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="Chapter12.html#cb356-1" tabindex="-1"></a><span class="do">## モデル比較  </span></span>
<span id="cb356-2"><a href="Chapter12.html#cb356-2" tabindex="-1"></a>waic12_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(m12_2b<span class="sc">$</span>waic<span class="sc">$</span>waic, m12_2c<span class="sc">$</span>waic<span class="sc">$</span>waic, m12_2d<span class="sc">$</span>waic<span class="sc">$</span>waic, m12_2e<span class="sc">$</span>waic<span class="sc">$</span>waic, m12_2f<span class="sc">$</span>waic<span class="sc">$</span>waic)</span>
<span id="cb356-3"><a href="Chapter12.html#cb356-3" tabindex="-1"></a>dic12_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(m12_2b<span class="sc">$</span>dic<span class="sc">$</span>dic, m12_2c<span class="sc">$</span>dic<span class="sc">$</span>dic, m12_2d<span class="sc">$</span>dic<span class="sc">$</span>dic, m12_2e<span class="sc">$</span>dic<span class="sc">$</span>dic, m12_2f<span class="sc">$</span>dic<span class="sc">$</span>dic)</span>
<span id="cb356-4"><a href="Chapter12.html#cb356-4" tabindex="-1"></a>modelcomp12_2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(waic12_2, dic12_2)</span>
<span id="cb356-5"><a href="Chapter12.html#cb356-5" tabindex="-1"></a><span class="fu">rownames</span>(modelcomp12_2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Full&quot;</span>,<span class="st">&quot;-Alt.SDI.fFor &quot;</span>, <span class="st">&quot;-SDI.fFor&quot;</span>, <span class="st">&quot;-Alt.fFor&quot;</span>,<span class="st">&quot;-Alt.SDI&quot;</span>)</span>
<span id="cb356-6"><a href="Chapter12.html#cb356-6" tabindex="-1"></a></span>
<span id="cb356-7"><a href="Chapter12.html#cb356-7" tabindex="-1"></a>modelcomp12_2</span></code></pre></div>
<pre><code>##                waic12_2  dic12_2
## Full           127.7375 124.2912
## -Alt.SDI.fFor  126.5898 122.6982
## -SDI.fFor      127.6033 123.5803
## -Alt.fFor      133.1570 130.0797
## -Alt.SDI       126.5112 123.0979</code></pre>
<p><br/></p>
<p>続いて、残った2次の交互作用項を1つずつ除いたものと、交互作用項を含まないモデルとの比較を行う。</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="Chapter12.html#cb358-1" tabindex="-1"></a><span class="do">## Alt.fForなし</span></span>
<span id="cb358-2"><a href="Chapter12.html#cb358-2" tabindex="-1"></a>f2g <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Alt  <span class="sc">+</span> SDI <span class="sc">+</span> fFor <span class="sc">+</span> </span>
<span id="cb358-3"><a href="Chapter12.html#cb358-3" tabindex="-1"></a>            SDI.fFor <span class="sc">+</span> <span class="fu">f</span>(w, <span class="at">model =</span> spde)</span>
<span id="cb358-4"><a href="Chapter12.html#cb358-4" tabindex="-1"></a></span>
<span id="cb358-5"><a href="Chapter12.html#cb358-5" tabindex="-1"></a>Xg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Alt          =</span> Xm[,<span class="dv">2</span>],</span>
<span id="cb358-6"><a href="Chapter12.html#cb358-6" tabindex="-1"></a>                <span class="at">SDI          =</span> Xm[,<span class="dv">3</span>],</span>
<span id="cb358-7"><a href="Chapter12.html#cb358-7" tabindex="-1"></a>                <span class="at">fFor         =</span> Xm[,<span class="dv">4</span>],</span>
<span id="cb358-8"><a href="Chapter12.html#cb358-8" tabindex="-1"></a>                <span class="at">SDI.fFor     =</span> Xm[,<span class="dv">7</span>])</span>
<span id="cb358-9"><a href="Chapter12.html#cb358-9" tabindex="-1"></a></span>
<span id="cb358-10"><a href="Chapter12.html#cb358-10" tabindex="-1"></a>StackFitg <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(</span>
<span id="cb358-11"><a href="Chapter12.html#cb358-11" tabindex="-1"></a>             <span class="at">tag =</span> <span class="st">&quot;Fit&quot;</span>,</span>
<span id="cb358-12"><a href="Chapter12.html#cb358-12" tabindex="-1"></a>             <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> iph<span class="sc">$</span>pH),  </span>
<span id="cb358-13"><a href="Chapter12.html#cb358-13" tabindex="-1"></a>               <span class="at">A =</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">1</span>, A12_5),                  </span>
<span id="cb358-14"><a href="Chapter12.html#cb358-14" tabindex="-1"></a>               <span class="at">effects =</span> <span class="fu">list</span>(   </span>
<span id="cb358-15"><a href="Chapter12.html#cb358-15" tabindex="-1"></a>                  <span class="at">Intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>, N),</span>
<span id="cb358-16"><a href="Chapter12.html#cb358-16" tabindex="-1"></a>                  <span class="at">X =</span> Xg,</span>
<span id="cb358-17"><a href="Chapter12.html#cb358-17" tabindex="-1"></a>                  <span class="at">w =</span> w.index))</span>
<span id="cb358-18"><a href="Chapter12.html#cb358-18" tabindex="-1"></a></span>
<span id="cb358-19"><a href="Chapter12.html#cb358-19" tabindex="-1"></a>m12_2g <span class="ot">&lt;-</span> <span class="fu">inla</span>(f2g,</span>
<span id="cb358-20"><a href="Chapter12.html#cb358-20" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb358-21"><a href="Chapter12.html#cb358-21" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">inla.stack.data</span>(StackFitg),</span>
<span id="cb358-22"><a href="Chapter12.html#cb358-22" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb358-23"><a href="Chapter12.html#cb358-23" tabindex="-1"></a>                                      <span class="at">waic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb358-24"><a href="Chapter12.html#cb358-24" tabindex="-1"></a>               <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">inla.stack.A</span>(StackFitg)))</span>
<span id="cb358-25"><a href="Chapter12.html#cb358-25" tabindex="-1"></a></span>
<span id="cb358-26"><a href="Chapter12.html#cb358-26" tabindex="-1"></a><span class="do">## SDI.fForなし</span></span>
<span id="cb358-27"><a href="Chapter12.html#cb358-27" tabindex="-1"></a>f2h <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Alt  <span class="sc">+</span> SDI <span class="sc">+</span> fFor <span class="sc">+</span> </span>
<span id="cb358-28"><a href="Chapter12.html#cb358-28" tabindex="-1"></a>           Alt.fFor  <span class="sc">+</span> <span class="fu">f</span>(w, <span class="at">model =</span> spde)</span>
<span id="cb358-29"><a href="Chapter12.html#cb358-29" tabindex="-1"></a></span>
<span id="cb358-30"><a href="Chapter12.html#cb358-30" tabindex="-1"></a>Xh <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Alt          =</span> Xm[,<span class="dv">2</span>],</span>
<span id="cb358-31"><a href="Chapter12.html#cb358-31" tabindex="-1"></a>                <span class="at">SDI          =</span> Xm[,<span class="dv">3</span>],</span>
<span id="cb358-32"><a href="Chapter12.html#cb358-32" tabindex="-1"></a>                <span class="at">fFor         =</span> Xm[,<span class="dv">4</span>],</span>
<span id="cb358-33"><a href="Chapter12.html#cb358-33" tabindex="-1"></a>                <span class="at">Alt.fFor     =</span> Xm[,<span class="dv">6</span>])</span>
<span id="cb358-34"><a href="Chapter12.html#cb358-34" tabindex="-1"></a></span>
<span id="cb358-35"><a href="Chapter12.html#cb358-35" tabindex="-1"></a>StackFith <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(</span>
<span id="cb358-36"><a href="Chapter12.html#cb358-36" tabindex="-1"></a>             <span class="at">tag =</span> <span class="st">&quot;Fit&quot;</span>,</span>
<span id="cb358-37"><a href="Chapter12.html#cb358-37" tabindex="-1"></a>             <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> iph<span class="sc">$</span>pH),  </span>
<span id="cb358-38"><a href="Chapter12.html#cb358-38" tabindex="-1"></a>               <span class="at">A =</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">1</span>, A12_5),                  </span>
<span id="cb358-39"><a href="Chapter12.html#cb358-39" tabindex="-1"></a>               <span class="at">effects =</span> <span class="fu">list</span>(   </span>
<span id="cb358-40"><a href="Chapter12.html#cb358-40" tabindex="-1"></a>                  <span class="at">Intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>, N),</span>
<span id="cb358-41"><a href="Chapter12.html#cb358-41" tabindex="-1"></a>                  <span class="at">X =</span> Xh,</span>
<span id="cb358-42"><a href="Chapter12.html#cb358-42" tabindex="-1"></a>                  <span class="at">w =</span> w.index))</span>
<span id="cb358-43"><a href="Chapter12.html#cb358-43" tabindex="-1"></a></span>
<span id="cb358-44"><a href="Chapter12.html#cb358-44" tabindex="-1"></a>m12_2h <span class="ot">&lt;-</span> <span class="fu">inla</span>(f2h,</span>
<span id="cb358-45"><a href="Chapter12.html#cb358-45" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb358-46"><a href="Chapter12.html#cb358-46" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">inla.stack.data</span>(StackFith),</span>
<span id="cb358-47"><a href="Chapter12.html#cb358-47" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb358-48"><a href="Chapter12.html#cb358-48" tabindex="-1"></a>                                      <span class="at">waic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb358-49"><a href="Chapter12.html#cb358-49" tabindex="-1"></a>               <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">inla.stack.A</span>(StackFith)))</span>
<span id="cb358-50"><a href="Chapter12.html#cb358-50" tabindex="-1"></a></span>
<span id="cb358-51"><a href="Chapter12.html#cb358-51" tabindex="-1"></a><span class="do">## 交互作用なし</span></span>
<span id="cb358-52"><a href="Chapter12.html#cb358-52" tabindex="-1"></a>f2i <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Intercept <span class="sc">+</span> Alt  <span class="sc">+</span> SDI <span class="sc">+</span> fFor <span class="sc">+</span> <span class="fu">f</span>(w, <span class="at">model =</span> spde)</span>
<span id="cb358-53"><a href="Chapter12.html#cb358-53" tabindex="-1"></a></span>
<span id="cb358-54"><a href="Chapter12.html#cb358-54" tabindex="-1"></a>Xi <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Alt          =</span> Xm[,<span class="dv">2</span>],</span>
<span id="cb358-55"><a href="Chapter12.html#cb358-55" tabindex="-1"></a>                <span class="at">SDI          =</span> Xm[,<span class="dv">3</span>],</span>
<span id="cb358-56"><a href="Chapter12.html#cb358-56" tabindex="-1"></a>                <span class="at">fFor         =</span> Xm[,<span class="dv">4</span>])</span>
<span id="cb358-57"><a href="Chapter12.html#cb358-57" tabindex="-1"></a></span>
<span id="cb358-58"><a href="Chapter12.html#cb358-58" tabindex="-1"></a>StackFiti <span class="ot">&lt;-</span> <span class="fu">inla.stack</span>(</span>
<span id="cb358-59"><a href="Chapter12.html#cb358-59" tabindex="-1"></a>             <span class="at">tag =</span> <span class="st">&quot;Fit&quot;</span>,</span>
<span id="cb358-60"><a href="Chapter12.html#cb358-60" tabindex="-1"></a>             <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> iph<span class="sc">$</span>pH),  </span>
<span id="cb358-61"><a href="Chapter12.html#cb358-61" tabindex="-1"></a>               <span class="at">A =</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">1</span>, A12_5),                  </span>
<span id="cb358-62"><a href="Chapter12.html#cb358-62" tabindex="-1"></a>               <span class="at">effects =</span> <span class="fu">list</span>(   </span>
<span id="cb358-63"><a href="Chapter12.html#cb358-63" tabindex="-1"></a>                  <span class="at">Intercept =</span> <span class="fu">rep</span>(<span class="dv">1</span>, N),</span>
<span id="cb358-64"><a href="Chapter12.html#cb358-64" tabindex="-1"></a>                  <span class="at">X =</span> Xi,</span>
<span id="cb358-65"><a href="Chapter12.html#cb358-65" tabindex="-1"></a>                  <span class="at">w =</span> w.index))</span>
<span id="cb358-66"><a href="Chapter12.html#cb358-66" tabindex="-1"></a></span>
<span id="cb358-67"><a href="Chapter12.html#cb358-67" tabindex="-1"></a></span>
<span id="cb358-68"><a href="Chapter12.html#cb358-68" tabindex="-1"></a>m12_2i <span class="ot">&lt;-</span> <span class="fu">inla</span>(f2i,</span>
<span id="cb358-69"><a href="Chapter12.html#cb358-69" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb358-70"><a href="Chapter12.html#cb358-70" tabindex="-1"></a>               <span class="at">data =</span> <span class="fu">inla.stack.data</span>(StackFiti),</span>
<span id="cb358-71"><a href="Chapter12.html#cb358-71" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb358-72"><a href="Chapter12.html#cb358-72" tabindex="-1"></a>                                      <span class="at">waic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb358-73"><a href="Chapter12.html#cb358-73" tabindex="-1"></a>               <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="fu">inla.stack.A</span>(StackFiti)))</span></code></pre></div>
<p>その結果、わずかながら2次の交互作用項を2つ含むモデル(<code>m12_2f</code>)が最もWAICとDICが低いことが分かった。</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="Chapter12.html#cb359-1" tabindex="-1"></a><span class="do">## モデル比較  </span></span>
<span id="cb359-2"><a href="Chapter12.html#cb359-2" tabindex="-1"></a>waic12_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(m12_2f<span class="sc">$</span>waic<span class="sc">$</span>waic, m12_2g<span class="sc">$</span>waic<span class="sc">$</span>waic, m12_2h<span class="sc">$</span>waic<span class="sc">$</span>waic, m12_2i<span class="sc">$</span>waic<span class="sc">$</span>waic)</span>
<span id="cb359-3"><a href="Chapter12.html#cb359-3" tabindex="-1"></a>dic12_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(m12_2f<span class="sc">$</span>dic<span class="sc">$</span>dic, m12_2g<span class="sc">$</span>dic<span class="sc">$</span>dic, m12_2h<span class="sc">$</span>dic<span class="sc">$</span>dic, m12_2i<span class="sc">$</span>dic<span class="sc">$</span>dic)</span>
<span id="cb359-4"><a href="Chapter12.html#cb359-4" tabindex="-1"></a>modelcomp12_2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(waic12_2, dic12_2)</span>
<span id="cb359-5"><a href="Chapter12.html#cb359-5" tabindex="-1"></a><span class="fu">rownames</span>(modelcomp12_2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Full&quot;</span>,<span class="st">&quot;-Alt.fFor &quot;</span>, <span class="st">&quot;-SDI.fFor&quot;</span>, <span class="st">&quot;no interaction&quot;</span>)</span>
<span id="cb359-6"><a href="Chapter12.html#cb359-6" tabindex="-1"></a></span>
<span id="cb359-7"><a href="Chapter12.html#cb359-7" tabindex="-1"></a>modelcomp12_2</span></code></pre></div>
<pre><code>##                waic12_2  dic12_2
## Full           126.5112 123.0979
## -Alt.fFor      130.7929 128.1620
## -SDI.fFor      126.8899 123.4883
## no interaction 133.8153 131.2625</code></pre>
<p><br/></p>
</div>
<div id="model-validation-6" class="section level2 hasAnchor" number="11.15">
<h2><span class="header-section-number">11.15</span> Model validation<a href="Chapter12.html#model-validation-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>続いて、モデル診断を行う。</p>
<p>まず、残差と予測値を計算する。<code>m12_2f$summary.fitted.values</code>はデータ数210ではなく合計632行のデータを返すが、最初の210個が予測値である。残りの432個が何を示しているのかは後程触れる。</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="Chapter12.html#cb361-1" tabindex="-1"></a>fitted <span class="ot">&lt;-</span> m12_2f<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean[<span class="dv">1</span><span class="sc">:</span><span class="dv">210</span>]</span>
<span id="cb361-2"><a href="Chapter12.html#cb361-2" tabindex="-1"></a>resid <span class="ot">&lt;-</span> iph<span class="sc">$</span>pH <span class="sc">-</span> fitted</span></code></pre></div>
<p>残差と予測値、残差と共変量の関係を見ると、1つだけ外れ値があるものの、全体的なパターンはないように見える。</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="Chapter12.html#cb362-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">fitted =</span> fitted,</span>
<span id="cb362-2"><a href="Chapter12.html#cb362-2" tabindex="-1"></a>           <span class="at">resid =</span> resid) <span class="sc">%&gt;%</span> </span>
<span id="cb362-3"><a href="Chapter12.html#cb362-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> fitted, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb362-4"><a href="Chapter12.html#cb362-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb362-5"><a href="Chapter12.html#cb362-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb362-6"><a href="Chapter12.html#cb362-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb362-7"><a href="Chapter12.html#cb362-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb362-8"><a href="Chapter12.html#cb362-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Fitted values&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>) <span class="ot">-&gt;</span> p1</span>
<span id="cb362-9"><a href="Chapter12.html#cb362-9" tabindex="-1"></a></span>
<span id="cb362-10"><a href="Chapter12.html#cb362-10" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">SDI =</span> iph<span class="sc">$</span>SDI,</span>
<span id="cb362-11"><a href="Chapter12.html#cb362-11" tabindex="-1"></a>           <span class="at">resid =</span> resid) <span class="sc">%&gt;%</span> </span>
<span id="cb362-12"><a href="Chapter12.html#cb362-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> SDI, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb362-13"><a href="Chapter12.html#cb362-13" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb362-14"><a href="Chapter12.html#cb362-14" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb362-15"><a href="Chapter12.html#cb362-15" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb362-16"><a href="Chapter12.html#cb362-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb362-17"><a href="Chapter12.html#cb362-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;SDI&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>) <span class="ot">-&gt;</span> p2</span>
<span id="cb362-18"><a href="Chapter12.html#cb362-18" tabindex="-1"></a></span>
<span id="cb362-19"><a href="Chapter12.html#cb362-19" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">SDI =</span> iph<span class="sc">$</span>logAlt,</span>
<span id="cb362-20"><a href="Chapter12.html#cb362-20" tabindex="-1"></a>           <span class="at">resid =</span> resid) <span class="sc">%&gt;%</span> </span>
<span id="cb362-21"><a href="Chapter12.html#cb362-21" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> SDI, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb362-22"><a href="Chapter12.html#cb362-22" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb362-23"><a href="Chapter12.html#cb362-23" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb362-24"><a href="Chapter12.html#cb362-24" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb362-25"><a href="Chapter12.html#cb362-25" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb362-26"><a href="Chapter12.html#cb362-26" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Log(Altitude)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>) <span class="ot">-&gt;</span> p3</span>
<span id="cb362-27"><a href="Chapter12.html#cb362-27" tabindex="-1"></a></span>
<span id="cb362-28"><a href="Chapter12.html#cb362-28" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">forested =</span> iph<span class="sc">$</span>fForested,</span>
<span id="cb362-29"><a href="Chapter12.html#cb362-29" tabindex="-1"></a>           <span class="at">resid =</span> resid) <span class="sc">%&gt;%</span> </span>
<span id="cb362-30"><a href="Chapter12.html#cb362-30" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> forested, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb362-31"><a href="Chapter12.html#cb362-31" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb362-32"><a href="Chapter12.html#cb362-32" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb362-33"><a href="Chapter12.html#cb362-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb362-34"><a href="Chapter12.html#cb362-34" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Forested&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>) <span class="ot">-&gt;</span> p4</span>
<span id="cb362-35"><a href="Chapter12.html#cb362-35" tabindex="-1"></a></span>
<span id="cb362-36"><a href="Chapter12.html#cb362-36" tabindex="-1"></a>(p1 <span class="sc">+</span> p2)<span class="sc">/</span>(p3<span class="sc">+</span>p4)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-260-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>続いて、バリオグラムを確認する。空間的相関を考慮しなかった場合に比べると水平に近づいており、だいぶん改善しているように見える。</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="Chapter12.html#cb363-1" tabindex="-1"></a>vario_12_2f <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">resid =</span> resid,</span>
<span id="cb363-2"><a href="Chapter12.html#cb363-2" tabindex="-1"></a>                          <span class="at">Easting.km =</span> iph<span class="sc">$</span>Easting<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb363-3"><a href="Chapter12.html#cb363-3" tabindex="-1"></a>                          <span class="at">Northing.km =</span> iph<span class="sc">$</span>Northing<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb363-4"><a href="Chapter12.html#cb363-4" tabindex="-1"></a></span>
<span id="cb363-5"><a href="Chapter12.html#cb363-5" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">coordinates</span>(vario_12_2f) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Easting.km&quot;</span>, <span class="st">&quot;Northing.km&quot;</span>)</span>
<span id="cb363-6"><a href="Chapter12.html#cb363-6" tabindex="-1"></a></span>
<span id="cb363-7"><a href="Chapter12.html#cb363-7" tabindex="-1"></a>vario_12_2f <span class="sc">%&gt;%</span> </span>
<span id="cb363-8"><a href="Chapter12.html#cb363-8" tabindex="-1"></a>  <span class="fu">variogram</span>(resid <span class="sc">~</span> Easting.km <span class="sc">+</span> Northing.km, <span class="at">data =</span> .,</span>
<span id="cb363-9"><a href="Chapter12.html#cb363-9" tabindex="-1"></a>            <span class="do">## 0が南北方向、90が東西方向</span></span>
<span id="cb363-10"><a href="Chapter12.html#cb363-10" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>),</span>
<span id="cb363-11"><a href="Chapter12.html#cb363-11" tabindex="-1"></a>            <span class="at">cressie =</span> <span class="cn">TRUE</span>,</span>
<span id="cb363-12"><a href="Chapter12.html#cb363-12" tabindex="-1"></a>            <span class="at">cutoff =</span> <span class="dv">150</span>,</span>
<span id="cb363-13"><a href="Chapter12.html#cb363-13" tabindex="-1"></a>            <span class="at">width =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb363-14"><a href="Chapter12.html#cb363-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> gamma))<span class="sc">+</span></span>
<span id="cb363-15"><a href="Chapter12.html#cb363-15" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> np))<span class="sc">+</span></span>
<span id="cb363-16"><a href="Chapter12.html#cb363-16" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb363-17"><a href="Chapter12.html#cb363-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb363-18"><a href="Chapter12.html#cb363-18" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span> dir.hor,</span>
<span id="cb363-19"><a href="Chapter12.html#cb363-19" tabindex="-1"></a>                 <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;North-South&quot;</span>,</span>
<span id="cb363-20"><a href="Chapter12.html#cb363-20" tabindex="-1"></a>                                          <span class="st">&quot;90&quot;</span> <span class="ot">=</span> <span class="st">&quot;East-West&quot;</span>)))<span class="sc">+</span></span>
<span id="cb363-21"><a href="Chapter12.html#cb363-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;semivariogram&quot;</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-261-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="model-interpretation-1" class="section level2 hasAnchor" number="11.16">
<h2><span class="header-section-number">11.16</span> Model interpretation<a href="Chapter12.html#model-interpretation-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>選ばれたモデルの結果は以下のとおりである。</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="Chapter12.html#cb364-1" tabindex="-1"></a>m12_2f<span class="sc">$</span>summary.fixe <span class="sc">%&gt;%</span> </span>
<span id="cb364-2"><a href="Chapter12.html#cb364-2" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##             mean     sd 0.025quant 0.5quant 0.975quant   mode     kld
## Intercept  8.114 0.2996      7.522    8.115      8.700  8.117 5.6e-09
## Alt        0.162 0.1432     -0.119    0.163      0.443  0.163 6.5e-10
## SDI       -0.023 0.0022     -0.028   -0.023     -0.019 -0.023 2.5e-09
## fFor       1.117 0.3971      0.336    1.117      1.895  1.118 6.2e-10
## Alt.fFor  -0.484 0.1912     -0.859   -0.484     -0.109 -0.484 6.7e-10
## SDI.fFor  -0.004 0.0041     -0.012   -0.004      0.004 -0.004 5.4e-10</code></pre>
<p><br/></p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="Chapter12.html#cb366-1" tabindex="-1"></a><span class="fu">inla.emarginal</span>(<span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(x), m12_2f<span class="sc">$</span>marginals.hyperpar<span class="sc">$</span><span class="st">`</span><span class="at">Precision for the Gaussian observations</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] 0.2900052</code></pre>
モデル式に当てはめると以下のようになる。<br />
$$
<span class="math display">\[\begin{aligned}

\end{aligned}\]</span>
<p>$$</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Cruikshanks2006" class="csl-entry">
Cruikshanks R, Lauridsen R, Harrison A, et al (2006) Evaluation of the use of the sodium dominance index as a potential measure of acid sensitivity
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Chapter11.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sessioninfo.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
