<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Poisson, negative binomial, binomial and g amma GLMs in R-INLA | Introduction to spatial-temporal data anlysis using R</title>
  <meta name="description" content="9 Poisson, negative binomial, binomial and g amma GLMs in R-INLA | Introduction to spatial-temporal data anlysis using R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Poisson, negative binomial, binomial and g amma GLMs in R-INLA | Introduction to spatial-temporal data anlysis using R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Poisson, negative binomial, binomial and g amma GLMs in R-INLA | Introduction to spatial-temporal data anlysis using R" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-09-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Chapter9.html"/>
<link rel="next" href="Chapter11.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="Chapter0.html"><a href="Chapter0.html"><i class="fa fa-check"></i>0. パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="Chapter2.html"><a href="Chapter2.html"><i class="fa fa-check"></i><b>1</b> Recognizing statistical dependency</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Chapter2.html"><a href="Chapter2.html#pseudoreplication"><i class="fa fa-check"></i><b>1.1</b> Pseudoreplication</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="Chapter2.html"><a href="Chapter2.html#疑似反復とは"><i class="fa fa-check"></i><b>1.1.1</b> 疑似反復とは</a></li>
<li class="chapter" data-level="1.1.2" data-path="Chapter2.html"><a href="Chapter2.html#時空間的な疑似反復"><i class="fa fa-check"></i><b>1.1.2</b> 時空間的な疑似反復</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="Chapter2.html"><a href="Chapter2.html#s1-2"><i class="fa fa-check"></i><b>1.2</b> Linear regression applied to spatial data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="Chapter2.html"><a href="Chapter2.html#visualization"><i class="fa fa-check"></i><b>1.2.1</b> Visualization</a></li>
<li class="chapter" data-level="1.2.2" data-path="Chapter2.html"><a href="Chapter2.html#dependency"><i class="fa fa-check"></i><b>1.2.2</b> Dependency</a></li>
<li class="chapter" data-level="1.2.3" data-path="Chapter2.html"><a href="Chapter2.html#fit-the-model"><i class="fa fa-check"></i><b>1.2.3</b> Fit the model</a></li>
<li class="chapter" data-level="1.2.4" data-path="Chapter2.html"><a href="Chapter2.html#model-validation"><i class="fa fa-check"></i><b>1.2.4</b> Model validation</a>
<ul>
<li class="chapter" data-level="1.2.4.1" data-path="Chapter2.html"><a href="Chapter2.html#check-homogeinity-and-model-misfit"><i class="fa fa-check"></i><b>1.2.4.1</b> Check homogeinity and model misfit</a></li>
</ul></li>
<li class="chapter" data-level="1.2.5" data-path="Chapter2.html"><a href="Chapter2.html#check-spatial-dependence"><i class="fa fa-check"></i><b>1.2.5</b> Check spatial dependence</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="Chapter2.html"><a href="Chapter2.html#s2-2"><i class="fa fa-check"></i><b>1.3</b> GAM applied to temporal data</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="Chapter2.html"><a href="Chapter2.html#subnivium-temperature-data"><i class="fa fa-check"></i><b>1.3.1</b> Subnivium temperature data</a></li>
<li class="chapter" data-level="1.3.2" data-path="Chapter2.html"><a href="Chapter2.html#sources-of-dependency"><i class="fa fa-check"></i><b>1.3.2</b> Sources of dependency</a></li>
<li class="chapter" data-level="1.3.3" data-path="Chapter2.html"><a href="Chapter2.html#the-model"><i class="fa fa-check"></i><b>1.3.3</b> The model</a></li>
<li class="chapter" data-level="1.3.4" data-path="Chapter2.html"><a href="Chapter2.html#model-validation-1"><i class="fa fa-check"></i><b>1.3.4</b> Model validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chapter3.html"><a href="Chapter3.html"><i class="fa fa-check"></i><b>2</b> Time series and GLS</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Chapter3.html"><a href="Chapter3.html#ospreys"><i class="fa fa-check"></i><b>2.1</b> Ospreys</a></li>
<li class="chapter" data-level="2.2" data-path="Chapter3.html"><a href="Chapter3.html#covariance-and-correlation-coefficients"><i class="fa fa-check"></i><b>2.2</b> Covariance and correlation coefficients</a></li>
<li class="chapter" data-level="2.3" data-path="Chapter3.html"><a href="Chapter3.html#linear-regression-models"><i class="fa fa-check"></i><b>2.3</b> Linear regression models</a></li>
<li class="chapter" data-level="2.4" data-path="Chapter3.html"><a href="Chapter3.html#focusing-on-the-residual-covariance-matrix"><i class="fa fa-check"></i><b>2.4</b> Focusing on the residual covariance matrix</a></li>
<li class="chapter" data-level="2.5" data-path="Chapter3.html"><a href="Chapter3.html#dependency-and-the-covariance-matrix"><i class="fa fa-check"></i><b>2.5</b> Dependency and the covariance matrix</a></li>
<li class="chapter" data-level="2.6" data-path="Chapter3.html"><a href="Chapter3.html#dealing-with-temporal-dependency"><i class="fa fa-check"></i><b>2.6</b> Dealing with temporal dependency</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="Chapter3.html"><a href="Chapter3.html#adelie-penguins"><i class="fa fa-check"></i><b>2.6.1</b> Adelie penguins</a></li>
<li class="chapter" data-level="2.6.2" data-path="Chapter3.html"><a href="Chapter3.html#do-we-have-dependency"><i class="fa fa-check"></i><b>2.6.2</b> Do we have dependency?</a></li>
<li class="chapter" data-level="2.6.3" data-path="Chapter3.html"><a href="Chapter3.html#formulation-of-the-linear-regression-model"><i class="fa fa-check"></i><b>2.6.3</b> Formulation of the linear regression model</a></li>
<li class="chapter" data-level="2.6.4" data-path="Chapter3.html"><a href="Chapter3.html#application-of-the-linear-regression-model"><i class="fa fa-check"></i><b>2.6.4</b> Application of the linear regression model</a></li>
<li class="chapter" data-level="2.6.5" data-path="Chapter3.html"><a href="Chapter3.html#formulation-of-the-gls-model"><i class="fa fa-check"></i><b>2.6.5</b> Formulation of the GLS model</a></li>
<li class="chapter" data-level="2.6.6" data-path="Chapter3.html"><a href="Chapter3.html#implementation-using-the-gls-function"><i class="fa fa-check"></i><b>2.6.6</b> Implementation using the gls function</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="Chapter3.html"><a href="Chapter3.html#multiple-time-series"><i class="fa fa-check"></i><b>2.7</b> Multiple time series</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chapter4.html"><a href="Chapter4.html"><i class="fa fa-check"></i><b>3</b> Spatial data and GLS</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Chapter4.html"><a href="Chapter4.html#variogram-models-for-spatial-dependency"><i class="fa fa-check"></i><b>3.1</b> Variogram models for spatial dependency</a></li>
<li class="chapter" data-level="3.2" data-path="Chapter4.html"><a href="Chapter4.html#application-on-the-irish-ph-data"><i class="fa fa-check"></i><b>3.2</b> Application on the Irish pH data</a></li>
<li class="chapter" data-level="3.3" data-path="Chapter4.html"><a href="Chapter4.html#s4-3"><i class="fa fa-check"></i><b>3.3</b> Matern correlation function</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chapter5.html"><a href="Chapter5.html"><i class="fa fa-check"></i><b>4</b> Linear mixed-effects models and dependency</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Chapter5.html"><a href="Chapter5.html#white-storks"><i class="fa fa-check"></i><b>4.1</b> White Storks</a></li>
<li class="chapter" data-level="4.2" data-path="Chapter5.html"><a href="Chapter5.html#considering-the-data-wrongly-as-one-way-nested"><i class="fa fa-check"></i><b>4.2</b> Considering the data (wrongly) as one-way nested</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="Chapter5.html"><a href="Chapter5.html#model-formulation"><i class="fa fa-check"></i><b>4.2.1</b> model formulation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="Chapter5.html"><a href="Chapter5.html#fitting-the-one-way-nested-model-using-lmer"><i class="fa fa-check"></i><b>4.3</b> Fitting the one-way nested model using lmer</a></li>
<li class="chapter" data-level="4.4" data-path="Chapter5.html"><a href="Chapter5.html#model-validation-2"><i class="fa fa-check"></i><b>4.4</b> Model validation</a></li>
<li class="chapter" data-level="4.5" data-path="Chapter5.html"><a href="Chapter5.html#sketching-the-fitted-value"><i class="fa fa-check"></i><b>4.5</b> Sketching the fitted value</a></li>
<li class="chapter" data-level="4.6" data-path="Chapter5.html"><a href="Chapter5.html#considering-the-data-correctly-as-two-way-nested"><i class="fa fa-check"></i><b>4.6</b> Considering the data (correctly) as two-way nested</a></li>
<li class="chapter" data-level="4.7" data-path="Chapter5.html"><a href="Chapter5.html#differences-with-the-ar1-process-approach"><i class="fa fa-check"></i><b>4.7</b> Differences with the AR1 process approach</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Chapter6.html"><a href="Chapter6.html"><i class="fa fa-check"></i><b>5</b> Modelling space explicitly</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Chapter6.html"><a href="Chapter6.html#model-formulation-1"><i class="fa fa-check"></i><b>5.1</b> Model formulation</a></li>
<li class="chapter" data-level="5.2" data-path="Chapter6.html"><a href="Chapter6.html#s6-2"><i class="fa fa-check"></i><b>5.2</b> Covariance matrix of the spatial random effect</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="Chapter6.html"><a href="Chapter6.html#simulation-study"><i class="fa fa-check"></i><b>5.2.1</b> Simulation study</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="Chapter6.html"><a href="Chapter6.html#spatial-temporal-correlation"><i class="fa fa-check"></i><b>5.3</b> Spatial-temporal correlation</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="Chapter6.html"><a href="Chapter6.html#simulation-study-continued"><i class="fa fa-check"></i><b>5.3.1</b> Simulation study (continued)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Chapter7.html"><a href="Chapter7.html"><i class="fa fa-check"></i><b>6</b> Introduction to Bayesian statistics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Chapter7.html"><a href="Chapter7.html#why-go-bayesian"><i class="fa fa-check"></i><b>6.1</b> Why go Bayesian?</a></li>
<li class="chapter" data-level="6.2" data-path="Chapter7.html"><a href="Chapter7.html#s7-2"><i class="fa fa-check"></i><b>6.2</b> General probability rules</a></li>
<li class="chapter" data-level="6.3" data-path="Chapter7.html"><a href="Chapter7.html#s7-3"><i class="fa fa-check"></i><b>6.3</b> The mean of a distribution</a></li>
<li class="chapter" data-level="6.4" data-path="Chapter7.html"><a href="Chapter7.html#bayes-theorem-again"><i class="fa fa-check"></i><b>6.4</b> Bayes theorem again</a></li>
<li class="chapter" data-level="6.5" data-path="Chapter7.html"><a href="Chapter7.html#s7-5"><i class="fa fa-check"></i><b>6.5</b> Conjugate priors</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="Chapter7.html"><a href="Chapter7.html#likelihood-function"><i class="fa fa-check"></i><b>6.5.1</b> Likelihood function</a></li>
<li class="chapter" data-level="6.5.2" data-path="Chapter7.html"><a href="Chapter7.html#priors"><i class="fa fa-check"></i><b>6.5.2</b> Priors</a></li>
<li class="chapter" data-level="6.5.3" data-path="Chapter7.html"><a href="Chapter7.html#posterior-distribution"><i class="fa fa-check"></i><b>6.5.3</b> Posterior distribution</a></li>
<li class="chapter" data-level="6.5.4" data-path="Chapter7.html"><a href="Chapter7.html#diffuse-prior"><i class="fa fa-check"></i><b>6.5.4</b> Diffuse prior</a></li>
<li class="chapter" data-level="6.5.5" data-path="Chapter7.html"><a href="Chapter7.html#informative-prior"><i class="fa fa-check"></i><b>6.5.5</b> Informative prior</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="Chapter7.html"><a href="Chapter7.html#markov-chain-monte-carlo-simulation"><i class="fa fa-check"></i><b>6.6</b> Markov chain Monte Carlo simulation</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="Chapter7.html"><a href="Chapter7.html#underlying-idea"><i class="fa fa-check"></i><b>6.6.1</b> underlying idea</a></li>
<li class="chapter" data-level="6.6.2" data-path="Chapter7.html"><a href="Chapter7.html#simple-example-of-mcmc-algorithm"><i class="fa fa-check"></i><b>6.6.2</b> Simple example of MCMC algorithm</a></li>
<li class="chapter" data-level="6.6.3" data-path="Chapter7.html"><a href="Chapter7.html#methods-in-mcmc"><i class="fa fa-check"></i><b>6.6.3</b> Methods in MCMC</a></li>
<li class="chapter" data-level="6.6.4" data-path="Chapter7.html"><a href="Chapter7.html#flowchart-for-running-a-model-in-stan"><i class="fa fa-check"></i><b>6.6.4</b> Flowchart for running a model in Stan</a>
<ul>
<li class="chapter" data-level="6.6.4.1" data-path="Chapter7.html"><a href="Chapter7.html#preparing-the-data-for-stan"><i class="fa fa-check"></i><b>6.6.4.1</b> Preparing the data for Stan</a></li>
<li class="chapter" data-level="6.6.4.2" data-path="Chapter7.html"><a href="Chapter7.html#decide-model-formulation-and-priors"><i class="fa fa-check"></i><b>6.6.4.2</b> Decide model formulation and priors</a></li>
<li class="chapter" data-level="6.6.4.3" data-path="Chapter7.html"><a href="Chapter7.html#preparing-stan-file"><i class="fa fa-check"></i><b>6.6.4.3</b> Preparing stan file</a></li>
<li class="chapter" data-level="6.6.4.4" data-path="Chapter7.html"><a href="Chapter7.html#initial-values"><i class="fa fa-check"></i><b>6.6.4.4</b> Initial values</a></li>
</ul></li>
<li class="chapter" data-level="6.6.5" data-path="Chapter7.html"><a href="Chapter7.html#running-model-in-stan"><i class="fa fa-check"></i><b>6.6.5</b> Running model in Stan</a></li>
<li class="chapter" data-level="6.6.6" data-path="Chapter7.html"><a href="Chapter7.html#assess-mixing"><i class="fa fa-check"></i><b>6.6.6</b> Assess mixing</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="Chapter7.html"><a href="Chapter7.html#integrated-nested-laplace-approximation"><i class="fa fa-check"></i><b>6.7</b> Integrated nested Laplace approximation</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="Chapter7.html"><a href="Chapter7.html#joint-posterior-distribution"><i class="fa fa-check"></i><b>6.7.1</b> Joint posterior distribution</a></li>
<li class="chapter" data-level="6.7.2" data-path="Chapter7.html"><a href="Chapter7.html#marginal-distributions"><i class="fa fa-check"></i><b>6.7.2</b> Marginal distributions</a></li>
<li class="chapter" data-level="6.7.3" data-path="Chapter7.html"><a href="Chapter7.html#back-to-high-school"><i class="fa fa-check"></i><b>6.7.3</b> Back to high school</a></li>
<li class="chapter" data-level="6.7.4" data-path="Chapter7.html"><a href="Chapter7.html#inla"><i class="fa fa-check"></i><b>6.7.4</b> INLA</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="Chapter7.html"><a href="Chapter7.html#examples-using-r-inla"><i class="fa fa-check"></i><b>6.8</b> Examples using R-INLA</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="Chapter7.html"><a href="Chapter7.html#s7-8-1"><i class="fa fa-check"></i><b>6.8.1</b> Posterior summary</a></li>
<li class="chapter" data-level="6.8.2" data-path="Chapter7.html"><a href="Chapter7.html#posterior-marginal-distributions"><i class="fa fa-check"></i><b>6.8.2</b> Posterior marginal distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="Chapter7.html"><a href="Chapter7.html#追記"><i class="fa fa-check"></i><b>6.9</b> 追記</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Chapter8.html"><a href="Chapter8.html"><i class="fa fa-check"></i><b>7</b> Multiple linear regression in R-INLA</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Chapter8.html"><a href="Chapter8.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="Chapter8.html"><a href="Chapter8.html#data-exploration"><i class="fa fa-check"></i><b>7.2</b> Data exploration</a></li>
<li class="chapter" data-level="7.3" data-path="Chapter8.html"><a href="Chapter8.html#linear-regression-result"><i class="fa fa-check"></i><b>7.3</b> Linear regression result</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="Chapter8.html"><a href="Chapter8.html#executing-the-model-in-rinla"><i class="fa fa-check"></i><b>7.3.1</b> Executing the model in R=INLA</a></li>
<li class="chapter" data-level="7.3.2" data-path="Chapter8.html"><a href="Chapter8.html#output-for-betas"><i class="fa fa-check"></i><b>7.3.2</b> Output for betas</a>
<ul>
<li class="chapter" data-level="7.3.2.1" data-path="Chapter8.html"><a href="Chapter8.html#numerical-output-for-the-betas"><i class="fa fa-check"></i><b>7.3.2.1</b> Numerical output for the betas</a></li>
<li class="chapter" data-level="7.3.2.2" data-path="Chapter8.html"><a href="Chapter8.html#graphical-output-for-the-betas"><i class="fa fa-check"></i><b>7.3.2.2</b> Graphical output for the betas</a></li>
</ul></li>
<li class="chapter" data-level="7.3.3" data-path="Chapter8.html"><a href="Chapter8.html#output-for-hyperparameters"><i class="fa fa-check"></i><b>7.3.3</b> Output for hyperparameters</a>
<ul>
<li class="chapter" data-level="7.3.3.1" data-path="Chapter8.html"><a href="Chapter8.html#numerical-output-for-hyper-parameters"><i class="fa fa-check"></i><b>7.3.3.1</b> Numerical output for hyper parameters</a></li>
<li class="chapter" data-level="7.3.3.2" data-path="Chapter8.html"><a href="Chapter8.html#graphical-output-for-the-hyperparameters"><i class="fa fa-check"></i><b>7.3.3.2</b> Graphical output for the hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="7.3.4" data-path="Chapter8.html"><a href="Chapter8.html#fitted-model"><i class="fa fa-check"></i><b>7.3.4</b> Fitted model</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="Chapter8.html"><a href="Chapter8.html#model-validation-3"><i class="fa fa-check"></i><b>7.4</b> Model validation</a></li>
<li class="chapter" data-level="7.5" data-path="Chapter8.html"><a href="Chapter8.html#model-selection"><i class="fa fa-check"></i><b>7.5</b> Model selection</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="Chapter8.html"><a href="Chapter8.html#what-should-we-do"><i class="fa fa-check"></i><b>7.5.1</b> What should we do?</a></li>
<li class="chapter" data-level="7.5.2" data-path="Chapter8.html"><a href="Chapter8.html#usind-the-dic"><i class="fa fa-check"></i><b>7.5.2</b> Usind the DIC</a>
<ul>
<li class="chapter" data-level="7.5.2.1" data-path="Chapter8.html"><a href="Chapter8.html#effective-number-of-parameters"><i class="fa fa-check"></i><b>7.5.2.1</b> Effective number of parameters</a></li>
<li class="chapter" data-level="7.5.2.2" data-path="Chapter8.html"><a href="Chapter8.html#dic-related-output"><i class="fa fa-check"></i><b>7.5.2.2</b> DIC related output</a></li>
<li class="chapter" data-level="7.5.2.3" data-path="Chapter8.html"><a href="Chapter8.html#model-selection-using-dic"><i class="fa fa-check"></i><b>7.5.2.3</b> Model selection using DIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5.3" data-path="Chapter8.html"><a href="Chapter8.html#waic"><i class="fa fa-check"></i><b>7.5.3</b> WAIC</a></li>
<li class="chapter" data-level="7.5.4" data-path="Chapter8.html"><a href="Chapter8.html#out-of-sample-prediction"><i class="fa fa-check"></i><b>7.5.4</b> Out of sample prediction</a></li>
<li class="chapter" data-level="7.5.5" data-path="Chapter8.html"><a href="Chapter8.html#posterior-predictive-check"><i class="fa fa-check"></i><b>7.5.5</b> Posterior predictive check</a>
<ul>
<li class="chapter" data-level="7.5.5.1" data-path="Chapter8.html"><a href="Chapter8.html#zuur-2017の方法"><i class="fa fa-check"></i><b>7.5.5.1</b> Zuur (2017)の方法</a></li>
<li class="chapter" data-level="7.5.5.2" data-path="Chapter8.html"><a href="Chapter8.html#s8-5-5-2"><i class="fa fa-check"></i><b>7.5.5.2</b> 正しい方法</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="Chapter8.html"><a href="Chapter8.html#s8-6"><i class="fa fa-check"></i><b>7.6</b> Visualizing the model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Chapter9.html"><a href="Chapter9.html"><i class="fa fa-check"></i><b>8</b> Mixed effects modelling in R-INLA to analysis otolith data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Chapter9.html"><a href="Chapter9.html#otoliths-in-plaice"><i class="fa fa-check"></i><b>8.1</b> Otoliths in plaice</a></li>
<li class="chapter" data-level="8.2" data-path="Chapter9.html"><a href="Chapter9.html#model-formulation-2"><i class="fa fa-check"></i><b>8.2</b> Model formulation</a></li>
<li class="chapter" data-level="8.3" data-path="Chapter9.html"><a href="Chapter9.html#dependency-1"><i class="fa fa-check"></i><b>8.3</b> Dependency</a></li>
<li class="chapter" data-level="8.4" data-path="Chapter9.html"><a href="Chapter9.html#data-exploration-1"><i class="fa fa-check"></i><b>8.4</b> Data exploration</a></li>
<li class="chapter" data-level="8.5" data-path="Chapter9.html"><a href="Chapter9.html#running-the-model-in-r-inla"><i class="fa fa-check"></i><b>8.5</b> Running the model in R-INLA</a></li>
<li class="chapter" data-level="8.6" data-path="Chapter9.html"><a href="Chapter9.html#model-validation-4"><i class="fa fa-check"></i><b>8.6</b> Model validation</a></li>
<li class="chapter" data-level="8.7" data-path="Chapter9.html"><a href="Chapter9.html#model-selection-1"><i class="fa fa-check"></i><b>8.7</b> Model selection</a></li>
<li class="chapter" data-level="8.8" data-path="Chapter9.html"><a href="Chapter9.html#model-interpretation"><i class="fa fa-check"></i><b>8.8</b> Model interpretation</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="Chapter9.html"><a href="Chapter9.html#option-1-for-prediction-adding-extra-data"><i class="fa fa-check"></i><b>8.8.1</b> Option 1 for prediction: Adding extra data</a></li>
<li class="chapter" data-level="8.8.2" data-path="Chapter9.html"><a href="Chapter9.html#s9-8-2"><i class="fa fa-check"></i><b>8.8.2</b> Option 2 for prediction: Using the <code>inla.make.lincombs</code></a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="Chapter9.html"><a href="Chapter9.html#multiple-random-effects"><i class="fa fa-check"></i><b>8.9</b> Multiple random effects</a></li>
<li class="chapter" data-level="8.10" data-path="Chapter9.html"><a href="Chapter9.html#changin-prior-of-fixed-parameters"><i class="fa fa-check"></i><b>8.10</b> Changin prior of fixed parameters</a></li>
<li class="chapter" data-level="8.11" data-path="Chapter9.html"><a href="Chapter9.html#changing-priors-of-hyperparameters"><i class="fa fa-check"></i><b>8.11</b> Changing priors of hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Chapter10.html"><a href="Chapter10.html"><i class="fa fa-check"></i><b>9</b> Poisson, negative binomial, binomial and g amma GLMs in R-INLA</a>
<ul>
<li class="chapter" data-level="9.1" data-path="Chapter10.html"><a href="Chapter10.html#poisson-and-negative-binomial-glms-in-r-inla"><i class="fa fa-check"></i><b>9.1</b> Poisson and negative binomial GLMs in R-INLA</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="Chapter10.html"><a href="Chapter10.html#introduction-1"><i class="fa fa-check"></i><b>9.1.1</b> Introduction</a></li>
<li class="chapter" data-level="9.1.2" data-path="Chapter10.html"><a href="Chapter10.html#data-exploration-2"><i class="fa fa-check"></i><b>9.1.2</b> Data exploration</a></li>
<li class="chapter" data-level="9.1.3" data-path="Chapter10.html"><a href="Chapter10.html#poisson-glm-an-r-inla"><i class="fa fa-check"></i><b>9.1.3</b> Poisson GLM an R-INLA</a>
<ul>
<li class="chapter" data-level="9.1.3.1" data-path="Chapter10.html"><a href="Chapter10.html#s10-1-3-1"><i class="fa fa-check"></i><b>9.1.3.1</b> Checking overdispersion</a></li>
</ul></li>
<li class="chapter" data-level="9.1.4" data-path="Chapter10.html"><a href="Chapter10.html#negative-binomial-glm-in-r-inla"><i class="fa fa-check"></i><b>9.1.4</b> Negative binomial GLM in R-INLA</a></li>
<li class="chapter" data-level="9.1.5" data-path="Chapter10.html"><a href="Chapter10.html#model-selection-for-the-nb-glm"><i class="fa fa-check"></i><b>9.1.5</b> Model selection for the NB GLM</a></li>
<li class="chapter" data-level="9.1.6" data-path="Chapter10.html"><a href="Chapter10.html#visualization-of-the-nb-glm"><i class="fa fa-check"></i><b>9.1.6</b> Visualization of the NB GLM</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="Chapter10.html"><a href="Chapter10.html#bernoulli-and-binomial-glm"><i class="fa fa-check"></i><b>9.2</b> Bernoulli and binomial GLM</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="Chapter10.html"><a href="Chapter10.html#bernoulli-glm"><i class="fa fa-check"></i><b>9.2.1</b> Bernoulli GLM</a></li>
<li class="chapter" data-level="9.2.2" data-path="Chapter10.html"><a href="Chapter10.html#model-selection-with-the-marginal-likelihood"><i class="fa fa-check"></i><b>9.2.2</b> 10.2.2 Model selection with the marginal likelihood</a></li>
<li class="chapter" data-level="9.2.3" data-path="Chapter10.html"><a href="Chapter10.html#binomial-glm"><i class="fa fa-check"></i><b>9.2.3</b> Binomial GLM</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="Chapter10.html"><a href="Chapter10.html#gamma-glm"><i class="fa fa-check"></i><b>9.3</b> Gamma GLM</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Chapter11.html"><a href="Chapter11.html"><i class="fa fa-check"></i><b>10</b> Matern correlation and SPDE</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Chapter11.html"><a href="Chapter11.html#continuous-gaussian-field"><i class="fa fa-check"></i><b>10.1</b> Continuous Gaussian field</a></li>
<li class="chapter" data-level="10.2" data-path="Chapter11.html"><a href="Chapter11.html#models-that-we-have-in-mind"><i class="fa fa-check"></i><b>10.2</b> Models that we have in mind</a></li>
<li class="chapter" data-level="10.3" data-path="Chapter11.html"><a href="Chapter11.html#matern-correlation"><i class="fa fa-check"></i><b>10.3</b> Matern correlation</a></li>
<li class="chapter" data-level="10.4" data-path="Chapter11.html"><a href="Chapter11.html#spde-approach"><i class="fa fa-check"></i><b>10.4</b> SPDE approach</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="Chapter11.html"><a href="Chapter11.html#mesh"><i class="fa fa-check"></i><b>10.4.1</b> Mesh</a></li>
<li class="chapter" data-level="10.4.2" data-path="Chapter11.html"><a href="Chapter11.html#finite-element-approach"><i class="fa fa-check"></i><b>10.4.2</b> Finite element approach</a></li>
<li class="chapter" data-level="10.4.3" data-path="Chapter11.html"><a href="Chapter11.html#simulation-study-with-five-points"><i class="fa fa-check"></i><b>10.4.3</b> Simulation study with five points</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="Chapter11.html"><a href="Chapter11.html#weighting-factors-again"><i class="fa fa-check"></i><b>10.5</b> Weighting factors … again</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Chapter12.html"><a href="Chapter12.html"><i class="fa fa-check"></i><b>11</b> Linear regression model with spatial dependency for the Irish pH data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Chapter12.html"><a href="Chapter12.html#introduction-2"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="Chapter12.html"><a href="Chapter12.html#model-formulation-3"><i class="fa fa-check"></i><b>11.2</b> Model formulation</a></li>
<li class="chapter" data-level="11.3" data-path="Chapter12.html"><a href="Chapter12.html#linear-regression-results"><i class="fa fa-check"></i><b>11.3</b> Linear regression results</a></li>
<li class="chapter" data-level="11.4" data-path="Chapter12.html"><a href="Chapter12.html#model-validation-5"><i class="fa fa-check"></i><b>11.4</b> Model validation</a></li>
<li class="chapter" data-level="11.5" data-path="Chapter12.html"><a href="Chapter12.html#adding-spatial-correlation-to-the-model"><i class="fa fa-check"></i><b>11.5</b> Adding spatial correlation to the model</a></li>
<li class="chapter" data-level="11.6" data-path="Chapter12.html"><a href="Chapter12.html#defining-the-mesh-for-the-irish-ph-data"><i class="fa fa-check"></i><b>11.6</b> Defining the mesh for the Irish pH data</a></li>
<li class="chapter" data-level="11.7" data-path="Chapter12.html"><a href="Chapter12.html#define-the-weight-factor-aik"><i class="fa fa-check"></i><b>11.7</b> Define the weight factor aik</a></li>
<li class="chapter" data-level="11.8" data-path="Chapter12.html"><a href="Chapter12.html#define-the-spde"><i class="fa fa-check"></i><b>11.8</b> Define the SPDE</a></li>
<li class="chapter" data-level="11.9" data-path="Chapter12.html"><a href="Chapter12.html#define-the-spatial-field"><i class="fa fa-check"></i><b>11.9</b> Define the spatial field</a></li>
<li class="chapter" data-level="11.10" data-path="Chapter12.html"><a href="Chapter12.html#define-the-stack"><i class="fa fa-check"></i><b>11.10</b> Define the stack</a></li>
<li class="chapter" data-level="11.11" data-path="Chapter12.html"><a href="Chapter12.html#define-the-formula-for-the-spatial-model"><i class="fa fa-check"></i><b>11.11</b> Define the formula for the spatial model</a></li>
<li class="chapter" data-level="11.12" data-path="Chapter12.html"><a href="Chapter12.html#execute-the-spatial-model-in-r"><i class="fa fa-check"></i><b>11.12</b> Execute the spatial model in R</a></li>
<li class="chapter" data-level="11.13" data-path="Chapter12.html"><a href="Chapter12.html#results"><i class="fa fa-check"></i><b>11.13</b> Results</a></li>
<li class="chapter" data-level="11.14" data-path="Chapter12.html"><a href="Chapter12.html#model-selection-2"><i class="fa fa-check"></i><b>11.14</b> Model selection</a></li>
<li class="chapter" data-level="11.15" data-path="Chapter12.html"><a href="Chapter12.html#model-validation-6"><i class="fa fa-check"></i><b>11.15</b> Model validation</a></li>
<li class="chapter" data-level="11.16" data-path="Chapter12.html"><a href="Chapter12.html#s12-16"><i class="fa fa-check"></i><b>11.16</b> Model interpretation</a></li>
<li class="chapter" data-level="11.17" data-path="Chapter12.html"><a href="Chapter12.html#detailed-information-about-the-stack"><i class="fa fa-check"></i><b>11.17</b> Detailed information about the stack</a>
<ul>
<li class="chapter" data-level="11.17.1" data-path="Chapter12.html"><a href="Chapter12.html#stack-for-the-fitted-model-again"><i class="fa fa-check"></i><b>11.17.1</b> Stack for the fitted model again</a></li>
<li class="chapter" data-level="11.17.2" data-path="Chapter12.html"><a href="Chapter12.html#stack-for-the-new-covariate-values"><i class="fa fa-check"></i><b>11.17.2</b> Stack for the new covariate values</a></li>
<li class="chapter" data-level="11.17.3" data-path="Chapter12.html"><a href="Chapter12.html#combine-the-two-stacks"><i class="fa fa-check"></i><b>11.17.3</b> Combine the two stacks</a></li>
<li class="chapter" data-level="11.17.4" data-path="Chapter12.html"><a href="Chapter12.html#run-the-model"><i class="fa fa-check"></i><b>11.17.4</b> Run the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="Chapter13.html"><a href="Chapter13.html"><i class="fa fa-check"></i><b>12</b> Spatial Poisson models applied to plant diversity</a>
<ul>
<li class="chapter" data-level="12.1" data-path="Chapter13.html"><a href="Chapter13.html#introduction-3"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="Chapter13.html"><a href="Chapter13.html#data-exploration-3"><i class="fa fa-check"></i><b>12.2</b> Data exploration</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="Chapter13.html"><a href="Chapter13.html#sampling-locations"><i class="fa fa-check"></i><b>12.2.1</b> Sampling locations</a></li>
<li class="chapter" data-level="12.2.2" data-path="Chapter13.html"><a href="Chapter13.html#outliers"><i class="fa fa-check"></i><b>12.2.2</b> Outliers</a></li>
<li class="chapter" data-level="12.2.3" data-path="Chapter13.html"><a href="Chapter13.html#collinearity"><i class="fa fa-check"></i><b>12.2.3</b> Collinearity</a></li>
<li class="chapter" data-level="12.2.4" data-path="Chapter13.html"><a href="Chapter13.html#relationships"><i class="fa fa-check"></i><b>12.2.4</b> Relationships</a></li>
<li class="chapter" data-level="12.2.5" data-path="Chapter13.html"><a href="Chapter13.html#number-of-zeros"><i class="fa fa-check"></i><b>12.2.5</b> Number of zeros</a></li>
<li class="chapter" data-level="12.2.6" data-path="Chapter13.html"><a href="Chapter13.html#conclusions-data-exploration"><i class="fa fa-check"></i><b>12.2.6</b> Conclusions data exploration</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="Chapter13.html"><a href="Chapter13.html#model-formulation-4"><i class="fa fa-check"></i><b>12.3</b> Model formulation</a></li>
<li class="chapter" data-level="12.4" data-path="Chapter13.html"><a href="Chapter13.html#glm-results"><i class="fa fa-check"></i><b>12.4</b> GLM results</a></li>
<li class="chapter" data-level="12.5" data-path="Chapter13.html"><a href="Chapter13.html#adding-spatial-correlation-to-the-model-1"><i class="fa fa-check"></i><b>12.5</b> Adding spatial correlation to the model</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="Chapter13.html"><a href="Chapter13.html#model-formulation-5"><i class="fa fa-check"></i><b>12.5.1</b> Model formulation</a></li>
<li class="chapter" data-level="12.5.2" data-path="Chapter13.html"><a href="Chapter13.html#mesh-1"><i class="fa fa-check"></i><b>12.5.2</b> Mesh</a></li>
<li class="chapter" data-level="12.5.3" data-path="Chapter13.html"><a href="Chapter13.html#projector-matrix"><i class="fa fa-check"></i><b>12.5.3</b> Projector matrix</a></li>
<li class="chapter" data-level="12.5.4" data-path="Chapter13.html"><a href="Chapter13.html#spde"><i class="fa fa-check"></i><b>12.5.4</b> SPDE</a></li>
<li class="chapter" data-level="12.5.5" data-path="Chapter13.html"><a href="Chapter13.html#spatial-field"><i class="fa fa-check"></i><b>12.5.5</b> Spatial field</a></li>
<li class="chapter" data-level="12.5.6" data-path="Chapter13.html"><a href="Chapter13.html#stack"><i class="fa fa-check"></i><b>12.5.6</b> Stack</a></li>
<li class="chapter" data-level="12.5.7" data-path="Chapter13.html"><a href="Chapter13.html#formula"><i class="fa fa-check"></i><b>12.5.7</b> Formula</a></li>
<li class="chapter" data-level="12.5.8" data-path="Chapter13.html"><a href="Chapter13.html#run-r-inla"><i class="fa fa-check"></i><b>12.5.8</b> Run R-INLA</a></li>
<li class="chapter" data-level="12.5.9" data-path="Chapter13.html"><a href="Chapter13.html#inspect-results"><i class="fa fa-check"></i><b>12.5.9</b> Inspect results</a>
<ul>
<li class="chapter" data-level="12.5.9.1" data-path="Chapter13.html"><a href="Chapter13.html#plotting-interpolated-wk"><i class="fa fa-check"></i><b>12.5.9.1</b> Plotting interpolated wk</a></li>
<li class="chapter" data-level="12.5.9.2" data-path="Chapter13.html"><a href="Chapter13.html#plotting-the-random-intercepts-ui"><i class="fa fa-check"></i><b>12.5.9.2</b> Plotting the random intercepts ui</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="Chapter13.html"><a href="Chapter13.html#simulating-from-the-model"><i class="fa fa-check"></i><b>12.6</b> Simulating from the model</a></li>
<li class="chapter" data-level="12.7" data-path="Chapter13.html"><a href="Chapter13.html#what-to-write-in-a-paper"><i class="fa fa-check"></i><b>12.7</b> What to write in a paper</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="Chapter14.html"><a href="Chapter14.html"><i class="fa fa-check"></i><b>13</b> Time-series analysis in R-INLA</a>
<ul>
<li class="chapter" data-level="13.1" data-path="Chapter14.html"><a href="Chapter14.html#simulation-study-1"><i class="fa fa-check"></i><b>13.1</b> Simulation study</a></li>
<li class="chapter" data-level="13.2" data-path="Chapter14.html"><a href="Chapter14.html#trends-in-migration-dates-of-sockeye-salmon"><i class="fa fa-check"></i><b>13.2</b> Trends in migration dates of sockeye salmon</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="Chapter14.html"><a href="Chapter14.html#applying-a-random-walk-trend-model"><i class="fa fa-check"></i><b>13.2.1</b> Applying a random walk trend model</a></li>
<li class="chapter" data-level="13.2.2" data-path="Chapter14.html"><a href="Chapter14.html#posterior-distribution-of-sigmas"><i class="fa fa-check"></i><b>13.2.2</b> Posterior distribution of sigmas</a></li>
<li class="chapter" data-level="13.2.3" data-path="Chapter14.html"><a href="Chapter14.html#covariates-and-trends"><i class="fa fa-check"></i><b>13.2.3</b> Covariates and trends</a></li>
<li class="chapter" data-level="13.2.4" data-path="Chapter14.html"><a href="Chapter14.html#making-the-trend-smoother"><i class="fa fa-check"></i><b>13.2.4</b> Making the trend smoother</a>
<ul>
<li class="chapter" data-level="13.2.4.1" data-path="Chapter14.html"><a href="Chapter14.html#changing-the-values-of-the-gamma-prior"><i class="fa fa-check"></i><b>13.2.4.1</b> Changing the values of the gamma prior</a></li>
<li class="chapter" data-level="13.2.4.2" data-path="Chapter14.html"><a href="Chapter14.html#changing-the-gamma-prior-to-the-pc-prior"><i class="fa fa-check"></i><b>13.2.4.2</b> changing the gamma prior to the PC prior</a></li>
<li class="chapter" data-level="13.2.4.3" data-path="Chapter14.html"><a href="Chapter14.html#changing-the-random-walk-model-rw2"><i class="fa fa-check"></i><b>13.2.4.3</b> Changing the random walk model: rw2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="Chapter14.html"><a href="Chapter14.html#trends-in-polar-bear-movements"><i class="fa fa-check"></i><b>13.3</b> Trends in polar bear movements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to spatial-temporal data anlysis using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="poisson-negative-binomial-binomial-and-g-amma-glms-in-r-inla" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">9</span> Poisson, negative binomial, binomial and g amma GLMs in R-INLA<a href="Chapter10.html#poisson-negative-binomial-binomial-and-g-amma-glms-in-r-inla" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>本章では、ポワソン分布、負の二項分布、二項分布、そしてガンマ分布の一般化線形モデル(GLM: generalized linea model)を<code>INLA</code>で行う方法を学ぶ。</p>
<div id="poisson-and-negative-binomial-glms-in-r-inla" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Poisson and negative binomial GLMs in R-INLA<a href="Chapter10.html#poisson-and-negative-binomial-glms-in-r-inla" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="introduction-1" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Introduction<a href="Chapter10.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>本節では、ブラジルに生息するトラギスという魚の体表にいる寄生虫の数を分析した <span class="citation">Timi et al. (<a href="#ref-Timi2008">2008</a>)</span> の研究データを用いる。魚のサンプルはアルゼンチンの3つの海域で採集された(<code>Location</code>)。また、性別(<code>SEX</code>)、体長(<code>LT</code>)、重さ(<code>Weight</code>)、矢状長(<code>LS</code>)が測定されている。<code>Location</code>と<code>Sex</code>は因子型に変換しておく。</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="Chapter10.html#cb252-1" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;data/Turcoparasitos.txt&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb252-2"><a href="Chapter10.html#cb252-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fSex =</span> <span class="fu">as.factor</span>(SEX),</span>
<span id="cb252-3"><a href="Chapter10.html#cb252-3" tabindex="-1"></a>         <span class="at">fLoc =</span> <span class="fu">as.factor</span>(Location))</span>
<span id="cb252-4"><a href="Chapter10.html#cb252-4" tabindex="-1"></a></span>
<span id="cb252-5"><a href="Chapter10.html#cb252-5" tabindex="-1"></a><span class="fu">datatable</span>(sp,</span>
<span id="cb252-6"><a href="Chapter10.html#cb252-6" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">20</span>),</span>
<span id="cb252-7"><a href="Chapter10.html#cb252-7" tabindex="-1"></a>          <span class="at">filter =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-12412b66d4114932716f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-12412b66d4114932716f">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"160\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"24\" data-max=\"41.5\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"21\" data-max=\"38\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"160\" data-max=\"912\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"190\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;1&quot;,&quot;2&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155"],[107,108,109,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[31.5,34.5,39,28.5,36,34.5,34,32.5,31.5,33,30,31,33.5,37,32.5,31.5,31,31.5,30.5,31.5,30,30,34,38,36,35.5,34,39,32.5,37.5,32,36,34.5,37,33.5,33.5,29,26,35,28,28,31,29,40,34,37.5,34,34.5,35,35.5,33.5,33,31.5,33,39,33.5,29.5,35,33,32,24,35,29.5,30,35,30.6,32.4,34.9,28.5,27,33,36,36,32,33.5,38.5,38.5,37,27.5,37,30.4,36.5,34,29,31,25.3,30.8,27,33.3,34.4,32.9,34,34.3,32.7,38,34.5,34.8,35.5,36,34.4,33.2,30,29.3,29.7,30,35,37.6,40,40.8,36,40,38,39.5,32.7,33,41,36,40.5,40,38,37,37,39,33.5,32,35,36,35.8,38.2,41.5,34.3,37.4,37.2,36.5,32.2,35.5,38,41,39.5,41.5,36.8,40,40.2,38.3,35.8,39.5,40,36,39,35,33,38,27,38,30.5],[27.5,30,34,24.5,31.5,30,29.5,28.5,27.5,29,26,27.35,29.5,32.5,29,28,27.5,27.5,27,28,27,26.5,30,34,31.5,31,29.5,34,28.5,33,28.5,32,30.5,33,29.5,29.5,25.5,23,31,24,24,27,25,35.5,30,33,30,30.5,30.5,31.5,29.5,29,29,29,34,29,26,31,29,27,21,31,26,26,31,26.6,28.3,30.2,25,23.5,29.5,32,31.5,28,29.5,34,33.5,32.5,24,32,26.4,32,29.5,25,27.5,22.2,27.4,24,29.3,30,29,29.5,30,29,33.5,30,30.5,31,31.5,30.2,29.4,26.5,25.8,26,26.5,31,33.4,35.5,35.5,32,35,33.5,35,29,29.5,36.2,31.5,35,34.8,34,32.5,33,34.5,30,28.5,31,31.5,32,34,36,30,33.4,32.8,32.5,28.7,31,33.5,35.5,34.8,36,32.5,35.2,38,33.8,31.4,34.8,35,32,34,31,29,33.5,24,33.5,27],[380,470,696,248,500,508,478,400,468,478,298,364,410,642,420,376,394,372,378,416,356,334,494,804,558,490,496,738,428,624,412,544,580,654,412,472,312,224,614,240,268,366,310,714,448,596,492,500,490,546,462,392,426,426,674,456,316,528,670,354,160,504,324,328,524,364,434,584,278,242,446,504,496,394,426,636,684,658,250,586,346,534,478,328,380,184,350,244,480,496,476,462,490,466,574,548,520,584,532,448,444,346,308,320,364,522,650,702,734,596,696,510,674,374,388,912,494,772,736,612,614,602,674,396,376,436,538,578,726,778,442,598,566,574,334,472,660,796,656,750,582,744,716,668,504,608,754,558,662,458,400,642,210,624,296],[1,2,2,2,2,2,2,1,2,1,1,1,1,2,1,1,1,1,1,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,1,2,2,1,2,2,2,1,2,2,1,2,2,2,2,2,1,2,1,2,1,2,2,2,2,1,2,1,2,2,2,2,1,1,2,2,2,1,1,2,1,1,2,1,2,2,2,2,2,1,2,1,1,2,2,2,1,2,1,2,2,1,2,1,2,2,1,1,1,1,1,2,1,2,2,2,2,2,1,1,2,1,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,1,1,1,1],[60,23,81,11,93,58,31,96,79,62,8,58,42,112,47,43,28,71,38,11,46,26,34,120,27,25,79,35,86,95,54,117,105,113,13,45,18,13,190,8,23,47,18,122,136,108,45,81,183,104,97,60,166,6,4,6,4,28,11,53,0,2,17,34,17,11,2,1,14,41,11,2,2,1,7,4,11,6,3,5,29,1,0,3,3,2,1,2,7,2,4,9,10,6,2,38,2,6,39,4,4,1,16,1,9,28,13,22,17,31,22,36,14,13,50,14,33,15,50,7,24,5,4,10,3,4,24,79,47,10,15,23,8,3,2,15,12,44,5,18,2,5,19,16,11,15,26,9,5,5,1,16,5,4,7],["1","2","2","2","2","2","2","1","2","1","1","1","1","2","1","1","1","1","1","1","2","1","2","2","2","2","2","2","2","2","2","2","2","2","2","1","2","2","2","2","2","2","1","2","2","2","2","2","2","2","2","2","1","1","2","2","1","2","2","2","1","2","2","1","2","2","2","2","2","1","2","1","2","1","2","2","2","2","1","2","1","2","2","2","2","1","1","2","2","2","1","1","2","1","1","2","1","2","2","2","2","2","1","2","1","1","2","2","2","1","2","1","2","2","1","2","1","2","2","1","1","1","1","1","2","1","2","2","2","2","2","1","1","2","1","2","2","2","2","2","2","2","2","1","1","1","1","1","2","2","2","1","1","1","1"],["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>ID<\/th>\n      <th>Location<\/th>\n      <th>LT<\/th>\n      <th>LS<\/th>\n      <th>Weight<\/th>\n      <th>SEX<\/th>\n      <th>Totalparasites<\/th>\n      <th>fSex<\/th>\n      <th>fLoc<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":20,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
</div>
<div id="data-exploration-2" class="section level3 hasAnchor" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Data exploration<a href="Chapter10.html#data-exploration-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>まずはデータの確認を行う。変数のdotplotを見たところ、そこまで極端な外れ値はないよう。</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="Chapter10.html#cb253-1" tabindex="-1"></a>sp <span class="sc">%&gt;%</span> </span>
<span id="cb253-2"><a href="Chapter10.html#cb253-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb253-3"><a href="Chapter10.html#cb253-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb253-4"><a href="Chapter10.html#cb253-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> n))<span class="sc">+</span></span>
<span id="cb253-5"><a href="Chapter10.html#cb253-5" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb253-6"><a href="Chapter10.html#cb253-6" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>name, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb253-7"><a href="Chapter10.html#cb253-7" tabindex="-1"></a>                 <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb253-8"><a href="Chapter10.html#cb253-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Sample number&quot;</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-185-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>続いて、変数間の関係を確認してみる。体重と体長、矢状長はかなり強く相関しており、これらを同じモデルで使うのは望ましくない。本節では、体長のみを用いる。</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="Chapter10.html#cb254-1" tabindex="-1"></a>sp <span class="sc">%&gt;%</span> </span>
<span id="cb254-2"><a href="Chapter10.html#cb254-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb254-3"><a href="Chapter10.html#cb254-3" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-186-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>図<a href="Chapter10.html#fig:sp-scatter">9.1</a>は海域(<code>Location</code>)ごとに体長と寄生虫の数の関連をプロットしたものである。曲線はポワソン分布のGLMを当てはめたものである。明らかに海域によって傾向が違うことが分かる。つまり、モデルには<strong>体長と海域の交互作用を入れる必要がある</strong>。</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="Chapter10.html#cb255-1" tabindex="-1"></a>sp <span class="sc">%&gt;%</span> </span>
<span id="cb255-2"><a href="Chapter10.html#cb255-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LT, <span class="at">y =</span> Totalparasites))<span class="sc">+</span></span>
<span id="cb255-3"><a href="Chapter10.html#cb255-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb255-4"><a href="Chapter10.html#cb255-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb255-5"><a href="Chapter10.html#cb255-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb255-6"><a href="Chapter10.html#cb255-6" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>Location)<span class="sc">+</span></span>
<span id="cb255-7"><a href="Chapter10.html#cb255-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, </span>
<span id="cb255-8"><a href="Chapter10.html#cb255-8" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sp-scatter"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/sp-scatter-1.png" alt="Scatterplot of total number of parasites per fish plotted versus length of the fish. Each pane l corresponds to a location." width="1344" />
<p class="caption">
図9.1: Scatterplot of total number of parasites per fish plotted versus length of the fish. Each pane l corresponds to a location.
</p>
</div>
<p><br/></p>
<p>性別でも見てみたが、こちらはそこまで明確ではない(図<a href="Chapter10.html#fig:sp-scatter2">9.2</a>)。よって、性別については交互作用を考慮しないこととする。</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="Chapter10.html#cb256-1" tabindex="-1"></a>sp <span class="sc">%&gt;%</span> </span>
<span id="cb256-2"><a href="Chapter10.html#cb256-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LT, <span class="at">y =</span> Totalparasites))<span class="sc">+</span></span>
<span id="cb256-3"><a href="Chapter10.html#cb256-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb256-4"><a href="Chapter10.html#cb256-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb256-5"><a href="Chapter10.html#cb256-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb256-6"><a href="Chapter10.html#cb256-6" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span> SEX)<span class="sc">+</span></span>
<span id="cb256-7"><a href="Chapter10.html#cb256-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, </span>
<span id="cb256-8"><a href="Chapter10.html#cb256-8" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sp-scatter2"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/sp-scatter2-1.png" alt="Scatterplot of total number of parasites per fish plotted versus length of the fish. Each pane l corresponds to sex." width="1344" />
<p class="caption">
図9.2: Scatterplot of total number of parasites per fish plotted versus length of the fish. Each pane l corresponds to sex.
</p>
</div>
</div>
<div id="poisson-glm-an-r-inla" class="section level3 hasAnchor" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> Poisson GLM an R-INLA<a href="Chapter10.html#poisson-glm-an-r-inla" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>以上から、以下のモデルを考える。<span class="math inline">\(TP_i\)</span>は寄生虫の数である。なお、回帰係数は省いている。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;TP_i \sim Poisson(\mu_i) \\
&amp;E(TP_i) = \mu_i \; and \; var(TP_i) = \mu_i\\
&amp;log(\mu_i) = Intercept + Sex_i + LT_i + Location_i + LT_i \times Location_i
\end{aligned}
\]</span></p>
<p><code>INLA</code>では以下のように実行できる。</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="Chapter10.html#cb257-1" tabindex="-1"></a>m10_1 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span> fSex <span class="sc">+</span> LT<span class="sc">*</span>fLoc,</span>
<span id="cb257-2"><a href="Chapter10.html#cb257-2" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>,</span>
<span id="cb257-3"><a href="Chapter10.html#cb257-3" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb257-4"><a href="Chapter10.html#cb257-4" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>結果は以下の通り。</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="Chapter10.html#cb258-1" tabindex="-1"></a><span class="fu">summary</span>(m10_1)</span></code></pre></div>
<pre><code>## 
## Call:
##    c(&quot;inla.core(formula = formula, family = family, contrasts = contrasts, 
##    &quot;, &quot; data = data, quantiles = quantiles, E = E, offset = offset, &quot;, &quot; 
##    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, 
##    &quot;, &quot; lp.scale = lp.scale, link.covariates = link.covariates, verbose = 
##    verbose, &quot;, &quot; lincomb = lincomb, selection = selection, control.compute 
##    = control.compute, &quot;, &quot; control.predictor = control.predictor, 
##    control.family = control.family, &quot;, &quot; control.inla = control.inla, 
##    control.fixed = control.fixed, &quot;, &quot; control.mode = control.mode, 
##    control.expert = control.expert, &quot;, &quot; control.hazard = control.hazard, 
##    control.lincomb = control.lincomb, &quot;, &quot; control.update = 
##    control.update, control.lp.scale = control.lp.scale, &quot;, &quot; 
##    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, 
##    &quot;, &quot; inla.call = inla.call, inla.arg = inla.arg, num.threads = 
##    num.threads, &quot;, &quot; blas.num.threads = blas.num.threads, keep = keep, 
##    working.directory = working.directory, &quot;, &quot; silent = silent, inla.mode 
##    = inla.mode, safe = FALSE, debug = debug, &quot;, &quot; .parent.frame = 
##    .parent.frame)&quot;) 
## Time used:
##     Pre = 0.732, Running = 0.471, Post = 0.0719, Total = 1.27 
## Fixed effects:
##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld
## (Intercept)  0.171 0.202     -0.224    0.171      0.567  0.171   0
## fSex2        0.008 0.036     -0.063    0.008      0.079  0.008   0
## LT           0.119 0.006      0.107    0.119      0.131  0.119   0
## fLoc2        2.977 0.462      2.071    2.977      3.883  2.977   0
## fLoc3        0.892 0.484     -0.057    0.892      1.840  0.892   0
## LT:fLoc2    -0.146 0.014     -0.173   -0.146     -0.118 -0.146   0
## LT:fLoc3    -0.071 0.013     -0.096   -0.071     -0.045 -0.071   0
## 
## Deviance Information Criterion (DIC) ...............: 2752.51
## Deviance Information Criterion (DIC, saturated) ....: 2057.57
## Effective number of parameters .....................: -128.12
## 
## Marginal log-Likelihood:  -1552.05 
##  is computed 
## Posterior summaries for the linear predictor and the fitted values are computed
## (Posterior marginals needs also &#39;control.compute=list(return.marginals.predictor=TRUE)&#39;)</code></pre>
<p>この結果から、<span class="math inline">\(log(\mu_i)\)</span>は以下のように書ける。<br />
<span class="math display">\[
\begin{aligned}
log(\mu_i) =
\begin{cases}
0.171 + 0.119 \times LT_i \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; \rm{for \; location = 1, Sex = 1}\\
0.171 + 2.977 + (0.119 - 0.146) \times LT_i \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; \rm{for \; location = 2, Sex = 1}\\
0.171 + 0.892 + (0.119 - 0.071) \times LT_i \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; \rm{for \; location = 3, Sex = 1}\\
0.171 + 0.008 + 0.119 \times LT_i \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; \rm{for \; location = 1, Sex = 2}\\
0.171 + 0.008 + 2.977 + (0.119 - 0.146) \times LT_i \;\;\;\; \rm{for \; location = 2, Sex = 2}\\
0.171 + 0.008 + 0.892 + (0.119 - 0.071) \times LT_i \;\;\;\; \rm{for \; location = 3, Sex = 2}
\end{cases}
\end{aligned}
\]</span></p>
<div id="s10-1-3-1" class="section level4 hasAnchor" number="9.1.3.1">
<h4><span class="header-section-number">9.1.3.1</span> Checking overdispersion<a href="Chapter10.html#s10-1-3-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="calculating-dispersion-parameter" class="section level5 hasAnchor" number="9.1.3.1.1">
<h5><span class="header-section-number">9.1.3.1.1</span> Calculating dispersion parameter<a href="Chapter10.html#calculating-dispersion-parameter" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>モデル選択やモデルの解釈に移る前に、まずはこのデータに対してポワソン分布が適切かを確認する。<strong>過分散</strong>の有無を確認するため、<strong>分散パラメータ</strong>を算出する。分散パラメータ<span class="math inline">\(\phi\)</span>は以下のように計算できる。なお、<span class="math inline">\(N\)</span>はサンプル数、<span class="math inline">\(k\)</span>はパラメータ数である。もし<span class="math inline">\(\phi\)</span>が1を超えていれば過分散が生じており、1以下であれば過少分散である。通常、<span class="math inline">\(\phi = 1.5\)</span>くらいまでであれば問題ないと判断される<span class="citation">(<a href="#ref-Ohigashi2010">健太郎 2010</a>)</span>。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;E_i = \frac{TP_i - E(TP_i)}{\sqrt{var(TP_i)}}\\
&amp;\phi = \frac{\sum_{i=1}^k E_i^2}{N - k}
\end{aligned}
\]</span></p>
<p>Rでは以下のように算出できる。分散パラメータは18.19であり、明らかに過分散が生じている。</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="Chapter10.html#cb260-1" tabindex="-1"></a>mu <span class="ot">&lt;-</span> m10_1<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb260-2"><a href="Chapter10.html#cb260-2" tabindex="-1"></a>E <span class="ot">&lt;-</span> (sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu)</span>
<span id="cb260-3"><a href="Chapter10.html#cb260-3" tabindex="-1"></a></span>
<span id="cb260-4"><a href="Chapter10.html#cb260-4" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sp)</span>
<span id="cb260-5"><a href="Chapter10.html#cb260-5" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">nrow</span>(m10_1<span class="sc">$</span>summary.fixed)</span>
<span id="cb260-6"><a href="Chapter10.html#cb260-6" tabindex="-1"></a></span>
<span id="cb260-7"><a href="Chapter10.html#cb260-7" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(N<span class="sc">-</span>p)</span>
<span id="cb260-8"><a href="Chapter10.html#cb260-8" tabindex="-1"></a></span>
<span id="cb260-9"><a href="Chapter10.html#cb260-9" tabindex="-1"></a>phi</span></code></pre></div>
<pre><code>## [1] 18.18584</code></pre>
</div>
<div id="bayesian-method-for-looking-for-overunder-dispersion" class="section level5 hasAnchor" number="9.1.3.1.2">
<h5><span class="header-section-number">9.1.3.1.2</span> Bayesian method for looking for over/under-dispersion<a href="Chapter10.html#bayesian-method-for-looking-for-overunder-dispersion" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>ただし、ベイズモデリングの場合、事前分布が無情報ではない場合には分散パラメータがそのまま解釈できない可能性がある。そこで、ベイズモデリングでは異なる方法で確認を行う。</p>
<p>MCMCの場合には、各MCMCサンプルごとにデータをシミュレートして実データと比べることで過分散の検討を行える<span class="citation">(<a href="#ref-Zuur2016">Zuur and Ieno 2016</a>)</span>。<code>INLA</code>ではMCMCをしていないので、事後分布から新たなデータをシミュレートし、これを実測値と比較することで過分散がないかを確認する。具体的には、以下の手順を行う。</p>
<ol style="list-style-type: decimal">
<li><code>INLA</code>でGLMを実行する。<br />
</li>
<li>事後分布から1セットの回帰係数<span class="math inline">\(\beta_1, \dots, \beta_7\)</span>をサンプリングする。<br />
</li>
<li>サンプリングしたパラメータを用いて期待値<span class="math inline">\(\bf{\mu} = exp(\bf{X} \times \bf{\beta})\)</span>を算出する。<br />
</li>
<li>計算した期待値から<code>rpois</code>関数を用いてデータをシミュレートする。<br />
</li>
<li>シミュレートしたデータセットのピアソン残差(<span class="math inline">\(E_i\)</span>)を算出し、その平方和(<span class="math inline">\(\sum_i^N E_i^2\)</span>)を計算する。<br />
</li>
<li>2から5を1000回繰り返す。<br />
</li>
<li>シミュレートしたデータセットのピアソン残差の平方和と実測値のピアソン残差の平方和を比較する。</li>
</ol>
<p>シミュレートしたデータセットのピアソン残差の平方和の分布は、もしモデルが正しいときにそれに従うデータセットが持つピアソン残差の平方和の分布である。もし過分散/過少分散が生じているのであれば、実際のデータセットのピアソン残差の平方和がこの分布から外れた値をとるはずである。</p>
<p>それでは、実際に行ってみよう。事後分布からパラメータのサンプリングを行うには、<code>control.compute</code>オプションで<code>config = TRUE</code>とする必要がある。</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="Chapter10.html#cb262-1" tabindex="-1"></a>m10_2 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span> fSex <span class="sc">+</span> LT<span class="sc">*</span>fLoc,</span>
<span id="cb262-2"><a href="Chapter10.html#cb262-2" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>,</span>
<span id="cb262-3"><a href="Chapter10.html#cb262-3" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb262-4"><a href="Chapter10.html#cb262-4" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb262-5"><a href="Chapter10.html#cb262-5" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>それでは、パラメータの事後同時分布から1000セットのパラメータをサンプリングする(第<a href="Chapter8.html#s8-5-5-2">7.5.5.2</a>節を参照)。</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="Chapter10.html#cb263-1" tabindex="-1"></a>sim_param <span class="ot">&lt;-</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n =</span> <span class="dv">1000</span>, m10_2)</span></code></pre></div>
<p>例えば1セット目にサンプリングされた値は以下の通り。なお、ここでは既にサンプリングしたパラメータを用いた期待値<span class="math inline">\(\bf{\mu} = exp(\bf{X} \times \bf{\beta})\)</span>も算出されている(最初の155行)。最後の7行はサンプリングされたパラメータの値である。</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="Chapter10.html#cb264-1" tabindex="-1"></a>sim_param[[<span class="dv">1</span>]]<span class="sc">$</span>latent <span class="sc">%&gt;%</span> </span>
<span id="cb264-2"><a href="Chapter10.html#cb264-2" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb264-3"><a href="Chapter10.html#cb264-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">mu =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb264-4"><a href="Chapter10.html#cb264-4" tabindex="-1"></a>  <span class="fu">datatable</span>()</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2e2e82c5afb675ab1eae" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2e2e82c5afb675ab1eae">{"x":{"filter":"none","vertical":false,"data":[["Predictor:1","Predictor:2","Predictor:3","Predictor:4","Predictor:5","Predictor:6","Predictor:7","Predictor:8","Predictor:9","Predictor:10","Predictor:11","Predictor:12","Predictor:13","Predictor:14","Predictor:15","Predictor:16","Predictor:17","Predictor:18","Predictor:19","Predictor:20","Predictor:21","Predictor:22","Predictor:23","Predictor:24","Predictor:25","Predictor:26","Predictor:27","Predictor:28","Predictor:29","Predictor:30","Predictor:31","Predictor:32","Predictor:33","Predictor:34","Predictor:35","Predictor:36","Predictor:37","Predictor:38","Predictor:39","Predictor:40","Predictor:41","Predictor:42","Predictor:43","Predictor:44","Predictor:45","Predictor:46","Predictor:47","Predictor:48","Predictor:49","Predictor:50","Predictor:51","Predictor:52","Predictor:53","Predictor:54","Predictor:55","Predictor:56","Predictor:57","Predictor:58","Predictor:59","Predictor:60","Predictor:61","Predictor:62","Predictor:63","Predictor:64","Predictor:65","Predictor:66","Predictor:67","Predictor:68","Predictor:69","Predictor:70","Predictor:71","Predictor:72","Predictor:73","Predictor:74","Predictor:75","Predictor:76","Predictor:77","Predictor:78","Predictor:79","Predictor:80","Predictor:81","Predictor:82","Predictor:83","Predictor:84","Predictor:85","Predictor:86","Predictor:87","Predictor:88","Predictor:89","Predictor:90","Predictor:91","Predictor:92","Predictor:93","Predictor:94","Predictor:95","Predictor:96","Predictor:97","Predictor:98","Predictor:99","Predictor:100","Predictor:101","Predictor:102","Predictor:103","Predictor:104","Predictor:105","Predictor:106","Predictor:107","Predictor:108","Predictor:109","Predictor:110","Predictor:111","Predictor:112","Predictor:113","Predictor:114","Predictor:115","Predictor:116","Predictor:117","Predictor:118","Predictor:119","Predictor:120","Predictor:121","Predictor:122","Predictor:123","Predictor:124","Predictor:125","Predictor:126","Predictor:127","Predictor:128","Predictor:129","Predictor:130","Predictor:131","Predictor:132","Predictor:133","Predictor:134","Predictor:135","Predictor:136","Predictor:137","Predictor:138","Predictor:139","Predictor:140","Predictor:141","Predictor:142","Predictor:143","Predictor:144","Predictor:145","Predictor:146","Predictor:147","Predictor:148","Predictor:149","Predictor:150","Predictor:151","Predictor:152","Predictor:153","Predictor:154","Predictor:155","(Intercept):1","fSex2:1","LT:1","fLoc2:1","fLoc3:1","LT:fLoc2:1","LT:fLoc3:1"],[3.96376794084712,4.25596027035663,4.78971132985949,3.54429219101949,4.43387729019092,4.25596027035663,4.19665459707854,4.08237928740331,3.90012623068806,4.14168496068141,3.78585092101284,3.90446226756903,4.2009906339595,4.55248863674711,4.08237928740331,3.96376794084712,3.90446226756903,3.96376794084712,3.84515659429093,3.96376794084712,3.72220921085378,3.78585092101284,4.19665459707854,4.6710999833033,4.43387729019092,4.37457161691282,4.19665459707854,4.78971132985949,4.01873757724425,4.6117943100252,3.95943190396616,4.43387729019092,4.25596027035663,4.55248863674711,4.13734892380044,4.2009906339595,3.60359786429759,3.24776382462902,4.31526594363473,3.4849865177414,3.4849865177414,3.84082055740997,3.66723957445665,4.90832267641568,4.19665459707854,4.6117943100252,4.19665459707854,4.25596027035663,4.31526594363473,4.37457161691282,4.13734892380044,4.07804325052235,3.96376794084712,2.30343885236783,2.11067778495815,2.22903719577122,2.3787584774307,2.19675735645857,2.23979714220878,2.26131703508388,2.49711788824377,2.19675735645857,2.31511676727164,2.36799853099315,2.19675735645857,2.29144488510903,2.25270907793384,2.19890934574608,2.33663666014674,2.43255820961846,2.23979714220878,2.23887917374252,2.17523746358346,2.32495874524294,2.22903719577122,2.12143773139571,2.12143773139571,2.15371757070836,2.42179826318091,2.15371757070836,2.3593905738431,2.16447751714591,2.21827724933367,2.32587671370919,2.28283692795898,2.46914202750613,2.35078261669306,2.3689164994594,2.23334117434624,2.20966929218363,2.30559084165534,2.28191895949273,2.21182128147114,2.30989482023036,2.19583938799232,2.20751730289612,2.26470304519265,2.18599741002102,2.17523746358346,2.20966929218363,2.23549316363375,2.30435682083409,2.38306245600572,2.31081278869662,2.36799853099315,2.72492539027804,2.85507399643775,3.03395736534738,3.09358515498392,2.79946012732372,3.03395736534738,2.94852960141508,2.99668999682454,2.48985378491392,2.57585591618668,3.10849210239306,2.79946012732372,3.07122473387022,3.03395736534738,2.94852960141508,2.8739948643694,2.8739948643694,3.02306433846076,2.61312328470952,2.43767946898194,2.72492539027804,2.73581841716466,2.72091146975552,2.89979483866515,3.1457594709159,2.60910936418701,2.90380875918767,2.88890181177853,2.7730857856875,2.51622812655014,2.69855104864182,2.88488789125602,3.10849210239306,2.99668999682454,3.1457594709159,2.7954462068012,3.03395736534738,3.04886431275651,2.97089002252878,2.78455317991458,3.0603317069836,3.09759907550643,2.79946012732372,2.9594226283017,2.66128368011898,2.51221420602762,2.94852960141508,2.12864749391261,2.94852960141508,2.38951907357248,0.227510524327136,-0.0636417101590582,0.11861134655619,2.78608479291912,-0.111300930647868,-0.140131239431294,-0.0440766095105109]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
<p>それでは、抽出した1000セットのパラメータを用いて1000個のデータセットをシミュレートする。</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="Chapter10.html#cb265-1" tabindex="-1"></a>y_sim <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(sp),</span>
<span id="cb265-2"><a href="Chapter10.html#cb265-2" tabindex="-1"></a>                <span class="at">ncol =</span> <span class="dv">1000</span>)</span>
<span id="cb265-3"><a href="Chapter10.html#cb265-3" tabindex="-1"></a></span>
<span id="cb265-4"><a href="Chapter10.html#cb265-4" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb265-5"><a href="Chapter10.html#cb265-5" tabindex="-1"></a> y_sim[,i] <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="fu">nrow</span>(sp), <span class="at">lambda =</span> <span class="fu">exp</span>(sim_param[[i]]<span class="sc">$</span>latent[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sp),])) </span>
<span id="cb265-6"><a href="Chapter10.html#cb265-6" tabindex="-1"></a>}</span></code></pre></div>
<p>続いて、それぞれのデータセットについてピアソン残差の平方和を算出する。</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="Chapter10.html#cb266-1" tabindex="-1"></a>sum_E2_sim <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb266-2"><a href="Chapter10.html#cb266-2" tabindex="-1"></a></span>
<span id="cb266-3"><a href="Chapter10.html#cb266-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb266-4"><a href="Chapter10.html#cb266-4" tabindex="-1"></a>  E <span class="ot">&lt;-</span> (y_sim[,i] <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu)</span>
<span id="cb266-5"><a href="Chapter10.html#cb266-5" tabindex="-1"></a>  sum_E2_sim[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb266-6"><a href="Chapter10.html#cb266-6" tabindex="-1"></a>}</span></code></pre></div>
<p>さて、実際に得られた実測値のピアソン残差の平方和は以下の通り、2691.504であった。</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="Chapter10.html#cb267-1" tabindex="-1"></a>E <span class="ot">&lt;-</span>(sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu)</span>
<span id="cb267-2"><a href="Chapter10.html#cb267-2" tabindex="-1"></a>sum_E2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb267-3"><a href="Chapter10.html#cb267-3" tabindex="-1"></a></span>
<span id="cb267-4"><a href="Chapter10.html#cb267-4" tabindex="-1"></a>sum_E2</span></code></pre></div>
<pre><code>## [1] 2691.504</code></pre>
<p>これをシミュレートしたデータセットのピアソン残差の平方和と比べると、そのすべてよりも大きいことが分かった。すなわち、実データはデータが想定するよりも非常に大きなばらつきがあるといえる(= 過分散が生じている)。</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="Chapter10.html#cb269-1" tabindex="-1"></a><span class="fu">mean</span>(sum_E2 <span class="sc">&gt;</span> sum_E2_sim)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>これは、シミュレートしたでーらセットにおけるピアソン残差の平方和の分布をみても明らかである。モデルに従うのであれば、ピアソン残差の平方和はせいぜい100から300くらいの値しか取らない。</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="Chapter10.html#cb271-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">x =</span> sum_E2_sim) <span class="sc">%&gt;%</span> </span>
<span id="cb271-2"><a href="Chapter10.html#cb271-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb271-3"><a href="Chapter10.html#cb271-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb271-4"><a href="Chapter10.html#cb271-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb271-5"><a href="Chapter10.html#cb271-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-197"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-197-1.png" alt="シミュレートされたデータのピアソン残差の平方和の分布" width="672" />
<p class="caption">
図9.3: シミュレートされたデータのピアソン残差の平方和の分布
</p>
</div>
<p>過分散はデータのばらつきがポワソン分布が仮定するよりも大きすぎるときのほかに、外れ値の影響や共変量を入れていないこと、交互作用がないことやリンク関数が間違っていること、非線形のパターンがあることやゼロ過剰、データの非独立性などが原因でも起きる。データをしっかりとみて原因に合った解決をしなくてはならない。</p>
<p>今回はゼロ過剰や外れ値の影響はなさそうである。また、予測値とピアソン残差の関係を見ても、明確にパターンがあるわけではなさそう。また、ピアソン残差と共変量の間にパターンもなく、応答変数と説明変数の間に非線形な関係があるというわけでもなさそう。</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="Chapter10.html#cb272-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> (sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu),</span>
<span id="cb272-2"><a href="Chapter10.html#cb272-2" tabindex="-1"></a>           <span class="at">fitted =</span> m10_2<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean) <span class="sc">%&gt;%</span> </span>
<span id="cb272-3"><a href="Chapter10.html#cb272-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb272-4"><a href="Chapter10.html#cb272-4" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb272-5"><a href="Chapter10.html#cb272-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb272-6"><a href="Chapter10.html#cb272-6" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb272-7"><a href="Chapter10.html#cb272-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb272-8"><a href="Chapter10.html#cb272-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb272-9"><a href="Chapter10.html#cb272-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span>,</span>
<span id="cb272-10"><a href="Chapter10.html#cb272-10" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p1</span>
<span id="cb272-11"><a href="Chapter10.html#cb272-11" tabindex="-1"></a></span>
<span id="cb272-12"><a href="Chapter10.html#cb272-12" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> (sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu),</span>
<span id="cb272-13"><a href="Chapter10.html#cb272-13" tabindex="-1"></a>           <span class="at">LT =</span> sp<span class="sc">$</span>LT) <span class="sc">%&gt;%</span> </span>
<span id="cb272-14"><a href="Chapter10.html#cb272-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LT, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb272-15"><a href="Chapter10.html#cb272-15" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb272-16"><a href="Chapter10.html#cb272-16" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb272-17"><a href="Chapter10.html#cb272-17" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb272-18"><a href="Chapter10.html#cb272-18" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb272-19"><a href="Chapter10.html#cb272-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb272-20"><a href="Chapter10.html#cb272-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;LT&quot;</span>,</span>
<span id="cb272-21"><a href="Chapter10.html#cb272-21" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p2</span>
<span id="cb272-22"><a href="Chapter10.html#cb272-22" tabindex="-1"></a></span>
<span id="cb272-23"><a href="Chapter10.html#cb272-23" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> (sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu),</span>
<span id="cb272-24"><a href="Chapter10.html#cb272-24" tabindex="-1"></a>           <span class="at">Loc =</span> sp<span class="sc">$</span>fLoc,</span>
<span id="cb272-25"><a href="Chapter10.html#cb272-25" tabindex="-1"></a>           <span class="at">Sex =</span> sp<span class="sc">$</span>fSex) <span class="sc">%&gt;%</span> </span>
<span id="cb272-26"><a href="Chapter10.html#cb272-26" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb272-27"><a href="Chapter10.html#cb272-27" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb272-28"><a href="Chapter10.html#cb272-28" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb272-29"><a href="Chapter10.html#cb272-29" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>name, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb272-30"><a href="Chapter10.html#cb272-30" tabindex="-1"></a>                 <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb272-31"><a href="Chapter10.html#cb272-31" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb272-32"><a href="Chapter10.html#cb272-32" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb272-33"><a href="Chapter10.html#cb272-33" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb272-34"><a href="Chapter10.html#cb272-34" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p3</span>
<span id="cb272-35"><a href="Chapter10.html#cb272-35" tabindex="-1"></a></span>
<span id="cb272-36"><a href="Chapter10.html#cb272-36" tabindex="-1"></a></span>
<span id="cb272-37"><a href="Chapter10.html#cb272-37" tabindex="-1"></a>(p1 <span class="sc">+</span> p2)<span class="sc">/</span>p3</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-198-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>そこで、本節では以下で負の二項分布を適用したモデリングを行う。</p>
</div>
</div>
</div>
<div id="negative-binomial-glm-in-r-inla" class="section level3 hasAnchor" number="9.1.4">
<h3><span class="header-section-number">9.1.4</span> Negative binomial GLM in R-INLA<a href="Chapter10.html#negative-binomial-glm-in-r-inla" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>モデル式は以下のとおりである。<span class="math inline">\(k\)</span>は負の二項分布の分散パラメータで、分布の分散を調整する。<code>INLA</code>では<code>size</code>パラメータと呼ばれる。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;TP_i \sim NegBinomial(\mu_i, k) \\
&amp;E(TP_i) = \mu_i \; and \; var(TP_i) = \mu_i + \frac{\mu_i^2}{k}\\
&amp;log(\mu_i) = Intercept + Sex_i + LT_i + Location_i + LT_i \times Location_i
\end{aligned}
\]</span></p>
<p><code>INLA</code>では以下のように実行する。</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="Chapter10.html#cb273-1" tabindex="-1"></a>m10_3 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span> fSex <span class="sc">+</span> LT<span class="sc">*</span>fLoc,</span>
<span id="cb273-2"><a href="Chapter10.html#cb273-2" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb273-3"><a href="Chapter10.html#cb273-3" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb273-4"><a href="Chapter10.html#cb273-4" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb273-5"><a href="Chapter10.html#cb273-5" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>結果は以下の通り。ポワソンモデルのときと比べて、確信区間が全て広くなっている。</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="Chapter10.html#cb274-1" tabindex="-1"></a><span class="fu">summary</span>(m10_3)</span></code></pre></div>
<pre><code>## 
## Call:
##    c(&quot;inla.core(formula = formula, family = family, contrasts = contrasts, 
##    &quot;, &quot; data = data, quantiles = quantiles, E = E, offset = offset, &quot;, &quot; 
##    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, 
##    &quot;, &quot; lp.scale = lp.scale, link.covariates = link.covariates, verbose = 
##    verbose, &quot;, &quot; lincomb = lincomb, selection = selection, control.compute 
##    = control.compute, &quot;, &quot; control.predictor = control.predictor, 
##    control.family = control.family, &quot;, &quot; control.inla = control.inla, 
##    control.fixed = control.fixed, &quot;, &quot; control.mode = control.mode, 
##    control.expert = control.expert, &quot;, &quot; control.hazard = control.hazard, 
##    control.lincomb = control.lincomb, &quot;, &quot; control.update = 
##    control.update, control.lp.scale = control.lp.scale, &quot;, &quot; 
##    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, 
##    &quot;, &quot; inla.call = inla.call, inla.arg = inla.arg, num.threads = 
##    num.threads, &quot;, &quot; blas.num.threads = blas.num.threads, keep = keep, 
##    working.directory = working.directory, &quot;, &quot; silent = silent, inla.mode 
##    = inla.mode, safe = FALSE, debug = debug, &quot;, &quot; .parent.frame = 
##    .parent.frame)&quot;) 
## Time used:
##     Pre = 0.658, Running = 0.168, Post = 0.109, Total = 0.935 
## Fixed effects:
##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld
## (Intercept) -1.005 1.452     -3.857   -1.005      1.847 -1.005   0
## fSex2        0.010 0.159     -0.303    0.010      0.323  0.010   0
## LT           0.153 0.044      0.066    0.153      0.240  0.153   0
## fLoc2        4.392 1.910      0.644    4.392      8.144  4.391   0
## fLoc3        1.812 2.126     -2.363    1.812      5.989  1.812   0
## LT:fLoc2    -0.188 0.058     -0.301   -0.188     -0.075 -0.188   0
## LT:fLoc3    -0.099 0.060     -0.217   -0.099      0.019 -0.099   0
## 
## Model hyperparameters:
##                                                        mean    sd 0.025quant
## size for the nbinomial observations (1/overdispersion) 1.56 0.186       1.22
##                                                        0.5quant 0.975quant mode
## size for the nbinomial observations (1/overdispersion)     1.55       1.95 1.53
## 
## Deviance Information Criterion (DIC) ...............: 1276.63
## Deviance Information Criterion (DIC, saturated) ....: 185.45
## Effective number of parameters .....................: 8.00
## 
## Marginal log-Likelihood:  -673.93 
##  is computed 
## Posterior summaries for the linear predictor and the fitted values are computed
## (Posterior marginals needs also &#39;control.compute=list(return.marginals.predictor=TRUE)&#39;)</code></pre>
<p><code>INLA</code>では<code>size</code>パラメータ<span class="math inline">\(k\)</span>の事前分布は、<span class="math inline">\(\theta = log(k)\)</span>の事前分布が<span class="math inline">\(logGamma(1,0.1)\)</span>になるようになっている。<span class="math inline">\(k\)</span>の事後平均値は1.56であった。事後分布は以下の通り。</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="Chapter10.html#cb276-1" tabindex="-1"></a>m10_3<span class="sc">$</span>marginals.hyperpar<span class="sc">$</span><span class="st">`</span><span class="at">size for the nbinomial observations (1/overdispersion)</span><span class="st">`</span> <span class="sc">%&gt;%</span> </span>
<span id="cb276-2"><a href="Chapter10.html#cb276-2" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb276-3"><a href="Chapter10.html#cb276-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb276-4"><a href="Chapter10.html#cb276-4" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb276-5"><a href="Chapter10.html#cb276-5" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb276-6"><a href="Chapter10.html#cb276-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb276-7"><a href="Chapter10.html#cb276-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb276-8"><a href="Chapter10.html#cb276-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(k),</span>
<span id="cb276-9"><a href="Chapter10.html#cb276-9" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Pr(&quot;</span>,k,<span class="st">&quot;|D)&quot;</span>)))</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-201-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>もし<span class="math inline">\(k\)</span>の値を固定したいときは以下のようにすればよい。モデル選択をする際など<span class="math inline">\(k\)</span>の値が変わると困る場合に用いればよい。</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="Chapter10.html#cb277-1" tabindex="-1"></a>hyp.nb <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="fu">list</span>(<span class="at">initial =</span> <span class="dv">1</span>,</span>
<span id="cb277-2"><a href="Chapter10.html#cb277-2" tabindex="-1"></a>                           <span class="at">fixed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb277-3"><a href="Chapter10.html#cb277-3" tabindex="-1"></a></span>
<span id="cb277-4"><a href="Chapter10.html#cb277-4" tabindex="-1"></a>m10_4 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span> fSex <span class="sc">+</span> LT<span class="sc">*</span>fLoc,</span>
<span id="cb277-5"><a href="Chapter10.html#cb277-5" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb277-6"><a href="Chapter10.html#cb277-6" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb277-7"><a href="Chapter10.html#cb277-7" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb277-8"><a href="Chapter10.html#cb277-8" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyp.nb),</span>
<span id="cb277-9"><a href="Chapter10.html#cb277-9" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>以下では、ポワソン分布のときと同じように過分散のチェックを行う。確認の結果、シミュレーションによって得られたポワソン残差の平方和の分布と実際のポワソン残差の平方和を示したのが図<a href="Chapter10.html#fig:od-nb">9.4</a>である。実際の平方和はシミュレーションの値の87%より大きいが、ポワソン分布に比べると過分散がかなり改善していることが分かった。</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="Chapter10.html#cb278-1" tabindex="-1"></a>sim_param.nb <span class="ot">&lt;-</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n =</span> <span class="dv">1000</span>, m10_3)</span>
<span id="cb278-2"><a href="Chapter10.html#cb278-2" tabindex="-1"></a></span>
<span id="cb278-3"><a href="Chapter10.html#cb278-3" tabindex="-1"></a>y_sim.nb <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(sp),</span>
<span id="cb278-4"><a href="Chapter10.html#cb278-4" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">1000</span>)</span>
<span id="cb278-5"><a href="Chapter10.html#cb278-5" tabindex="-1"></a></span>
<span id="cb278-6"><a href="Chapter10.html#cb278-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb278-7"><a href="Chapter10.html#cb278-7" tabindex="-1"></a> y_sim.nb[,i] <span class="ot">&lt;-</span> <span class="fu">rnbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(sp), </span>
<span id="cb278-8"><a href="Chapter10.html#cb278-8" tabindex="-1"></a>                      <span class="at">mu =</span> <span class="fu">exp</span>(sim_param[[i]]<span class="sc">$</span>latent[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sp),]),</span>
<span id="cb278-9"><a href="Chapter10.html#cb278-9" tabindex="-1"></a>                      <span class="at">size =</span> sim_param.nb[[i]]<span class="sc">$</span>hyperpar[[<span class="dv">1</span>]]) </span>
<span id="cb278-10"><a href="Chapter10.html#cb278-10" tabindex="-1"></a>}</span>
<span id="cb278-11"><a href="Chapter10.html#cb278-11" tabindex="-1"></a></span>
<span id="cb278-12"><a href="Chapter10.html#cb278-12" tabindex="-1"></a><span class="do">### シミュレートしたデータセットのピアソン残差の平方和</span></span>
<span id="cb278-13"><a href="Chapter10.html#cb278-13" tabindex="-1"></a>sum_E2_sim.nb <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb278-14"><a href="Chapter10.html#cb278-14" tabindex="-1"></a>mu <span class="ot">&lt;-</span> m10_3<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb278-15"><a href="Chapter10.html#cb278-15" tabindex="-1"></a>k <span class="ot">&lt;-</span> m10_3<span class="sc">$</span>summary.hyperpar<span class="sc">$</span>mean</span>
<span id="cb278-16"><a href="Chapter10.html#cb278-16" tabindex="-1"></a></span>
<span id="cb278-17"><a href="Chapter10.html#cb278-17" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb278-18"><a href="Chapter10.html#cb278-18" tabindex="-1"></a>  E <span class="ot">&lt;-</span> (y_sim.nb[,i] <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)</span>
<span id="cb278-19"><a href="Chapter10.html#cb278-19" tabindex="-1"></a>  sum_E2_sim.nb[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb278-20"><a href="Chapter10.html#cb278-20" tabindex="-1"></a>}</span>
<span id="cb278-21"><a href="Chapter10.html#cb278-21" tabindex="-1"></a></span>
<span id="cb278-22"><a href="Chapter10.html#cb278-22" tabindex="-1"></a><span class="do">### 実データのピアソン残差の平方和</span></span>
<span id="cb278-23"><a href="Chapter10.html#cb278-23" tabindex="-1"></a>E <span class="ot">&lt;-</span>(sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)</span>
<span id="cb278-24"><a href="Chapter10.html#cb278-24" tabindex="-1"></a>sum_E2.nb <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb278-25"><a href="Chapter10.html#cb278-25" tabindex="-1"></a></span>
<span id="cb278-26"><a href="Chapter10.html#cb278-26" tabindex="-1"></a><span class="do">### 比較  </span></span>
<span id="cb278-27"><a href="Chapter10.html#cb278-27" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">mean</span>(sum_E2.nb <span class="sc">&gt;</span> sum_E2_sim.nb)</span>
<span id="cb278-28"><a href="Chapter10.html#cb278-28" tabindex="-1"></a></span>
<span id="cb278-29"><a href="Chapter10.html#cb278-29" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">x =</span> sum_E2_sim.nb) <span class="sc">%&gt;%</span> </span>
<span id="cb278-30"><a href="Chapter10.html#cb278-30" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb278-31"><a href="Chapter10.html#cb278-31" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb278-32"><a href="Chapter10.html#cb278-32" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb278-33"><a href="Chapter10.html#cb278-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb278-34"><a href="Chapter10.html#cb278-34" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> sum_E2.nb,</span>
<span id="cb278-35"><a href="Chapter10.html#cb278-35" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red2&quot;</span>)<span class="sc">+</span></span>
<span id="cb278-36"><a href="Chapter10.html#cb278-36" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">210</span>, <span class="at">y =</span> <span class="dv">60</span>),</span>
<span id="cb278-37"><a href="Chapter10.html#cb278-37" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">&quot;p = &quot;</span>, p))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:od-nb"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/od-nb-1.png" alt="シミュレートされたデータのピアソン残差の平方和の分布の実データのピアソン残差の平方和" width="672" />
<p class="caption">
図9.4: シミュレートされたデータのピアソン残差の平方和の分布の実データのピアソン残差の平方和
</p>
</div>
</div>
<div id="model-selection-for-the-nb-glm" class="section level3 hasAnchor" number="9.1.5">
<h3><span class="header-section-number">9.1.5</span> Model selection for the NB GLM<a href="Chapter10.html#model-selection-for-the-nb-glm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>モデル選択は議論の多い話題ではあるが、以下ではひとまずDICとWAICによるモデル選択を行う。なお、比較のため<span class="math inline">\(k\)</span>は先ほどのモデルで得られた値に固定する。ひとまず、1つずつ説明変数をなくした場合と比較を行う。</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="Chapter10.html#cb279-1" tabindex="-1"></a>hyper.nb <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="fu">list</span>(<span class="at">initial =</span> k,</span>
<span id="cb279-2"><a href="Chapter10.html#cb279-2" tabindex="-1"></a>                             <span class="at">fixed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb279-3"><a href="Chapter10.html#cb279-3" tabindex="-1"></a></span>
<span id="cb279-4"><a href="Chapter10.html#cb279-4" tabindex="-1"></a><span class="do">## フルモデル  </span></span>
<span id="cb279-5"><a href="Chapter10.html#cb279-5" tabindex="-1"></a>m10_5 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span> fSex <span class="sc">+</span> LT<span class="sc">*</span>fLoc,</span>
<span id="cb279-6"><a href="Chapter10.html#cb279-6" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb279-7"><a href="Chapter10.html#cb279-7" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-8"><a href="Chapter10.html#cb279-8" tabindex="-1"></a>                                     <span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-9"><a href="Chapter10.html#cb279-9" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb279-10"><a href="Chapter10.html#cb279-10" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyp.nb),</span>
<span id="cb279-11"><a href="Chapter10.html#cb279-11" tabindex="-1"></a>              <span class="at">data =</span> sp)</span>
<span id="cb279-12"><a href="Chapter10.html#cb279-12" tabindex="-1"></a></span>
<span id="cb279-13"><a href="Chapter10.html#cb279-13" tabindex="-1"></a><span class="do">## fSexなし  </span></span>
<span id="cb279-14"><a href="Chapter10.html#cb279-14" tabindex="-1"></a>m10_5a <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span>  LT<span class="sc">*</span>fLoc,</span>
<span id="cb279-15"><a href="Chapter10.html#cb279-15" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb279-16"><a href="Chapter10.html#cb279-16" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-17"><a href="Chapter10.html#cb279-17" tabindex="-1"></a>                                     <span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-18"><a href="Chapter10.html#cb279-18" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb279-19"><a href="Chapter10.html#cb279-19" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyp.nb),</span>
<span id="cb279-20"><a href="Chapter10.html#cb279-20" tabindex="-1"></a>              <span class="at">data =</span> sp)</span>
<span id="cb279-21"><a href="Chapter10.html#cb279-21" tabindex="-1"></a></span>
<span id="cb279-22"><a href="Chapter10.html#cb279-22" tabindex="-1"></a><span class="do">## 交互作用項なし</span></span>
<span id="cb279-23"><a href="Chapter10.html#cb279-23" tabindex="-1"></a>m10_5b <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span>  fSex <span class="sc">+</span> LT <span class="sc">+</span> fLoc,</span>
<span id="cb279-24"><a href="Chapter10.html#cb279-24" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb279-25"><a href="Chapter10.html#cb279-25" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-26"><a href="Chapter10.html#cb279-26" tabindex="-1"></a>                                     <span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-27"><a href="Chapter10.html#cb279-27" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb279-28"><a href="Chapter10.html#cb279-28" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyp.nb),</span>
<span id="cb279-29"><a href="Chapter10.html#cb279-29" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>まずこれらの3つのモデルでDICとWAICを比較したところ、<code>fSex</code>がないモデルがどちらも最も低いことが分かった。</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="Chapter10.html#cb280-1" tabindex="-1"></a>dic10_5 <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_5<span class="sc">$</span>dic<span class="sc">$</span>dic, m10_5a<span class="sc">$</span>dic<span class="sc">$</span>dic, m10_5b<span class="sc">$</span>dic<span class="sc">$</span>dic)</span>
<span id="cb280-2"><a href="Chapter10.html#cb280-2" tabindex="-1"></a>waic10_5 <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_5<span class="sc">$</span>waic<span class="sc">$</span>waic, m10_5a<span class="sc">$</span>waic<span class="sc">$</span>waic, m10_5b<span class="sc">$</span>waic<span class="sc">$</span>waic)</span>
<span id="cb280-3"><a href="Chapter10.html#cb280-3" tabindex="-1"></a></span>
<span id="cb280-4"><a href="Chapter10.html#cb280-4" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="st">&quot;type&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Full&quot;</span>, <span class="st">&quot;-fSex&quot;</span>, <span class="st">&quot;-LT × fLoc&quot;</span>),</span>
<span id="cb280-5"><a href="Chapter10.html#cb280-5" tabindex="-1"></a>           <span class="at">DIC =</span> dic10_5,</span>
<span id="cb280-6"><a href="Chapter10.html#cb280-6" tabindex="-1"></a>           <span class="at">WAIC =</span> waic10_5) <span class="sc">%&gt;%</span> </span>
<span id="cb280-7"><a href="Chapter10.html#cb280-7" tabindex="-1"></a>  <span class="fu">column_as_rownames</span>(<span class="at">var =</span> <span class="st">&quot;type&quot;</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["DIC"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["WAIC"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1296.968","2":"1305.405","_rn_":"Full"},{"1":"1294.966","2":"1302.255","_rn_":"-fSex"},{"1":"1310.778","2":"1318.025","_rn_":"-LT × fLoc"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br/></p>
<p>最後に、ここから交互作用を除いたモデルと比較を行う。</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="Chapter10.html#cb281-1" tabindex="-1"></a>m10_5c <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span>  LT <span class="sc">+</span> fLoc,</span>
<span id="cb281-2"><a href="Chapter10.html#cb281-2" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb281-3"><a href="Chapter10.html#cb281-3" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb281-4"><a href="Chapter10.html#cb281-4" tabindex="-1"></a>                                     <span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb281-5"><a href="Chapter10.html#cb281-5" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb281-6"><a href="Chapter10.html#cb281-6" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyp.nb),</span>
<span id="cb281-7"><a href="Chapter10.html#cb281-7" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>その結果、やはり交互作用を含むモデルの方がDICとWAICは低い。</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="Chapter10.html#cb282-1" tabindex="-1"></a>dic10_5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_5a<span class="sc">$</span>dic<span class="sc">$</span>dic, m10_5c<span class="sc">$</span>dic<span class="sc">$</span>dic)</span>
<span id="cb282-2"><a href="Chapter10.html#cb282-2" tabindex="-1"></a>waic10_5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_5a<span class="sc">$</span>waic<span class="sc">$</span>waic, m10_5c<span class="sc">$</span>waic<span class="sc">$</span>waic)</span>
<span id="cb282-3"><a href="Chapter10.html#cb282-3" tabindex="-1"></a></span>
<span id="cb282-4"><a href="Chapter10.html#cb282-4" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="st">&quot;type&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Full&quot;</span>, <span class="st">&quot;-LT × fLoc&quot;</span>),</span>
<span id="cb282-5"><a href="Chapter10.html#cb282-5" tabindex="-1"></a>           <span class="at">DIC =</span> dic10_5<span class="fl">.2</span>,</span>
<span id="cb282-6"><a href="Chapter10.html#cb282-6" tabindex="-1"></a>           <span class="at">WAIC =</span> waic10_5<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-7"><a href="Chapter10.html#cb282-7" tabindex="-1"></a>  <span class="fu">column_as_rownames</span>(<span class="at">var =</span> <span class="st">&quot;type&quot;</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["DIC"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["WAIC"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1294.966","2":"1302.255","_rn_":"Full"},{"1":"1308.775","2":"1314.627","_rn_":"-LT × fLoc"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br/></p>
<p>以上の結果は、<code>m10_5a</code>が最適なモデルであることを示唆している。このモデルの残差と予測値、残差と共変量の関連を示したのが図@ref(fig:modelvalidation10.5a)である。パターンがあるように見えるが、 <span class="citation">Zuur (<a href="#ref-Zuur2017">2017</a>)</span> は問題がなかったと述べている。</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="Chapter10.html#cb283-1" tabindex="-1"></a>mu <span class="ot">&lt;-</span> m10_5a<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb283-2"><a href="Chapter10.html#cb283-2" tabindex="-1"></a>k <span class="ot">&lt;-</span> k</span>
<span id="cb283-3"><a href="Chapter10.html#cb283-3" tabindex="-1"></a>resid <span class="ot">&lt;-</span> (sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)</span>
<span id="cb283-4"><a href="Chapter10.html#cb283-4" tabindex="-1"></a></span>
<span id="cb283-5"><a href="Chapter10.html#cb283-5" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> resid,</span>
<span id="cb283-6"><a href="Chapter10.html#cb283-6" tabindex="-1"></a>           <span class="at">fitted =</span> mu) <span class="sc">%&gt;%</span> </span>
<span id="cb283-7"><a href="Chapter10.html#cb283-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb283-8"><a href="Chapter10.html#cb283-8" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb283-9"><a href="Chapter10.html#cb283-9" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb283-10"><a href="Chapter10.html#cb283-10" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb283-11"><a href="Chapter10.html#cb283-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb283-12"><a href="Chapter10.html#cb283-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb283-13"><a href="Chapter10.html#cb283-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span>,</span>
<span id="cb283-14"><a href="Chapter10.html#cb283-14" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p1</span>
<span id="cb283-15"><a href="Chapter10.html#cb283-15" tabindex="-1"></a></span>
<span id="cb283-16"><a href="Chapter10.html#cb283-16" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> resid,</span>
<span id="cb283-17"><a href="Chapter10.html#cb283-17" tabindex="-1"></a>           <span class="at">LT =</span> sp<span class="sc">$</span>LT) <span class="sc">%&gt;%</span> </span>
<span id="cb283-18"><a href="Chapter10.html#cb283-18" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LT, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb283-19"><a href="Chapter10.html#cb283-19" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb283-20"><a href="Chapter10.html#cb283-20" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb283-21"><a href="Chapter10.html#cb283-21" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb283-22"><a href="Chapter10.html#cb283-22" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb283-23"><a href="Chapter10.html#cb283-23" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb283-24"><a href="Chapter10.html#cb283-24" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;LT&quot;</span>,</span>
<span id="cb283-25"><a href="Chapter10.html#cb283-25" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p2</span>
<span id="cb283-26"><a href="Chapter10.html#cb283-26" tabindex="-1"></a></span>
<span id="cb283-27"><a href="Chapter10.html#cb283-27" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> resid,</span>
<span id="cb283-28"><a href="Chapter10.html#cb283-28" tabindex="-1"></a>           <span class="at">Loc =</span> sp<span class="sc">$</span>fLoc,</span>
<span id="cb283-29"><a href="Chapter10.html#cb283-29" tabindex="-1"></a>           <span class="at">Sex =</span> sp<span class="sc">$</span>fSex) <span class="sc">%&gt;%</span> </span>
<span id="cb283-30"><a href="Chapter10.html#cb283-30" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb283-31"><a href="Chapter10.html#cb283-31" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb283-32"><a href="Chapter10.html#cb283-32" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb283-33"><a href="Chapter10.html#cb283-33" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>name, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb283-34"><a href="Chapter10.html#cb283-34" tabindex="-1"></a>                 <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb283-35"><a href="Chapter10.html#cb283-35" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb283-36"><a href="Chapter10.html#cb283-36" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb283-37"><a href="Chapter10.html#cb283-37" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb283-38"><a href="Chapter10.html#cb283-38" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p3</span>
<span id="cb283-39"><a href="Chapter10.html#cb283-39" tabindex="-1"></a></span>
<span id="cb283-40"><a href="Chapter10.html#cb283-40" tabindex="-1"></a></span>
<span id="cb283-41"><a href="Chapter10.html#cb283-41" tabindex="-1"></a>(p1 <span class="sc">+</span> p2)<span class="sc">/</span>p3</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/modelvalidation10.5a-1.png" alt="Model validation for m10_5a" width="672" />
<p class="caption">
(#fig:modelvalidation10.5a)Model validation for m10_5a
</p>
</div>
<p><br/></p>
<p>これまで同様に過分散のチェックも行ったが、大きな問題はないよう。</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="Chapter10.html#cb284-1" tabindex="-1"></a>sim_param.nb <span class="ot">&lt;-</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n =</span> <span class="dv">1000</span>, m10_5a)</span>
<span id="cb284-2"><a href="Chapter10.html#cb284-2" tabindex="-1"></a></span>
<span id="cb284-3"><a href="Chapter10.html#cb284-3" tabindex="-1"></a>y_sim.nb <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(sp),</span>
<span id="cb284-4"><a href="Chapter10.html#cb284-4" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">1000</span>)</span>
<span id="cb284-5"><a href="Chapter10.html#cb284-5" tabindex="-1"></a></span>
<span id="cb284-6"><a href="Chapter10.html#cb284-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb284-7"><a href="Chapter10.html#cb284-7" tabindex="-1"></a> y_sim.nb[,i] <span class="ot">&lt;-</span> <span class="fu">rnbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(sp), </span>
<span id="cb284-8"><a href="Chapter10.html#cb284-8" tabindex="-1"></a>                      <span class="at">mu =</span> <span class="fu">exp</span>(sim_param[[i]]<span class="sc">$</span>latent[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sp),]),</span>
<span id="cb284-9"><a href="Chapter10.html#cb284-9" tabindex="-1"></a>                      <span class="at">size =</span> k)</span>
<span id="cb284-10"><a href="Chapter10.html#cb284-10" tabindex="-1"></a>}</span>
<span id="cb284-11"><a href="Chapter10.html#cb284-11" tabindex="-1"></a></span>
<span id="cb284-12"><a href="Chapter10.html#cb284-12" tabindex="-1"></a><span class="do">### シミュレートしたデータセットのピアソン残差の平方和</span></span>
<span id="cb284-13"><a href="Chapter10.html#cb284-13" tabindex="-1"></a>sum_E2_sim.nb <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb284-14"><a href="Chapter10.html#cb284-14" tabindex="-1"></a>mu <span class="ot">&lt;-</span> m10_5a<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb284-15"><a href="Chapter10.html#cb284-15" tabindex="-1"></a>k <span class="ot">&lt;-</span> k</span>
<span id="cb284-16"><a href="Chapter10.html#cb284-16" tabindex="-1"></a></span>
<span id="cb284-17"><a href="Chapter10.html#cb284-17" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb284-18"><a href="Chapter10.html#cb284-18" tabindex="-1"></a>  E <span class="ot">&lt;-</span> (y_sim.nb[,i] <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)</span>
<span id="cb284-19"><a href="Chapter10.html#cb284-19" tabindex="-1"></a>  sum_E2_sim.nb[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb284-20"><a href="Chapter10.html#cb284-20" tabindex="-1"></a>}</span>
<span id="cb284-21"><a href="Chapter10.html#cb284-21" tabindex="-1"></a></span>
<span id="cb284-22"><a href="Chapter10.html#cb284-22" tabindex="-1"></a><span class="do">### 実データのピアソン残差の平方和</span></span>
<span id="cb284-23"><a href="Chapter10.html#cb284-23" tabindex="-1"></a>E <span class="ot">&lt;-</span>(sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)</span>
<span id="cb284-24"><a href="Chapter10.html#cb284-24" tabindex="-1"></a>sum_E2.nb <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb284-25"><a href="Chapter10.html#cb284-25" tabindex="-1"></a></span>
<span id="cb284-26"><a href="Chapter10.html#cb284-26" tabindex="-1"></a><span class="do">### 比較  </span></span>
<span id="cb284-27"><a href="Chapter10.html#cb284-27" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">mean</span>(sum_E2.nb <span class="sc">&gt;</span> sum_E2_sim.nb)</span>
<span id="cb284-28"><a href="Chapter10.html#cb284-28" tabindex="-1"></a></span>
<span id="cb284-29"><a href="Chapter10.html#cb284-29" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">x =</span> sum_E2_sim.nb) <span class="sc">%&gt;%</span> </span>
<span id="cb284-30"><a href="Chapter10.html#cb284-30" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb284-31"><a href="Chapter10.html#cb284-31" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb284-32"><a href="Chapter10.html#cb284-32" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb284-33"><a href="Chapter10.html#cb284-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb284-34"><a href="Chapter10.html#cb284-34" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> sum_E2.nb,</span>
<span id="cb284-35"><a href="Chapter10.html#cb284-35" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red2&quot;</span>)<span class="sc">+</span></span>
<span id="cb284-36"><a href="Chapter10.html#cb284-36" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">210</span>, <span class="at">y =</span> <span class="dv">60</span>),</span>
<span id="cb284-37"><a href="Chapter10.html#cb284-37" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">&quot;p = &quot;</span>, p))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:od-nb2"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/od-nb2-1.png" alt="シミュレートされたデータのピアソン残差の平方和の分布の実データのピアソン残差の平方和" width="672" />
<p class="caption">
図9.5: シミュレートされたデータのピアソン残差の平方和の分布の実データのピアソン残差の平方和
</p>
</div>
</div>
<div id="visualization-of-the-nb-glm" class="section level3 hasAnchor" number="9.1.6">
<h3><span class="header-section-number">9.1.6</span> Visualization of the NB GLM<a href="Chapter10.html#visualization-of-the-nb-glm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>以下では、結果の可視化を行う。なお、ここでは前章(<a href="Chapter9.html#s9-8-2">8.8.2</a>)で用いた<code>inla.make.lincoms</code>を用いる方法で実行する。</p>
<p>まずは予測値が欲しい範囲の変数を格納したデータフレームを作る。</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="Chapter10.html#cb285-1" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">LT =</span> <span class="fu">seq</span>(<span class="fu">min</span>(sp<span class="sc">$</span>LT), <span class="fu">max</span>(sp<span class="sc">$</span>LT),<span class="at">length =</span><span class="dv">100</span>),</span>
<span id="cb285-2"><a href="Chapter10.html#cb285-2" tabindex="-1"></a>                    <span class="at">fLoc =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>))</span>
<span id="cb285-3"><a href="Chapter10.html#cb285-3" tabindex="-1"></a></span>
<span id="cb285-4"><a href="Chapter10.html#cb285-4" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> LT<span class="sc">*</span>fLoc, <span class="at">data =</span> newdata) <span class="sc">%&gt;%</span> </span>
<span id="cb285-5"><a href="Chapter10.html#cb285-5" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code></pre></div>
<p>次に、<code>lincombs</code>オプションで<code>lcb</code>を指定してモデルを実行する。</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="Chapter10.html#cb286-1" tabindex="-1"></a>lcb <span class="ot">&lt;-</span> <span class="fu">inla.make.lincombs</span>(X)</span>
<span id="cb286-2"><a href="Chapter10.html#cb286-2" tabindex="-1"></a></span>
<span id="cb286-3"><a href="Chapter10.html#cb286-3" tabindex="-1"></a>m10_6 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span>  LT<span class="sc">*</span>fLoc,</span>
<span id="cb286-4"><a href="Chapter10.html#cb286-4" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb286-5"><a href="Chapter10.html#cb286-5" tabindex="-1"></a>              <span class="at">lincomb =</span> lcb,</span>
<span id="cb286-6"><a href="Chapter10.html#cb286-6" tabindex="-1"></a>              <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-7"><a href="Chapter10.html#cb286-7" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">return.marginals.predictor =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-8"><a href="Chapter10.html#cb286-8" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyper.nb),</span>
<span id="cb286-9"><a href="Chapter10.html#cb286-9" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>注意しなければならないのは、<code>m10_6$summary.lincomb.derived</code>などは線形予測子、つまり<span class="math inline">\(log(\mu_i)\)</span>の事後分布についての情報を返してくるということだ。私たちは<span class="math inline">\(\mu_i\)</span>の予測値が欲しいので、これを変換する必要がある。</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="Chapter10.html#cb287-1" tabindex="-1"></a>m10_6<span class="sc">$</span>summary.lincomb.derived <span class="sc">%&gt;%</span> </span>
<span id="cb287-2"><a href="Chapter10.html#cb287-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["ID"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["mean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["0.025quant"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["0.5quant"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["0.975quant"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["mode"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["kld"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"2.693527","3":"0.2398739","4":"2.223383","5":"2.693527","6":"3.163671","7":"2.693527","8":"1.129835e-05","_rn_":"lc001"},{"1":"2","2":"2.542250","3":"0.2257605","4":"2.099767","5":"2.542250","6":"2.984732","7":"2.542250","8":"5.732487e-05","_rn_":"lc002"},{"1":"3","2":"2.125057","3":"0.3506095","4":"1.437875","5":"2.125057","6":"2.812239","7":"2.125057","8":"2.606986e-05","_rn_":"lc003"},{"1":"4","2":"2.720475","3":"0.2356762","4":"2.258558","5":"2.720475","6":"3.182391","7":"2.720475","8":"1.127511e-05","_rn_":"lc004"},{"1":"5","2":"2.536664","3":"0.2216882","4":"2.102163","5":"2.536664","6":"2.971165","7":"2.536664","8":"5.712059e-05","_rn_":"lc005"},{"1":"6","2":"2.134729","3":"0.3461100","4":"1.456366","5":"2.134729","6":"2.813092","7":"2.134729","8":"2.604989e-05","_rn_":"lc006"},{"1":"7","2":"2.747422","3":"0.2314847","4":"2.293720","5":"2.747422","6":"3.201124","7":"2.747422","8":"1.125043e-05","_rn_":"lc007"},{"1":"8","2":"2.531078","3":"0.2176264","4":"2.104538","5":"2.531078","6":"2.957618","7":"2.531078","8":"5.690357e-05","_rn_":"lc008"},{"1":"9","2":"2.144402","3":"0.3416133","4":"1.474852","5":"2.144402","6":"2.813952","7":"2.144402","8":"2.602898e-05","_rn_":"lc009"},{"1":"10","2":"2.774369","3":"0.2272999","4":"2.328870","5":"2.774369","6":"3.219869","7":"2.774369","8":"1.122422e-05","_rn_":"lc010"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br/></p>
<p>以下のようにして変換して事後分布の要約統計量を算出する。</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="Chapter10.html#cb288-1" tabindex="-1"></a><span class="do">## 線形予測子の事後周辺分布  </span></span>
<span id="cb288-2"><a href="Chapter10.html#cb288-2" tabindex="-1"></a>post_pred10_6 <span class="ot">&lt;-</span> m10_6<span class="sc">$</span>marginals.lincomb.derived</span>
<span id="cb288-3"><a href="Chapter10.html#cb288-3" tabindex="-1"></a></span>
<span id="cb288-4"><a href="Chapter10.html#cb288-4" tabindex="-1"></a><span class="do">## 変換を行って要約統計量を計算</span></span>
<span id="cb288-5"><a href="Chapter10.html#cb288-5" tabindex="-1"></a></span>
<span id="cb288-6"><a href="Chapter10.html#cb288-6" tabindex="-1"></a><span class="do">## 95%確信区間</span></span>
<span id="cb288-7"><a href="Chapter10.html#cb288-7" tabindex="-1"></a>ci<span class="fl">.10</span>_6 <span class="ot">&lt;-</span> <span class="fu">map_df</span>(post_pred10_6, <span class="sc">~</span><span class="fu">inla.qmarginal</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>),</span>
<span id="cb288-8"><a href="Chapter10.html#cb288-8" tabindex="-1"></a>                                                 <span class="fu">inla.tmarginal</span>(exp,.))) <span class="sc">%&gt;%</span> </span>
<span id="cb288-9"><a href="Chapter10.html#cb288-9" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb288-10"><a href="Chapter10.html#cb288-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb288-11"><a href="Chapter10.html#cb288-11" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">2</span>)</span>
<span id="cb288-12"><a href="Chapter10.html#cb288-12" tabindex="-1"></a></span>
<span id="cb288-13"><a href="Chapter10.html#cb288-13" tabindex="-1"></a><span class="do">## 事後平均値  </span></span>
<span id="cb288-14"><a href="Chapter10.html#cb288-14" tabindex="-1"></a>mean<span class="fl">.10</span>_6 <span class="ot">&lt;-</span> <span class="fu">map_df</span>(post_pred10_6, <span class="sc">~</span><span class="fu">inla.emarginal</span>(exp,.)) <span class="sc">%&gt;%</span> </span>
<span id="cb288-15"><a href="Chapter10.html#cb288-15" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb288-16"><a href="Chapter10.html#cb288-16" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb288-17"><a href="Chapter10.html#cb288-17" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fitted =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>結果を図示したのが以下の図である。</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="Chapter10.html#cb289-1" tabindex="-1"></a><span class="do">## 作図  </span></span>
<span id="cb289-2"><a href="Chapter10.html#cb289-2" tabindex="-1"></a><span class="fu">bind_cols</span>(newdata, ci<span class="fl">.10</span>_6, mean<span class="fl">.10</span>_6) <span class="sc">%&gt;%</span> </span>
<span id="cb289-3"><a href="Chapter10.html#cb289-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fLoc =</span> <span class="fu">str_c</span>(<span class="st">&quot;Location = &quot;</span>, fLoc)) <span class="sc">%&gt;%</span> </span>
<span id="cb289-4"><a href="Chapter10.html#cb289-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LT, <span class="at">y =</span> fitted))<span class="sc">+</span></span>
<span id="cb289-5"><a href="Chapter10.html#cb289-5" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb289-6"><a href="Chapter10.html#cb289-6" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),</span>
<span id="cb289-7"><a href="Chapter10.html#cb289-7" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb289-8"><a href="Chapter10.html#cb289-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> sp <span class="sc">%&gt;%</span> </span>
<span id="cb289-9"><a href="Chapter10.html#cb289-9" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">fLoc =</span> <span class="fu">str_c</span>(<span class="st">&quot;Location = &quot;</span>, fLoc)),</span>
<span id="cb289-10"><a href="Chapter10.html#cb289-10" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> Totalparasites),</span>
<span id="cb289-11"><a href="Chapter10.html#cb289-11" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb289-12"><a href="Chapter10.html#cb289-12" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>fLoc, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb289-13"><a href="Chapter10.html#cb289-13" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">300</span>))<span class="sc">+</span></span>
<span id="cb289-14"><a href="Chapter10.html#cb289-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb289-15"><a href="Chapter10.html#cb289-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb289-16"><a href="Chapter10.html#cb289-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Total parasites&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-211"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-211-1.png" alt="Posterior mean fitted values and 95% credible intervals." width="1344" />
<p class="caption">
図9.6: Posterior mean fitted values and 95% credible intervals.
</p>
</div>
</div>
</div>
<div id="bernoulli-and-binomial-glm" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Bernoulli and binomial GLM<a href="Chapter10.html#bernoulli-and-binomial-glm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>本節では、<code>INLA</code>でベルヌーイ分布と二項分布のモデルを実行する方法を学ぶ。</p>
<div id="bernoulli-glm" class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Bernoulli GLM<a href="Chapter10.html#bernoulli-glm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ここでは、オーストラリアでワニに襲われた人の生死を分析した <span class="citation">Fukuda et al. (<a href="#ref-Fukuda2015">2015</a>)</span> のデータを用いる。襲われた場所(<code>Position</code>)、ワニと人間の体重の差(<code>DeltaWeight</code>)などの要因が生死(<code>Survival</code>)に与える影響が分析されている。</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="Chapter10.html#cb290-1" tabindex="-1"></a>croco <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;data/Crocodiles.txt&quot;</span>) </span>
<span id="cb290-2"><a href="Chapter10.html#cb290-2" tabindex="-1"></a></span>
<span id="cb290-3"><a href="Chapter10.html#cb290-3" tabindex="-1"></a><span class="fu">datatable</span>(croco,</span>
<span id="cb290-4"><a href="Chapter10.html#cb290-4" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">80</span>),</span>
<span id="cb290-5"><a href="Chapter10.html#cb290-5" tabindex="-1"></a>          <span class="at">filter =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5603c92ee4cd360cce59" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5603c92ee4cd360cce59">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"86\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-85.97135714\" data-max=\"510.0658083\" data-scale=\"9\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87"],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86],["Yes","No","No","No","Yes","No","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","Yes","No","No","Yes","Yes","Yes","No","No","No","Yes","Yes","No","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","Yes","Yes","No","Yes","No","No","Yes","Yes","Yes","Yes","Yes","No","No","Yes","Yes","No","Yes","Yes","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","Yes","No","No","No","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","No","No"],[1,0,0,0,1,0,1,1,1,1,0,0,1,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,0,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,1,0,0],[-53.99276747,288.2030234,281.2293891,-1.226547526,-1.226547526,352.2440682,-33.28270594,-59.27838514,-85.97135714,-51.44861204,177.659669,126.2016986,-34.52519946,-60.83979739,-35.22072539,7.211611589,243.8571847,85.31349397,-14.90242015,-20.08065876,11.57204826,510.0658083,288.5363071,167.7120036,167.9647491,-3.864880261,173.5129342,28.96088805,-6.407198877,-31.2494407,230.3135165,294.3914633,-63.36496916,28.4372769,37.93349814,11.00913597,20.50421445,15.05260659,78.90655415,14.14516593,180.2867922,33.09504016,77.47448213,125.5611955,124.343588,294.1089217,12.6329866,447.1778005,275.6255509,16.55732107,53.21725528,-55.49549877,79.73743296,16.03660911,305.0582932,57.14908882,-18.21175683,13.7201563,305.7587367,76.34865755,-57.05763464,167.1816267,143.5077349,213.3943037,-13.79998929,76.601403,-7.127333689,166.3790968,-32.68151272,68.74017765,76.87328891,75.90058805,-19.72868605,-59.66511384,462.7742222,460.4930347,449.276326,-44.10141117,-32.6190229,-34.52519946,-59.66511384,46.09409225,-40.83043215,59.14819719,11.57204826,465.1531634,171.5449291],["No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","Yes","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","No","Yes","Yes","No","No","No","Yes","Yes","No","No","No","No","No","No","No","No","Yes","No","No","No","No","No","No","No","No","Yes","Yes","No","Yes","Yes","No","No","No","No","No","No","No","No","No","No","Yes","No","No","No","Yes","No","No","No","No","No"],["In_water","In_water","On_water","In_water","In_water","In_water","On_water","In_water","On_water","On_land","In_water","In_water","On_water","On_land","In_water","In_water","In_water","In_water","In_water","In_water","On_land","On_land","In_water","In_water","On_water","On_land","In_water","On_land","In_water","On_land","In_water","On_water","In_water","In_water","In_water","On_land","On_land","On_land","On_land","In_water","On_land","In_water","In_water","On_land","In_water","In_water","On_land","In_water","In_water","In_water","On_water","On_water","In_water","On_land","In_water","In_water","In_water","On_land","In_water","In_water","In_water","On_water","In_water","On_land","In_water","On_land","In_water","In_water","In_water","In_water","In_water","In_water","In_water","In_water","In_water","In_water","In_water","In_water","In_water","On_water","On_water","In_water","In_water","In_water","On_water","In_water","In_water"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>Survived<\/th>\n      <th>Survived01<\/th>\n      <th>DeltaWeight<\/th>\n      <th>Assistance<\/th>\n      <th>Position<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":80,"columnDefs":[{"className":"dt-right","targets":[1,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
<p>ここでは、よりシンプルに考えるため体重差のみを説明変数に入れたモデルを考える。<br />
<span class="math display">\[
\begin{aligned}
&amp;Survived_i \sim Bernoulli(\pi_i)\\
&amp;E(Survived_i) = \pi_i \; and \; var(Survived_i) = \pi_i \times (1-\pi_i)\\
&amp;logit(\pi_i) = log \Bigl(\frac{\pi_i}{1 - \pi_i} \Bigl) = \beta_1 + \beta_2 \times DeltaWeight_i
\end{aligned}
\]</span></p>
<p>Rでは以下のように実行する。応答変数は数字である必要がある。また、ベルヌーイ分布の場合は<code>Ntrials = 1</code>となる(なくても実行はできる)。</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="Chapter10.html#cb291-1" tabindex="-1"></a>m10_7 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Survived01 <span class="sc">~</span> DeltaWeight,</span>
<span id="cb291-2"><a href="Chapter10.html#cb291-2" tabindex="-1"></a>              <span class="at">data =</span> croco,</span>
<span id="cb291-3"><a href="Chapter10.html#cb291-3" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb291-4"><a href="Chapter10.html#cb291-4" tabindex="-1"></a>              <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb291-5"><a href="Chapter10.html#cb291-5" tabindex="-1"></a>              <span class="at">Ntrials =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>結果は以下の通り。</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="Chapter10.html#cb292-1" tabindex="-1"></a><span class="fu">summary</span>(m10_7)</span></code></pre></div>
<pre><code>## 
## Call:
##    c(&quot;inla.core(formula = formula, family = family, contrasts = contrasts, 
##    &quot;, &quot; data = data, quantiles = quantiles, E = E, offset = offset, &quot;, &quot; 
##    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, 
##    &quot;, &quot; lp.scale = lp.scale, link.covariates = link.covariates, verbose = 
##    verbose, &quot;, &quot; lincomb = lincomb, selection = selection, control.compute 
##    = control.compute, &quot;, &quot; control.predictor = control.predictor, 
##    control.family = control.family, &quot;, &quot; control.inla = control.inla, 
##    control.fixed = control.fixed, &quot;, &quot; control.mode = control.mode, 
##    control.expert = control.expert, &quot;, &quot; control.hazard = control.hazard, 
##    control.lincomb = control.lincomb, &quot;, &quot; control.update = 
##    control.update, control.lp.scale = control.lp.scale, &quot;, &quot; 
##    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, 
##    &quot;, &quot; inla.call = inla.call, inla.arg = inla.arg, num.threads = 
##    num.threads, &quot;, &quot; blas.num.threads = blas.num.threads, keep = keep, 
##    working.directory = working.directory, &quot;, &quot; silent = silent, inla.mode 
##    = inla.mode, safe = FALSE, debug = debug, &quot;, &quot; .parent.frame = 
##    .parent.frame)&quot;) 
## Time used:
##     Pre = 0.592, Running = 0.113, Post = 0.0354, Total = 0.74 
## Fixed effects:
##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld
## (Intercept)  2.760 0.516      1.748    2.760      3.772  2.760   0
## DeltaWeight -0.017 0.003     -0.024   -0.017     -0.010 -0.017   0
## 
## Marginal log-Likelihood:  -37.99 
##  is computed 
## Posterior summaries for the linear predictor and the fitted values are computed
## (Posterior marginals needs also &#39;control.compute=list(return.marginals.predictor=TRUE)&#39;)</code></pre>
<p>この結果から、<span class="math inline">\(\mu_i\)</span>は以下のように書ける。<br />
<span class="math display">\[
\begin{aligned}
logit(\pi_i) &amp;= 2.70 -0.017 \times DeltaWeight_i \\
\therefore \pi_i &amp;= \frac{exp(2.70 -0.017 \times DeltaWeight_i)}{1 + exp(2.70 -0.017 \times DeltaWeight_i)}
\end{aligned}
\]</span></p>
<p>結果を可視化すると以下のようになる(図<a href="Chapter10.html#fig:fitted-10-8">9.7</a>)。</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="Chapter10.html#cb294-1" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">DeltaWeight=</span> <span class="fu">seq</span>(<span class="fu">min</span>(croco<span class="sc">$</span>DeltaWeight),<span class="fu">max</span>(croco<span class="sc">$</span>DeltaWeight),<span class="at">length =</span> <span class="dv">100</span>))</span>
<span id="cb294-2"><a href="Chapter10.html#cb294-2" tabindex="-1"></a>Xmat <span class="ot">&lt;-</span>  <span class="fu">model.matrix</span>(<span class="sc">~</span> DeltaWeight,</span>
<span id="cb294-3"><a href="Chapter10.html#cb294-3" tabindex="-1"></a>                      <span class="at">data =</span> newdata)</span>
<span id="cb294-4"><a href="Chapter10.html#cb294-4" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Xmat)</span>
<span id="cb294-5"><a href="Chapter10.html#cb294-5" tabindex="-1"></a>lcb <span class="ot">&lt;-</span> <span class="fu">inla.make.lincombs</span>(X)</span>
<span id="cb294-6"><a href="Chapter10.html#cb294-6" tabindex="-1"></a></span>
<span id="cb294-7"><a href="Chapter10.html#cb294-7" tabindex="-1"></a>m10_8 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Survived01 <span class="sc">~</span> DeltaWeight,</span>
<span id="cb294-8"><a href="Chapter10.html#cb294-8" tabindex="-1"></a>              <span class="at">data =</span> croco,</span>
<span id="cb294-9"><a href="Chapter10.html#cb294-9" tabindex="-1"></a>              <span class="at">lincomb =</span> lcb,</span>
<span id="cb294-10"><a href="Chapter10.html#cb294-10" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb294-11"><a href="Chapter10.html#cb294-11" tabindex="-1"></a>              <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>),</span>
<span id="cb294-12"><a href="Chapter10.html#cb294-12" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">return.marginals.predictor=</span><span class="cn">TRUE</span>),</span>
<span id="cb294-13"><a href="Chapter10.html#cb294-13" tabindex="-1"></a>              <span class="at">Ntrials =</span> <span class="dv">1</span>)</span>
<span id="cb294-14"><a href="Chapter10.html#cb294-14" tabindex="-1"></a></span>
<span id="cb294-15"><a href="Chapter10.html#cb294-15" tabindex="-1"></a><span class="do">## 線形予測子の事後周辺分布  </span></span>
<span id="cb294-16"><a href="Chapter10.html#cb294-16" tabindex="-1"></a>post_pred10_8 <span class="ot">&lt;-</span> m10_8<span class="sc">$</span>marginals.lincomb.derived</span>
<span id="cb294-17"><a href="Chapter10.html#cb294-17" tabindex="-1"></a></span>
<span id="cb294-18"><a href="Chapter10.html#cb294-18" tabindex="-1"></a><span class="do">## 変換を行って要約統計量を計算</span></span>
<span id="cb294-19"><a href="Chapter10.html#cb294-19" tabindex="-1"></a></span>
<span id="cb294-20"><a href="Chapter10.html#cb294-20" tabindex="-1"></a><span class="do">## 95%確信区間</span></span>
<span id="cb294-21"><a href="Chapter10.html#cb294-21" tabindex="-1"></a>myfun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {<span class="fu">exp</span>(x)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(x))}</span>
<span id="cb294-22"><a href="Chapter10.html#cb294-22" tabindex="-1"></a></span>
<span id="cb294-23"><a href="Chapter10.html#cb294-23" tabindex="-1"></a>ci<span class="fl">.10</span>_8 <span class="ot">&lt;-</span> <span class="fu">map_df</span>(post_pred10_8, <span class="sc">~</span><span class="fu">inla.qmarginal</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>),</span>
<span id="cb294-24"><a href="Chapter10.html#cb294-24" tabindex="-1"></a>                                                 <span class="fu">inla.tmarginal</span>(myfun,.))) <span class="sc">%&gt;%</span> </span>
<span id="cb294-25"><a href="Chapter10.html#cb294-25" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb294-26"><a href="Chapter10.html#cb294-26" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb294-27"><a href="Chapter10.html#cb294-27" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">2</span>)</span>
<span id="cb294-28"><a href="Chapter10.html#cb294-28" tabindex="-1"></a></span>
<span id="cb294-29"><a href="Chapter10.html#cb294-29" tabindex="-1"></a><span class="do">## 事後平均値  </span></span>
<span id="cb294-30"><a href="Chapter10.html#cb294-30" tabindex="-1"></a>mean<span class="fl">.10</span>_8 <span class="ot">&lt;-</span> <span class="fu">map_df</span>(post_pred10_8, <span class="sc">~</span><span class="fu">inla.emarginal</span>(myfun,.)) <span class="sc">%&gt;%</span> </span>
<span id="cb294-31"><a href="Chapter10.html#cb294-31" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb294-32"><a href="Chapter10.html#cb294-32" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb294-33"><a href="Chapter10.html#cb294-33" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fitted =</span> <span class="dv">1</span>)</span>
<span id="cb294-34"><a href="Chapter10.html#cb294-34" tabindex="-1"></a></span>
<span id="cb294-35"><a href="Chapter10.html#cb294-35" tabindex="-1"></a><span class="do">## 図示  </span></span>
<span id="cb294-36"><a href="Chapter10.html#cb294-36" tabindex="-1"></a><span class="fu">bind_cols</span>(newdata, mean<span class="fl">.10</span>_8, ci<span class="fl">.10</span>_8) <span class="sc">%&gt;%</span> </span>
<span id="cb294-37"><a href="Chapter10.html#cb294-37" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> DeltaWeight, <span class="at">y =</span> fitted))<span class="sc">+</span></span>
<span id="cb294-38"><a href="Chapter10.html#cb294-38" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb294-39"><a href="Chapter10.html#cb294-39" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),</span>
<span id="cb294-40"><a href="Chapter10.html#cb294-40" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb294-41"><a href="Chapter10.html#cb294-41" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> croco ,</span>
<span id="cb294-42"><a href="Chapter10.html#cb294-42" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> Survived01),</span>
<span id="cb294-43"><a href="Chapter10.html#cb294-43" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb294-44"><a href="Chapter10.html#cb294-44" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb294-45"><a href="Chapter10.html#cb294-45" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb294-46"><a href="Chapter10.html#cb294-46" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Survived&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fitted-10-8"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/fitted-10-8-1.png" alt="Fitted values of the Bernoulli model applied on the crocodile attack data." width="672" />
<p class="caption">
図9.7: Fitted values of the Bernoulli model applied on the crocodile attack data.
</p>
</div>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="Chapter10.html#cb295-1" tabindex="-1"></a><span class="fu">summary</span>(m10_7)</span></code></pre></div>
<pre><code>## 
## Call:
##    c(&quot;inla.core(formula = formula, family = family, contrasts = contrasts, 
##    &quot;, &quot; data = data, quantiles = quantiles, E = E, offset = offset, &quot;, &quot; 
##    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, 
##    &quot;, &quot; lp.scale = lp.scale, link.covariates = link.covariates, verbose = 
##    verbose, &quot;, &quot; lincomb = lincomb, selection = selection, control.compute 
##    = control.compute, &quot;, &quot; control.predictor = control.predictor, 
##    control.family = control.family, &quot;, &quot; control.inla = control.inla, 
##    control.fixed = control.fixed, &quot;, &quot; control.mode = control.mode, 
##    control.expert = control.expert, &quot;, &quot; control.hazard = control.hazard, 
##    control.lincomb = control.lincomb, &quot;, &quot; control.update = 
##    control.update, control.lp.scale = control.lp.scale, &quot;, &quot; 
##    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, 
##    &quot;, &quot; inla.call = inla.call, inla.arg = inla.arg, num.threads = 
##    num.threads, &quot;, &quot; blas.num.threads = blas.num.threads, keep = keep, 
##    working.directory = working.directory, &quot;, &quot; silent = silent, inla.mode 
##    = inla.mode, safe = FALSE, debug = debug, &quot;, &quot; .parent.frame = 
##    .parent.frame)&quot;) 
## Time used:
##     Pre = 0.592, Running = 0.113, Post = 0.0354, Total = 0.74 
## Fixed effects:
##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld
## (Intercept)  2.760 0.516      1.748    2.760      3.772  2.760   0
## DeltaWeight -0.017 0.003     -0.024   -0.017     -0.010 -0.017   0
## 
## Marginal log-Likelihood:  -37.99 
##  is computed 
## Posterior summaries for the linear predictor and the fitted values are computed
## (Posterior marginals needs also &#39;control.compute=list(return.marginals.predictor=TRUE)&#39;)</code></pre>
</div>
<div id="model-selection-with-the-marginal-likelihood" class="section level3 hasAnchor" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> 10.2.2 Model selection with the marginal likelihood<a href="Chapter10.html#model-selection-with-the-marginal-likelihood" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ここでは、<strong>ベイズファクター(Bayes factor)</strong>を用いてモデル比較を行う方法を解説する。ここで、2つのモデルがあるとしよう。1つ目は先ほど実行したモデルで、切片と体重差を含むモデル(<code>Model1</code>)、もう1つは切片のみを含むモデル(<code>Model2</code>)である。このとき、ベイズファクターは以下のように定義される。</p>
<p><span class="math display">\[
\begin{aligned}
\rm{Bayes} \; \rm{factor} &amp;= \frac{Prob(Model1|D)}{Prob(Model2|D)} \\
                          &amp;= \frac{Prob(D|Model1)}{Prob(D|Model2)} \times \frac{Model1}{Model2}
\end{aligned}                          
\]</span></p>
<p>周辺尤度<span class="math inline">\(Prob(D|Model1)\)</span>と<span class="math inline">\(Prob(D|Model2)\)</span>はそれに対数をとったものが<code>INLA</code>の結果で示されている(それぞれ-37.97と-54.43)。各モデルの事前確率<span class="math inline">\(Prob(Model1), Prob(Model2)\)</span>は分からないが、何も知識がない状況ではどちらのモデルが正しいかはわからない(五分五分)なので、その比は<span class="math inline">\(0.5/0.5 = 1\)</span>とする。</p>
<p>このとき、ベイズファクターは以下の値になる。この結果は、モデル1が正しい確率がモデル2が正しい確率よりもはるかに大きいことを示す。すなわち、体重差は生存に大きく影響しているといえる。<br />
<span class="math display">\[
\begin{aligned}
\rm{Bayes} \; \rm{factor} &amp;= \frac{Prob(D|Model1)}{Prob(D|Model2)} \times \frac{Model1}{Model2}\\
                          &amp;= \frac{exp(-37.97)}{exp(-54.43)} \times 1\\
                          &amp;= 14076257
\end{aligned}    
\]</span></p>
<p>過分散の診断を含むモデル診断も行う必要があるが、ここでは省略する。</p>
</div>
<div id="binomial-glm" class="section level3 hasAnchor" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Binomial GLM<a href="Chapter10.html#binomial-glm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ここからは、商用のダニ駆除剤がミツバチへのダニの寄生に影響するかを調べたMaggi(unpublished data)のデータを用いる。4種類の駆除剤(<code>Toxic</code>)が異なる濃度(<code>Concentration</code>)で使用された24時間後に死亡したダニの数(<code>Dead_mites</code>)がバッチごとに記録されている。<code>Total</code>はもともといたダニの数を示す。</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="Chapter10.html#cb297-1" tabindex="-1"></a>mite <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;data/Drugsmites.txt&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb297-2"><a href="Chapter10.html#cb297-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fToxic =</span> <span class="fu">as.factor</span>(Toxic))</span>
<span id="cb297-3"><a href="Chapter10.html#cb297-3" tabindex="-1"></a></span>
<span id="cb297-4"><a href="Chapter10.html#cb297-4" tabindex="-1"></a><span class="fu">datatable</span>(mite,</span>
<span id="cb297-5"><a href="Chapter10.html#cb297-5" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">80</span>),</span>
<span id="cb297-6"><a href="Chapter10.html#cb297-6" tabindex="-1"></a>          <span class="at">filter =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-64fe1a053c30a4cbb8ea" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-64fe1a053c30a4cbb8ea">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"115\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2.16\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"4\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"5\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"3\" data-max=\"5\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"1\" data-scale=\"9\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115],[0,0,0,0,0,0.25,0.25,0.25,0.25,0.25,0.5,0.5,0.5,0.5,0.5,1,1,1,1,1,2,2,2,2,2,0,0,0,0,0,0.12,0.12,0.12,0.12,0.12,0.24,0.24,0.24,0.24,0.24,0.49,0.49,0.49,0.49,0.49,0.98,0.98,0.98,0.98,0.98,0,0,0,0,0,0,0,0,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,1,1,1,1,1,1,1,1,0,0,0,0,0,0.54,0.54,0.54,0.54,0.54,1.08,1.08,1.08,1.08,1.08,1.62,1.62,1.62,1.62,1.62,2.16,2.16,2.16,2.16,2.16],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,1,0,0,2,1,3,2,1,3,4,3,2,4,3,4,3,4,2,4,4,4,4,4,0,0,1,0,0,3,2,3,4,4,4,5,3,3,3,5,4,5,5,4,5,5,5,5,5,1,0,0,1,0,0,1,0,2,2,2,1,1,3,1,1,3,2,3,3,3,2,2,3,3,3,2,3,3,3,2,3,3,3,2,3,3,3,3,3,0,0,0,0,1,3,1,2,2,4,3,5,4,4,4,5,5,2,4,5,5,4,5,4,5],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],[0,0,0.25,0,0,0.5,0.25,0.75,0.5,0.25,0.75,1,0.75,0.5,1,0.75,1,0.75,1,0.5,1,1,1,1,1,0,0,0.2,0,0,0.6,0.4,0.6,0.8,0.8,0.8,1,0.6,0.6,0.6,1,0.8,1,1,0.8,1,1,1,1,1,0.333333333,0,0,0.333333333,0,0,0.333333333,0,0.666666667,0.666666667,0.666666667,0.333333333,0.333333333,1,0.333333333,0.333333333,1,0.666666667,1,1,1,0.666666667,0.666666667,1,1,1,0.666666667,1,1,1,0.666666667,1,1,1,0.666666667,1,1,1,1,1,0,0,0,0,0.2,0.6,0.2,0.4,0.4,0.8,0.6,1,0.8,0.8,0.8,1,1,0.4,0.8,1,1,0.8,1,0.8,1],["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4","4"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>ID<\/th>\n      <th>Concentration<\/th>\n      <th>Toxic<\/th>\n      <th>Dead_mites<\/th>\n      <th>Total<\/th>\n      <th>Proportion<\/th>\n      <th>fToxic<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":80,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
<p>応答変数をバッチごとに死んだダニの割合(<code>Dead_mites</code>/<code>Total</code>)とする以下のモデルを考える。ただし、<span class="math inline">\(N_i = Total_i\)</span>である。回帰係数は省略している。
<span class="math display">\[
\begin{aligned}
&amp;Deadmites_i \sim Binomial(\pi_i, N_i)\\
&amp;E(Deadmites_i) = \pi_i \times N_i \; and \; var(Deadmites_i) = N_i \times \pi_i \times (1-\pi_i)\\
&amp;logit(\pi_i ) = Intercept + Concentration_i + Toxic_i + Concentration_i \times Toxic_i
\end{aligned}
\]</span></p>
<p>Rでは以下のように実行する。</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="Chapter10.html#cb298-1" tabindex="-1"></a>m10_9 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Dead_mites <span class="sc">~</span> Concentration<span class="sc">*</span>fToxic,</span>
<span id="cb298-2"><a href="Chapter10.html#cb298-2" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb298-3"><a href="Chapter10.html#cb298-3" tabindex="-1"></a>              <span class="at">data =</span> mite,</span>
<span id="cb298-4"><a href="Chapter10.html#cb298-4" tabindex="-1"></a>              <span class="at">Ntrials =</span> Total,</span>
<span id="cb298-5"><a href="Chapter10.html#cb298-5" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb298-6"><a href="Chapter10.html#cb298-6" tabindex="-1"></a>                                     <span class="at">dic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb298-7"><a href="Chapter10.html#cb298-7" tabindex="-1"></a>              <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p>交互作用がないモデルとどちらが良いか確かめるためDICとWAICを用いたモデル選択を行う。結果、交互作用を含むモデルの方がよいことが分かった。</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="Chapter10.html#cb299-1" tabindex="-1"></a>m10_10 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Dead_mites <span class="sc">~</span> Concentration <span class="sc">+</span> fToxic,</span>
<span id="cb299-2"><a href="Chapter10.html#cb299-2" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb299-3"><a href="Chapter10.html#cb299-3" tabindex="-1"></a>              <span class="at">data =</span> mite,</span>
<span id="cb299-4"><a href="Chapter10.html#cb299-4" tabindex="-1"></a>              <span class="at">Ntrials =</span> Total,</span>
<span id="cb299-5"><a href="Chapter10.html#cb299-5" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb299-6"><a href="Chapter10.html#cb299-6" tabindex="-1"></a>                                     <span class="at">dic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb299-7"><a href="Chapter10.html#cb299-7" tabindex="-1"></a>              <span class="at">control.predictor =</span> <span class="fu">list</span>(<span class="at">compute =</span> <span class="cn">TRUE</span>))</span>
<span id="cb299-8"><a href="Chapter10.html#cb299-8" tabindex="-1"></a></span>
<span id="cb299-9"><a href="Chapter10.html#cb299-9" tabindex="-1"></a>waic<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_9<span class="sc">$</span>waic<span class="sc">$</span>waic, m10_10<span class="sc">$</span>waic<span class="sc">$</span>waic)</span>
<span id="cb299-10"><a href="Chapter10.html#cb299-10" tabindex="-1"></a>dic<span class="fl">.10</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_9<span class="sc">$</span>dic<span class="sc">$</span>dic, m10_10<span class="sc">$</span>dic<span class="sc">$</span>dic)</span>
<span id="cb299-11"><a href="Chapter10.html#cb299-11" tabindex="-1"></a></span>
<span id="cb299-12"><a href="Chapter10.html#cb299-12" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;Full&quot;</span>, <span class="st">&quot;- Conc × Toxic&quot;</span>),</span>
<span id="cb299-13"><a href="Chapter10.html#cb299-13" tabindex="-1"></a>           <span class="at">WAIC =</span> waic<span class="fl">.10</span>,</span>
<span id="cb299-14"><a href="Chapter10.html#cb299-14" tabindex="-1"></a>           <span class="at">DIC =</span> dic<span class="fl">.10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb299-15"><a href="Chapter10.html#cb299-15" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">&quot;type&quot;</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["WAIC"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["DIC"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"233.8443","2":"231.1413","_rn_":"Full"},{"1":"256.3229","2":"253.5174","_rn_":"- Conc × Toxic"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br/></p>
<p>過分散の診断を含むモデル診断も行う必要があるが、ここでは省略する。</p>
</div>
</div>
<div id="gamma-glm" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Gamma GLM<a href="Chapter10.html#gamma-glm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ここでは、イタリアのトスカーナ地方のアメリカザリガニについて調査した <span class="citation">Ligas (<a href="#ref-Ligas2008">2008</a>)</span> のデータを用いる。746個体について6つの形態学的特徴が記録されている。ここでは、体重(<code>Weight</code>)と性別(<code>Sex</code>)、体長(<code>CTL</code>)のみに着目する。</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="Chapter10.html#cb300-1" tabindex="-1"></a>cray <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;data/Procambarus.txt&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb300-2"><a href="Chapter10.html#cb300-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fSex =</span> <span class="fu">as.factor</span>(Sex))</span>
<span id="cb300-3"><a href="Chapter10.html#cb300-3" tabindex="-1"></a></span>
<span id="cb300-4"><a href="Chapter10.html#cb300-4" tabindex="-1"></a><span class="fu">datatable</span>(cray,</span>
<span id="cb300-5"><a href="Chapter10.html#cb300-5" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">80</span>),</span>
<span id="cb300-6"><a href="Chapter10.html#cb300-6" tabindex="-1"></a>          <span class="at">filter =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b2e64733ae45e0286433" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b2e64733ae45e0286433">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"23.8\" data-max=\"69.5\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"3\" data-max=\"72.5\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;1\\t&quot;,&quot;2\\t&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320"],[47.6,45.1,59.7,51.2,59.6,44.5,45.8,42.2,54.9,65.1,31.3,41.3,40.1,55.1,45.1,41.7,43,39.5,49.5,51.2,50.2,52.5,57.6,61,62.3,43.3,56.5,63,62.6,47.1,58.2,46.2,58.1,64.2,47.4,59.8,60,62,53.9,57.1,53.8,63.3,59.3,57.1,47.6,55.7,31.2,42.2,62.5,49.1,54.6,40.3,53.1,57.4,58.2,55,56,53.4,55,65,61.3,52.2,55.9,53.3,34.4,42.5,61.9,38.2,32.7,48.4,52.6,27.9,31.5,57.4,45.5,26.1,25.5,25.3,52.4,56.6,55.7,48.5,46.4,48.5,30,30.5,24.5,51.5,37.8,25.2,39.5,42.6,39.9,38.9,38,30.1,37.5,35.2,37.6,30.1,45,26.9,23.8,45.2,35.5,34.4,42.5,61.9,38.2,32.7,48.4,52.6,27.9,31.5,57.4,45.5,26.1,25.5,25.3,52.4,56.6,55.7,48.5,46.4,48.5,30,30.5,24.5,51.5,37.8,25.2,39.5,42.6,39.9,38.9,38,30.1,37.5,35.2,37.6,30.1,45,26.9,23.8,45.2,35.5,57.3,48.7,47.2,50.9,44.7,56.5,47.8,46.6,48.2,52.1,44.9,51.8,50.2,40,47.5,47.3,48.3,46.4,36.2,37.6,41.8,45.5,40.2,39.2,27.2,69.5,64,57.4,54.8,49.4,57.4,55,53.2,55,50.3,62.4,50,49.4,43.3,43.4,56.2,43.2,46.4,46.1,42,44.5,37.3,33.5,37.9,36.3,50.5,43.9,43.3,47.4,46.6,50.2,39.8,41.1,34.1,38.2,33,51.2,50.9,40.9,33.1,39,36.3,36.8,48.7,45.7,40.3,39.4,37.3,37.4,33.4,38.3,43.7,40,45,36.9,27.3,60.2,56.5,53.9,47.4,50.4,49,44,51.4,43.5,61.4,43.3,42.5,40.8,49,51.5,51.1,37.6,46.8,50.9,39.7,44.2,49.5,29.5,32.2,26.1,34.8,33.6,47.8,39.4,33.7,36.2,40,41.2,41,40.2,41.4,42.4,47.4,48.5,45,46.1,46.6,46.4,49.8,40.8,49.6,45.3,45.8,56.2,38,35.8,45.8,39.5,39.4,41.8,55,49.5,59,53.5,49.5,41,48,42.6,35,34.2,39.1,53.8,52.8,51.5,50.2,43,38.1,36.5,38.6,45.9,34.8,41.3,41.9,46,34.5,34.8,30.7,45.3,51,53.9,46.5,55.5,42.9,40,43.8,35.3,27.8,32.5],[23.5,16.5,50,33,50,20,23,16,52,63,7.5,15,15.5,22.5,22.5,21,21.5,17.5,27.5,30.5,31,40,49,63.5,59.5,18.5,46.5,61,53.5,27,39,23,51.5,58,27,47,47.5,null,37.5,null,43.5,51,null,41,19.5,36.5,null,16,62.5,22,29.5,14,33,42,37.5,33,42,36.5,39.5,56.5,48,36.5,45,34.5,9,20.5,null,12.5,6,24.5,31,4.5,6,null,20,3.5,3,3,null,40,null,26.5,25,26,5,5.5,null,28,10.5,3,12,17.5,14.5,11,null,4.5,11,9,11,5,20.5,4,3,null,9,9,20.5,null,12.5,6,24.5,31,4.5,6,null,20,3.5,3,3,null,40,null,26.5,25,26,5,5.5,null,28,10.5,3,12,17.5,14.5,11,null,4.5,11,9,11,5,20.5,4,3,null,9,48.5,33.5,26.5,31,23.5,50,31.5,26.5,26,34,22,26,26.5,15,21.5,21,27,20,9,12.5,12,22,14,11.5,4,72.5,62,43.5,31,17,38.5,43.5,36,42.5,26.5,54,27,32,17,19.5,35.5,20.5,19.5,24,19.5,21.5,8.5,9,13.5,10,27.5,15.5,18,19.5,17,33,15,15,9,13.5,7.5,null,25,15,7.5,13,13,12,25,21.5,13.5,15.5,12,12.5,10,13,21,15,20,12,4.5,40.5,39,46,26,26,24,17.5,22,17,47.5,21,19,16,29,33.5,35,13.5,24.5,34,16.5,18,24,5,5.5,3.5,8.5,7.5,24,14,8,9,13.5,15,16.5,12.5,16.5,16.5,23,22.5,21.5,21,22,22,32,17.5,25.5,26,23,33,10.5,14,21.5,15,16.5,18,34,31,41,43,39.5,17,27,14,9.5,8.5,10.5,39.5,36.5,25.5,26.5,19.5,13.5,9.5,12,18,8.5,17.5,16.5,18.5,9.5,10,6.5,22.5,30.5,35.5,21,31.5,18.5,15.5,17.5,9.5,4,8],["1\t","2\t","1\t","2\t","1\t","1\t","1\t","2\t","2\t","2\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","1\t","1\t","2\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","2\t","2\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","1\t","1\t","2\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","2\t","1\t","1\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","1\t","2\t","1\t","1\t","1\t","1\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","1\t","1\t","2\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","2\t","1\t","1\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","1\t","2\t","1\t","1\t","1\t","1\t","1\t","1\t","2\t","2\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","1\t","2\t","1\t","1\t","1\t","2\t","2\t","2\t","1\t","2\t","2\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","2\t","2\t","1\t","2\t","2\t","1\t","2\t","2\t","2\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","1\t","1\t","1\t","2\t","1\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","2\t","2\t","1\t","2\t","2\t","2\t","1\t","1\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","2\t","1\t","2\t","1\t","2\t","1\t","2\t","2\t","1\t","1\t","1\t","1\t","1\t","2\t","1\t","1\t","1\t","2\t","1\t","1\t","1\t","2\t","1\t","1\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","2\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t"],["1\t","2\t","1\t","2\t","1\t","1\t","1\t","2\t","2\t","2\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","1\t","1\t","2\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","2\t","2\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","1\t","1\t","2\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","2\t","1\t","1\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","1\t","2\t","1\t","1\t","1\t","1\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","1\t","1\t","2\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","1\t","2\t","1\t","1\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","1\t","2\t","1\t","1\t","1\t","1\t","1\t","1\t","2\t","2\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","1\t","1\t","2\t","2\t","1\t","1\t","1\t","2\t","1\t","1\t","1\t","2\t","2\t","2\t","1\t","2\t","2\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","2\t","2\t","1\t","2\t","2\t","1\t","2\t","2\t","2\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","1\t","1\t","1\t","2\t","1\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","2\t","2\t","1\t","2\t","2\t","2\t","1\t","1\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","2\t","1\t","2\t","1\t","2\t","1\t","2\t","2\t","1\t","1\t","1\t","1\t","1\t","2\t","1\t","1\t","1\t","2\t","1\t","1\t","1\t","2\t","1\t","1\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","2\t","2\t","1\t","1\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t","2\t","2\t","2\t","2\t","2\t","2\t","1\t","2\t","1\t","2\t"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CTL<\/th>\n      <th>Weight<\/th>\n      <th>Sex<\/th>\n      <th>fSex<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":80,"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
<p>以下のモデルを考える。回帰係数は省略している。<br />
<span class="math display">\[
\begin{aligned}
&amp;Weight_i \sim Gamma(\mu_i, \phi)\\
&amp;E(Weight_i) = \mu_i \; and \; var(Weight_i) = \frac{\mu_i^2}{\phi}\\
&amp;log(\mu_i) = Length_i + Sex_i + +ength_i \times Sex_i
\end{aligned}
\]</span></p>
<p>Rでは以下のように実行する。</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="Chapter10.html#cb301-1" tabindex="-1"></a>m10_11 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Weight <span class="sc">~</span> CTL<span class="sc">*</span>fSex,</span>
<span id="cb301-2"><a href="Chapter10.html#cb301-2" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;Gamma&quot;</span>,</span>
<span id="cb301-3"><a href="Chapter10.html#cb301-3" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb301-4"><a href="Chapter10.html#cb301-4" tabindex="-1"></a>                                      <span class="at">dic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb301-5"><a href="Chapter10.html#cb301-5" tabindex="-1"></a>               <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>,</span>
<span id="cb301-6"><a href="Chapter10.html#cb301-6" tabindex="-1"></a>                                     <span class="at">hyper =</span> <span class="fu">list</span>(<span class="at">prec =</span> <span class="fu">list</span>(</span>
<span id="cb301-7"><a href="Chapter10.html#cb301-7" tabindex="-1"></a>                                       <span class="at">prior =</span> <span class="st">&quot;loggamma&quot;</span>,</span>
<span id="cb301-8"><a href="Chapter10.html#cb301-8" tabindex="-1"></a>                                       <span class="at">param =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.5</span>)</span>
<span id="cb301-9"><a href="Chapter10.html#cb301-9" tabindex="-1"></a>                                     ))),</span>
<span id="cb301-10"><a href="Chapter10.html#cb301-10" tabindex="-1"></a>               <span class="at">data =</span> cray)</span></code></pre></div>
<p>ガンマ分布のパラメータ<span class="math inline">\(\phi\)</span>は負の二項分布の<span class="math inline">\(k\)</span>と同じように機能する<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>。デフォルトの事前分布としては、<span class="math inline">\(log(\phi)\)</span>に対してガンマ分布が用いられている。<code>INLA</code>では<span class="math inline">\(\phi\)</span>はprecisionパラメータと呼ばれ、モデルの結果に推定値が直接示されている。</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="Chapter10.html#cb302-1" tabindex="-1"></a>m10_11<span class="sc">$</span>summary.hyperpar</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["mean"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["sd"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["0.025quant"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["0.5quant"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["0.975quant"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["mode"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"33.19574","2":"2.701187","3":"28.11658","4":"33.12266","5":"38.69875","6":"32.97489","_rn_":"Precision parameter for the Gamma observations"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>モデル選択を行うため、交互作用なしのモデルとフルモデルの比較を行ったところ、交互作用のないモデルの方がDICとWAICが低い値をとることが分かった。</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="Chapter10.html#cb303-1" tabindex="-1"></a>m10_11b <span class="ot">&lt;-</span> <span class="fu">inla</span>(Weight <span class="sc">~</span> CTL <span class="sc">+</span> fSex,</span>
<span id="cb303-2"><a href="Chapter10.html#cb303-2" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;Gamma&quot;</span>,</span>
<span id="cb303-3"><a href="Chapter10.html#cb303-3" tabindex="-1"></a>               <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb303-4"><a href="Chapter10.html#cb303-4" tabindex="-1"></a>                                      <span class="at">dic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb303-5"><a href="Chapter10.html#cb303-5" tabindex="-1"></a>               <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>,</span>
<span id="cb303-6"><a href="Chapter10.html#cb303-6" tabindex="-1"></a>                                     <span class="at">hyper =</span> <span class="fu">list</span>(<span class="at">prec =</span> <span class="fu">list</span>(</span>
<span id="cb303-7"><a href="Chapter10.html#cb303-7" tabindex="-1"></a>                                       <span class="at">prior =</span> <span class="st">&quot;loggamma&quot;</span>,</span>
<span id="cb303-8"><a href="Chapter10.html#cb303-8" tabindex="-1"></a>                                       <span class="at">param =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.5</span>)</span>
<span id="cb303-9"><a href="Chapter10.html#cb303-9" tabindex="-1"></a>                                     ))),</span>
<span id="cb303-10"><a href="Chapter10.html#cb303-10" tabindex="-1"></a>               <span class="at">data =</span> cray)</span>
<span id="cb303-11"><a href="Chapter10.html#cb303-11" tabindex="-1"></a></span>
<span id="cb303-12"><a href="Chapter10.html#cb303-12" tabindex="-1"></a>waic<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_11<span class="sc">$</span>waic<span class="sc">$</span>waic, m10_11b<span class="sc">$</span>waic<span class="sc">$</span>waic)</span>
<span id="cb303-13"><a href="Chapter10.html#cb303-13" tabindex="-1"></a>  dic<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_11<span class="sc">$</span>dic<span class="sc">$</span>dic, m10_11b<span class="sc">$</span>dic<span class="sc">$</span>dic)</span>
<span id="cb303-14"><a href="Chapter10.html#cb303-14" tabindex="-1"></a></span>
<span id="cb303-15"><a href="Chapter10.html#cb303-15" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;Full&quot;</span>, <span class="st">&quot;- Conc × Toxic&quot;</span>),</span>
<span id="cb303-16"><a href="Chapter10.html#cb303-16" tabindex="-1"></a>           <span class="at">WAIC =</span> waic<span class="fl">.11</span>,</span>
<span id="cb303-17"><a href="Chapter10.html#cb303-17" tabindex="-1"></a>           <span class="at">DIC =</span> dic<span class="fl">.11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb303-18"><a href="Chapter10.html#cb303-18" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">&quot;type&quot;</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["WAIC"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["DIC"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1519.631","2":"1518.983","_rn_":"Full"},{"1":"1517.392","2":"1517.277","_rn_":"- Conc × Toxic"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br/></p>
<p>過分散の診断を含むモデル診断も行う必要があるが、ここでは省略する。</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Fukuda2015" class="csl-entry">
Fukuda Y, Manolis C, Saalfeld K, Zuur A (2015) Dead or alive? Factors affecting the survival of victims during attacks by saltwater crocodiles (crocodylus porosus) in australia. PLoS One 10:e0126778
</div>
<div id="ref-Ligas2008" class="csl-entry">
Ligas A (2008) Population dynamics of procambarus clarkii (girard, 1852) (decapoda, astacidea, cambaridae) from southern tuscany (italy). Crustaceana 81:601–609
</div>
<div id="ref-Timi2008" class="csl-entry">
Timi JT, Lanfranchi AL, Etchegoin JA, Cremonte F (2008) Parasites of the brazilian sandperch pinguipes brasilianus cuvier: A tool for stock discrimination in the argentine sea. J Fish Biol 72:1332–1342
</div>
<div id="ref-Zuur2017" class="csl-entry">
Zuur AF (2017) Beginner’s guide to spatial, temporal and <span>Spatial-Temporal</span> ecological data analysis with <span>R-Inla</span>: Using glm and glmm volume <span>I</span>. Hightland Statistics Ltd.
</div>
<div id="ref-Zuur2016" class="csl-entry">
Zuur AF, Ieno EN (2016) Beginner’s guide to zero-inflated models with <span>R</span>. <a href="https://www.highstat.com/Books/BGS/ZIM/pdfs/TOCOnly.pdf" class="uri">https://www.highstat.com/Books/BGS/ZIM/pdfs/TOCOnly.pdf</a>; Highland Statistics
</div>
<div id="ref-Ohigashi2010" class="csl-entry">
健太郎大東 (2010) <span>線形モデルから一般化線形モデル（GLM）へ</span>. 雑草研究 55:268–274
</div>
</div>
<div class="footnotes">
<hr />
<ol start="9">
<li id="fn9"><p>というより、負の二項分布はポワソン分布の期待値<span class="math inline">\(\lambda\)</span>がガンマ分布から得られているとする混合分布である。<a href="Chapter10.html#fnref9" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Chapter9.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Chapter11.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
