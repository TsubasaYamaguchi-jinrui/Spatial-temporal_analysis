<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Poisson, negative binomial, binomial and g amma GLMs in R-INLA | Introduction to spatial-temporal data anlysis using R</title>
  <meta name="description" content="9 Poisson, negative binomial, binomial and g amma GLMs in R-INLA | Introduction to spatial-temporal data anlysis using R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Poisson, negative binomial, binomial and g amma GLMs in R-INLA | Introduction to spatial-temporal data anlysis using R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Poisson, negative binomial, binomial and g amma GLMs in R-INLA | Introduction to spatial-temporal data anlysis using R" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-09-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Chapter9.html"/>
<link rel="next" href="sessioninfo.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="Chapter0.html"><a href="Chapter0.html"><i class="fa fa-check"></i>0. パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="Chapter2.html"><a href="Chapter2.html"><i class="fa fa-check"></i><b>1</b> Recognizing statistical dependency</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Chapter2.html"><a href="Chapter2.html#pseudoreplication"><i class="fa fa-check"></i><b>1.1</b> Pseudoreplication</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="Chapter2.html"><a href="Chapter2.html#疑似反復とは"><i class="fa fa-check"></i><b>1.1.1</b> 疑似反復とは</a></li>
<li class="chapter" data-level="1.1.2" data-path="Chapter2.html"><a href="Chapter2.html#時空間的な疑似反復"><i class="fa fa-check"></i><b>1.1.2</b> 時空間的な疑似反復</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="Chapter2.html"><a href="Chapter2.html#s1-2"><i class="fa fa-check"></i><b>1.2</b> Linear regression applied to spatial data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="Chapter2.html"><a href="Chapter2.html#visualization"><i class="fa fa-check"></i><b>1.2.1</b> Visualization</a></li>
<li class="chapter" data-level="1.2.2" data-path="Chapter2.html"><a href="Chapter2.html#dependency"><i class="fa fa-check"></i><b>1.2.2</b> Dependency</a></li>
<li class="chapter" data-level="1.2.3" data-path="Chapter2.html"><a href="Chapter2.html#fit-the-model"><i class="fa fa-check"></i><b>1.2.3</b> Fit the model</a></li>
<li class="chapter" data-level="1.2.4" data-path="Chapter2.html"><a href="Chapter2.html#model-validation"><i class="fa fa-check"></i><b>1.2.4</b> Model validation</a>
<ul>
<li class="chapter" data-level="1.2.4.1" data-path="Chapter2.html"><a href="Chapter2.html#check-homogeinity-and-model-misfit"><i class="fa fa-check"></i><b>1.2.4.1</b> Check homogeinity and model misfit</a></li>
</ul></li>
<li class="chapter" data-level="1.2.5" data-path="Chapter2.html"><a href="Chapter2.html#check-spatial-dependence"><i class="fa fa-check"></i><b>1.2.5</b> Check spatial dependence</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="Chapter2.html"><a href="Chapter2.html#s2-2"><i class="fa fa-check"></i><b>1.3</b> GAM applied to temporal data</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="Chapter2.html"><a href="Chapter2.html#subnivium-temperature-data"><i class="fa fa-check"></i><b>1.3.1</b> Subnivium temperature data</a></li>
<li class="chapter" data-level="1.3.2" data-path="Chapter2.html"><a href="Chapter2.html#sources-of-dependency"><i class="fa fa-check"></i><b>1.3.2</b> Sources of dependency</a></li>
<li class="chapter" data-level="1.3.3" data-path="Chapter2.html"><a href="Chapter2.html#the-model"><i class="fa fa-check"></i><b>1.3.3</b> The model</a></li>
<li class="chapter" data-level="1.3.4" data-path="Chapter2.html"><a href="Chapter2.html#model-validation-1"><i class="fa fa-check"></i><b>1.3.4</b> Model validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chapter3.html"><a href="Chapter3.html"><i class="fa fa-check"></i><b>2</b> Time series and GLS</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Chapter3.html"><a href="Chapter3.html#ospreys"><i class="fa fa-check"></i><b>2.1</b> Ospreys</a></li>
<li class="chapter" data-level="2.2" data-path="Chapter3.html"><a href="Chapter3.html#covariance-and-correlation-coefficients"><i class="fa fa-check"></i><b>2.2</b> Covariance and correlation coefficients</a></li>
<li class="chapter" data-level="2.3" data-path="Chapter3.html"><a href="Chapter3.html#linear-regression-models"><i class="fa fa-check"></i><b>2.3</b> Linear regression models</a></li>
<li class="chapter" data-level="2.4" data-path="Chapter3.html"><a href="Chapter3.html#focusing-on-the-residual-covariance-matrix"><i class="fa fa-check"></i><b>2.4</b> Focusing on the residual covariance matrix</a></li>
<li class="chapter" data-level="2.5" data-path="Chapter3.html"><a href="Chapter3.html#dependency-and-the-covariance-matrix"><i class="fa fa-check"></i><b>2.5</b> Dependency and the covariance matrix</a></li>
<li class="chapter" data-level="2.6" data-path="Chapter3.html"><a href="Chapter3.html#dealing-with-temporal-dependency"><i class="fa fa-check"></i><b>2.6</b> Dealing with temporal dependency</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="Chapter3.html"><a href="Chapter3.html#adelie-penguins"><i class="fa fa-check"></i><b>2.6.1</b> Adelie penguins</a></li>
<li class="chapter" data-level="2.6.2" data-path="Chapter3.html"><a href="Chapter3.html#do-we-have-dependency"><i class="fa fa-check"></i><b>2.6.2</b> Do we have dependency?</a></li>
<li class="chapter" data-level="2.6.3" data-path="Chapter3.html"><a href="Chapter3.html#formulation-of-the-linear-regression-model"><i class="fa fa-check"></i><b>2.6.3</b> Formulation of the linear regression model</a></li>
<li class="chapter" data-level="2.6.4" data-path="Chapter3.html"><a href="Chapter3.html#application-of-the-linear-regression-model"><i class="fa fa-check"></i><b>2.6.4</b> Application of the linear regression model</a></li>
<li class="chapter" data-level="2.6.5" data-path="Chapter3.html"><a href="Chapter3.html#formulation-of-the-gls-model"><i class="fa fa-check"></i><b>2.6.5</b> Formulation of the GLS model</a></li>
<li class="chapter" data-level="2.6.6" data-path="Chapter3.html"><a href="Chapter3.html#implementation-using-the-gls-function"><i class="fa fa-check"></i><b>2.6.6</b> Implementation using the gls function</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="Chapter3.html"><a href="Chapter3.html#multiple-time-series"><i class="fa fa-check"></i><b>2.7</b> Multiple time series</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chapter4.html"><a href="Chapter4.html"><i class="fa fa-check"></i><b>3</b> Spatial data and GLS</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Chapter4.html"><a href="Chapter4.html#variogram-models-for-spatial-dependency"><i class="fa fa-check"></i><b>3.1</b> Variogram models for spatial dependency</a></li>
<li class="chapter" data-level="3.2" data-path="Chapter4.html"><a href="Chapter4.html#application-on-the-irish-ph-data"><i class="fa fa-check"></i><b>3.2</b> Application on the Irish pH data</a></li>
<li class="chapter" data-level="3.3" data-path="Chapter4.html"><a href="Chapter4.html#s4-3"><i class="fa fa-check"></i><b>3.3</b> Matern correlation function</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chapter5.html"><a href="Chapter5.html"><i class="fa fa-check"></i><b>4</b> Linear mixed-effects models and dependency</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Chapter5.html"><a href="Chapter5.html#white-storks"><i class="fa fa-check"></i><b>4.1</b> White Storks</a></li>
<li class="chapter" data-level="4.2" data-path="Chapter5.html"><a href="Chapter5.html#considering-the-data-wrongly-as-one-way-nested"><i class="fa fa-check"></i><b>4.2</b> Considering the data (wrongly) as one-way nested</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="Chapter5.html"><a href="Chapter5.html#model-formulation"><i class="fa fa-check"></i><b>4.2.1</b> model formulation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="Chapter5.html"><a href="Chapter5.html#fitting-the-one-way-nested-model-using-lmer"><i class="fa fa-check"></i><b>4.3</b> Fitting the one-way nested model using lmer</a></li>
<li class="chapter" data-level="4.4" data-path="Chapter5.html"><a href="Chapter5.html#model-validation-2"><i class="fa fa-check"></i><b>4.4</b> Model validation</a></li>
<li class="chapter" data-level="4.5" data-path="Chapter5.html"><a href="Chapter5.html#sketching-the-fitted-value"><i class="fa fa-check"></i><b>4.5</b> Sketching the fitted value</a></li>
<li class="chapter" data-level="4.6" data-path="Chapter5.html"><a href="Chapter5.html#considering-the-data-correctly-as-two-way-nested"><i class="fa fa-check"></i><b>4.6</b> Considering the data (correctly) as two-way nested</a></li>
<li class="chapter" data-level="4.7" data-path="Chapter5.html"><a href="Chapter5.html#differences-with-the-ar1-process-approach"><i class="fa fa-check"></i><b>4.7</b> Differences with the AR1 process approach</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Chapter6.html"><a href="Chapter6.html"><i class="fa fa-check"></i><b>5</b> Modelling space explicitly</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Chapter6.html"><a href="Chapter6.html#model-formulation-1"><i class="fa fa-check"></i><b>5.1</b> Model formulation</a></li>
<li class="chapter" data-level="5.2" data-path="Chapter6.html"><a href="Chapter6.html#s6-2"><i class="fa fa-check"></i><b>5.2</b> Covariance matrix of the spatial random effect</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="Chapter6.html"><a href="Chapter6.html#simulation-study"><i class="fa fa-check"></i><b>5.2.1</b> Simulation study</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="Chapter6.html"><a href="Chapter6.html#spatial-temporal-correlation"><i class="fa fa-check"></i><b>5.3</b> Spatial-temporal correlation</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="Chapter6.html"><a href="Chapter6.html#simulation-study-continued"><i class="fa fa-check"></i><b>5.3.1</b> Simulation study (continued)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Chapter7.html"><a href="Chapter7.html"><i class="fa fa-check"></i><b>6</b> Introduction to Bayesian statistics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Chapter7.html"><a href="Chapter7.html#why-go-bayesian"><i class="fa fa-check"></i><b>6.1</b> Why go Bayesian?</a></li>
<li class="chapter" data-level="6.2" data-path="Chapter7.html"><a href="Chapter7.html#s7-2"><i class="fa fa-check"></i><b>6.2</b> General probability rules</a></li>
<li class="chapter" data-level="6.3" data-path="Chapter7.html"><a href="Chapter7.html#s7-3"><i class="fa fa-check"></i><b>6.3</b> The mean of a distribution</a></li>
<li class="chapter" data-level="6.4" data-path="Chapter7.html"><a href="Chapter7.html#bayes-theorem-again"><i class="fa fa-check"></i><b>6.4</b> Bayes theorem again</a></li>
<li class="chapter" data-level="6.5" data-path="Chapter7.html"><a href="Chapter7.html#s7-5"><i class="fa fa-check"></i><b>6.5</b> Conjugate priors</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="Chapter7.html"><a href="Chapter7.html#likelihood-function"><i class="fa fa-check"></i><b>6.5.1</b> Likelihood function</a></li>
<li class="chapter" data-level="6.5.2" data-path="Chapter7.html"><a href="Chapter7.html#priors"><i class="fa fa-check"></i><b>6.5.2</b> Priors</a></li>
<li class="chapter" data-level="6.5.3" data-path="Chapter7.html"><a href="Chapter7.html#posterior-distribution"><i class="fa fa-check"></i><b>6.5.3</b> Posterior distribution</a></li>
<li class="chapter" data-level="6.5.4" data-path="Chapter7.html"><a href="Chapter7.html#diffuse-prior"><i class="fa fa-check"></i><b>6.5.4</b> Diffuse prior</a></li>
<li class="chapter" data-level="6.5.5" data-path="Chapter7.html"><a href="Chapter7.html#informative-prior"><i class="fa fa-check"></i><b>6.5.5</b> Informative prior</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="Chapter7.html"><a href="Chapter7.html#markov-chain-monte-carlo-simulation"><i class="fa fa-check"></i><b>6.6</b> Markov chain Monte Carlo simulation</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="Chapter7.html"><a href="Chapter7.html#underlying-idea"><i class="fa fa-check"></i><b>6.6.1</b> underlying idea</a></li>
<li class="chapter" data-level="6.6.2" data-path="Chapter7.html"><a href="Chapter7.html#simple-example-of-mcmc-algorithm"><i class="fa fa-check"></i><b>6.6.2</b> Simple example of MCMC algorithm</a></li>
<li class="chapter" data-level="6.6.3" data-path="Chapter7.html"><a href="Chapter7.html#methods-in-mcmc"><i class="fa fa-check"></i><b>6.6.3</b> Methods in MCMC</a></li>
<li class="chapter" data-level="6.6.4" data-path="Chapter7.html"><a href="Chapter7.html#flowchart-for-running-a-model-in-stan"><i class="fa fa-check"></i><b>6.6.4</b> Flowchart for running a model in Stan</a>
<ul>
<li class="chapter" data-level="6.6.4.1" data-path="Chapter7.html"><a href="Chapter7.html#preparing-the-data-for-stan"><i class="fa fa-check"></i><b>6.6.4.1</b> Preparing the data for Stan</a></li>
<li class="chapter" data-level="6.6.4.2" data-path="Chapter7.html"><a href="Chapter7.html#decide-model-formulation-and-priors"><i class="fa fa-check"></i><b>6.6.4.2</b> Decide model formulation and priors</a></li>
<li class="chapter" data-level="6.6.4.3" data-path="Chapter7.html"><a href="Chapter7.html#preparing-stan-file"><i class="fa fa-check"></i><b>6.6.4.3</b> Preparing stan file</a></li>
<li class="chapter" data-level="6.6.4.4" data-path="Chapter7.html"><a href="Chapter7.html#initial-values"><i class="fa fa-check"></i><b>6.6.4.4</b> Initial values</a></li>
</ul></li>
<li class="chapter" data-level="6.6.5" data-path="Chapter7.html"><a href="Chapter7.html#running-model-in-stan"><i class="fa fa-check"></i><b>6.6.5</b> Running model in Stan</a></li>
<li class="chapter" data-level="6.6.6" data-path="Chapter7.html"><a href="Chapter7.html#assess-mixing"><i class="fa fa-check"></i><b>6.6.6</b> Assess mixing</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="Chapter7.html"><a href="Chapter7.html#integrated-nested-laplace-approximation"><i class="fa fa-check"></i><b>6.7</b> Integrated nested Laplace approximation</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="Chapter7.html"><a href="Chapter7.html#joint-posterior-distribution"><i class="fa fa-check"></i><b>6.7.1</b> Joint posterior distribution</a></li>
<li class="chapter" data-level="6.7.2" data-path="Chapter7.html"><a href="Chapter7.html#marginal-distributions"><i class="fa fa-check"></i><b>6.7.2</b> Marginal distributions</a></li>
<li class="chapter" data-level="6.7.3" data-path="Chapter7.html"><a href="Chapter7.html#back-to-high-school"><i class="fa fa-check"></i><b>6.7.3</b> Back to high school</a></li>
<li class="chapter" data-level="6.7.4" data-path="Chapter7.html"><a href="Chapter7.html#inla"><i class="fa fa-check"></i><b>6.7.4</b> INLA</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="Chapter7.html"><a href="Chapter7.html#examples-using-r-inla"><i class="fa fa-check"></i><b>6.8</b> Examples using R-INLA</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="Chapter7.html"><a href="Chapter7.html#s7-8-1"><i class="fa fa-check"></i><b>6.8.1</b> Posterior summary</a></li>
<li class="chapter" data-level="6.8.2" data-path="Chapter7.html"><a href="Chapter7.html#posterior-marginal-distributions"><i class="fa fa-check"></i><b>6.8.2</b> Posterior marginal distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="Chapter7.html"><a href="Chapter7.html#追記"><i class="fa fa-check"></i><b>6.9</b> 追記</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Chapter8.html"><a href="Chapter8.html"><i class="fa fa-check"></i><b>7</b> Multiple linear regression in R-INLA</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Chapter8.html"><a href="Chapter8.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="Chapter8.html"><a href="Chapter8.html#data-exploration"><i class="fa fa-check"></i><b>7.2</b> Data exploration</a></li>
<li class="chapter" data-level="7.3" data-path="Chapter8.html"><a href="Chapter8.html#linear-regression-result"><i class="fa fa-check"></i><b>7.3</b> Linear regression result</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="Chapter8.html"><a href="Chapter8.html#executing-the-model-in-rinla"><i class="fa fa-check"></i><b>7.3.1</b> Executing the model in R=INLA</a></li>
<li class="chapter" data-level="7.3.2" data-path="Chapter8.html"><a href="Chapter8.html#output-for-betas"><i class="fa fa-check"></i><b>7.3.2</b> Output for betas</a>
<ul>
<li class="chapter" data-level="7.3.2.1" data-path="Chapter8.html"><a href="Chapter8.html#numerical-output-for-the-betas"><i class="fa fa-check"></i><b>7.3.2.1</b> Numerical output for the betas</a></li>
<li class="chapter" data-level="7.3.2.2" data-path="Chapter8.html"><a href="Chapter8.html#graphical-output-for-the-betas"><i class="fa fa-check"></i><b>7.3.2.2</b> Graphical output for the betas</a></li>
</ul></li>
<li class="chapter" data-level="7.3.3" data-path="Chapter8.html"><a href="Chapter8.html#output-for-hyperparameters"><i class="fa fa-check"></i><b>7.3.3</b> Output for hyperparameters</a>
<ul>
<li class="chapter" data-level="7.3.3.1" data-path="Chapter8.html"><a href="Chapter8.html#numerical-output-for-hyper-parameters"><i class="fa fa-check"></i><b>7.3.3.1</b> Numerical output for hyper parameters</a></li>
<li class="chapter" data-level="7.3.3.2" data-path="Chapter8.html"><a href="Chapter8.html#graphical-output-for-the-hyperparameters"><i class="fa fa-check"></i><b>7.3.3.2</b> Graphical output for the hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="7.3.4" data-path="Chapter8.html"><a href="Chapter8.html#fitted-model"><i class="fa fa-check"></i><b>7.3.4</b> Fitted model</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="Chapter8.html"><a href="Chapter8.html#model-validation-3"><i class="fa fa-check"></i><b>7.4</b> Model validation</a></li>
<li class="chapter" data-level="7.5" data-path="Chapter8.html"><a href="Chapter8.html#model-selection"><i class="fa fa-check"></i><b>7.5</b> Model selection</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="Chapter8.html"><a href="Chapter8.html#what-should-we-do"><i class="fa fa-check"></i><b>7.5.1</b> What should we do?</a></li>
<li class="chapter" data-level="7.5.2" data-path="Chapter8.html"><a href="Chapter8.html#usind-the-dic"><i class="fa fa-check"></i><b>7.5.2</b> Usind the DIC</a>
<ul>
<li class="chapter" data-level="7.5.2.1" data-path="Chapter8.html"><a href="Chapter8.html#effective-number-of-parameters"><i class="fa fa-check"></i><b>7.5.2.1</b> Effective number of parameters</a></li>
<li class="chapter" data-level="7.5.2.2" data-path="Chapter8.html"><a href="Chapter8.html#dic-related-output"><i class="fa fa-check"></i><b>7.5.2.2</b> DIC related output</a></li>
<li class="chapter" data-level="7.5.2.3" data-path="Chapter8.html"><a href="Chapter8.html#model-selection-using-dic"><i class="fa fa-check"></i><b>7.5.2.3</b> Model selection using DIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5.3" data-path="Chapter8.html"><a href="Chapter8.html#waic"><i class="fa fa-check"></i><b>7.5.3</b> WAIC</a></li>
<li class="chapter" data-level="7.5.4" data-path="Chapter8.html"><a href="Chapter8.html#out-of-sample-prediction"><i class="fa fa-check"></i><b>7.5.4</b> Out of sample prediction</a></li>
<li class="chapter" data-level="7.5.5" data-path="Chapter8.html"><a href="Chapter8.html#posterior-predictive-check"><i class="fa fa-check"></i><b>7.5.5</b> Posterior predictive check</a>
<ul>
<li class="chapter" data-level="7.5.5.1" data-path="Chapter8.html"><a href="Chapter8.html#zuur-2017の方法"><i class="fa fa-check"></i><b>7.5.5.1</b> Zuur (2017)の方法</a></li>
<li class="chapter" data-level="7.5.5.2" data-path="Chapter8.html"><a href="Chapter8.html#s8-5-5-2"><i class="fa fa-check"></i><b>7.5.5.2</b> 正しい方法</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="Chapter8.html"><a href="Chapter8.html#s8-6"><i class="fa fa-check"></i><b>7.6</b> Visualizing the model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Chapter9.html"><a href="Chapter9.html"><i class="fa fa-check"></i><b>8</b> Mixed effects modelling in R-INLA to analysis otolith data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Chapter9.html"><a href="Chapter9.html#otoliths-in-plaice"><i class="fa fa-check"></i><b>8.1</b> Otoliths in plaice</a></li>
<li class="chapter" data-level="8.2" data-path="Chapter9.html"><a href="Chapter9.html#model-formulation-2"><i class="fa fa-check"></i><b>8.2</b> Model formulation</a></li>
<li class="chapter" data-level="8.3" data-path="Chapter9.html"><a href="Chapter9.html#dependency-1"><i class="fa fa-check"></i><b>8.3</b> Dependency</a></li>
<li class="chapter" data-level="8.4" data-path="Chapter9.html"><a href="Chapter9.html#data-exploration-1"><i class="fa fa-check"></i><b>8.4</b> Data exploration</a></li>
<li class="chapter" data-level="8.5" data-path="Chapter9.html"><a href="Chapter9.html#running-the-model-in-r-inla"><i class="fa fa-check"></i><b>8.5</b> Running the model in R-INLA</a></li>
<li class="chapter" data-level="8.6" data-path="Chapter9.html"><a href="Chapter9.html#model-validation-4"><i class="fa fa-check"></i><b>8.6</b> Model validation</a></li>
<li class="chapter" data-level="8.7" data-path="Chapter9.html"><a href="Chapter9.html#model-selection-1"><i class="fa fa-check"></i><b>8.7</b> Model selection</a></li>
<li class="chapter" data-level="8.8" data-path="Chapter9.html"><a href="Chapter9.html#model-interpretation"><i class="fa fa-check"></i><b>8.8</b> Model interpretation</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="Chapter9.html"><a href="Chapter9.html#option-1-for-prediction-adding-extra-data"><i class="fa fa-check"></i><b>8.8.1</b> Option 1 for prediction: Adding extra data</a></li>
<li class="chapter" data-level="8.8.2" data-path="Chapter9.html"><a href="Chapter9.html#option-2-for-prediction-using-the-inla.make.lincombs"><i class="fa fa-check"></i><b>8.8.2</b> Option 2 for prediction: Using the <code>inla.make.lincombs</code></a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="Chapter9.html"><a href="Chapter9.html#multiple-random-effects"><i class="fa fa-check"></i><b>8.9</b> Multiple random effects</a></li>
<li class="chapter" data-level="8.10" data-path="Chapter9.html"><a href="Chapter9.html#changin-prior-of-fixed-parameters"><i class="fa fa-check"></i><b>8.10</b> Changin prior of fixed parameters</a></li>
<li class="chapter" data-level="8.11" data-path="Chapter9.html"><a href="Chapter9.html#changing-priors-of-hyperparameters"><i class="fa fa-check"></i><b>8.11</b> Changing priors of hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Chapter10.html"><a href="Chapter10.html"><i class="fa fa-check"></i><b>9</b> Poisson, negative binomial, binomial and g amma GLMs in R-INLA</a>
<ul>
<li class="chapter" data-level="9.1" data-path="Chapter10.html"><a href="Chapter10.html#poisson-and-negative-binomial-glms-in-r-inla"><i class="fa fa-check"></i><b>9.1</b> Poisson and negative binomial GLMs in R-INLA</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="Chapter10.html"><a href="Chapter10.html#introduction-1"><i class="fa fa-check"></i><b>9.1.1</b> Introduction</a></li>
<li class="chapter" data-level="9.1.2" data-path="Chapter10.html"><a href="Chapter10.html#data-exploration-2"><i class="fa fa-check"></i><b>9.1.2</b> Data exploration</a></li>
<li class="chapter" data-level="9.1.3" data-path="Chapter10.html"><a href="Chapter10.html#poisson-glm-an-r-inla"><i class="fa fa-check"></i><b>9.1.3</b> Poisson GLM an R-INLA</a>
<ul>
<li class="chapter" data-level="9.1.3.1" data-path="Chapter10.html"><a href="Chapter10.html#checking-overdispersion"><i class="fa fa-check"></i><b>9.1.3.1</b> Checking overdispersion</a></li>
</ul></li>
<li class="chapter" data-level="9.1.4" data-path="Chapter10.html"><a href="Chapter10.html#negative-binomial-glm-in-r-inla"><i class="fa fa-check"></i><b>9.1.4</b> Negative binomial GLM in R-INLA</a></li>
<li class="chapter" data-level="9.1.5" data-path="Chapter10.html"><a href="Chapter10.html#model-selection-for-the-nb-glm"><i class="fa fa-check"></i><b>9.1.5</b> Model selection for the NB GLM</a></li>
<li class="chapter" data-level="9.1.6" data-path="Chapter10.html"><a href="Chapter10.html#visualization-of-the-nb-glm"><i class="fa fa-check"></i><b>9.1.6</b> Visualization of the NB GLM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to spatial-temporal data anlysis using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="poisson-negative-binomial-binomial-and-g-amma-glms-in-r-inla" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">9</span> Poisson, negative binomial, binomial and g amma GLMs in R-INLA<a href="Chapter10.html#poisson-negative-binomial-binomial-and-g-amma-glms-in-r-inla" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>本章では、ポワソン分布、負の二項分布、二項分布、そしてガンマ分布の一般化線形モデル(GLM: generalized linea model)を<code>INLA</code>で行う方法を学ぶ。</p>
<div id="poisson-and-negative-binomial-glms-in-r-inla" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Poisson and negative binomial GLMs in R-INLA<a href="Chapter10.html#poisson-and-negative-binomial-glms-in-r-inla" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="introduction-1" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Introduction<a href="Chapter10.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>本節では、ブラジルに生息するトラギスという魚の体表にいる寄生虫の数を分析した <span class="citation">Timi et al. (<a href="#ref-Timi2008">2008</a>)</span> の研究データを用いる。魚のサンプルはアルゼンチンの3つの海域で採集された(<code>Location</code>)。また、性別(<code>SEX</code>)、体長(<code>LT</code>)、重さ(<code>Weight</code>)、矢状長(<code>LS</code>)が測定されている。<code>Location</code>と<code>Sex</code>は因子型に変換しておく。</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="Chapter10.html#cb252-1" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">&quot;data/Turcoparasitos.txt&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb252-2"><a href="Chapter10.html#cb252-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fSex =</span> <span class="fu">as.factor</span>(SEX),</span>
<span id="cb252-3"><a href="Chapter10.html#cb252-3" tabindex="-1"></a>         <span class="at">fLoc =</span> <span class="fu">as.factor</span>(Location))</span>
<span id="cb252-4"><a href="Chapter10.html#cb252-4" tabindex="-1"></a></span>
<span id="cb252-5"><a href="Chapter10.html#cb252-5" tabindex="-1"></a><span class="fu">datatable</span>(sp,</span>
<span id="cb252-6"><a href="Chapter10.html#cb252-6" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">20</span>),</span>
<span id="cb252-7"><a href="Chapter10.html#cb252-7" tabindex="-1"></a>          <span class="at">filter =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-12412b66d4114932716f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-12412b66d4114932716f">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"160\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"24\" data-max=\"41.5\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"21\" data-max=\"38\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"160\" data-max=\"912\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"190\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;1&quot;,&quot;2&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155"],[107,108,109,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[31.5,34.5,39,28.5,36,34.5,34,32.5,31.5,33,30,31,33.5,37,32.5,31.5,31,31.5,30.5,31.5,30,30,34,38,36,35.5,34,39,32.5,37.5,32,36,34.5,37,33.5,33.5,29,26,35,28,28,31,29,40,34,37.5,34,34.5,35,35.5,33.5,33,31.5,33,39,33.5,29.5,35,33,32,24,35,29.5,30,35,30.6,32.4,34.9,28.5,27,33,36,36,32,33.5,38.5,38.5,37,27.5,37,30.4,36.5,34,29,31,25.3,30.8,27,33.3,34.4,32.9,34,34.3,32.7,38,34.5,34.8,35.5,36,34.4,33.2,30,29.3,29.7,30,35,37.6,40,40.8,36,40,38,39.5,32.7,33,41,36,40.5,40,38,37,37,39,33.5,32,35,36,35.8,38.2,41.5,34.3,37.4,37.2,36.5,32.2,35.5,38,41,39.5,41.5,36.8,40,40.2,38.3,35.8,39.5,40,36,39,35,33,38,27,38,30.5],[27.5,30,34,24.5,31.5,30,29.5,28.5,27.5,29,26,27.35,29.5,32.5,29,28,27.5,27.5,27,28,27,26.5,30,34,31.5,31,29.5,34,28.5,33,28.5,32,30.5,33,29.5,29.5,25.5,23,31,24,24,27,25,35.5,30,33,30,30.5,30.5,31.5,29.5,29,29,29,34,29,26,31,29,27,21,31,26,26,31,26.6,28.3,30.2,25,23.5,29.5,32,31.5,28,29.5,34,33.5,32.5,24,32,26.4,32,29.5,25,27.5,22.2,27.4,24,29.3,30,29,29.5,30,29,33.5,30,30.5,31,31.5,30.2,29.4,26.5,25.8,26,26.5,31,33.4,35.5,35.5,32,35,33.5,35,29,29.5,36.2,31.5,35,34.8,34,32.5,33,34.5,30,28.5,31,31.5,32,34,36,30,33.4,32.8,32.5,28.7,31,33.5,35.5,34.8,36,32.5,35.2,38,33.8,31.4,34.8,35,32,34,31,29,33.5,24,33.5,27],[380,470,696,248,500,508,478,400,468,478,298,364,410,642,420,376,394,372,378,416,356,334,494,804,558,490,496,738,428,624,412,544,580,654,412,472,312,224,614,240,268,366,310,714,448,596,492,500,490,546,462,392,426,426,674,456,316,528,670,354,160,504,324,328,524,364,434,584,278,242,446,504,496,394,426,636,684,658,250,586,346,534,478,328,380,184,350,244,480,496,476,462,490,466,574,548,520,584,532,448,444,346,308,320,364,522,650,702,734,596,696,510,674,374,388,912,494,772,736,612,614,602,674,396,376,436,538,578,726,778,442,598,566,574,334,472,660,796,656,750,582,744,716,668,504,608,754,558,662,458,400,642,210,624,296],[1,2,2,2,2,2,2,1,2,1,1,1,1,2,1,1,1,1,1,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,1,2,2,1,2,2,2,1,2,2,1,2,2,2,2,2,1,2,1,2,1,2,2,2,2,1,2,1,2,2,2,2,1,1,2,2,2,1,1,2,1,1,2,1,2,2,2,2,2,1,2,1,1,2,2,2,1,2,1,2,2,1,2,1,2,2,1,1,1,1,1,2,1,2,2,2,2,2,1,1,2,1,2,2,2,2,2,2,2,2,1,1,1,1,1,2,2,2,1,1,1,1],[60,23,81,11,93,58,31,96,79,62,8,58,42,112,47,43,28,71,38,11,46,26,34,120,27,25,79,35,86,95,54,117,105,113,13,45,18,13,190,8,23,47,18,122,136,108,45,81,183,104,97,60,166,6,4,6,4,28,11,53,0,2,17,34,17,11,2,1,14,41,11,2,2,1,7,4,11,6,3,5,29,1,0,3,3,2,1,2,7,2,4,9,10,6,2,38,2,6,39,4,4,1,16,1,9,28,13,22,17,31,22,36,14,13,50,14,33,15,50,7,24,5,4,10,3,4,24,79,47,10,15,23,8,3,2,15,12,44,5,18,2,5,19,16,11,15,26,9,5,5,1,16,5,4,7],["1","2","2","2","2","2","2","1","2","1","1","1","1","2","1","1","1","1","1","1","2","1","2","2","2","2","2","2","2","2","2","2","2","2","2","1","2","2","2","2","2","2","1","2","2","2","2","2","2","2","2","2","1","1","2","2","1","2","2","2","1","2","2","1","2","2","2","2","2","1","2","1","2","1","2","2","2","2","1","2","1","2","2","2","2","1","1","2","2","2","1","1","2","1","1","2","1","2","2","2","2","2","1","2","1","1","2","2","2","1","2","1","2","2","1","2","1","2","2","1","1","1","1","1","2","1","2","2","2","2","2","1","1","2","1","2","2","2","2","2","2","2","2","1","1","1","1","1","2","2","2","1","1","1","1"],["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>ID<\/th>\n      <th>Location<\/th>\n      <th>LT<\/th>\n      <th>LS<\/th>\n      <th>Weight<\/th>\n      <th>SEX<\/th>\n      <th>Totalparasites<\/th>\n      <th>fSex<\/th>\n      <th>fLoc<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":20,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
</div>
<div id="data-exploration-2" class="section level3 hasAnchor" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Data exploration<a href="Chapter10.html#data-exploration-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>まずはデータの確認を行う。変数のdotplotを見たところ、そこまで極端な外れ値はないよう。</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="Chapter10.html#cb253-1" tabindex="-1"></a>sp <span class="sc">%&gt;%</span> </span>
<span id="cb253-2"><a href="Chapter10.html#cb253-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb253-3"><a href="Chapter10.html#cb253-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb253-4"><a href="Chapter10.html#cb253-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> n))<span class="sc">+</span></span>
<span id="cb253-5"><a href="Chapter10.html#cb253-5" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb253-6"><a href="Chapter10.html#cb253-6" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>name, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb253-7"><a href="Chapter10.html#cb253-7" tabindex="-1"></a>                 <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb253-8"><a href="Chapter10.html#cb253-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Sample number&quot;</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-185-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>続いて、変数間の関係を確認してみる。体重と体長、矢状長はかなり強く相関しており、これらを同じモデルで使うのは望ましくない。本節では、体長のみを用いる。</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="Chapter10.html#cb254-1" tabindex="-1"></a>sp <span class="sc">%&gt;%</span> </span>
<span id="cb254-2"><a href="Chapter10.html#cb254-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb254-3"><a href="Chapter10.html#cb254-3" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-186-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>図<a href="Chapter10.html#fig:sp-scatter">9.1</a>は海域(<code>Location</code>)ごとに体長と寄生虫の数の関連をプロットしたものである。曲線はポワソン分布のGLMを当てはめたものである。明らかに海域によって傾向が違うことが分かる。つまり、モデルには<strong>体長と海域の交互作用を入れる必要がある</strong>。</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="Chapter10.html#cb255-1" tabindex="-1"></a>sp <span class="sc">%&gt;%</span> </span>
<span id="cb255-2"><a href="Chapter10.html#cb255-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LT, <span class="at">y =</span> Totalparasites))<span class="sc">+</span></span>
<span id="cb255-3"><a href="Chapter10.html#cb255-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb255-4"><a href="Chapter10.html#cb255-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb255-5"><a href="Chapter10.html#cb255-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb255-6"><a href="Chapter10.html#cb255-6" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>Location)<span class="sc">+</span></span>
<span id="cb255-7"><a href="Chapter10.html#cb255-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, </span>
<span id="cb255-8"><a href="Chapter10.html#cb255-8" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sp-scatter"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/sp-scatter-1.png" alt="Scatterplot of total number of parasites per fish plotted versus length of the fish. Each pane l corresponds to a location." width="1344" />
<p class="caption">
図9.1: Scatterplot of total number of parasites per fish plotted versus length of the fish. Each pane l corresponds to a location.
</p>
</div>
<p><br/></p>
<p>性別でも見てみたが、こちらはそこまで明確ではない(図<a href="Chapter10.html#fig:sp-scatter2">9.2</a>)。よって、性別については交互作用を考慮しないこととする。</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="Chapter10.html#cb256-1" tabindex="-1"></a>sp <span class="sc">%&gt;%</span> </span>
<span id="cb256-2"><a href="Chapter10.html#cb256-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LT, <span class="at">y =</span> Totalparasites))<span class="sc">+</span></span>
<span id="cb256-3"><a href="Chapter10.html#cb256-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb256-4"><a href="Chapter10.html#cb256-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb256-5"><a href="Chapter10.html#cb256-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb256-6"><a href="Chapter10.html#cb256-6" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span> SEX)<span class="sc">+</span></span>
<span id="cb256-7"><a href="Chapter10.html#cb256-7" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, </span>
<span id="cb256-8"><a href="Chapter10.html#cb256-8" tabindex="-1"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sp-scatter2"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/sp-scatter2-1.png" alt="Scatterplot of total number of parasites per fish plotted versus length of the fish. Each pane l corresponds to sex." width="1344" />
<p class="caption">
図9.2: Scatterplot of total number of parasites per fish plotted versus length of the fish. Each pane l corresponds to sex.
</p>
</div>
</div>
<div id="poisson-glm-an-r-inla" class="section level3 hasAnchor" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> Poisson GLM an R-INLA<a href="Chapter10.html#poisson-glm-an-r-inla" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>以上から、以下のモデルを考える。<span class="math inline">\(TP_i\)</span>は寄生虫の数である。なお、回帰係数は省いている。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;TP_i \sim Poisson(\mu_i) \\
&amp;E(TP_i) = \mu_i \; and \; var(TP_i) = \mu_i\\
&amp;log(\mu_i) = Intercept + Sex_i + LT_i + Location_i + LT_i \times Location_i
\end{aligned}
\]</span></p>
<p><code>INLA</code>では以下のように実行できる。</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="Chapter10.html#cb257-1" tabindex="-1"></a>m10_1 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span> fSex <span class="sc">+</span> LT<span class="sc">*</span>fLoc,</span>
<span id="cb257-2"><a href="Chapter10.html#cb257-2" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>,</span>
<span id="cb257-3"><a href="Chapter10.html#cb257-3" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>),</span>
<span id="cb257-4"><a href="Chapter10.html#cb257-4" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>結果は以下の通り。</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="Chapter10.html#cb258-1" tabindex="-1"></a><span class="fu">summary</span>(m10_1)</span></code></pre></div>
<pre><code>## 
## Call:
##    c(&quot;inla.core(formula = formula, family = family, contrasts = contrasts, 
##    &quot;, &quot; data = data, quantiles = quantiles, E = E, offset = offset, &quot;, &quot; 
##    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, 
##    &quot;, &quot; lp.scale = lp.scale, link.covariates = link.covariates, verbose = 
##    verbose, &quot;, &quot; lincomb = lincomb, selection = selection, control.compute 
##    = control.compute, &quot;, &quot; control.predictor = control.predictor, 
##    control.family = control.family, &quot;, &quot; control.inla = control.inla, 
##    control.fixed = control.fixed, &quot;, &quot; control.mode = control.mode, 
##    control.expert = control.expert, &quot;, &quot; control.hazard = control.hazard, 
##    control.lincomb = control.lincomb, &quot;, &quot; control.update = 
##    control.update, control.lp.scale = control.lp.scale, &quot;, &quot; 
##    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, 
##    &quot;, &quot; inla.call = inla.call, inla.arg = inla.arg, num.threads = 
##    num.threads, &quot;, &quot; blas.num.threads = blas.num.threads, keep = keep, 
##    working.directory = working.directory, &quot;, &quot; silent = silent, inla.mode 
##    = inla.mode, safe = FALSE, debug = debug, &quot;, &quot; .parent.frame = 
##    .parent.frame)&quot;) 
## Time used:
##     Pre = 0.732, Running = 0.471, Post = 0.0719, Total = 1.27 
## Fixed effects:
##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld
## (Intercept)  0.171 0.202     -0.224    0.171      0.567  0.171   0
## fSex2        0.008 0.036     -0.063    0.008      0.079  0.008   0
## LT           0.119 0.006      0.107    0.119      0.131  0.119   0
## fLoc2        2.977 0.462      2.071    2.977      3.883  2.977   0
## fLoc3        0.892 0.484     -0.057    0.892      1.840  0.892   0
## LT:fLoc2    -0.146 0.014     -0.173   -0.146     -0.118 -0.146   0
## LT:fLoc3    -0.071 0.013     -0.096   -0.071     -0.045 -0.071   0
## 
## Deviance Information Criterion (DIC) ...............: 2752.51
## Deviance Information Criterion (DIC, saturated) ....: 2057.57
## Effective number of parameters .....................: -128.12
## 
## Marginal log-Likelihood:  -1552.05 
##  is computed 
## Posterior summaries for the linear predictor and the fitted values are computed
## (Posterior marginals needs also &#39;control.compute=list(return.marginals.predictor=TRUE)&#39;)</code></pre>
<p>この結果から、<span class="math inline">\(log(\mu_i)\)</span>は以下のように書ける。<br />
<span class="math display">\[
\begin{aligned}
log(\mu_i) =
\begin{cases}
0.171 + 0.119 \times LT_i \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; \rm{for \; location = 1, Sex = 1}\\
0.171 + 2.977 + (0.119 - 0.146) \times LT_i \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; \rm{for \; location = 2, Sex = 1}\\
0.171 + 0.892 + (0.119 - 0.071) \times LT_i \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; \rm{for \; location = 3, Sex = 1}\\
0.171 + 0.008 + 0.119 \times LT_i \;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; \rm{for \; location = 1, Sex = 2}\\
0.171 + 0.008 + 2.977 + (0.119 - 0.146) \times LT_i \;\;\;\; \rm{for \; location = 2, Sex = 2}\\
0.171 + 0.008 + 0.892 + (0.119 - 0.071) \times LT_i \;\;\;\; \rm{for \; location = 3, Sex = 2}
\end{cases}
\end{aligned}
\]</span></p>
<div id="checking-overdispersion" class="section level4 hasAnchor" number="9.1.3.1">
<h4><span class="header-section-number">9.1.3.1</span> Checking overdispersion<a href="Chapter10.html#checking-overdispersion" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="calculating-dispersion-parameter" class="section level5 hasAnchor" number="9.1.3.1.1">
<h5><span class="header-section-number">9.1.3.1.1</span> Calculating dispersion parameter<a href="Chapter10.html#calculating-dispersion-parameter" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>モデル選択やモデルの解釈に移る前に、まずはこのデータに対してポワソン分布が適切かを確認する。<strong>過分散</strong>の有無を確認するため、<strong>分散パラメータ</strong>を算出する。分散パラメータ<span class="math inline">\(\phi\)</span>は以下のように計算できる。なお、<span class="math inline">\(N\)</span>はサンプル数、<span class="math inline">\(k\)</span>はパラメータ数である。もし<span class="math inline">\(\phi\)</span>が1を超えていれば過分散が生じており、1以下であれば過少分散である。通常、<span class="math inline">\(\phi = 1.5\)</span>くらいまでであれば問題ないと判断される<span class="citation">(<a href="#ref-Ohigashi2010">健太郎 2010</a>)</span>。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;E_i = \frac{TP_i - E(TP_i)}{\sqrt{var(TP_i)}}\\
&amp;\phi = \frac{\sum_{i=1}^k E_i^2}{N - k}
\end{aligned}
\]</span></p>
<p>Rでは以下のように算出できる。分散パラメータは18.19であり、明らかに過分散が生じている。</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="Chapter10.html#cb260-1" tabindex="-1"></a>mu <span class="ot">&lt;-</span> m10_1<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb260-2"><a href="Chapter10.html#cb260-2" tabindex="-1"></a>E <span class="ot">&lt;-</span> (sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu)</span>
<span id="cb260-3"><a href="Chapter10.html#cb260-3" tabindex="-1"></a></span>
<span id="cb260-4"><a href="Chapter10.html#cb260-4" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sp)</span>
<span id="cb260-5"><a href="Chapter10.html#cb260-5" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">nrow</span>(m10_1<span class="sc">$</span>summary.fixed)</span>
<span id="cb260-6"><a href="Chapter10.html#cb260-6" tabindex="-1"></a></span>
<span id="cb260-7"><a href="Chapter10.html#cb260-7" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(N<span class="sc">-</span>p)</span>
<span id="cb260-8"><a href="Chapter10.html#cb260-8" tabindex="-1"></a></span>
<span id="cb260-9"><a href="Chapter10.html#cb260-9" tabindex="-1"></a>phi</span></code></pre></div>
<pre><code>## [1] 18.18584</code></pre>
</div>
<div id="bayesian-method-for-looking-for-overunder-dispersion" class="section level5 hasAnchor" number="9.1.3.1.2">
<h5><span class="header-section-number">9.1.3.1.2</span> Bayesian method for looking for over/under-dispersion<a href="Chapter10.html#bayesian-method-for-looking-for-overunder-dispersion" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>ただし、ベイズモデリングの場合、事前分布が無情報ではない場合には分散パラメータがそのまま解釈できない可能性がある。そこで、ベイズモデリングでは異なる方法で確認を行う。</p>
<p>MCMCの場合には、各MCMCサンプルごとにデータをシミュレートして実データと比べることで過分散の検討を行える<span class="citation">(<a href="#ref-Zuur2016">Zuur and Ieno 2016</a>)</span>。<code>INLA</code>ではMCMCをしていないので、事後分布から新たなデータをシミュレートし、これを実測値と比較することで過分散がないかを確認する。具体的には、以下の手順を行う。</p>
<ol style="list-style-type: decimal">
<li><code>INLA</code>でGLMを実行する。<br />
</li>
<li>事後分布から1セットの回帰係数<span class="math inline">\(\beta_1, \dots, \beta_7\)</span>をサンプリングする。<br />
</li>
<li>サンプリングしたパラメータを用いて期待値<span class="math inline">\(\bf{\mu} = exp(\bf{X} \times \bf{\beta})\)</span>を算出する。<br />
</li>
<li>計算した期待値から<code>rpois</code>関数を用いてデータをシミュレートする。<br />
</li>
<li>シミュレートしたデータセットのピアソン残差(<span class="math inline">\(E_i\)</span>)を算出し、その平方和(<span class="math inline">\(\sum_i^N E_i^2\)</span>)を計算する。<br />
</li>
<li>2から5を1000回繰り返す。<br />
</li>
<li>シミュレートしたデータセットのピアソン残差の平方和と実測値のピアソン残差の平方和を比較する。</li>
</ol>
<p>シミュレートしたデータセットのピアソン残差の平方和の分布は、もしモデルが正しいときにそれに従うデータセットが持つピアソン残差の平方和の分布である。もし過分散/過少分散が生じているのであれば、実際のデータセットのピアソン残差の平方和がこの分布から外れた値をとるはずである。</p>
<p>それでは、実際に行ってみよう。事後分布からパラメータのサンプリングを行うには、<code>control.compute</code>オプションで<code>config = TRUE</code>とする必要がある。</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="Chapter10.html#cb262-1" tabindex="-1"></a>m10_2 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span> fSex <span class="sc">+</span> LT<span class="sc">*</span>fLoc,</span>
<span id="cb262-2"><a href="Chapter10.html#cb262-2" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>,</span>
<span id="cb262-3"><a href="Chapter10.html#cb262-3" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb262-4"><a href="Chapter10.html#cb262-4" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb262-5"><a href="Chapter10.html#cb262-5" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>それでは、パラメータの事後同時分布から1000セットのパラメータをサンプリングする(第<a href="Chapter8.html#s8-5-5-2">7.5.5.2</a>節を参照)。</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="Chapter10.html#cb263-1" tabindex="-1"></a>sim_param <span class="ot">&lt;-</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n =</span> <span class="dv">1000</span>, m10_2)</span></code></pre></div>
<p>例えば1セット目にサンプリングされた値は以下の通り。なお、ここでは既にサンプリングしたパラメータを用いた期待値<span class="math inline">\(\bf{\mu} = exp(\bf{X} \times \bf{\beta})\)</span>も算出されている(最初の155行)。最後の7行はサンプリングされたパラメータの値である。</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="Chapter10.html#cb264-1" tabindex="-1"></a>sim_param[[<span class="dv">1</span>]]<span class="sc">$</span>latent <span class="sc">%&gt;%</span> </span>
<span id="cb264-2"><a href="Chapter10.html#cb264-2" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb264-3"><a href="Chapter10.html#cb264-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">mu =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb264-4"><a href="Chapter10.html#cb264-4" tabindex="-1"></a>  <span class="fu">datatable</span>()</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2e2e82c5afb675ab1eae" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2e2e82c5afb675ab1eae">{"x":{"filter":"none","vertical":false,"data":[["Predictor:1","Predictor:2","Predictor:3","Predictor:4","Predictor:5","Predictor:6","Predictor:7","Predictor:8","Predictor:9","Predictor:10","Predictor:11","Predictor:12","Predictor:13","Predictor:14","Predictor:15","Predictor:16","Predictor:17","Predictor:18","Predictor:19","Predictor:20","Predictor:21","Predictor:22","Predictor:23","Predictor:24","Predictor:25","Predictor:26","Predictor:27","Predictor:28","Predictor:29","Predictor:30","Predictor:31","Predictor:32","Predictor:33","Predictor:34","Predictor:35","Predictor:36","Predictor:37","Predictor:38","Predictor:39","Predictor:40","Predictor:41","Predictor:42","Predictor:43","Predictor:44","Predictor:45","Predictor:46","Predictor:47","Predictor:48","Predictor:49","Predictor:50","Predictor:51","Predictor:52","Predictor:53","Predictor:54","Predictor:55","Predictor:56","Predictor:57","Predictor:58","Predictor:59","Predictor:60","Predictor:61","Predictor:62","Predictor:63","Predictor:64","Predictor:65","Predictor:66","Predictor:67","Predictor:68","Predictor:69","Predictor:70","Predictor:71","Predictor:72","Predictor:73","Predictor:74","Predictor:75","Predictor:76","Predictor:77","Predictor:78","Predictor:79","Predictor:80","Predictor:81","Predictor:82","Predictor:83","Predictor:84","Predictor:85","Predictor:86","Predictor:87","Predictor:88","Predictor:89","Predictor:90","Predictor:91","Predictor:92","Predictor:93","Predictor:94","Predictor:95","Predictor:96","Predictor:97","Predictor:98","Predictor:99","Predictor:100","Predictor:101","Predictor:102","Predictor:103","Predictor:104","Predictor:105","Predictor:106","Predictor:107","Predictor:108","Predictor:109","Predictor:110","Predictor:111","Predictor:112","Predictor:113","Predictor:114","Predictor:115","Predictor:116","Predictor:117","Predictor:118","Predictor:119","Predictor:120","Predictor:121","Predictor:122","Predictor:123","Predictor:124","Predictor:125","Predictor:126","Predictor:127","Predictor:128","Predictor:129","Predictor:130","Predictor:131","Predictor:132","Predictor:133","Predictor:134","Predictor:135","Predictor:136","Predictor:137","Predictor:138","Predictor:139","Predictor:140","Predictor:141","Predictor:142","Predictor:143","Predictor:144","Predictor:145","Predictor:146","Predictor:147","Predictor:148","Predictor:149","Predictor:150","Predictor:151","Predictor:152","Predictor:153","Predictor:154","Predictor:155","(Intercept):1","fSex2:1","LT:1","fLoc2:1","fLoc3:1","LT:fLoc2:1","LT:fLoc3:1"],[3.96376794084712,4.25596027035663,4.78971132985949,3.54429219101949,4.43387729019092,4.25596027035663,4.19665459707854,4.08237928740331,3.90012623068806,4.14168496068141,3.78585092101284,3.90446226756903,4.2009906339595,4.55248863674711,4.08237928740331,3.96376794084712,3.90446226756903,3.96376794084712,3.84515659429093,3.96376794084712,3.72220921085378,3.78585092101284,4.19665459707854,4.6710999833033,4.43387729019092,4.37457161691282,4.19665459707854,4.78971132985949,4.01873757724425,4.6117943100252,3.95943190396616,4.43387729019092,4.25596027035663,4.55248863674711,4.13734892380044,4.2009906339595,3.60359786429759,3.24776382462902,4.31526594363473,3.4849865177414,3.4849865177414,3.84082055740997,3.66723957445665,4.90832267641568,4.19665459707854,4.6117943100252,4.19665459707854,4.25596027035663,4.31526594363473,4.37457161691282,4.13734892380044,4.07804325052235,3.96376794084712,2.30343885236783,2.11067778495815,2.22903719577122,2.3787584774307,2.19675735645857,2.23979714220878,2.26131703508388,2.49711788824377,2.19675735645857,2.31511676727164,2.36799853099315,2.19675735645857,2.29144488510903,2.25270907793384,2.19890934574608,2.33663666014674,2.43255820961846,2.23979714220878,2.23887917374252,2.17523746358346,2.32495874524294,2.22903719577122,2.12143773139571,2.12143773139571,2.15371757070836,2.42179826318091,2.15371757070836,2.3593905738431,2.16447751714591,2.21827724933367,2.32587671370919,2.28283692795898,2.46914202750613,2.35078261669306,2.3689164994594,2.23334117434624,2.20966929218363,2.30559084165534,2.28191895949273,2.21182128147114,2.30989482023036,2.19583938799232,2.20751730289612,2.26470304519265,2.18599741002102,2.17523746358346,2.20966929218363,2.23549316363375,2.30435682083409,2.38306245600572,2.31081278869662,2.36799853099315,2.72492539027804,2.85507399643775,3.03395736534738,3.09358515498392,2.79946012732372,3.03395736534738,2.94852960141508,2.99668999682454,2.48985378491392,2.57585591618668,3.10849210239306,2.79946012732372,3.07122473387022,3.03395736534738,2.94852960141508,2.8739948643694,2.8739948643694,3.02306433846076,2.61312328470952,2.43767946898194,2.72492539027804,2.73581841716466,2.72091146975552,2.89979483866515,3.1457594709159,2.60910936418701,2.90380875918767,2.88890181177853,2.7730857856875,2.51622812655014,2.69855104864182,2.88488789125602,3.10849210239306,2.99668999682454,3.1457594709159,2.7954462068012,3.03395736534738,3.04886431275651,2.97089002252878,2.78455317991458,3.0603317069836,3.09759907550643,2.79946012732372,2.9594226283017,2.66128368011898,2.51221420602762,2.94852960141508,2.12864749391261,2.94852960141508,2.38951907357248,0.227510524327136,-0.0636417101590582,0.11861134655619,2.78608479291912,-0.111300930647868,-0.140131239431294,-0.0440766095105109]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
<p>それでは、抽出した1000セットのパラメータを用いて1000個のデータセットをシミュレートする。</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="Chapter10.html#cb265-1" tabindex="-1"></a>y_sim <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(sp),</span>
<span id="cb265-2"><a href="Chapter10.html#cb265-2" tabindex="-1"></a>                <span class="at">ncol =</span> <span class="dv">1000</span>)</span>
<span id="cb265-3"><a href="Chapter10.html#cb265-3" tabindex="-1"></a></span>
<span id="cb265-4"><a href="Chapter10.html#cb265-4" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb265-5"><a href="Chapter10.html#cb265-5" tabindex="-1"></a> y_sim[,i] <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="fu">nrow</span>(sp), <span class="at">lambda =</span> <span class="fu">exp</span>(sim_param[[i]]<span class="sc">$</span>latent[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sp),])) </span>
<span id="cb265-6"><a href="Chapter10.html#cb265-6" tabindex="-1"></a>}</span></code></pre></div>
<p>続いて、それぞれのデータセットについてピアソン残差の平方和を算出する。</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="Chapter10.html#cb266-1" tabindex="-1"></a>sum_E2_sim <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb266-2"><a href="Chapter10.html#cb266-2" tabindex="-1"></a></span>
<span id="cb266-3"><a href="Chapter10.html#cb266-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb266-4"><a href="Chapter10.html#cb266-4" tabindex="-1"></a>  E <span class="ot">&lt;-</span> (y_sim[,i] <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu)</span>
<span id="cb266-5"><a href="Chapter10.html#cb266-5" tabindex="-1"></a>  sum_E2_sim[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb266-6"><a href="Chapter10.html#cb266-6" tabindex="-1"></a>}</span></code></pre></div>
<p>さて、実際に得られた実測値のピアソン残差の平方和は以下の通り、2691.504であった。</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="Chapter10.html#cb267-1" tabindex="-1"></a>E <span class="ot">&lt;-</span>(sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu)</span>
<span id="cb267-2"><a href="Chapter10.html#cb267-2" tabindex="-1"></a>sum_E2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb267-3"><a href="Chapter10.html#cb267-3" tabindex="-1"></a></span>
<span id="cb267-4"><a href="Chapter10.html#cb267-4" tabindex="-1"></a>sum_E2</span></code></pre></div>
<pre><code>## [1] 2691.504</code></pre>
<p>これをシミュレートしたデータセットのピアソン湾差の平方和と比べると、そのすべてよりも大きいことが分かった。すなわち、実データはデータが想定するよりも非常に大きなばらつきがあるといえる(= 過分散が生じている)。</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="Chapter10.html#cb269-1" tabindex="-1"></a><span class="fu">mean</span>(sum_E2 <span class="sc">&gt;</span> sum_E2_sim)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>これは、シミュレートしたでーらセットにおけるピアソン残差の平方和の分布をみても明らかである。モデルに従うのであれば、ピアソン残差の平方和はせいぜい100から300くらいの値しか取らない。</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="Chapter10.html#cb271-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">x =</span> sum_E2_sim) <span class="sc">%&gt;%</span> </span>
<span id="cb271-2"><a href="Chapter10.html#cb271-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb271-3"><a href="Chapter10.html#cb271-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb271-4"><a href="Chapter10.html#cb271-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb271-5"><a href="Chapter10.html#cb271-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-197"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-197-1.png" alt="シミュレートされたデータのピアソン残差の平方和の分布" width="672" />
<p class="caption">
図9.3: シミュレートされたデータのピアソン残差の平方和の分布
</p>
</div>
<p>過分散はデータのばらつきがポワソン分布が仮定するよりも大きすぎるときのほかに、外れ値の影響や共変量を入れていないこと、交互作用がないことやリンク関数が間違っていること、非線形のパターンがあることやゼロ過剰、データの非独立性などが原因でも起きる。データをしっかりとみて原因に合った解決をしなくてはならない。</p>
<p>今回はゼロ過剰や外れ値の影響はなさそうである。また、予測値とピアソン残差の関係を見ても、明確にパターンがあるわけではなさそう。また、ピアソン残差と共変量の間にパターンもなく、応答変数と説明変数の間に非線形な関係があるというわけでもなさそう。</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="Chapter10.html#cb272-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> (sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu),</span>
<span id="cb272-2"><a href="Chapter10.html#cb272-2" tabindex="-1"></a>           <span class="at">fitted =</span> m10_2<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean) <span class="sc">%&gt;%</span> </span>
<span id="cb272-3"><a href="Chapter10.html#cb272-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb272-4"><a href="Chapter10.html#cb272-4" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb272-5"><a href="Chapter10.html#cb272-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb272-6"><a href="Chapter10.html#cb272-6" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb272-7"><a href="Chapter10.html#cb272-7" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb272-8"><a href="Chapter10.html#cb272-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb272-9"><a href="Chapter10.html#cb272-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span>,</span>
<span id="cb272-10"><a href="Chapter10.html#cb272-10" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p1</span>
<span id="cb272-11"><a href="Chapter10.html#cb272-11" tabindex="-1"></a></span>
<span id="cb272-12"><a href="Chapter10.html#cb272-12" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> (sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu),</span>
<span id="cb272-13"><a href="Chapter10.html#cb272-13" tabindex="-1"></a>           <span class="at">LT =</span> sp<span class="sc">$</span>LT) <span class="sc">%&gt;%</span> </span>
<span id="cb272-14"><a href="Chapter10.html#cb272-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LT, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb272-15"><a href="Chapter10.html#cb272-15" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb272-16"><a href="Chapter10.html#cb272-16" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb272-17"><a href="Chapter10.html#cb272-17" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb272-18"><a href="Chapter10.html#cb272-18" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb272-19"><a href="Chapter10.html#cb272-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb272-20"><a href="Chapter10.html#cb272-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;LT&quot;</span>,</span>
<span id="cb272-21"><a href="Chapter10.html#cb272-21" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p2</span>
<span id="cb272-22"><a href="Chapter10.html#cb272-22" tabindex="-1"></a></span>
<span id="cb272-23"><a href="Chapter10.html#cb272-23" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> (sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu),</span>
<span id="cb272-24"><a href="Chapter10.html#cb272-24" tabindex="-1"></a>           <span class="at">Loc =</span> sp<span class="sc">$</span>fLoc,</span>
<span id="cb272-25"><a href="Chapter10.html#cb272-25" tabindex="-1"></a>           <span class="at">Sex =</span> sp<span class="sc">$</span>fSex) <span class="sc">%&gt;%</span> </span>
<span id="cb272-26"><a href="Chapter10.html#cb272-26" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb272-27"><a href="Chapter10.html#cb272-27" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb272-28"><a href="Chapter10.html#cb272-28" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb272-29"><a href="Chapter10.html#cb272-29" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>name, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb272-30"><a href="Chapter10.html#cb272-30" tabindex="-1"></a>                 <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb272-31"><a href="Chapter10.html#cb272-31" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb272-32"><a href="Chapter10.html#cb272-32" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb272-33"><a href="Chapter10.html#cb272-33" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb272-34"><a href="Chapter10.html#cb272-34" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p3</span>
<span id="cb272-35"><a href="Chapter10.html#cb272-35" tabindex="-1"></a></span>
<span id="cb272-36"><a href="Chapter10.html#cb272-36" tabindex="-1"></a></span>
<span id="cb272-37"><a href="Chapter10.html#cb272-37" tabindex="-1"></a>(p1 <span class="sc">+</span> p2)<span class="sc">/</span>p3</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-198-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>そこで、本節では以下で負の二項分布を適用したもでリン負を行う。</p>
</div>
</div>
</div>
<div id="negative-binomial-glm-in-r-inla" class="section level3 hasAnchor" number="9.1.4">
<h3><span class="header-section-number">9.1.4</span> Negative binomial GLM in R-INLA<a href="Chapter10.html#negative-binomial-glm-in-r-inla" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>モデル式は以下のとおりである。<span class="math inline">\(k\)</span>は負の二項分布の分散パラメータで、分布の分散を調整する。<code>INLA</code>では<code>size</code>パラメータと呼ばれる。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;TP_i \sim NegBinomial(\mu_i, k) \\
&amp;E(TP_i) = \mu_i \; and \; var(TP_i) = \mu_i + \frac{\mu_i^2}{k}\\
&amp;log(\mu_i) = Intercept + Sex_i + LT_i + Location_i + LT_i \times Location_i
\end{aligned}
\]</span></p>
<p><code>INLA</code>では以下のように実行する。</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="Chapter10.html#cb273-1" tabindex="-1"></a>m10_3 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span> fSex <span class="sc">+</span> LT<span class="sc">*</span>fLoc,</span>
<span id="cb273-2"><a href="Chapter10.html#cb273-2" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb273-3"><a href="Chapter10.html#cb273-3" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb273-4"><a href="Chapter10.html#cb273-4" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb273-5"><a href="Chapter10.html#cb273-5" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>結果は以下の通り。ポワソンモデルのときと比べて、確信区間が全て広くなっている。</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="Chapter10.html#cb274-1" tabindex="-1"></a><span class="fu">summary</span>(m10_3)</span></code></pre></div>
<pre><code>## 
## Call:
##    c(&quot;inla.core(formula = formula, family = family, contrasts = contrasts, 
##    &quot;, &quot; data = data, quantiles = quantiles, E = E, offset = offset, &quot;, &quot; 
##    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, 
##    &quot;, &quot; lp.scale = lp.scale, link.covariates = link.covariates, verbose = 
##    verbose, &quot;, &quot; lincomb = lincomb, selection = selection, control.compute 
##    = control.compute, &quot;, &quot; control.predictor = control.predictor, 
##    control.family = control.family, &quot;, &quot; control.inla = control.inla, 
##    control.fixed = control.fixed, &quot;, &quot; control.mode = control.mode, 
##    control.expert = control.expert, &quot;, &quot; control.hazard = control.hazard, 
##    control.lincomb = control.lincomb, &quot;, &quot; control.update = 
##    control.update, control.lp.scale = control.lp.scale, &quot;, &quot; 
##    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, 
##    &quot;, &quot; inla.call = inla.call, inla.arg = inla.arg, num.threads = 
##    num.threads, &quot;, &quot; blas.num.threads = blas.num.threads, keep = keep, 
##    working.directory = working.directory, &quot;, &quot; silent = silent, inla.mode 
##    = inla.mode, safe = FALSE, debug = debug, &quot;, &quot; .parent.frame = 
##    .parent.frame)&quot;) 
## Time used:
##     Pre = 0.658, Running = 0.168, Post = 0.109, Total = 0.935 
## Fixed effects:
##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld
## (Intercept) -1.005 1.452     -3.857   -1.005      1.847 -1.005   0
## fSex2        0.010 0.159     -0.303    0.010      0.323  0.010   0
## LT           0.153 0.044      0.066    0.153      0.240  0.153   0
## fLoc2        4.392 1.910      0.644    4.392      8.144  4.391   0
## fLoc3        1.812 2.126     -2.363    1.812      5.989  1.812   0
## LT:fLoc2    -0.188 0.058     -0.301   -0.188     -0.075 -0.188   0
## LT:fLoc3    -0.099 0.060     -0.217   -0.099      0.019 -0.099   0
## 
## Model hyperparameters:
##                                                        mean    sd 0.025quant
## size for the nbinomial observations (1/overdispersion) 1.56 0.186       1.22
##                                                        0.5quant 0.975quant mode
## size for the nbinomial observations (1/overdispersion)     1.55       1.95 1.53
## 
## Deviance Information Criterion (DIC) ...............: 1276.63
## Deviance Information Criterion (DIC, saturated) ....: 185.45
## Effective number of parameters .....................: 8.00
## 
## Marginal log-Likelihood:  -673.93 
##  is computed 
## Posterior summaries for the linear predictor and the fitted values are computed
## (Posterior marginals needs also &#39;control.compute=list(return.marginals.predictor=TRUE)&#39;)</code></pre>
<p><code>INLA</code>では<code>size</code>パラメータ<span class="math inline">\(k\)</span>の事前分布は、<span class="math inline">\(\theta = log(k)\)</span>の事前分布が<span class="math inline">\(logGamma(1,0.1)\)</span>になるようになっている。<span class="math inline">\(k\)</span>の事後平均値は1.56であった。事後分布は以下の通り。</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="Chapter10.html#cb276-1" tabindex="-1"></a>m10_3<span class="sc">$</span>marginals.hyperpar<span class="sc">$</span><span class="st">`</span><span class="at">size for the nbinomial observations (1/overdispersion)</span><span class="st">`</span> <span class="sc">%&gt;%</span> </span>
<span id="cb276-2"><a href="Chapter10.html#cb276-2" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb276-3"><a href="Chapter10.html#cb276-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb276-4"><a href="Chapter10.html#cb276-4" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>)<span class="sc">+</span></span>
<span id="cb276-5"><a href="Chapter10.html#cb276-5" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb276-6"><a href="Chapter10.html#cb276-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb276-7"><a href="Chapter10.html#cb276-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb276-8"><a href="Chapter10.html#cb276-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(k),</span>
<span id="cb276-9"><a href="Chapter10.html#cb276-9" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&quot;Pr(&quot;</span>,k,<span class="st">&quot;|D)&quot;</span>)))</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-201-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>もし<span class="math inline">\(k\)</span>の値を固定したいときは以下のようにすればよい。モデル選択をする際など<span class="math inline">\(k\)</span>の値が変わると困る場合に用いればよい。</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="Chapter10.html#cb277-1" tabindex="-1"></a>hyp.nb <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="fu">list</span>(<span class="at">initial =</span> <span class="dv">1</span>,</span>
<span id="cb277-2"><a href="Chapter10.html#cb277-2" tabindex="-1"></a>                           <span class="at">fixed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb277-3"><a href="Chapter10.html#cb277-3" tabindex="-1"></a></span>
<span id="cb277-4"><a href="Chapter10.html#cb277-4" tabindex="-1"></a>m10_4 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span> fSex <span class="sc">+</span> LT<span class="sc">*</span>fLoc,</span>
<span id="cb277-5"><a href="Chapter10.html#cb277-5" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb277-6"><a href="Chapter10.html#cb277-6" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb277-7"><a href="Chapter10.html#cb277-7" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb277-8"><a href="Chapter10.html#cb277-8" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyp.nb),</span>
<span id="cb277-9"><a href="Chapter10.html#cb277-9" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>以下では、ポワソン分布のときと同じように過分散のチェックを行う。確認の結果、シミュレーションによって得られたポワソン残差の平方和の分布と実際のポワソン残差の平方和を示したのが図<a href="Chapter10.html#fig:od-nb">9.4</a>である。実際の平方和はシミュレーションの値の87%より大きいが、ポワソン分布に比べると過分散がかなり改善していることが分かった。</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="Chapter10.html#cb278-1" tabindex="-1"></a>sim_param.nb <span class="ot">&lt;-</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n =</span> <span class="dv">1000</span>, m10_3)</span>
<span id="cb278-2"><a href="Chapter10.html#cb278-2" tabindex="-1"></a></span>
<span id="cb278-3"><a href="Chapter10.html#cb278-3" tabindex="-1"></a>y_sim.nb <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(sp),</span>
<span id="cb278-4"><a href="Chapter10.html#cb278-4" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">1000</span>)</span>
<span id="cb278-5"><a href="Chapter10.html#cb278-5" tabindex="-1"></a></span>
<span id="cb278-6"><a href="Chapter10.html#cb278-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb278-7"><a href="Chapter10.html#cb278-7" tabindex="-1"></a> y_sim.nb[,i] <span class="ot">&lt;-</span> <span class="fu">rnbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(sp), </span>
<span id="cb278-8"><a href="Chapter10.html#cb278-8" tabindex="-1"></a>                      <span class="at">mu =</span> <span class="fu">exp</span>(sim_param[[i]]<span class="sc">$</span>latent[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sp),]),</span>
<span id="cb278-9"><a href="Chapter10.html#cb278-9" tabindex="-1"></a>                      <span class="at">size =</span> sim_param.nb[[i]]<span class="sc">$</span>hyperpar[[<span class="dv">1</span>]]) </span>
<span id="cb278-10"><a href="Chapter10.html#cb278-10" tabindex="-1"></a>}</span>
<span id="cb278-11"><a href="Chapter10.html#cb278-11" tabindex="-1"></a></span>
<span id="cb278-12"><a href="Chapter10.html#cb278-12" tabindex="-1"></a><span class="do">### シミュレートしたデータセットのピアソン残差の平方和</span></span>
<span id="cb278-13"><a href="Chapter10.html#cb278-13" tabindex="-1"></a>sum_E2_sim.nb <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb278-14"><a href="Chapter10.html#cb278-14" tabindex="-1"></a>mu <span class="ot">&lt;-</span> m10_3<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb278-15"><a href="Chapter10.html#cb278-15" tabindex="-1"></a>k <span class="ot">&lt;-</span> m10_3<span class="sc">$</span>summary.hyperpar<span class="sc">$</span>mean</span>
<span id="cb278-16"><a href="Chapter10.html#cb278-16" tabindex="-1"></a></span>
<span id="cb278-17"><a href="Chapter10.html#cb278-17" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb278-18"><a href="Chapter10.html#cb278-18" tabindex="-1"></a>  E <span class="ot">&lt;-</span> (y_sim.nb[,i] <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)</span>
<span id="cb278-19"><a href="Chapter10.html#cb278-19" tabindex="-1"></a>  sum_E2_sim.nb[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb278-20"><a href="Chapter10.html#cb278-20" tabindex="-1"></a>}</span>
<span id="cb278-21"><a href="Chapter10.html#cb278-21" tabindex="-1"></a></span>
<span id="cb278-22"><a href="Chapter10.html#cb278-22" tabindex="-1"></a><span class="do">### 実データのピアソン残差の平方和</span></span>
<span id="cb278-23"><a href="Chapter10.html#cb278-23" tabindex="-1"></a>E <span class="ot">&lt;-</span>(sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)</span>
<span id="cb278-24"><a href="Chapter10.html#cb278-24" tabindex="-1"></a>sum_E2.nb <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb278-25"><a href="Chapter10.html#cb278-25" tabindex="-1"></a></span>
<span id="cb278-26"><a href="Chapter10.html#cb278-26" tabindex="-1"></a><span class="do">### 比較  </span></span>
<span id="cb278-27"><a href="Chapter10.html#cb278-27" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">mean</span>(sum_E2.nb <span class="sc">&gt;</span> sum_E2_sim.nb)</span>
<span id="cb278-28"><a href="Chapter10.html#cb278-28" tabindex="-1"></a></span>
<span id="cb278-29"><a href="Chapter10.html#cb278-29" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">x =</span> sum_E2_sim.nb) <span class="sc">%&gt;%</span> </span>
<span id="cb278-30"><a href="Chapter10.html#cb278-30" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb278-31"><a href="Chapter10.html#cb278-31" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb278-32"><a href="Chapter10.html#cb278-32" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb278-33"><a href="Chapter10.html#cb278-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb278-34"><a href="Chapter10.html#cb278-34" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> sum_E2.nb,</span>
<span id="cb278-35"><a href="Chapter10.html#cb278-35" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red2&quot;</span>)<span class="sc">+</span></span>
<span id="cb278-36"><a href="Chapter10.html#cb278-36" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">210</span>, <span class="at">y =</span> <span class="dv">60</span>),</span>
<span id="cb278-37"><a href="Chapter10.html#cb278-37" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">&quot;p = &quot;</span>, p))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:od-nb"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/od-nb-1.png" alt="シミュレートされたデータのピアソン残差の平方和の分布の実データのピアソン残差の平方和" width="672" />
<p class="caption">
図9.4: シミュレートされたデータのピアソン残差の平方和の分布の実データのピアソン残差の平方和
</p>
</div>
</div>
<div id="model-selection-for-the-nb-glm" class="section level3 hasAnchor" number="9.1.5">
<h3><span class="header-section-number">9.1.5</span> Model selection for the NB GLM<a href="Chapter10.html#model-selection-for-the-nb-glm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>モデル選択は議論の多い話題ではあるが、以下ではひとまずDICとWAICによるモデル選択を行う。なお、比較のため<span class="math inline">\(k\)</span>は先ほどのモデルで得られた値に固定する。ひとまず、1つずつ説明変数をなくした場合と比較を行う。</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="Chapter10.html#cb279-1" tabindex="-1"></a>hyper.nb <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="fu">list</span>(<span class="at">initial =</span> k,</span>
<span id="cb279-2"><a href="Chapter10.html#cb279-2" tabindex="-1"></a>                             <span class="at">fixed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb279-3"><a href="Chapter10.html#cb279-3" tabindex="-1"></a></span>
<span id="cb279-4"><a href="Chapter10.html#cb279-4" tabindex="-1"></a><span class="do">## フルモデル  </span></span>
<span id="cb279-5"><a href="Chapter10.html#cb279-5" tabindex="-1"></a>m10_5 <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span> fSex <span class="sc">+</span> LT<span class="sc">*</span>fLoc,</span>
<span id="cb279-6"><a href="Chapter10.html#cb279-6" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb279-7"><a href="Chapter10.html#cb279-7" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-8"><a href="Chapter10.html#cb279-8" tabindex="-1"></a>                                     <span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-9"><a href="Chapter10.html#cb279-9" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb279-10"><a href="Chapter10.html#cb279-10" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyp.nb),</span>
<span id="cb279-11"><a href="Chapter10.html#cb279-11" tabindex="-1"></a>              <span class="at">data =</span> sp)</span>
<span id="cb279-12"><a href="Chapter10.html#cb279-12" tabindex="-1"></a></span>
<span id="cb279-13"><a href="Chapter10.html#cb279-13" tabindex="-1"></a><span class="do">## fSexなし  </span></span>
<span id="cb279-14"><a href="Chapter10.html#cb279-14" tabindex="-1"></a>m10_5a <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span>  LT<span class="sc">*</span>fLoc,</span>
<span id="cb279-15"><a href="Chapter10.html#cb279-15" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb279-16"><a href="Chapter10.html#cb279-16" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-17"><a href="Chapter10.html#cb279-17" tabindex="-1"></a>                                     <span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-18"><a href="Chapter10.html#cb279-18" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb279-19"><a href="Chapter10.html#cb279-19" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyp.nb),</span>
<span id="cb279-20"><a href="Chapter10.html#cb279-20" tabindex="-1"></a>              <span class="at">data =</span> sp)</span>
<span id="cb279-21"><a href="Chapter10.html#cb279-21" tabindex="-1"></a></span>
<span id="cb279-22"><a href="Chapter10.html#cb279-22" tabindex="-1"></a><span class="do">## 交互作用項なし</span></span>
<span id="cb279-23"><a href="Chapter10.html#cb279-23" tabindex="-1"></a>m10_5b <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span>  fSex <span class="sc">+</span> LT <span class="sc">+</span> fLoc,</span>
<span id="cb279-24"><a href="Chapter10.html#cb279-24" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb279-25"><a href="Chapter10.html#cb279-25" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-26"><a href="Chapter10.html#cb279-26" tabindex="-1"></a>                                     <span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb279-27"><a href="Chapter10.html#cb279-27" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb279-28"><a href="Chapter10.html#cb279-28" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyp.nb),</span>
<span id="cb279-29"><a href="Chapter10.html#cb279-29" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>まずこれらの3つのモデルでDICとWAICを比較したところ、<code>fSex</code>がないモデルがどちらも最も低いことが分かった。</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="Chapter10.html#cb280-1" tabindex="-1"></a>dic10_5 <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_5<span class="sc">$</span>dic<span class="sc">$</span>dic, m10_5a<span class="sc">$</span>dic<span class="sc">$</span>dic, m10_5b<span class="sc">$</span>dic<span class="sc">$</span>dic)</span>
<span id="cb280-2"><a href="Chapter10.html#cb280-2" tabindex="-1"></a>waic10_5 <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_5<span class="sc">$</span>waic<span class="sc">$</span>waic, m10_5a<span class="sc">$</span>waic<span class="sc">$</span>waic, m10_5b<span class="sc">$</span>waic<span class="sc">$</span>waic)</span>
<span id="cb280-3"><a href="Chapter10.html#cb280-3" tabindex="-1"></a></span>
<span id="cb280-4"><a href="Chapter10.html#cb280-4" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="st">&quot;type&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Full&quot;</span>, <span class="st">&quot;-fSex&quot;</span>, <span class="st">&quot;-LT × fLoc&quot;</span>),</span>
<span id="cb280-5"><a href="Chapter10.html#cb280-5" tabindex="-1"></a>           <span class="at">DIC =</span> dic10_5,</span>
<span id="cb280-6"><a href="Chapter10.html#cb280-6" tabindex="-1"></a>           <span class="at">WAIC =</span> waic10_5) <span class="sc">%&gt;%</span> </span>
<span id="cb280-7"><a href="Chapter10.html#cb280-7" tabindex="-1"></a>  <span class="fu">column_as_rownames</span>(<span class="at">var =</span> <span class="st">&quot;type&quot;</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["DIC"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["WAIC"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1296.968","2":"1305.405","_rn_":"Full"},{"1":"1294.966","2":"1302.255","_rn_":"-fSex"},{"1":"1310.778","2":"1318.025","_rn_":"-LT × fLoc"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br/></p>
<p>最後に、ここから交互作用を除いたモデルと比較を行う。</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="Chapter10.html#cb281-1" tabindex="-1"></a>m10_5c <span class="ot">&lt;-</span> <span class="fu">inla</span>(Totalparasites <span class="sc">~</span>  LT <span class="sc">+</span> fLoc,</span>
<span id="cb281-2"><a href="Chapter10.html#cb281-2" tabindex="-1"></a>              <span class="at">family =</span> <span class="st">&quot;nbinomial&quot;</span>,</span>
<span id="cb281-3"><a href="Chapter10.html#cb281-3" tabindex="-1"></a>              <span class="at">control.compute =</span> <span class="fu">list</span>(<span class="at">dic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb281-4"><a href="Chapter10.html#cb281-4" tabindex="-1"></a>                                     <span class="at">waic =</span> <span class="cn">TRUE</span>,</span>
<span id="cb281-5"><a href="Chapter10.html#cb281-5" tabindex="-1"></a>                                     <span class="at">config =</span> <span class="cn">TRUE</span>),</span>
<span id="cb281-6"><a href="Chapter10.html#cb281-6" tabindex="-1"></a>              <span class="at">control.family =</span> <span class="fu">list</span>(<span class="at">hyper =</span> hyp.nb),</span>
<span id="cb281-7"><a href="Chapter10.html#cb281-7" tabindex="-1"></a>              <span class="at">data =</span> sp)</span></code></pre></div>
<p>その結果、やはり交互作用を含むモデルの方がDICとWAICは低い。</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="Chapter10.html#cb282-1" tabindex="-1"></a>dic10_5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_5a<span class="sc">$</span>dic<span class="sc">$</span>dic, m10_5c<span class="sc">$</span>dic<span class="sc">$</span>dic)</span>
<span id="cb282-2"><a href="Chapter10.html#cb282-2" tabindex="-1"></a>waic10_5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">c</span>(m10_5a<span class="sc">$</span>waic<span class="sc">$</span>waic, m10_5c<span class="sc">$</span>waic<span class="sc">$</span>waic)</span>
<span id="cb282-3"><a href="Chapter10.html#cb282-3" tabindex="-1"></a></span>
<span id="cb282-4"><a href="Chapter10.html#cb282-4" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="st">&quot;type&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Full&quot;</span>, <span class="st">&quot;-LT × fLoc&quot;</span>),</span>
<span id="cb282-5"><a href="Chapter10.html#cb282-5" tabindex="-1"></a>           <span class="at">DIC =</span> dic10_5<span class="fl">.2</span>,</span>
<span id="cb282-6"><a href="Chapter10.html#cb282-6" tabindex="-1"></a>           <span class="at">WAIC =</span> waic10_5<span class="fl">.2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-7"><a href="Chapter10.html#cb282-7" tabindex="-1"></a>  <span class="fu">column_as_rownames</span>(<span class="at">var =</span> <span class="st">&quot;type&quot;</span>)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["DIC"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["WAIC"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"1294.966","2":"1302.255","_rn_":"Full"},{"1":"1308.775","2":"1314.627","_rn_":"-LT × fLoc"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br/></p>
<p>以上の結果は、<code>m10_5a</code>が最適なモデルであることを示唆している。このモデルの残差と予測値、残差と共変量の関連を示したのが図@ref(fig:modelvalidation10.5a)である。パターンがあるように見えるが、 <span class="citation">Zuur (<a href="#ref-Zuur2017">2017</a>)</span> は問題がなかったと述べている。</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="Chapter10.html#cb283-1" tabindex="-1"></a>mu <span class="ot">&lt;-</span> m10_5a<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb283-2"><a href="Chapter10.html#cb283-2" tabindex="-1"></a>k <span class="ot">&lt;-</span> k</span>
<span id="cb283-3"><a href="Chapter10.html#cb283-3" tabindex="-1"></a>resid <span class="ot">&lt;-</span> (sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)</span>
<span id="cb283-4"><a href="Chapter10.html#cb283-4" tabindex="-1"></a></span>
<span id="cb283-5"><a href="Chapter10.html#cb283-5" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> resid,</span>
<span id="cb283-6"><a href="Chapter10.html#cb283-6" tabindex="-1"></a>           <span class="at">fitted =</span> mu) <span class="sc">%&gt;%</span> </span>
<span id="cb283-7"><a href="Chapter10.html#cb283-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb283-8"><a href="Chapter10.html#cb283-8" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb283-9"><a href="Chapter10.html#cb283-9" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb283-10"><a href="Chapter10.html#cb283-10" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb283-11"><a href="Chapter10.html#cb283-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb283-12"><a href="Chapter10.html#cb283-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb283-13"><a href="Chapter10.html#cb283-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span>,</span>
<span id="cb283-14"><a href="Chapter10.html#cb283-14" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p1</span>
<span id="cb283-15"><a href="Chapter10.html#cb283-15" tabindex="-1"></a></span>
<span id="cb283-16"><a href="Chapter10.html#cb283-16" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> resid,</span>
<span id="cb283-17"><a href="Chapter10.html#cb283-17" tabindex="-1"></a>           <span class="at">LT =</span> sp<span class="sc">$</span>LT) <span class="sc">%&gt;%</span> </span>
<span id="cb283-18"><a href="Chapter10.html#cb283-18" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> LT, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb283-19"><a href="Chapter10.html#cb283-19" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb283-20"><a href="Chapter10.html#cb283-20" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb283-21"><a href="Chapter10.html#cb283-21" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb283-22"><a href="Chapter10.html#cb283-22" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb283-23"><a href="Chapter10.html#cb283-23" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb283-24"><a href="Chapter10.html#cb283-24" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;LT&quot;</span>,</span>
<span id="cb283-25"><a href="Chapter10.html#cb283-25" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p2</span>
<span id="cb283-26"><a href="Chapter10.html#cb283-26" tabindex="-1"></a></span>
<span id="cb283-27"><a href="Chapter10.html#cb283-27" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> resid,</span>
<span id="cb283-28"><a href="Chapter10.html#cb283-28" tabindex="-1"></a>           <span class="at">Loc =</span> sp<span class="sc">$</span>fLoc,</span>
<span id="cb283-29"><a href="Chapter10.html#cb283-29" tabindex="-1"></a>           <span class="at">Sex =</span> sp<span class="sc">$</span>fSex) <span class="sc">%&gt;%</span> </span>
<span id="cb283-30"><a href="Chapter10.html#cb283-30" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb283-31"><a href="Chapter10.html#cb283-31" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb283-32"><a href="Chapter10.html#cb283-32" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb283-33"><a href="Chapter10.html#cb283-33" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>name, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb283-34"><a href="Chapter10.html#cb283-34" tabindex="-1"></a>                 <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb283-35"><a href="Chapter10.html#cb283-35" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb283-36"><a href="Chapter10.html#cb283-36" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb283-37"><a href="Chapter10.html#cb283-37" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb283-38"><a href="Chapter10.html#cb283-38" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pearson residuals&quot;</span>)<span class="ot">-&gt;</span> p3</span>
<span id="cb283-39"><a href="Chapter10.html#cb283-39" tabindex="-1"></a></span>
<span id="cb283-40"><a href="Chapter10.html#cb283-40" tabindex="-1"></a></span>
<span id="cb283-41"><a href="Chapter10.html#cb283-41" tabindex="-1"></a>(p1 <span class="sc">+</span> p2)<span class="sc">/</span>p3</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/modelvalidation10.5a-1.png" alt="Model validation for m10_5a" width="672" />
<p class="caption">
(#fig:modelvalidation10.5a)Model validation for m10_5a
</p>
</div>
<p><br/></p>
<p>これまで同様に過分散のチェックも行ったが、大きな問題はないよう。</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="Chapter10.html#cb284-1" tabindex="-1"></a>sim_param.nb <span class="ot">&lt;-</span> <span class="fu">inla.posterior.sample</span>(<span class="at">n =</span> <span class="dv">1000</span>, m10_5a)</span>
<span id="cb284-2"><a href="Chapter10.html#cb284-2" tabindex="-1"></a></span>
<span id="cb284-3"><a href="Chapter10.html#cb284-3" tabindex="-1"></a>y_sim.nb <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(sp),</span>
<span id="cb284-4"><a href="Chapter10.html#cb284-4" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">1000</span>)</span>
<span id="cb284-5"><a href="Chapter10.html#cb284-5" tabindex="-1"></a></span>
<span id="cb284-6"><a href="Chapter10.html#cb284-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb284-7"><a href="Chapter10.html#cb284-7" tabindex="-1"></a> y_sim.nb[,i] <span class="ot">&lt;-</span> <span class="fu">rnbinom</span>(<span class="at">n =</span> <span class="fu">nrow</span>(sp), </span>
<span id="cb284-8"><a href="Chapter10.html#cb284-8" tabindex="-1"></a>                      <span class="at">mu =</span> <span class="fu">exp</span>(sim_param[[i]]<span class="sc">$</span>latent[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sp),]),</span>
<span id="cb284-9"><a href="Chapter10.html#cb284-9" tabindex="-1"></a>                      <span class="at">size =</span> k)</span>
<span id="cb284-10"><a href="Chapter10.html#cb284-10" tabindex="-1"></a>}</span>
<span id="cb284-11"><a href="Chapter10.html#cb284-11" tabindex="-1"></a></span>
<span id="cb284-12"><a href="Chapter10.html#cb284-12" tabindex="-1"></a><span class="do">### シミュレートしたデータセットのピアソン残差の平方和</span></span>
<span id="cb284-13"><a href="Chapter10.html#cb284-13" tabindex="-1"></a>sum_E2_sim.nb <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb284-14"><a href="Chapter10.html#cb284-14" tabindex="-1"></a>mu <span class="ot">&lt;-</span> m10_5a<span class="sc">$</span>summary.fitted.values<span class="sc">$</span>mean</span>
<span id="cb284-15"><a href="Chapter10.html#cb284-15" tabindex="-1"></a>k <span class="ot">&lt;-</span> k</span>
<span id="cb284-16"><a href="Chapter10.html#cb284-16" tabindex="-1"></a></span>
<span id="cb284-17"><a href="Chapter10.html#cb284-17" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>){</span>
<span id="cb284-18"><a href="Chapter10.html#cb284-18" tabindex="-1"></a>  E <span class="ot">&lt;-</span> (y_sim.nb[,i] <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)</span>
<span id="cb284-19"><a href="Chapter10.html#cb284-19" tabindex="-1"></a>  sum_E2_sim.nb[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb284-20"><a href="Chapter10.html#cb284-20" tabindex="-1"></a>}</span>
<span id="cb284-21"><a href="Chapter10.html#cb284-21" tabindex="-1"></a></span>
<span id="cb284-22"><a href="Chapter10.html#cb284-22" tabindex="-1"></a><span class="do">### 実データのピアソン残差の平方和</span></span>
<span id="cb284-23"><a href="Chapter10.html#cb284-23" tabindex="-1"></a>E <span class="ot">&lt;-</span>(sp<span class="sc">$</span>Totalparasites <span class="sc">-</span> mu)<span class="sc">/</span><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>k)</span>
<span id="cb284-24"><a href="Chapter10.html#cb284-24" tabindex="-1"></a>sum_E2.nb <span class="ot">&lt;-</span> <span class="fu">sum</span>(E<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb284-25"><a href="Chapter10.html#cb284-25" tabindex="-1"></a></span>
<span id="cb284-26"><a href="Chapter10.html#cb284-26" tabindex="-1"></a><span class="do">### 比較  </span></span>
<span id="cb284-27"><a href="Chapter10.html#cb284-27" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">mean</span>(sum_E2.nb <span class="sc">&gt;</span> sum_E2_sim.nb)</span>
<span id="cb284-28"><a href="Chapter10.html#cb284-28" tabindex="-1"></a></span>
<span id="cb284-29"><a href="Chapter10.html#cb284-29" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">x =</span> sum_E2_sim.nb) <span class="sc">%&gt;%</span> </span>
<span id="cb284-30"><a href="Chapter10.html#cb284-30" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb284-31"><a href="Chapter10.html#cb284-31" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb284-32"><a href="Chapter10.html#cb284-32" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb284-33"><a href="Chapter10.html#cb284-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb284-34"><a href="Chapter10.html#cb284-34" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> sum_E2.nb,</span>
<span id="cb284-35"><a href="Chapter10.html#cb284-35" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red2&quot;</span>)<span class="sc">+</span></span>
<span id="cb284-36"><a href="Chapter10.html#cb284-36" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">210</span>, <span class="at">y =</span> <span class="dv">60</span>),</span>
<span id="cb284-37"><a href="Chapter10.html#cb284-37" tabindex="-1"></a>            <span class="at">label =</span> <span class="fu">str_c</span>(<span class="st">&quot;p = &quot;</span>, p))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:od-nb2"></span>
<img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/od-nb2-1.png" alt="シミュレートされたデータのピアソン残差の平方和の分布の実データのピアソン残差の平方和" width="672" />
<p class="caption">
図9.5: シミュレートされたデータのピアソン残差の平方和の分布の実データのピアソン残差の平方和
</p>
</div>
</div>
<div id="visualization-of-the-nb-glm" class="section level3 hasAnchor" number="9.1.6">
<h3><span class="header-section-number">9.1.6</span> Visualization of the NB GLM<a href="Chapter10.html#visualization-of-the-nb-glm" class="anchor-section" aria-label="Anchor link to header"></a></h3>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Timi2008" class="csl-entry">
Timi JT, Lanfranchi AL, Etchegoin JA, Cremonte F (2008) Parasites of the brazilian sandperch pinguipes brasilianus cuvier: A tool for stock discrimination in the argentine sea. J Fish Biol 72:1332–1342
</div>
<div id="ref-Zuur2017" class="csl-entry">
Zuur AF (2017) Beginner’s guide to spatial, temporal and <span>Spatial-Temporal</span> ecological data analysis with <span>R-Inla</span>: Using glm and glmm volume <span>I</span>. Hightland Statistics Ltd.
</div>
<div id="ref-Zuur2016" class="csl-entry">
Zuur AF, Ieno EN (2016) Beginner’s guide to zero-inflated models with <span>R</span>. <a href="https://www.highstat.com/Books/BGS/ZIM/pdfs/TOCOnly.pdf" class="uri">https://www.highstat.com/Books/BGS/ZIM/pdfs/TOCOnly.pdf</a>; Highland Statistics
</div>
<div id="ref-Ohigashi2010" class="csl-entry">
健太郎大東 (2010) <span>線形モデルから一般化線形モデル（GLM）へ</span>. 雑草研究 55:268–274
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Chapter9.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sessioninfo.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
