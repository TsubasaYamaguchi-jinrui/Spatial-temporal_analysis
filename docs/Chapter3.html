<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Time series and GLS | Introduction to spatial-temporal data anlysis using R</title>
  <meta name="description" content="2 Time series and GLS | Introduction to spatial-temporal data anlysis using R" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Time series and GLS | Introduction to spatial-temporal data anlysis using R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Time series and GLS | Introduction to spatial-temporal data anlysis using R" />
  
  
  

<meta name="author" content="Tsubasa Yamaguchi" />


<meta name="date" content="2023-09-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Chapter2.html"/>
<link rel="next" href="Chapter4.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.27/datatables.js"></script>
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="custom_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>本稿の目的</a></li>
<li class="chapter" data-level="" data-path="Chapter0.html"><a href="Chapter0.html"><i class="fa fa-check"></i>0. パッケージの読み込み</a></li>
<li class="chapter" data-level="1" data-path="Chapter2.html"><a href="Chapter2.html"><i class="fa fa-check"></i><b>1</b> Recognizing statistical dependency</a>
<ul>
<li class="chapter" data-level="1.1" data-path="Chapter2.html"><a href="Chapter2.html#pseudoreplication"><i class="fa fa-check"></i><b>1.1</b> Pseudoreplication</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="Chapter2.html"><a href="Chapter2.html#疑似反復とは"><i class="fa fa-check"></i><b>1.1.1</b> 疑似反復とは</a></li>
<li class="chapter" data-level="1.1.2" data-path="Chapter2.html"><a href="Chapter2.html#時空間的な疑似反復"><i class="fa fa-check"></i><b>1.1.2</b> 時空間的な疑似反復</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="Chapter2.html"><a href="Chapter2.html#s1-2"><i class="fa fa-check"></i><b>1.2</b> Linear regression applied to spatial data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="Chapter2.html"><a href="Chapter2.html#visualization"><i class="fa fa-check"></i><b>1.2.1</b> Visualization</a></li>
<li class="chapter" data-level="1.2.2" data-path="Chapter2.html"><a href="Chapter2.html#dependency"><i class="fa fa-check"></i><b>1.2.2</b> Dependency</a></li>
<li class="chapter" data-level="1.2.3" data-path="Chapter2.html"><a href="Chapter2.html#fit-the-model"><i class="fa fa-check"></i><b>1.2.3</b> Fit the model</a></li>
<li class="chapter" data-level="1.2.4" data-path="Chapter2.html"><a href="Chapter2.html#model-validation"><i class="fa fa-check"></i><b>1.2.4</b> Model validation</a>
<ul>
<li class="chapter" data-level="1.2.4.1" data-path="Chapter2.html"><a href="Chapter2.html#check-homogeinity-and-model-misfit"><i class="fa fa-check"></i><b>1.2.4.1</b> Check homogeinity and model misfit</a></li>
</ul></li>
<li class="chapter" data-level="1.2.5" data-path="Chapter2.html"><a href="Chapter2.html#check-spatial-dependence"><i class="fa fa-check"></i><b>1.2.5</b> Check spatial dependence</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="Chapter2.html"><a href="Chapter2.html#s2-2"><i class="fa fa-check"></i><b>1.3</b> GAM applied to temporal data</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="Chapter2.html"><a href="Chapter2.html#subnivium-temperature-data"><i class="fa fa-check"></i><b>1.3.1</b> Subnivium temperature data</a></li>
<li class="chapter" data-level="1.3.2" data-path="Chapter2.html"><a href="Chapter2.html#sources-of-dependency"><i class="fa fa-check"></i><b>1.3.2</b> Sources of dependency</a></li>
<li class="chapter" data-level="1.3.3" data-path="Chapter2.html"><a href="Chapter2.html#the-model"><i class="fa fa-check"></i><b>1.3.3</b> The model</a></li>
<li class="chapter" data-level="1.3.4" data-path="Chapter2.html"><a href="Chapter2.html#model-validation-1"><i class="fa fa-check"></i><b>1.3.4</b> Model validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chapter3.html"><a href="Chapter3.html"><i class="fa fa-check"></i><b>2</b> Time series and GLS</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Chapter3.html"><a href="Chapter3.html#ospreys"><i class="fa fa-check"></i><b>2.1</b> Ospreys</a></li>
<li class="chapter" data-level="2.2" data-path="Chapter3.html"><a href="Chapter3.html#covariance-and-correlation-coefficients"><i class="fa fa-check"></i><b>2.2</b> Covariance and correlation coefficients</a></li>
<li class="chapter" data-level="2.3" data-path="Chapter3.html"><a href="Chapter3.html#linear-regression-models"><i class="fa fa-check"></i><b>2.3</b> Linear regression models</a></li>
<li class="chapter" data-level="2.4" data-path="Chapter3.html"><a href="Chapter3.html#focusing-on-the-residual-covariance-matrix"><i class="fa fa-check"></i><b>2.4</b> Focusing on the residual covariance matrix</a></li>
<li class="chapter" data-level="2.5" data-path="Chapter3.html"><a href="Chapter3.html#dependency-and-the-covariance-matrix"><i class="fa fa-check"></i><b>2.5</b> Dependency and the covariance matrix</a></li>
<li class="chapter" data-level="2.6" data-path="Chapter3.html"><a href="Chapter3.html#dealing-with-temporal-dependency"><i class="fa fa-check"></i><b>2.6</b> Dealing with temporal dependency</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="Chapter3.html"><a href="Chapter3.html#adelie-penguins"><i class="fa fa-check"></i><b>2.6.1</b> Adelie penguins</a></li>
<li class="chapter" data-level="2.6.2" data-path="Chapter3.html"><a href="Chapter3.html#do-we-have-dependency"><i class="fa fa-check"></i><b>2.6.2</b> Do we have dependency?</a></li>
<li class="chapter" data-level="2.6.3" data-path="Chapter3.html"><a href="Chapter3.html#formulation-of-the-linear-regression-model"><i class="fa fa-check"></i><b>2.6.3</b> Formulation of the linear regression model</a></li>
<li class="chapter" data-level="2.6.4" data-path="Chapter3.html"><a href="Chapter3.html#application-of-the-linear-regression-model"><i class="fa fa-check"></i><b>2.6.4</b> Application of the linear regression model</a></li>
<li class="chapter" data-level="2.6.5" data-path="Chapter3.html"><a href="Chapter3.html#formulation-of-the-gls-model"><i class="fa fa-check"></i><b>2.6.5</b> Formulation of the GLS model</a></li>
<li class="chapter" data-level="2.6.6" data-path="Chapter3.html"><a href="Chapter3.html#implementation-using-the-gls-function"><i class="fa fa-check"></i><b>2.6.6</b> Implementation using the gls function</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="Chapter3.html"><a href="Chapter3.html#multiple-time-series"><i class="fa fa-check"></i><b>2.7</b> Multiple time series</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chapter4.html"><a href="Chapter4.html"><i class="fa fa-check"></i><b>3</b> Spatial data and GLS</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Chapter4.html"><a href="Chapter4.html#variogram-models-for-spatial-dependency"><i class="fa fa-check"></i><b>3.1</b> Variogram models for spatial dependency</a></li>
<li class="chapter" data-level="3.2" data-path="Chapter4.html"><a href="Chapter4.html#application-on-the-irish-ph-data"><i class="fa fa-check"></i><b>3.2</b> Application on the Irish pH data</a></li>
<li class="chapter" data-level="3.3" data-path="Chapter4.html"><a href="Chapter4.html#s4-3"><i class="fa fa-check"></i><b>3.3</b> Matern correlation function</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chapter5.html"><a href="Chapter5.html"><i class="fa fa-check"></i><b>4</b> Linear mixed-effects models and dependency</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Chapter5.html"><a href="Chapter5.html#white-storks"><i class="fa fa-check"></i><b>4.1</b> White Storks</a></li>
<li class="chapter" data-level="4.2" data-path="Chapter5.html"><a href="Chapter5.html#considering-the-data-wrongly-as-one-way-nested"><i class="fa fa-check"></i><b>4.2</b> Considering the data (wrongly) as one-way nested</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="Chapter5.html"><a href="Chapter5.html#model-formulation"><i class="fa fa-check"></i><b>4.2.1</b> model formulation</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="Chapter5.html"><a href="Chapter5.html#fitting-the-one-way-nested-model-using-lmer"><i class="fa fa-check"></i><b>4.3</b> Fitting the one-way nested model using lmer</a></li>
<li class="chapter" data-level="4.4" data-path="Chapter5.html"><a href="Chapter5.html#model-validation-2"><i class="fa fa-check"></i><b>4.4</b> Model validation</a></li>
<li class="chapter" data-level="4.5" data-path="Chapter5.html"><a href="Chapter5.html#sketching-the-fitted-value"><i class="fa fa-check"></i><b>4.5</b> Sketching the fitted value</a></li>
<li class="chapter" data-level="4.6" data-path="Chapter5.html"><a href="Chapter5.html#considering-the-data-correctly-as-two-way-nested"><i class="fa fa-check"></i><b>4.6</b> Considering the data (correctly) as two-way nested</a></li>
<li class="chapter" data-level="4.7" data-path="Chapter5.html"><a href="Chapter5.html#differences-with-the-ar1-process-approach"><i class="fa fa-check"></i><b>4.7</b> Differences with the AR1 process approach</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Chapter6.html"><a href="Chapter6.html"><i class="fa fa-check"></i><b>5</b> Modelling space explicitly</a>
<ul>
<li class="chapter" data-level="5.1" data-path="Chapter6.html"><a href="Chapter6.html#model-formulation-1"><i class="fa fa-check"></i><b>5.1</b> Model formulation</a></li>
<li class="chapter" data-level="5.2" data-path="Chapter6.html"><a href="Chapter6.html#s6-2"><i class="fa fa-check"></i><b>5.2</b> Covariance matrix of the spatial random effect</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="Chapter6.html"><a href="Chapter6.html#simulation-study"><i class="fa fa-check"></i><b>5.2.1</b> Simulation study</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="Chapter6.html"><a href="Chapter6.html#spatial-temporal-correlation"><i class="fa fa-check"></i><b>5.3</b> Spatial-temporal correlation</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="Chapter6.html"><a href="Chapter6.html#simulation-study-continued"><i class="fa fa-check"></i><b>5.3.1</b> Simulation study (continued)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Chapter7.html"><a href="Chapter7.html"><i class="fa fa-check"></i><b>6</b> Introduction to Bayesian statistics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Chapter7.html"><a href="Chapter7.html#why-go-bayesian"><i class="fa fa-check"></i><b>6.1</b> Why go Bayesian?</a></li>
<li class="chapter" data-level="6.2" data-path="Chapter7.html"><a href="Chapter7.html#s7-2"><i class="fa fa-check"></i><b>6.2</b> General probability rules</a></li>
<li class="chapter" data-level="6.3" data-path="Chapter7.html"><a href="Chapter7.html#s7-3"><i class="fa fa-check"></i><b>6.3</b> The mean of a distribution</a></li>
<li class="chapter" data-level="6.4" data-path="Chapter7.html"><a href="Chapter7.html#bayes-theorem-again"><i class="fa fa-check"></i><b>6.4</b> Bayes theorem again</a></li>
<li class="chapter" data-level="6.5" data-path="Chapter7.html"><a href="Chapter7.html#s7-5"><i class="fa fa-check"></i><b>6.5</b> Conjugate priors</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="Chapter7.html"><a href="Chapter7.html#likelihood-function"><i class="fa fa-check"></i><b>6.5.1</b> Likelihood function</a></li>
<li class="chapter" data-level="6.5.2" data-path="Chapter7.html"><a href="Chapter7.html#priors"><i class="fa fa-check"></i><b>6.5.2</b> Priors</a></li>
<li class="chapter" data-level="6.5.3" data-path="Chapter7.html"><a href="Chapter7.html#posterior-distribution"><i class="fa fa-check"></i><b>6.5.3</b> Posterior distribution</a></li>
<li class="chapter" data-level="6.5.4" data-path="Chapter7.html"><a href="Chapter7.html#diffuse-prior"><i class="fa fa-check"></i><b>6.5.4</b> Diffuse prior</a></li>
<li class="chapter" data-level="6.5.5" data-path="Chapter7.html"><a href="Chapter7.html#informative-prior"><i class="fa fa-check"></i><b>6.5.5</b> Informative prior</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="Chapter7.html"><a href="Chapter7.html#markov-chain-monte-carlo-simulation"><i class="fa fa-check"></i><b>6.6</b> Markov chain Monte Carlo simulation</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="Chapter7.html"><a href="Chapter7.html#underlying-idea"><i class="fa fa-check"></i><b>6.6.1</b> underlying idea</a></li>
<li class="chapter" data-level="6.6.2" data-path="Chapter7.html"><a href="Chapter7.html#simple-example-of-mcmc-algorithm"><i class="fa fa-check"></i><b>6.6.2</b> Simple example of MCMC algorithm</a></li>
<li class="chapter" data-level="6.6.3" data-path="Chapter7.html"><a href="Chapter7.html#methods-in-mcmc"><i class="fa fa-check"></i><b>6.6.3</b> Methods in MCMC</a></li>
<li class="chapter" data-level="6.6.4" data-path="Chapter7.html"><a href="Chapter7.html#flowchart-for-running-a-model-in-stan"><i class="fa fa-check"></i><b>6.6.4</b> Flowchart for running a model in Stan</a>
<ul>
<li class="chapter" data-level="6.6.4.1" data-path="Chapter7.html"><a href="Chapter7.html#preparing-the-data-for-stan"><i class="fa fa-check"></i><b>6.6.4.1</b> Preparing the data for Stan</a></li>
<li class="chapter" data-level="6.6.4.2" data-path="Chapter7.html"><a href="Chapter7.html#decide-model-formulation-and-priors"><i class="fa fa-check"></i><b>6.6.4.2</b> Decide model formulation and priors</a></li>
<li class="chapter" data-level="6.6.4.3" data-path="Chapter7.html"><a href="Chapter7.html#preparing-stan-file"><i class="fa fa-check"></i><b>6.6.4.3</b> Preparing stan file</a></li>
<li class="chapter" data-level="6.6.4.4" data-path="Chapter7.html"><a href="Chapter7.html#initial-values"><i class="fa fa-check"></i><b>6.6.4.4</b> Initial values</a></li>
</ul></li>
<li class="chapter" data-level="6.6.5" data-path="Chapter7.html"><a href="Chapter7.html#running-model-in-stan"><i class="fa fa-check"></i><b>6.6.5</b> Running model in Stan</a></li>
<li class="chapter" data-level="6.6.6" data-path="Chapter7.html"><a href="Chapter7.html#assess-mixing"><i class="fa fa-check"></i><b>6.6.6</b> Assess mixing</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="Chapter7.html"><a href="Chapter7.html#integrated-nested-laplace-approximation"><i class="fa fa-check"></i><b>6.7</b> Integrated nested Laplace approximation</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="Chapter7.html"><a href="Chapter7.html#joint-posterior-distribution"><i class="fa fa-check"></i><b>6.7.1</b> Joint posterior distribution</a></li>
<li class="chapter" data-level="6.7.2" data-path="Chapter7.html"><a href="Chapter7.html#marginal-distributions"><i class="fa fa-check"></i><b>6.7.2</b> Marginal distributions</a></li>
<li class="chapter" data-level="6.7.3" data-path="Chapter7.html"><a href="Chapter7.html#back-to-high-school"><i class="fa fa-check"></i><b>6.7.3</b> Back to high school</a></li>
<li class="chapter" data-level="6.7.4" data-path="Chapter7.html"><a href="Chapter7.html#inla"><i class="fa fa-check"></i><b>6.7.4</b> INLA</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="Chapter7.html"><a href="Chapter7.html#examples-using-r-inla"><i class="fa fa-check"></i><b>6.8</b> Examples using R-INLA</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="Chapter7.html"><a href="Chapter7.html#s7-8-1"><i class="fa fa-check"></i><b>6.8.1</b> Posterior summary</a></li>
<li class="chapter" data-level="6.8.2" data-path="Chapter7.html"><a href="Chapter7.html#posterior-marginal-distributions"><i class="fa fa-check"></i><b>6.8.2</b> Posterior marginal distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="Chapter7.html"><a href="Chapter7.html#追記"><i class="fa fa-check"></i><b>6.9</b> 追記</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Chapter8.html"><a href="Chapter8.html"><i class="fa fa-check"></i><b>7</b> Multiple linear regression in R-INLA</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Chapter8.html"><a href="Chapter8.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="Chapter8.html"><a href="Chapter8.html#data-exploration"><i class="fa fa-check"></i><b>7.2</b> Data exploration</a></li>
<li class="chapter" data-level="7.3" data-path="Chapter8.html"><a href="Chapter8.html#linear-regression-result"><i class="fa fa-check"></i><b>7.3</b> Linear regression result</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="Chapter8.html"><a href="Chapter8.html#executing-the-model-in-rinla"><i class="fa fa-check"></i><b>7.3.1</b> Executing the model in R=INLA</a></li>
<li class="chapter" data-level="7.3.2" data-path="Chapter8.html"><a href="Chapter8.html#output-for-betas"><i class="fa fa-check"></i><b>7.3.2</b> Output for betas</a>
<ul>
<li class="chapter" data-level="7.3.2.1" data-path="Chapter8.html"><a href="Chapter8.html#numerical-output-for-the-betas"><i class="fa fa-check"></i><b>7.3.2.1</b> Numerical output for the betas</a></li>
<li class="chapter" data-level="7.3.2.2" data-path="Chapter8.html"><a href="Chapter8.html#graphical-output-for-the-betas"><i class="fa fa-check"></i><b>7.3.2.2</b> Graphical output for the betas</a></li>
</ul></li>
<li class="chapter" data-level="7.3.3" data-path="Chapter8.html"><a href="Chapter8.html#output-for-hyperparameters"><i class="fa fa-check"></i><b>7.3.3</b> Output for hyperparameters</a>
<ul>
<li class="chapter" data-level="7.3.3.1" data-path="Chapter8.html"><a href="Chapter8.html#numerical-output-for-hyper-parameters"><i class="fa fa-check"></i><b>7.3.3.1</b> Numerical output for hyper parameters</a></li>
<li class="chapter" data-level="7.3.3.2" data-path="Chapter8.html"><a href="Chapter8.html#graphical-output-for-the-hyperparameters"><i class="fa fa-check"></i><b>7.3.3.2</b> Graphical output for the hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="7.3.4" data-path="Chapter8.html"><a href="Chapter8.html#fitted-model"><i class="fa fa-check"></i><b>7.3.4</b> Fitted model</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="Chapter8.html"><a href="Chapter8.html#model-validation-3"><i class="fa fa-check"></i><b>7.4</b> Model validation</a></li>
<li class="chapter" data-level="7.5" data-path="Chapter8.html"><a href="Chapter8.html#model-selection"><i class="fa fa-check"></i><b>7.5</b> Model selection</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="Chapter8.html"><a href="Chapter8.html#what-should-we-do"><i class="fa fa-check"></i><b>7.5.1</b> What should we do?</a></li>
<li class="chapter" data-level="7.5.2" data-path="Chapter8.html"><a href="Chapter8.html#usind-the-dic"><i class="fa fa-check"></i><b>7.5.2</b> Usind the DIC</a>
<ul>
<li class="chapter" data-level="7.5.2.1" data-path="Chapter8.html"><a href="Chapter8.html#effective-number-of-parameters"><i class="fa fa-check"></i><b>7.5.2.1</b> Effective number of parameters</a></li>
<li class="chapter" data-level="7.5.2.2" data-path="Chapter8.html"><a href="Chapter8.html#dic-related-output"><i class="fa fa-check"></i><b>7.5.2.2</b> DIC related output</a></li>
<li class="chapter" data-level="7.5.2.3" data-path="Chapter8.html"><a href="Chapter8.html#model-selection-using-dic"><i class="fa fa-check"></i><b>7.5.2.3</b> Model selection using DIC</a></li>
</ul></li>
<li class="chapter" data-level="7.5.3" data-path="Chapter8.html"><a href="Chapter8.html#waic"><i class="fa fa-check"></i><b>7.5.3</b> WAIC</a></li>
<li class="chapter" data-level="7.5.4" data-path="Chapter8.html"><a href="Chapter8.html#out-of-sample-prediction"><i class="fa fa-check"></i><b>7.5.4</b> Out of sample prediction</a></li>
<li class="chapter" data-level="7.5.5" data-path="Chapter8.html"><a href="Chapter8.html#posterior-predictive-check"><i class="fa fa-check"></i><b>7.5.5</b> Posterior predictive check</a>
<ul>
<li class="chapter" data-level="7.5.5.1" data-path="Chapter8.html"><a href="Chapter8.html#zuur-2017の方法"><i class="fa fa-check"></i><b>7.5.5.1</b> Zuur (2017)の方法</a></li>
<li class="chapter" data-level="7.5.5.2" data-path="Chapter8.html"><a href="Chapter8.html#s8-5-5-2"><i class="fa fa-check"></i><b>7.5.5.2</b> 正しい方法</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="Chapter8.html"><a href="Chapter8.html#s8-6"><i class="fa fa-check"></i><b>7.6</b> Visualizing the model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Chapter9.html"><a href="Chapter9.html"><i class="fa fa-check"></i><b>8</b> Mixed effects modelling in R-INLA to analysis otolith data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Chapter9.html"><a href="Chapter9.html#otoliths-in-plaice"><i class="fa fa-check"></i><b>8.1</b> Otoliths in plaice</a></li>
<li class="chapter" data-level="8.2" data-path="Chapter9.html"><a href="Chapter9.html#model-formulation-2"><i class="fa fa-check"></i><b>8.2</b> Model formulation</a></li>
<li class="chapter" data-level="8.3" data-path="Chapter9.html"><a href="Chapter9.html#dependency-1"><i class="fa fa-check"></i><b>8.3</b> Dependency</a></li>
<li class="chapter" data-level="8.4" data-path="Chapter9.html"><a href="Chapter9.html#data-exploration-1"><i class="fa fa-check"></i><b>8.4</b> Data exploration</a></li>
<li class="chapter" data-level="8.5" data-path="Chapter9.html"><a href="Chapter9.html#running-the-model-in-r-inla"><i class="fa fa-check"></i><b>8.5</b> Running the model in R-INLA</a></li>
<li class="chapter" data-level="8.6" data-path="Chapter9.html"><a href="Chapter9.html#model-validation-4"><i class="fa fa-check"></i><b>8.6</b> Model validation</a></li>
<li class="chapter" data-level="8.7" data-path="Chapter9.html"><a href="Chapter9.html#model-selection-1"><i class="fa fa-check"></i><b>8.7</b> Model selection</a></li>
<li class="chapter" data-level="8.8" data-path="Chapter9.html"><a href="Chapter9.html#model-interpretation"><i class="fa fa-check"></i><b>8.8</b> Model interpretation</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="Chapter9.html"><a href="Chapter9.html#option-1-for-prediction-adding-extra-data"><i class="fa fa-check"></i><b>8.8.1</b> Option 1 for prediction: Adding extra data</a></li>
<li class="chapter" data-level="8.8.2" data-path="Chapter9.html"><a href="Chapter9.html#s9-8-2"><i class="fa fa-check"></i><b>8.8.2</b> Option 2 for prediction: Using the <code>inla.make.lincombs</code></a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="Chapter9.html"><a href="Chapter9.html#multiple-random-effects"><i class="fa fa-check"></i><b>8.9</b> Multiple random effects</a></li>
<li class="chapter" data-level="8.10" data-path="Chapter9.html"><a href="Chapter9.html#changin-prior-of-fixed-parameters"><i class="fa fa-check"></i><b>8.10</b> Changin prior of fixed parameters</a></li>
<li class="chapter" data-level="8.11" data-path="Chapter9.html"><a href="Chapter9.html#changing-priors-of-hyperparameters"><i class="fa fa-check"></i><b>8.11</b> Changing priors of hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Chapter10.html"><a href="Chapter10.html"><i class="fa fa-check"></i><b>9</b> Poisson, negative binomial, binomial and g amma GLMs in R-INLA</a>
<ul>
<li class="chapter" data-level="9.1" data-path="Chapter10.html"><a href="Chapter10.html#poisson-and-negative-binomial-glms-in-r-inla"><i class="fa fa-check"></i><b>9.1</b> Poisson and negative binomial GLMs in R-INLA</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="Chapter10.html"><a href="Chapter10.html#introduction-1"><i class="fa fa-check"></i><b>9.1.1</b> Introduction</a></li>
<li class="chapter" data-level="9.1.2" data-path="Chapter10.html"><a href="Chapter10.html#data-exploration-2"><i class="fa fa-check"></i><b>9.1.2</b> Data exploration</a></li>
<li class="chapter" data-level="9.1.3" data-path="Chapter10.html"><a href="Chapter10.html#poisson-glm-an-r-inla"><i class="fa fa-check"></i><b>9.1.3</b> Poisson GLM an R-INLA</a>
<ul>
<li class="chapter" data-level="9.1.3.1" data-path="Chapter10.html"><a href="Chapter10.html#s10-1-3-1"><i class="fa fa-check"></i><b>9.1.3.1</b> Checking overdispersion</a></li>
</ul></li>
<li class="chapter" data-level="9.1.4" data-path="Chapter10.html"><a href="Chapter10.html#negative-binomial-glm-in-r-inla"><i class="fa fa-check"></i><b>9.1.4</b> Negative binomial GLM in R-INLA</a></li>
<li class="chapter" data-level="9.1.5" data-path="Chapter10.html"><a href="Chapter10.html#model-selection-for-the-nb-glm"><i class="fa fa-check"></i><b>9.1.5</b> Model selection for the NB GLM</a></li>
<li class="chapter" data-level="9.1.6" data-path="Chapter10.html"><a href="Chapter10.html#visualization-of-the-nb-glm"><i class="fa fa-check"></i><b>9.1.6</b> Visualization of the NB GLM</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="Chapter10.html"><a href="Chapter10.html#bernoulli-and-binomial-glm"><i class="fa fa-check"></i><b>9.2</b> Bernoulli and binomial GLM</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="Chapter10.html"><a href="Chapter10.html#bernoulli-glm"><i class="fa fa-check"></i><b>9.2.1</b> Bernoulli GLM</a></li>
<li class="chapter" data-level="9.2.2" data-path="Chapter10.html"><a href="Chapter10.html#model-selection-with-the-marginal-likelihood"><i class="fa fa-check"></i><b>9.2.2</b> 10.2.2 Model selection with the marginal likelihood</a></li>
<li class="chapter" data-level="9.2.3" data-path="Chapter10.html"><a href="Chapter10.html#binomial-glm"><i class="fa fa-check"></i><b>9.2.3</b> Binomial GLM</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="Chapter10.html"><a href="Chapter10.html#gamma-glm"><i class="fa fa-check"></i><b>9.3</b> Gamma GLM</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Chapter11.html"><a href="Chapter11.html"><i class="fa fa-check"></i><b>10</b> Matern correlation and SPDE</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Chapter11.html"><a href="Chapter11.html#continuous-gaussian-field"><i class="fa fa-check"></i><b>10.1</b> Continuous Gaussian field</a></li>
<li class="chapter" data-level="10.2" data-path="Chapter11.html"><a href="Chapter11.html#models-that-we-have-in-mind"><i class="fa fa-check"></i><b>10.2</b> Models that we have in mind</a></li>
<li class="chapter" data-level="10.3" data-path="Chapter11.html"><a href="Chapter11.html#matern-correlation"><i class="fa fa-check"></i><b>10.3</b> Matern correlation</a></li>
<li class="chapter" data-level="10.4" data-path="Chapter11.html"><a href="Chapter11.html#spde-approach"><i class="fa fa-check"></i><b>10.4</b> SPDE approach</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="Chapter11.html"><a href="Chapter11.html#mesh"><i class="fa fa-check"></i><b>10.4.1</b> Mesh</a></li>
<li class="chapter" data-level="10.4.2" data-path="Chapter11.html"><a href="Chapter11.html#finite-element-approach"><i class="fa fa-check"></i><b>10.4.2</b> Finite element approach</a></li>
<li class="chapter" data-level="10.4.3" data-path="Chapter11.html"><a href="Chapter11.html#simulation-study-with-five-points"><i class="fa fa-check"></i><b>10.4.3</b> Simulation study with five points</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="Chapter11.html"><a href="Chapter11.html#weighting-factors-again"><i class="fa fa-check"></i><b>10.5</b> Weighting factors … again</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Chapter12.html"><a href="Chapter12.html"><i class="fa fa-check"></i><b>11</b> Linear regression model with spatial dependency for the Irish pH data</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Chapter12.html"><a href="Chapter12.html#introduction-2"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="Chapter12.html"><a href="Chapter12.html#model-formulation-3"><i class="fa fa-check"></i><b>11.2</b> Model formulation</a></li>
<li class="chapter" data-level="11.3" data-path="Chapter12.html"><a href="Chapter12.html#linear-regression-results"><i class="fa fa-check"></i><b>11.3</b> Linear regression results</a></li>
<li class="chapter" data-level="11.4" data-path="Chapter12.html"><a href="Chapter12.html#model-validation-5"><i class="fa fa-check"></i><b>11.4</b> Model validation</a></li>
<li class="chapter" data-level="11.5" data-path="Chapter12.html"><a href="Chapter12.html#adding-spatial-correlation-to-the-model"><i class="fa fa-check"></i><b>11.5</b> Adding spatial correlation to the model</a></li>
<li class="chapter" data-level="11.6" data-path="Chapter12.html"><a href="Chapter12.html#defining-the-mesh-for-the-irish-ph-data"><i class="fa fa-check"></i><b>11.6</b> Defining the mesh for the Irish pH data</a></li>
<li class="chapter" data-level="11.7" data-path="Chapter12.html"><a href="Chapter12.html#define-the-weight-factor-aik"><i class="fa fa-check"></i><b>11.7</b> Define the weight factor aik</a></li>
<li class="chapter" data-level="11.8" data-path="Chapter12.html"><a href="Chapter12.html#define-the-spde"><i class="fa fa-check"></i><b>11.8</b> Define the SPDE</a></li>
<li class="chapter" data-level="11.9" data-path="Chapter12.html"><a href="Chapter12.html#define-the-spatial-field"><i class="fa fa-check"></i><b>11.9</b> Define the spatial field</a></li>
<li class="chapter" data-level="11.10" data-path="Chapter12.html"><a href="Chapter12.html#define-the-stack"><i class="fa fa-check"></i><b>11.10</b> Define the stack</a></li>
<li class="chapter" data-level="11.11" data-path="Chapter12.html"><a href="Chapter12.html#define-the-formula-for-the-spatial-model"><i class="fa fa-check"></i><b>11.11</b> Define the formula for the spatial model</a></li>
<li class="chapter" data-level="11.12" data-path="Chapter12.html"><a href="Chapter12.html#execute-the-spatial-model-in-r"><i class="fa fa-check"></i><b>11.12</b> Execute the spatial model in R</a></li>
<li class="chapter" data-level="11.13" data-path="Chapter12.html"><a href="Chapter12.html#results"><i class="fa fa-check"></i><b>11.13</b> Results</a></li>
<li class="chapter" data-level="11.14" data-path="Chapter12.html"><a href="Chapter12.html#model-selection-2"><i class="fa fa-check"></i><b>11.14</b> Model selection</a></li>
<li class="chapter" data-level="11.15" data-path="Chapter12.html"><a href="Chapter12.html#model-validation-6"><i class="fa fa-check"></i><b>11.15</b> Model validation</a></li>
<li class="chapter" data-level="11.16" data-path="Chapter12.html"><a href="Chapter12.html#s12-16"><i class="fa fa-check"></i><b>11.16</b> Model interpretation</a></li>
<li class="chapter" data-level="11.17" data-path="Chapter12.html"><a href="Chapter12.html#detailed-information-about-the-stack"><i class="fa fa-check"></i><b>11.17</b> Detailed information about the stack</a>
<ul>
<li class="chapter" data-level="11.17.1" data-path="Chapter12.html"><a href="Chapter12.html#stack-for-the-fitted-model-again"><i class="fa fa-check"></i><b>11.17.1</b> Stack for the fitted model again</a></li>
<li class="chapter" data-level="11.17.2" data-path="Chapter12.html"><a href="Chapter12.html#stack-for-the-new-covariate-values"><i class="fa fa-check"></i><b>11.17.2</b> Stack for the new covariate values</a></li>
<li class="chapter" data-level="11.17.3" data-path="Chapter12.html"><a href="Chapter12.html#combine-the-two-stacks"><i class="fa fa-check"></i><b>11.17.3</b> Combine the two stacks</a></li>
<li class="chapter" data-level="11.17.4" data-path="Chapter12.html"><a href="Chapter12.html#run-the-model"><i class="fa fa-check"></i><b>11.17.4</b> Run the model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="Chapter13.html"><a href="Chapter13.html"><i class="fa fa-check"></i><b>12</b> Spatial Poisson models applied to plant diversity</a>
<ul>
<li class="chapter" data-level="12.1" data-path="Chapter13.html"><a href="Chapter13.html#introduction-3"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="Chapter13.html"><a href="Chapter13.html#data-exploration-3"><i class="fa fa-check"></i><b>12.2</b> Data exploration</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="Chapter13.html"><a href="Chapter13.html#sampling-locations"><i class="fa fa-check"></i><b>12.2.1</b> Sampling locations</a></li>
<li class="chapter" data-level="12.2.2" data-path="Chapter13.html"><a href="Chapter13.html#outliers"><i class="fa fa-check"></i><b>12.2.2</b> Outliers</a></li>
<li class="chapter" data-level="12.2.3" data-path="Chapter13.html"><a href="Chapter13.html#collinearity"><i class="fa fa-check"></i><b>12.2.3</b> Collinearity</a></li>
<li class="chapter" data-level="12.2.4" data-path="Chapter13.html"><a href="Chapter13.html#relationships"><i class="fa fa-check"></i><b>12.2.4</b> Relationships</a></li>
<li class="chapter" data-level="12.2.5" data-path="Chapter13.html"><a href="Chapter13.html#number-of-zeros"><i class="fa fa-check"></i><b>12.2.5</b> Number of zeros</a></li>
<li class="chapter" data-level="12.2.6" data-path="Chapter13.html"><a href="Chapter13.html#conclusions-data-exploration"><i class="fa fa-check"></i><b>12.2.6</b> Conclusions data exploration</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="Chapter13.html"><a href="Chapter13.html#model-formulation-4"><i class="fa fa-check"></i><b>12.3</b> Model formulation</a></li>
<li class="chapter" data-level="12.4" data-path="Chapter13.html"><a href="Chapter13.html#glm-results"><i class="fa fa-check"></i><b>12.4</b> GLM results</a></li>
<li class="chapter" data-level="12.5" data-path="Chapter13.html"><a href="Chapter13.html#adding-spatial-correlation-to-the-model-1"><i class="fa fa-check"></i><b>12.5</b> Adding spatial correlation to the model</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="Chapter13.html"><a href="Chapter13.html#model-formulation-5"><i class="fa fa-check"></i><b>12.5.1</b> Model formulation</a></li>
<li class="chapter" data-level="12.5.2" data-path="Chapter13.html"><a href="Chapter13.html#mesh-1"><i class="fa fa-check"></i><b>12.5.2</b> Mesh</a></li>
<li class="chapter" data-level="12.5.3" data-path="Chapter13.html"><a href="Chapter13.html#projector-matrix"><i class="fa fa-check"></i><b>12.5.3</b> Projector matrix</a></li>
<li class="chapter" data-level="12.5.4" data-path="Chapter13.html"><a href="Chapter13.html#spde"><i class="fa fa-check"></i><b>12.5.4</b> SPDE</a></li>
<li class="chapter" data-level="12.5.5" data-path="Chapter13.html"><a href="Chapter13.html#spatial-field"><i class="fa fa-check"></i><b>12.5.5</b> Spatial field</a></li>
<li class="chapter" data-level="12.5.6" data-path="Chapter13.html"><a href="Chapter13.html#stack"><i class="fa fa-check"></i><b>12.5.6</b> Stack</a></li>
<li class="chapter" data-level="12.5.7" data-path="Chapter13.html"><a href="Chapter13.html#formula"><i class="fa fa-check"></i><b>12.5.7</b> Formula</a></li>
<li class="chapter" data-level="12.5.8" data-path="Chapter13.html"><a href="Chapter13.html#run-r-inla"><i class="fa fa-check"></i><b>12.5.8</b> Run R-INLA</a></li>
<li class="chapter" data-level="12.5.9" data-path="Chapter13.html"><a href="Chapter13.html#inspect-results"><i class="fa fa-check"></i><b>12.5.9</b> Inspect results</a>
<ul>
<li class="chapter" data-level="12.5.9.1" data-path="Chapter13.html"><a href="Chapter13.html#plotting-interpolated-wk"><i class="fa fa-check"></i><b>12.5.9.1</b> Plotting interpolated wk</a></li>
<li class="chapter" data-level="12.5.9.2" data-path="Chapter13.html"><a href="Chapter13.html#plotting-the-random-intercepts-ui"><i class="fa fa-check"></i><b>12.5.9.2</b> Plotting the random intercepts ui</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="Chapter13.html"><a href="Chapter13.html#simulating-from-the-model"><i class="fa fa-check"></i><b>12.6</b> Simulating from the model</a></li>
<li class="chapter" data-level="12.7" data-path="Chapter13.html"><a href="Chapter13.html#what-to-write-in-a-paper"><i class="fa fa-check"></i><b>12.7</b> What to write in a paper</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="Chapter14.html"><a href="Chapter14.html"><i class="fa fa-check"></i><b>13</b> Time-series analysis in R-INLA</a>
<ul>
<li class="chapter" data-level="13.1" data-path="Chapter14.html"><a href="Chapter14.html#simulation-study-1"><i class="fa fa-check"></i><b>13.1</b> Simulation study</a></li>
<li class="chapter" data-level="13.2" data-path="Chapter14.html"><a href="Chapter14.html#trends-in-migration-dates-of-sockeye-salmon"><i class="fa fa-check"></i><b>13.2</b> Trends in migration dates of sockeye salmon</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="Chapter14.html"><a href="Chapter14.html#applying-a-random-walk-trend-model"><i class="fa fa-check"></i><b>13.2.1</b> Applying a random walk trend model</a></li>
<li class="chapter" data-level="13.2.2" data-path="Chapter14.html"><a href="Chapter14.html#posterior-distribution-of-sigmas"><i class="fa fa-check"></i><b>13.2.2</b> Posterior distribution of sigmas</a></li>
<li class="chapter" data-level="13.2.3" data-path="Chapter14.html"><a href="Chapter14.html#covariates-and-trends"><i class="fa fa-check"></i><b>13.2.3</b> Covariates and trends</a></li>
<li class="chapter" data-level="13.2.4" data-path="Chapter14.html"><a href="Chapter14.html#making-the-trend-smoother"><i class="fa fa-check"></i><b>13.2.4</b> Making the trend smoother</a>
<ul>
<li class="chapter" data-level="13.2.4.1" data-path="Chapter14.html"><a href="Chapter14.html#changing-the-values-of-the-gamma-prior"><i class="fa fa-check"></i><b>13.2.4.1</b> Changing the values of the gamma prior</a></li>
<li class="chapter" data-level="13.2.4.2" data-path="Chapter14.html"><a href="Chapter14.html#changing-the-gamma-prior-to-the-pc-prior"><i class="fa fa-check"></i><b>13.2.4.2</b> changing the gamma prior to the PC prior</a></li>
<li class="chapter" data-level="13.2.4.3" data-path="Chapter14.html"><a href="Chapter14.html#changing-the-random-walk-model-rw2"><i class="fa fa-check"></i><b>13.2.4.3</b> Changing the random walk model: rw2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="Chapter14.html"><a href="Chapter14.html#trends-in-polar-bear-movements"><i class="fa fa-check"></i><b>13.3</b> Trends in polar bear movements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sessioninfo.html"><a href="sessioninfo.html"><i class="fa fa-check"></i>実行環境</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to spatial-temporal data anlysis using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c3" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Time series and GLS<a href="Chapter3.html#c3" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>本章では、時系列データに対して用いることができる回帰モデルについて解説する。</p>
<div id="ospreys" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Ospreys<a href="Chapter3.html#ospreys" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="citation">Steidl et al. (<a href="#ref-Steidl1991">1991</a>)</span> は、ミサゴの卵の厚さが殺虫剤の崩壊産物(DDD)によって変わるかを調べ、有意な関連を見つけた。本節ではこのデータを用いる。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="Chapter3.html#cb34-1" tabindex="-1"></a>osp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/Ospreys.csv&quot;</span>)</span>
<span id="cb34-2"><a href="Chapter3.html#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="Chapter3.html#cb34-3" tabindex="-1"></a><span class="fu">datatable</span>(osp,</span>
<span id="cb34-4"><a href="Chapter3.html#cb34-4" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">20</span>),</span>
<span id="cb34-5"><a href="Chapter3.html#cb34-5" tabindex="-1"></a>          <span class="at">filter =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-17cbb784f2defae63325" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-17cbb784f2defae63325">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"38\" data-max=\"58\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2.7\" data-max=\"42\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.51\" data-max=\"7.7\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.09\" data-max=\"0.92\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25"],["ATLANTIC","ATLANTIC","ATLANTIC","MAURICE","MAURICE","DELAWARE","DELAWARE","DELAWARE","DELAWARE","DELAWARE","ATLANTIC","ATLANTIC","ATLANTIC","ATLANTIC","ATLANTIC","DELAWARE","DELAWARE","DELAWARE","DELAWARE","DELAWARE","DELAWARE","ATLANTIC","ATLANTIC","ATLANTIC","ATLANTIC"],[41.5,52,51.5,44.5,53.5,38.5,42,42,48,45.5,58,47,43,44,51,54,41,47,47,49.5,47,58,46,38,53.5],[5.2,5.9,6.3,10,3.7,5.4,20,11,7.4,9.3,2.7,4.2,7.8,4.8,3.1,10,5.4,8.6,42,13,14,8.8,6.6,6.4,5.1],[1.9,1.5,1.8,2.5,1.7,2.6,4.84,3.7,3.2,4.8,0.51,1.7,3.5,1.4,0.7,5.7,2,3.3,7.7,3.7,6.2,3.3,1.9,2.5,2.3],[0.5,0.13,0.21,0.26,0.16,0.3,0.78,0.76,0.46,0.62,0.09,0.23,0.53,0.66,0.14,0.47,0.37,0.53,0.92,0.58,0.71,0.33,0.3,0.34,0.29]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>COAST<\/th>\n      <th>THICK<\/th>\n      <th>PCB<\/th>\n      <th>DDE<\/th>\n      <th>DDD<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":20,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="covariance-and-correlation-coefficients" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Covariance and correlation coefficients<a href="Chapter3.html#covariance-and-correlation-coefficients" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>DDDと卵の殻の厚さの関連は以下の通り。</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="Chapter3.html#cb35-1" tabindex="-1"></a>osp <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="Chapter3.html#cb35-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> DDD, <span class="at">y =</span> THICK))<span class="sc">+</span></span>
<span id="cb35-3"><a href="Chapter3.html#cb35-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb35-4"><a href="Chapter3.html#cb35-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb35-5"><a href="Chapter3.html#cb35-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>相関係数は-0.42である。</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="Chapter3.html#cb36-1" tabindex="-1"></a><span class="fu">cor</span>(osp<span class="sc">$</span>THICK, osp<span class="sc">$</span>DDD)</span></code></pre></div>
<pre><code>## [1] -0.4195692</code></pre>
</div>
<div id="linear-regression-models" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Linear regression models<a href="Chapter3.html#linear-regression-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>以下のモデルを考える。</p>
<p><span class="math display">\[
\begin{aligned}
Thichness_i &amp;= \beta_1 + \beta_2 \times DDD_i + \epsilon_i \\
\epsilon_i &amp;\sim N(0, \sigma^2)
\end{aligned}
\]</span></p>
<p>Rでは以下のように実行する。</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="Chapter3.html#cb38-1" tabindex="-1"></a>m3_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(THICK <span class="sc">~</span> DDD, <span class="at">data =</span> osp)</span></code></pre></div>
</div>
<div id="focusing-on-the-residual-covariance-matrix" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Focusing on the residual covariance matrix<a href="Chapter3.html#focusing-on-the-residual-covariance-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>残差<span class="math inline">\(\epsilon_i\)</span>は行列式で以下のように書ける。なお、<span class="math inline">\(\bf{I}\)</span>は単位行列である。<br />
<span class="math display">\[
\bf{\epsilon} \sim N(0, \bf{\sigma^2} \times \mathbf{I})
\]</span></p>
<p>より一般的に、残差<span class="math inline">\(\epsilon_i\)</span>は以下のように書ける。<span class="math inline">\(\bf{\Sigma}\)</span>は<strong>分散共分散行列</strong>と呼ばれる。<br />
<span class="math display">\[
\bf{\epsilon} \sim N(0, \bf{\Sigma})
\]</span></p>
<p>通常の線形回帰モデルでは、<span class="math inline">\(\bf{\Sigma}\)</span>は以下のようになる。ここで、<span class="math inline">\(sigma^2\)</span>に単位行列を書けるということは、残差間が独立であることを仮定していることになる。例えば、1行2列目は<span class="math inline">\(\epsilon_1\)</span>と<span class="math inline">\(\epsilon_2\)</span>の共分散を表すが、単位行列ではこれが0になる。同様に、単位行列は対角成分以外が全て0になるので、異なる残差同士の共分散が全て0になると仮定していることになる。<br />
<span class="math display">\[
\bf{\Sigma} = \sigma^2 \times \mathbf{I}
\]</span></p>
<p>より一般的には、分散共分散行列<span class="math inline">\(\bf{\Sigma}\)</span>は以下のように書ける。これは対称行列である。<span class="math inline">\(\phi_{i,j}\)</span>は<span class="math inline">\(\epsilon_i\)</span>と<span class="math inline">\(\epsilon_j\)</span>の共分散である。通常の回帰分析ではこれらが全て0と仮定された。共分散が０以外の値をとる場合、異なる残差は独立ではなくなる。</p>
<p><span class="math display" id="eq:covmatrix">\[
\bf{\Sigma} =
\begin{pmatrix}
\sigma^2 &amp; \phi_{1,2} &amp; \phi_{1,3} &amp; \phi_{1,4} &amp; \cdots &amp;\phi_{1,25} \\
&amp; \sigma^2 &amp; \phi_{2,3} &amp; \phi_{2,4} &amp; \cdots&amp; \phi_{2,25}\\
&amp; &amp; \sigma^2 &amp; \phi_{3,4} &amp; \cdots &amp; \phi_{3,25} \\
&amp; &amp; &amp; \sigma^2 &amp; \ddots &amp; \vdots \\
&amp; &amp; &amp; &amp; \sigma^2 &amp; \phi_{24,25}\\
&amp; &amp; &amp; &amp; &amp; \sigma^2
\end{pmatrix}
\tag{2.1}
\]</span></p>
</div>
<div id="dependency-and-the-covariance-matrix" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Dependency and the covariance matrix<a href="Chapter3.html#dependency-and-the-covariance-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>ここで、回帰モデルにおける分散共分散行列の役割について理解するためにシミュレーションを行う。変数<span class="math inline">\(z_1\)</span>と<span class="math inline">\(z_2\)</span>が以下に従って1000個ずつ得られるとする。</p>
<p><span class="math display">\[
\begin{aligned}
z_1 &amp;\sim N(10,1)\\
z_2 &amp;\sim N(15,1)
\end{aligned}
\]</span></p>
<p>Rでは以下のように得る。</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="Chapter3.html#cb39-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb39-2"><a href="Chapter3.html#cb39-2" tabindex="-1"></a>z1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">10</span>, <span class="dv">1</span>)</span>
<span id="cb39-3"><a href="Chapter3.html#cb39-3" tabindex="-1"></a>z2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">15</span>, <span class="dv">1</span>)</span></code></pre></div>
<p><code>MASS</code>パッケージの<code>mvrnorm</code>関数を用い、多変量正規分布から同様に値を行列として得ることもできる。</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="Chapter3.html#cb40-1" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">2</span>)</span>
<span id="cb40-2"><a href="Chapter3.html#cb40-2" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(<span class="dv">1000</span>,</span>
<span id="cb40-3"><a href="Chapter3.html#cb40-3" tabindex="-1"></a>             <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>),</span>
<span id="cb40-4"><a href="Chapter3.html#cb40-4" tabindex="-1"></a>             <span class="at">Sigma =</span> sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="Chapter3.html#cb40-5" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb40-6"><a href="Chapter3.html#cb40-6" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">z1 =</span> <span class="dv">1</span>, <span class="at">z2 =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="Chapter3.html#cb41-1" tabindex="-1"></a><span class="fu">datatable</span>(Z)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-64cede6396bb8c9b017a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-64cede6396bb8c9b017a">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667","668","669","670","671","672","673","674","675","676","677","678","679","680","681","682","683","684","685","686","687","688","689","690","691","692","693","694","695","696","697","698","699","700","701","702","703","704","705","706","707","708","709","710","711","712","713","714","715","716","717","718","719","720","721","722","723","724","725","726","727","728","729","730","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","750","751","752","753","754","755","756","757","758","759","760","761","762","763","764","765","766","767","768","769","770","771","772","773","774","775","776","777","778","779","780","781","782","783","784","785","786","787","788","789","790","791","792","793","794","795","796","797","798","799","800","801","802","803","804","805","806","807","808","809","810","811","812","813","814","815","816","817","818","819","820","821","822","823","824","825","826","827","828","829","830","831","832","833","834","835","836","837","838","839","840","841","842","843","844","845","846","847","848","849","850","851","852","853","854","855","856","857","858","859","860","861","862","863","864","865","866","867","868","869","870","871","872","873","874","875","876","877","878","879","880","881","882","883","884","885","886","887","888","889","890","891","892","893","894","895","896","897","898","899","900","901","902","903","904","905","906","907","908","909","910","911","912","913","914","915","916","917","918","919","920","921","922","923","924","925","926","927","928","929","930","931","932","933","934","935","936","937","938","939","940","941","942","943","944","945","946","947","948","949","950","951","952","953","954","955","956","957","958","959","960","961","962","963","964","965","966","967","968","969","970","971","972","973","974","975","976","977","978","979","980","981","982","983","984","985","986","987","988","989","990","991","992","993","994","995","996","997","998","999","1000"],[10.385072409405,9.48594451011363,9.6919957756454,8.16084607295405,8.40659535026485,10.3581968500907,11.1128771777333,9.50408150445662,11.3745542799364,9.44378984684666,10.4806681510313,8.77711624955276,9.0155040276638,8.41679779832566,10.5252071533245,7.98352035251483,10.7340891941483,11.2306224134078,9.88166769971254,9.52798515177594,8.73860521547557,9.49503010853203,10.7764277235192,9.09924423101773,10.8861172041189,8.84640932372008,9.61758767725705,9.69722874114481,10.8664206871196,10.6488186685996,8.91455350029128,9.57407176653775,10.5022240141534,9.75977487391854,8.51528026553127,10.4082582551307,11.7005801261176,9.38051123855769,9.94687365097376,10.7222985958034,10.6858749163385,9.89792205851872,10.04791480581,9.91414788372243,10.2206229121804,9.41855146058949,10.9360563994908,10.8077406305462,8.17432385283431,8.90544876550012,10.4759186469167,11.1961966577585,12.8959270354442,9.06706531679701,9.81903637978784,9.6239649762329,9.82652029475169,10.0783605662358,8.91335539503112,9.55789943566218,9.25228777302367,9.9977823890372,9.23536163025054,9.65781002217088,9.79498889770552,9.63965855380009,9.19157282719185,11.1430808510436,11.911007100507,9.4092079074823,10.3240348800125,11.7823500551703,9.44435973916376,10.6484185225778,9.23473495954301,9.62804955872502,9.21069445837555,11.849422406354,11.1886813010045,9.01457865856821,10.2143015235374,8.03368017171383,10.1791808633457,12.0741754683615,9.29589491433516,10.7929892860467,8.28478524744559,8.15489724527511,8.60173283426362,9.71783787404263,10.6913027835195,9.97600360401245,10.5611105345287,10.7090807754156,11.3057085308172,9.80971462214766,9.04779714742024,9.73443319796416,10.6932640657142,9.6228131437011,9.27331320324998,9.74109612634375,9.1940985485247,11.5262332843741,10.0590853466053,10.6377923795655,9.44776400645167,8.59625328712685,9.48794849037624,9.33952089008919,10.5191751540883,9.27831474686863,10.2781622542515,10.524699374531,9.93746112623422,10.4505988716941,7.88375642406953,9.56868110136602,10.7231944266419,10.3429023981902,8.5046111441581,11.0093752836215,11.2034748580007,9.60439597736709,8.94090872585326,11.9788541298768,9.80902679467337,7.78355518782785,9.6517391717384,9.11861054840927,9.96194415068066,10.6502600005509,11.1007504316699,10.6647559245814,11.3647226330081,10.019312701363,10.9109224245165,9.67001780364939,10.6206021263527,10.6192279542886,9.1891013828069,9.31003962162701,7.73130505538052,9.94283329462474,11.8004770797059,10.9718274450806,9.35949141313454,10.1295272108826,9.04826775253184,9.0163863668317,7.82996284824674,9.71522121492522,10.0772162440674,10.5081432600893,9.89127226776567,9.57790628800234,8.45777626430288,9.42481825685112,11.3407929389305,11.1960651732202,11.56159821242,8.93720626877254,11.4083374015506,10.5764305408725,11.2063436089858,8.79616675691961,8.46546372021684,9.23156657808721,10.9397337636102,10.299053329044,9.75125487718117,9.80674867852963,11.1678685641493,10.232555217632,8.72551215194526,11.0515505270355,9.2147836607016,10.3777875151868,9.78253635767843,9.40190488261153,9.86393346184116,8.45401778480744,11.4520469000639,9.72101391608417,9.29397670054226,10.0158488852507,10.667036910744,8.08404566563487,9.0430708098611,8.94154288049666,11.1491825105646,10.4657614214608,11.9899276494977,9.66406057468353,11.7468053011071,11.9211930422549,9.43978942359163,11.5688340628361,10.443049095215,9.63249530309905,10.0983477694073,9.27435126017938,10.8427478896718,10.4303801853984,11.3031094090793,11.4001701033823,10.0372966168106,10.4094478319847,9.39782765598339,11.0563571566205,10.5489536700548,7.72582288675401,9.6668791888632,9.53548770556483,11.0056957046075,8.00236306133986,8.93003631116995,8.57398399731272,9.20089248175871,10.1022245749313,10.5722773428785,10.8457736985419,9.60014204536983,10.6322999840228,9.79718520291798,9.868613843778,9.55172465399655,10.2403274978959,9.79966964435646,10.8192242165498,10.9244918859399,10.3206161505049,10.9843993407984,9.7825217730429,8.46751934559799,10.1592937504156,9.57415968410182,10.8257792897946,9.20895902368856,10.0597747880628,12.3867622661506,9.5522557184221,9.34820011727057,9.50766452361215,10.0236549771176,9.43269684476658,10.0877249385193,9.03160105527071,11.2161579447145,9.26888294168638,9.54030757193561,9.29161203530872,10.2348095989622,9.65024878540886,9.4109442227754,9.93642078849774,11.3409996222657,9.48410741203783,10.5817547889161,11.3161925610004,9.34163247498146,8.5254492052313,9.89547572410915,9.22053452326055,10.4282721733151,10.2538087385928,8.86514036212438,10.3146951771014,9.30993833447203,10.5875040327584,9.79314986362429,7.68110067171602,8.96924459767513,8.00383134033217,8.35895825835339,9.35001598352841,11.1450480040071,9.48789948159132,9.96216741012171,10.9000159694594,11.8201998522094,11.6336326915039,10.252830493149,9.10534762039962,12.2119315853634,8.82890352091028,11.8211926290592,10.3339613493118,8.84474298841398,9.24632576861679,9.74472979856913,10.0146506140652,9.60440857902624,10.3910632123888,10.0541776262069,9.99246104061715,8.42726466449252,8.80664744159963,9.01431929539911,9.55135639248832,9.4870963921039,9.12343489709982,9.51801011893771,10.3980231909542,9.03498145929566,9.44204640570165,10.4844802780274,10.3714948589851,10.933453389097,11.5200590038326,10.3253302737925,9.13067028885633,8.50980074434997,9.3875353073324,9.13067462053258,10.7522161752929,11.4942361978426,10.4602714119366,9.84195995297069,10.408735233083,8.96578573827454,9.59003402703254,10.6201777747964,8.5515425275462,10.6730784168938,11.2191762446651,9.763563509315,9.56010247876872,11.6919445629191,10.0667788612626,11.7830426505324,9.84439916806696,10.2047950685467,10.5595207817083,11.0659307352758,10.1588323983349,11.0416849569973,8.46807160612801,9.311035897278,8.21445180007036,9.58706410050568,9.20464073461943,7.29687605616912,11.6928409306589,12.0955787438153,11.0440224722828,8.98688242182059,11.4073931137702,8.31989682224368,8.66754416215112,7.64654821468386,12.04870037564,10.9035729971834,9.18300713773903,10.1028684602934,9.11022253802895,11.091615549303,9.53566093380739,9.86631390565125,9.87997620344789,8.72857145740991,10.5269555386282,9.6483323058553,11.2707714928294,10.1572782746746,11.6644216280124,10.6618038490354,9.91866968006779,9.0658975412748,10.3002688716542,9.94125553018176,8.92152841492123,11.5869129511111,10.0155692567259,10.0297066964104,8.88634816288909,10.0424896695644,10.8791036605202,11.8901471684045,10.6397828528286,8.81648678463161,8.04296350515741,8.57976632801667,10.836747150648,9.96975687160487,9.0054990430649,10.4368284315335,10.9187176658178,10.060755193756,10.944673293077,11.6495666951697,10.8822472445531,8.53523826089198,9.19843814874065,9.69956163824308,10.1675116001196,10.4699949022244,10.1132662014621,9.7484973614612,8.16556020379283,9.86820409920962,10.0879550966087,9.58171898230307,8.86392195259837,8.36685598597901,9.52807475659897,10.7584421372567,9.55709657236092,10.0391419987766,10.6861868389443,11.3842202365871,9.15493070816938,9.23543405006434,10.0008951531244,10.718434000236,10.2701283040481,10.9866141575257,10.5677074062206,10.1093556167295,9.9286999488163,10.0667616264309,9.41556318974813,12.3152313145609,7.87805983226181,8.17242425447605,9.56157779176681,11.4074262411778,9.2172808352109,12.365364789931,8.5742265487696,9.06030580053643,11.3348284942216,9.28212992833511,10.0893234964539,9.8262856660506,10.2186503977438,9.72675493835063,8.93999327240273,10.7801154845556,13.0430420937508,8.35984628639032,12.025255157731,9.54238127484724,9.95918470025523,9.64584871795892,8.82606550588269,9.98960370914604,9.54578306293071,10.9623160612622,9.76955653191525,10.0793051928265,9.3162080423901,9.23004131091959,10.3563882248683,11.2691880350063,11.1764635337064,10.833314472184,9.76522962851429,10.7478969527922,9.89788555915757,8.81765913993819,10.4754011058059,9.33468658159367,10.1968037719726,10.3634702393906,10.4694138059917,9.94876455400935,10.4873279229482,8.94122691553317,10.0260131435069,9.35004550120178,8.39869175403027,9.4912605535901,11.5587765083749,11.2802356029143,10.3774391916984,9.11877678638024,10.3183026990681,10.2966147312314,9.55400077669009,9.95414779741895,9.9812207645173,10.2182015162726,8.90030438398737,10.0808904502497,9.67360433018658,9.50596757549407,9.67669230090951,9.70136790006121,11.0544733127502,7.72438868910553,9.48421773780325,11.2260833557184,8.37023254562125,10.234112248005,8.52997746619729,9.03873067725069,10.284391559219,9.94152197730772,10.7892731915375,11.9220825116341,10.8780203586182,9.94064967996367,10.3541349704062,9.26795995849639,10.31692955332,11.1455678042934,10.8587110794515,12.3829096880437,9.13075317582772,9.49667429948922,9.7565444736856,9.87911021087476,9.60351391174468,10.6365867167787,11.3327638842909,9.94462616950605,10.4979534177012,9.54088066604223,9.31452868377205,11.1781326189242,11.5589872468809,8.7293103318863,11.195580670835,11.1554391156183,9.99833271573233,11.3651024606806,9.62784697365422,10.755770852921,8.67159678920648,11.5563601960818,9.272533473689,10.4044540345242,7.90834875913433,10.4433520829619,11.0468637099178,10.5769473156822,9.95008073469616,10.2205880709372,10.6688987257912,10.0980197403526,9.84415311850733,12.4611342903611,11.5822980780243,11.6641990530546,9.18351770377295,10.2685491846696,10.213321411622,8.53882738808509,11.1176700051619,7.84929165892217,10.2535716451521,11.4610368429637,10.9016345612891,10.2905029030421,9.44995258423625,10.2307400040604,10.8880210540098,11.0860650348349,9.32116995511647,10.1236197262828,9.71138219348506,10.168173127439,11.4795414126582,9.00246660378038,9.88661574909257,8.46910911681664,8.26597506674913,9.85531070846103,10.2431253173079,12.5299620407305,10.0155833081331,10.1514694716341,8.55318715430316,10.6143674375114,8.8948965111103,10.7192822868087,10.3988202591915,9.71706065447777,9.20013715213776,10.1598962789527,8.92589508364655,8.39215232430764,10.2434152277006,11.1687596061971,10.0799428615463,8.97769160528001,10.5937146299219,9.95083050606952,9.40934051647381,10.2825839625606,10.6757905367481,10.2115898886258,9.15629479855633,11.5088396075109,10.9166411707117,10.7555324990318,11.413731306213,10.7063934856119,7.36009107159822,11.2484564007204,11.4764454704312,11.1346249899178,10.4948309930428,11.4019096043681,9.15773253626155,10.1704323745297,11.5315396165912,10.7076305362213,10.2527381392805,9.90857768646632,8.95999222727684,10.2036685332042,11.6008226804128,9.56349700306674,10.5398247192195,11.1084201414392,8.86341467408543,11.0345437264624,8.82943356756114,10.1552780515251,9.05095202097148,9.26937441480886,10.2006153525215,7.99859889777565,9.42557707368661,10.6649255004429,10.2124926867366,10.1898888281683,8.66781735214366,8.70504452054197,8.47110147713364,8.0685929030381,9.68419225043048,9.91337044409132,8.94976633200715,9.36078182284436,9.33698314771827,10.1408604138599,8.68927162748653,9.4032251330104,8.94669671629045,10.1148523271785,10.0020666816623,10.9033801964207,9.13848341618611,11.2682308055163,11.3536178966664,8.72857509977747,12.7127526251296,9.3955599317109,11.2000973218393,8.94161386062578,9.69843768681557,9.92218793438296,9.43769092592941,9.75345110161095,10.5345019957546,11.1700585441724,9.86114222660038,10.5080765736658,9.38313075720607,11.1042212928976,11.6216715404309,9.55096452290035,8.66153214246683,9.73036452469734,10.293959555381,10.0197160578936,8.81763426142468,10.5625751869215,9.94132892789098,10.0464126322116,9.9122280154838,8.9146789382158,9.55960878111248,9.85498778652341,11.5809363528347,10.0501246438759,9.40822240724613,9.68877153222965,10.9481289928444,10.6496673047225,10.7045420488187,10.9923961993316,9.07055020970933,9.08460799574524,9.17183264106183,10.5980476864281,10.163086750138,9.55542405113709,9.08986636251727,10.0289590117802,10.3263702997789,12.3140241353771,10.2027127432141,10.7841876286689,9.55112914700877,10.4604014282122,9.38580926367611,10.2322435029821,10.8103377216922,12.1385825370638,10.8734003134699,9.59086334003626,10.4645877443262,9.63721531505884,12.516655412134,9.86204129666805,10.2299628554456,10.3006608610749,8.92536921842621,9.66557369820404,9.81624233034789,7.9851986853345,10.2103175420275,9.29742148052571,10.3461272163155,10.536506626591,9.15179219570675,10.1481109406154,10.7277726347302,10.3268893064336,10.182961753564,9.51669312868455,9.98586783918813,9.87649351293318,8.16254865405782,11.7640587610687,10.3610444467077,10.1043629297889,11.375355450043,7.40303693233918,10.5255660673355,8.97124354884853,10.5349858211279,10.7695625990961,11.0015750915853,11.0549436230209,12.6665705409083,9.21434568012068,10.4274736845025,9.81832775044392,10.2968272445875,9.79268974053622,10.9105397979913,10.2232265032274,9.52022805410267,9.55363070560325,10.0543850632027,11.6335932595596,9.39013378735454,9.36110028216578,8.2969632987295,11.6809572222165,9.694156162699,10.1214640445528,8.75768839437848,9.81988224532168,11.234832737182,10.6956462213692,9.44098244237781,10.8737320550698,12.2648809745678,8.13875157713266,9.65634438041675,9.21356688193805,10.7716828411771,10.3261075275863,12.1113827066924,8.33809952821204,9.25156047615438,10.9623426675033,9.7546189330358,9.42396982608019,10.9912923259339,10.9648331409866,9.38905309988604,9.55624528468813,9.19336282752792,10.2505723388065,10.4752693239127,9.0066208109223,9.51630967440707,9.45650439153433,12.2022681779726,11.8283932554694,10.4689770939505,10.1883184926542,9.0960258587916,9.7977918144252,10.6650436470707,11.0197691883522,7.63658002336859,9.09456151506404,9.53240392220546,9.00257867118684,10.1387402396114,11.076740087963,10.7131926093228,11.0627069260137,7.40728153986297,11.1625363368577,10.7291546216734,9.54904504019344,10.2910708351589,11.6936923779688,9.75532974860307,11.0280685825556,11.3005698586109,11.1142570069469,8.76607051985419,10.1561935668681,9.47586880425273,10.5586678923052,10.0765682251548,10.190330405726,8.11794545413569,6.99163023321885,9.38285514134345,11.1330604945842,10.418089344732,10.0133742753706,9.68734885763182,10.9343863108881,9.53885058518894,9.4365087680752,10.3189606843984,9.58488675577611,11.851176826389,9.91561142470009,9.29839197592588,10.4784228694027,10.6471190609476,10.2493083950587,8.20954504293635,10.3592436399108,10.1146356314765,11.3269252842675,9.01535379012688,10.4815444111253,8.46187614081902,11.1652914203311,9.51403255356776,11.6111511584149,8.59175235074347,9.70120118370561,8.94973056575485,9.37302313288433,8.14766830000175,8.05515005732866,11.1967431692609,9.3408291575623,10.7768589762391,10.2111472828054,11.3171909723146,9.95314467613169,11.3882305311987,10.6939841923852,10.0088488126213,10.7307897536568,9.99379339012445,9.00335123903517,10.4747161660934,9.61105357409926,10.2910637996577,9.74756159257382,9.74656822917114,9.32472141569731,9.71582629577893,11.6211748902796,11.3271986231122,8.80483281856813,10.7453460704163,9.7303970593484,10.1048966691785,9.85894937210435,8.05731869379223,11.3819207835951,8.68529914690583,9.60192327548086,9.82949711843189,10.7109262832986,9.06226176973299,9.57166052355766,9.81482678797809,11.0270799676283,9.08052300557396,10.3366756728661,10.3757552517796,8.84416786241565,9.33965448893446,10.576375050674,9.45078827314894,10.860516202225,9.23460504236955,10.8056915164323,11.8123469846724,8.29645887068642,10.3856927691389,9.33583412833885,11.1313494656292,10.1402893704882,9.33875892149971,8.99574553945472,9.3291947077809,9.41669570209495,10.2320602228661,9.61876693014979,9.24964472658371,11.3384549361758,10.194392027099,10.7018371439188,11.3657386405664,8.81393304595153,8.86763068347035,10.2858717953613,10.6852720556973,8.9329446816421,9.955692144416,10.7550943218285,10.4539170369574,12.1105197610696,10.3457298653,7.74113577825752,10.3203596909573,10.8565273232383,9.13832847882703,9.61733434916829,9.57410093984537,10.5756871433474,10.3238034445598,9.49380514579905,11.0775145450883,9.32720166440978,9.53626600413607,10.9535358560581,9.72530192624307,10.8500154516837,9.93622267712993,9.76872937137731,10.6264024213172,11.0399033401175,10.6467533986713,10.4222874576927,10.2517402987345,10.5535519443974,10.6902054062473,9.2475861806649,11.2310712762966,9.15430017492725,9.39858939441677,10.6498200117437,8.86484102868016,10.1602051306155,10.2563476546407,10.4003828749655,9.88034866063857,10.5788717888804,11.9442137170459,11.0130379421712,9.84461031060701,8.43947524199943,9.26843199017364,9.0632463949262,9.53437786996359,9.15375595890273,8.5596014014979,11.0374526254577,11.6306515767054,10.0558171131424,10.9851381623641,11.7126899409233,9.64057291157624,11.314376956383,6.88009663372784,9.94224469073344,9.26779898975013,9.24066395254097,10.9851117717715,10.0587592866552,11.0796121978563,9.60074970021517,9.20459611395595,10.1331271872443,12.4217474745649,9.11572233465987,10.565090983121,8.47091096785599,9.68280306398404,10.4959047112779,10.8292863425035,9.81053502141745,11.1888637342896,9.36259778862265,9.44442040060841,9.8077428989607,8.97317385918612,10.9834778310044,10.9326951913016],[14.0261813806447,14.9003688029129,14.8892649998876,16.1921945960068,13.3441140698083,13.9543567093214,13.2597608661882,15.5131207715308,14.5540431540161,13.1608062241774,14.180152360904,14.0047904512858,15.2973101275361,15.5574164951303,13.7266629925214,16.0250726098461,15.4666121712665,15.2339183178149,15.2644418986788,15.4324199213942,15.9732221539504,14.4708059413887,15.0457684846023,17.7946914139387,13.9119997975173,15.2954295709327,13.5620354347843,15.2130814808578,15.9749606342371,12.6465378446601,14.4154821878868,17.2538741495818,14.2259789444679,13.5763320201211,15.4576693816536,14.2769991092092,16.4837446283852,16.0820488624743,15.7997584441097,13.5747841985833,15.3592038326834,15.3812225506858,12.9165414681667,15.6278339029361,15.3006132458847,13.9416027613873,14.7913505403627,17.0479732298309,15.7840972776947,13.7227706854034,15.0911240065007,16.7468453063403,15.0324521834741,14.4885672845953,16.1648052385983,14.5347226583239,14.7693699512566,15.855809152531,16.7791443319707,14.1746572843091,14.7711200473654,14.9309626825125,15.8941310574154,16.5404061702469,16.6911065002257,14.7727830841369,15.9312109629702,14.1263973707831,14.4621786266468,13.8030558087417,13.8995841819521,15.5912199303559,15.7337125676925,15.2172775622243,14.2377859566097,15.2969031311711,13.7950062162142,13.244235915962,14.4972573943938,14.5878721403719,14.0502521144834,12.9958578299439,14.5753346211781,15.5327040599243,15.7861753104614,16.59545412796,15.0417731560774,17.2764750502569,15.4527002186335,14.8431013915345,13.0699817968072,17.4304054161173,16.4107007451004,15.6336929760847,16.1184549633141,16.0443726298647,15.8592079056236,15.9418352924092,16.0621315836472,14.3098951700842,14.7314621447424,15.1175220016339,14.144394673688,17.1752063392533,13.675550110446,15.142196304649,14.2053550526151,15.0892238076606,15.1690085680576,14.9516356080331,11.9053446770223,12.5037465221124,15.7206202900804,14.1078421466737,15.0970200128514,15.8000298617149,14.8317031775973,14.2855314410452,14.7733943436655,16.6085409275119,16.5600375308607,16.9459047621514,16.5008400129551,13.4068028833194,13.1444781102995,15.0652080811471,14.8222791126525,13.5222559134419,13.0057075650396,16.2475201733288,16.6703757754983,15.2639231873595,15.1707469509298,14.8778946126457,14.5055725927916,13.6094650359488,14.7950997072497,13.9511264581644,15.1907464891447,15.7076580624889,14.7091353186132,16.4839965866843,16.6752251549064,16.2374102376991,13.5880000236937,13.45825537056,15.0769444109442,15.1583226988493,15.6734444322802,13.5304124557199,14.7248389864437,15.3517725579755,13.3351468886443,15.1869321520358,16.9028274960604,13.4812242750456,16.3305266325199,16.0516004878014,16.0551216722837,16.4314069641956,15.0206470049523,15.2013348882351,14.0102072466968,15.518479614529,16.2742558760856,15.1921793290021,16.1751695647671,16.2423929312046,13.7086100568456,15.3379710889933,14.524847320536,14.8340456045406,14.8336113705972,13.8768394643509,15.9409467240138,14.0867233080018,15.4858721212132,13.2048030213063,14.6301985300531,14.7913194292753,14.3388882376987,14.8234037155085,16.0358115725368,15.5853527307013,14.2067491675278,14.7874595118415,14.9033612894742,14.6216495917517,14.8681960145696,14.7065154245444,17.1374810872396,15.2899479631483,15.5476140091861,14.4210157129165,15.2421453751949,15.2876591667993,15.3959829555557,15.1836205598393,16.9827846390733,13.0332230924934,15.5447282499239,15.5297082147263,14.287044699189,15.059129728232,14.0890628974942,14.2557273250568,12.7883596471353,16.2700514507791,14.4528160678153,15.6050202739993,14.7253293328849,17.0238414743823,15.2420617111821,17.2188414388665,15.164227326967,16.4509759385635,15.1234160139769,15.3488014448367,14.756998458241,15.1026157355476,15.7162219521094,15.4898970914758,13.3573434165992,16.2162813971656,14.2563475607021,15.9430824149071,14.8764979238675,15.0705507685898,15.5204732103905,14.1001609102507,14.9323535783067,14.3029764520392,15.6812092913205,15.3342161857524,13.5772705629524,14.6874978030498,14.4016855882453,14.3366192432383,15.0057082539341,13.1827709255746,16.9249185520801,15.4760221678949,13.0655567907446,14.0861799887804,15.3704201312849,12.7067035459457,14.5179765112676,14.9807550972381,16.2704252503709,16.6759645776218,16.3233098056923,16.4818735406866,14.5035211609375,16.1379538335161,15.0411068780126,16.8123849936444,15.3347573427229,15.6858836804549,15.3835394565995,15.8176855871153,15.3841410137899,14.551595641149,15.1078966501991,17.9398211600723,13.9227020491229,15.5053080492241,15.4194030281784,16.0079728964757,12.6804326735141,13.7385260111652,15.1282449446873,14.0723717930798,14.5701316091113,15.6790266368551,14.9676973945399,14.2185955197411,14.7091266140955,16.7317008021098,16.6013459815989,14.5496596375642,16.5462907332082,15.6106626422188,15.8929742914274,14.0357643373562,13.4624658743218,16.3290196838156,14.2666445303774,14.3690953975138,15.2198884242372,13.3515605639079,15.592309914129,16.325891924107,14.8854408850427,13.2718805288017,14.4111154564024,14.4428748220986,16.0477404722146,16.0560285900861,15.2996131834787,14.614852530224,14.8531887431379,15.673903556218,15.8115889191354,16.7560832558532,13.7826000375889,15.3772728621767,15.2587076329724,13.2767506635869,14.788242366384,14.447753532772,13.8321093335377,15.249717416931,12.6075607751395,16.072541199012,16.4946636493169,16.2513726818649,15.9134294983009,15.2476991741065,15.1606687898644,14.8864031596012,14.2394182856331,15.2081471939584,15.7513504383244,13.6914929565573,14.7498387991035,14.6610382415503,15.3033975019415,14.1375388619915,15.9601203818139,14.4983395902088,16.2701476975646,14.4884688064019,16.2091339261401,14.6637494939342,15.6471124231248,15.2773312873621,14.9087483456375,16.4948358780041,15.1841218736316,15.4255518568186,14.8577808346633,14.5938759651667,17.2084473201058,14.7886822015413,15.1438043822884,15.3313355006371,15.1737740273571,16.4289400254854,13.8310038622102,14.6524023334242,13.8627458489886,14.3076091748964,15.4934573901431,15.8450015643311,17.8478250534552,15.5023960407382,14.7053900650579,13.9953413406059,15.4051579133603,15.9277156910891,14.5719824661694,15.2673142895711,15.244523476432,14.5995208548567,15.7801069035943,13.5701706486166,17.0238033975381,15.0540846199169,15.4266176391976,15.1074526384339,13.6744310784644,15.5905903207931,14.8852714227774,13.9778665300323,15.3829036225187,13.050661620364,16.5357402290625,14.0994789086616,14.8765528243708,16.852161559317,13.551790745781,16.6779437745844,15.8071262758545,15.7164167157776,12.8107467221196,14.7576717381275,13.6057120186705,14.2914540845889,15.438613706878,14.1166310802866,16.0877691035491,15.04892479514,13.413395927132,15.8557625143439,14.3970063284898,13.9630441776274,16.1833647931089,15.3178220511312,15.4938874588391,15.3162821718419,14.3023323685158,15.0180159109156,14.8206942278946,14.3499123126656,13.3082639286366,15.4784294184956,14.3328622895377,16.318081030593,15.9844633300435,14.7014649730564,15.3249473556186,15.929028803868,14.715457786043,18.0224756073336,15.5646548433358,14.9066341045264,15.0551751135643,14.9613466646135,16.3090097435505,16.2433264194705,15.1357460226784,14.8411462560263,15.5893797331737,14.4038825720402,15.0566506693317,14.8138030764247,13.5832556741766,14.4366886512945,13.8911893111692,15.940367423405,13.8274879264219,14.8799117461507,14.0287629955179,15.0948009995226,14.5266922195464,17.3518914346464,14.6679685685754,15.7502013300748,15.3853682389721,15.6790202267084,16.0235641705615,14.51428851917,13.8665211234687,15.6636194457771,14.0738776398844,16.3652663922502,13.9064681518064,12.4356810726325,13.9419364178799,14.4825594074146,16.8992525377378,15.823985914005,16.5731321865134,13.6860679584539,16.1146771359948,14.3920115508098,15.8669110479091,13.0565496607252,15.9841658997479,14.6978140458668,14.8136682198118,16.324513191451,15.3636482248539,15.1007369697797,15.8234255484169,14.1110822744121,13.6684982680618,16.0836075937165,16.4234178173535,15.4996410615427,14.9921654569405,16.4198030574951,15.1489033312038,15.3894462040723,15.1181503534808,15.7524501124027,13.8280648576258,14.5368855941988,14.7996472439043,13.3801059433892,15.7721251209706,15.2160938251078,14.2903786907965,15.3510048168584,15.1726285400683,14.2954291755413,15.063448553266,14.2417635490879,15.5358709776528,13.6096130071852,15.1617611880315,15.8451450385276,15.2042531780643,14.2210285439251,13.9153548687242,13.3773428007203,15.4562577665761,15.1840732874362,15.0579763571196,15.6921157146153,13.6337624267243,15.5392092810598,13.6780679528443,14.7187113302554,12.8950531192305,13.3823952651486,14.2762681192613,15.3067410361141,15.2255961989436,15.9357160410185,15.4424048531693,15.4545190329089,14.0379260420535,13.8675347777721,14.3996730179214,13.2249389500092,14.9082858117172,14.7673742661137,14.4868907295913,15.1855885862334,13.5683768894857,13.1013552124504,15.5712372283639,14.0243739502374,14.1235238013692,14.5547538180497,14.2256702007951,16.231309496555,16.028078895746,15.0501034025012,14.7896178592306,14.3869311646597,15.9954492529957,15.2392741592713,15.2128211896749,13.5036968434058,15.8776933490648,14.3965615006298,15.3414922015074,15.0497093743721,16.3176271459613,16.3494569404246,16.3025748709313,14.9128602131413,14.8864510314902,15.0963360518561,15.4887576121917,14.9703812331621,13.6731848880557,14.1100120785384,13.9096653073629,14.3324106628186,16.294703286551,14.908660552351,15.6699432056361,14.911167929835,15.9512279675194,13.1838403631601,14.5319848646336,14.9146154247137,15.3769194984453,14.7694929689583,14.7923489226052,16.130153994787,15.624426473284,14.6729986937783,14.9355746917422,15.6908832935121,13.3800426646675,15.8476920264841,16.3694709277091,14.4064021691968,15.05418533528,13.4613128196798,14.8801069665423,15.2636303429149,14.2418751851869,14.899217121518,14.0681625619209,14.907683939501,14.7606144783403,15.497228176913,15.7494474172699,16.6544467004357,15.8470752375294,14.5911375852793,14.8136624060191,16.7352856206353,13.8120866992195,14.8816317264524,17.3929786000836,14.6229102617601,13.809236801986,15.2822501501274,13.734192095148,13.5755921388338,14.7845290859248,13.8144126347714,14.5376401813474,16.2581628084085,16.9670435006939,14.2924186304163,14.5660534749693,15.2568668136188,13.954814707585,14.9806587231868,13.9515694885791,14.1823904427235,14.8797543148399,14.9115486101355,15.8163817853767,14.5951212961551,15.5664177863123,13.2913696640177,15.2672089799354,15.845661236412,14.94208166748,14.8570326233549,14.5982814853615,15.1458404402851,15.825918551201,15.9388377082963,15.2355209449165,14.4956375086433,16.7306576385985,15.9821647099945,14.0752018898085,15.2055508158375,13.3603503507603,13.3737476588247,14.181342048045,15.0331242280876,14.4354523053833,16.22801470526,17.0844556288535,15.9092047005188,16.2603875813277,15.8610261701366,16.0935220280772,17.4617705502081,14.3059695863489,13.8019768584124,17.6159393263915,14.4251316573719,13.7004756058175,13.9478904014531,15.7480309914925,14.4595263901995,14.6001102612364,14.6926741497525,15.9134865554687,14.9419639802668,15.8794981024726,15.0852416004161,16.1541634745299,15.8166451751089,15.5163687778402,15.7193042519967,13.1662886414035,14.8923537300138,14.6155666934576,13.4448831198165,15.1801979716845,15.6162218697653,15.5710573374823,14.3062729604052,15.3564475918608,15.3959686052692,16.8290589815653,13.8816989352371,15.6892047987942,14.6587619945696,15.2472094670229,13.8674562981386,14.1208136363052,13.4547548319827,14.9092423558701,15.2087682663719,14.7437405619968,14.1487911869926,15.6099531782821,15.9216656375013,14.7235749990062,16.4124094393377,13.70024329194,15.7122971104672,15.7959333230895,14.1601237174522,15.5782061322755,15.6865409622931,16.1745613891913,15.3775669144014,14.1176919138145,14.4598219751246,14.5063773797152,16.0080194762888,14.4033107073788,13.8383200054584,15.5046878341736,15.8621805551778,17.1154663477513,15.8099766493832,14.9912846655653,15.1615716795457,14.0839675550075,17.206933824946,14.2213937121812,15.126157026961,15.7693887824001,13.4475386851747,15.9613577700515,15.306088393304,14.8498432601333,15.4646368667378,14.5291954093006,12.7411228168538,15.6700533925671,14.5449220373157,16.5314321008369,14.1425196241732,15.684151975021,15.5628193596973,14.9531157076806,13.854392757757,15.1878704084512,13.6690026899058,14.236756222094,14.2743546416703,16.2491197783189,13.3890349925132,14.1415958229254,13.6407148559162,15.3974176188289,15.5036199217321,16.7504224000058,14.2586418426925,16.659318485148,15.5047666874757,15.2189733650455,15.7896057111691,14.0155875983478,14.7867576424299,14.3373561370425,17.1572705054328,14.199433166163,15.0854936287213,15.4996672481064,12.7608189903146,15.6372728509662,13.0897446472862,15.409234507823,13.2266766007544,14.3353448460331,15.0915714509262,14.3045804991017,13.7800779461346,16.880859937329,15.2152732541944,16.9916253597081,14.3274044362128,14.508870714197,16.9470143984295,15.0537337301719,14.9674990531337,16.2010445009794,14.3610734946892,13.6736592231491,15.3610046511832,14.5473319848926,14.8561581529637,15.5202991289846,13.417660563418,13.4315082723458,16.1712197049805,15.0154579575332,16.0202919582547,14.8462000343864,15.5442133491006,15.4523596681086,14.1969861952858,16.2255458173529,15.860497783069,15.1715701840726,14.9811633685316,17.3193169588559,13.3493484851325,14.0044603774534,16.6978292106256,14.8281987917981,13.2680493016126,14.619981957394,15.6319143000642,16.1645221062123,15.4997839766688,14.3981855028977,13.4596047010888,16.6230723755034,14.9722089513284,14.4044185400525,14.470890270185,15.915264270463,13.5770006811337,14.6572592655991,16.2552628578067,15.5595059214105,15.4583714866063,15.2010571003214,14.2835873982837,14.8881381371932,14.1560188882335,15.8120682866864,15.402375860344,14.5298239208251,16.1545513313509,16.491123028072,16.0211640391661,15.9792010117544,14.5053890517247,16.0714708420847,13.7950253068199,16.0217972683066,16.4212242518706,15.3853650443464,14.9073913525975,14.4630837617005,13.6808316557991,14.7755807319721,14.8402121631623,16.1933448259706,13.9139152580754,14.887919979966,14.5767138509673,14.6618266312177,15.6602701535451,15.0382140905262,15.0997946267443,15.459999018913,13.4317582494335,14.8919273061843,15.117422503156,14.7127825592025,15.8051181152787,13.5594977856025,12.1921507632099,13.7930370512082,15.4696235839979,16.75901202663,16.5633577794033,13.5819121263042,14.1594511171978,16.0808845954169,14.9942683625504,15.453794053103,15.7286227082096,16.0724763177501,16.6391383784576,15.1322162918439,15.0288187267031,12.9993656415733,15.7804696606808,14.8641456785532,13.5989926565278,15.1208758243852,15.4469585324164,13.6774414828284,14.4668981624836,15.1417590114682,13.8201767057974,15.0279383978957,15.0686368898788,16.5744599762645,16.3134094289349,14.2540396175373,16.7306912553387,15.6874400910569,13.2374746522382,13.9877160858133,14.1801240556733,14.8415803928076,14.4514328246281,13.782901196674,13.7487497579446,16.3229930501199,15.172777983403,15.1416339455754,14.9512585334693,15.7595314819006,15.5367888818401,15.3520891764634,17.4459957739317,14.5246759300159,15.8408475691864,16.2923264608426,15.2646589067836,13.6995244516574,14.5816954109959,15.5329530524077,14.4606714360965,15.2042664767924,14.4740848275509,15.5477825629286,16.3545111475693,14.2935009679209,13.8328404403556,14.3418457624955,14.888353932276,14.2775583641884,13.7145677111455,16.7464854240195,14.4607903737668,15.9485998713222,14.049750762753,14.5831683771663,15.4132349928216,14.827723703129,15.79993080998,15.5037418025169,15.1197388122257,14.7427337480253,13.6637199367821,14.1998295756386,13.8264966124927,14.8315080433065,15.0087969342272,15.6452402648437,14.4167427328573,14.1455544080717,15.0296119674811,14.7151135217185,14.9484920275396,17.5363747380012,16.0677335196149,14.3149232878156,15.8571907010018,14.281558971765,13.2901111971427,16.282978225011,15.144490031065,15.0564946268066,14.2903793326383,16.2424535014464,15.1925622435556,16.2973821250896,15.3498521907636,15.5645578333628,14.1339386663398,15.2428463643498,13.9390473604246,12.5784407125279,15.9416075638845,16.4328841439785,15.4183173805525,15.2680091399978,15.3840522705967,13.1728405154072,14.0202603517861,14.342659887879,14.8171963192041,15.3645084293721,16.2347965360422,16.5720382238218,15.0369733989263,15.6483567816428,14.7287811167884,15.1584615152562,15.8957204630263,15.4724880128838,14.5095097025832,15.6555353177011,15.8496976620921,14.3636649594226,15.5132924140965,15.9566564794835,15.8097102938476,14.8235448400639,15.8266331413932,16.3405966568179,14.0037830508,12.8224563375509,15.9125059224565,14.2149828296329,14.2683904605722,15.7780084054375,13.5861605023091,15.2974337014646,17.3597635928019,13.9430030611417,14.5709028775571,15.4755523762737,15.1689659225818,13.882147607524,15.2121035248033,14.6511546162979,14.0035334891751,16.0428718399567,16.7064713461363,13.478756705383,16.1469168753732,15.2344396152943,15.5432188175605]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>z1<\/th>\n      <th>z2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>このとき、<span class="math inline">\(z_1\)</span>と<span class="math inline">\(z_2\)</span>は行列を用いると以下のように多変量正規分布から得られていると書くことができる。これは、平均がそれぞれ10と15で、分散共分散行列<span class="math inline">\(\bf{\Sigma}\)</span>が単位行列の多変量正規分布から値が得られたことを示す。<br />
<span class="math display">\[
\begin{pmatrix}
z_1 \\
z_2
\end{pmatrix} =
N \Bigl(
\begin{pmatrix}
10 \\
15
\end{pmatrix},
\begin{pmatrix}
1 &amp; 0 \\
0 &amp; 1 \\
\end{pmatrix}
\Bigl)
\]</span></p>
<p>得られたデータをプロットして分かるように、分散共分散行列が単位行列であり、<span class="math inline">\(z_1\)</span>と<span class="math inline">\(z_2\)</span>の間の共分散はゼロとなっているため、これらに相関が全くないことが分かる。</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="Chapter3.html#cb42-1" tabindex="-1"></a>Z <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="Chapter3.html#cb42-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> z1, <span class="at">y =</span> z2))<span class="sc">+</span></span>
<span id="cb42-3"><a href="Chapter3.html#cb42-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb42-4"><a href="Chapter3.html#cb42-4" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb42-5"><a href="Chapter3.html#cb42-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-32-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>今度は、<span class="math inline">\(z_1\)</span>と<span class="math inline">\(z_2\)</span>が正の相関を持つような場合を考える。このようなときは、以下のように<span class="math inline">\(\bf{\Sigma}\)</span>の<span class="math inline">\(\phi\)</span>成分を0でなく正の値にしてやればよい(ここでは0.9)。分散を1にしているので、この値はそのまま相関係数になる。</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="Chapter3.html#cb43-1" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">2</span>)  </span>
<span id="cb43-2"><a href="Chapter3.html#cb43-2" tabindex="-1"></a>sigma[<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb43-3"><a href="Chapter3.html#cb43-3" tabindex="-1"></a>sigma[<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb43-4"><a href="Chapter3.html#cb43-4" tabindex="-1"></a></span>
<span id="cb43-5"><a href="Chapter3.html#cb43-5" tabindex="-1"></a>sigma</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]  1.0  0.9
## [2,]  0.9  1.0</code></pre>
<p>実際に得られた値をプロットしても、<span class="math inline">\(z_1\)</span>と<span class="math inline">\(z_2\)</span>が強い相関を持つことが分かる。このように、<span class="math inline">\(\bf{Sigma}\)</span>の非対角成分に0以外の値を割り当てることで、多変量正規分布から得られる値が非独立であることを表現できる。</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="Chapter3.html#cb45-1" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(<span class="dv">1000</span>,</span>
<span id="cb45-2"><a href="Chapter3.html#cb45-2" tabindex="-1"></a>             <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>),</span>
<span id="cb45-3"><a href="Chapter3.html#cb45-3" tabindex="-1"></a>             <span class="at">Sigma =</span> sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="Chapter3.html#cb45-4" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="Chapter3.html#cb45-5" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">z1 =</span> <span class="dv">1</span>, <span class="at">z2 =</span> <span class="dv">2</span>)</span>
<span id="cb45-6"><a href="Chapter3.html#cb45-6" tabindex="-1"></a></span>
<span id="cb45-7"><a href="Chapter3.html#cb45-7" tabindex="-1"></a>Z <span class="sc">%&gt;%</span> </span>
<span id="cb45-8"><a href="Chapter3.html#cb45-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> z1, <span class="at">y =</span> z2))<span class="sc">+</span></span>
<span id="cb45-9"><a href="Chapter3.html#cb45-9" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb45-10"><a href="Chapter3.html#cb45-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb45-11"><a href="Chapter3.html#cb45-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-34-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="dealing-with-temporal-dependency" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Dealing with temporal dependency<a href="Chapter3.html#dealing-with-temporal-dependency" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>同様に、時系列データに対しても、残差の分散共分散行列の非対角成分<span class="math inline">\(\phi_{i,j}\)</span>を0以外の値にすることで、データの非独立性に対処することができる。そのような方法の一つがGLS(Generalized least square)と呼ばれる方法である。</p>
<div id="adelie-penguins" class="section level3 hasAnchor" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Adelie penguins<a href="Chapter3.html#adelie-penguins" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ここでは、 <span class="citation">Barbraud and Weimerskirch (<a href="#ref-Barbraud2006">2006</a>)</span> が南極の海鳥が到着する日と産卵日について調査したデータを用いる。ここでは、特に産卵日について着目する。</p>
<p>データは以下の通り。各年について1つのデータがある。</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="Chapter3.html#cb46-1" tabindex="-1"></a>bird <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/Phenology_Data_Antarcticbirds_AFZ1.csv&quot;</span>)</span>
<span id="cb46-2"><a href="Chapter3.html#cb46-2" tabindex="-1"></a></span>
<span id="cb46-3"><a href="Chapter3.html#cb46-3" tabindex="-1"></a><span class="fu">datatable</span>(bird,</span>
<span id="cb46-4"><a href="Chapter3.html#cb46-4" tabindex="-1"></a>          <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="dv">20</span>),</span>
<span id="cb46-5"><a href="Chapter3.html#cb46-5" tabindex="-1"></a>          <span class="at">filter =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e97a237113698110c355" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e97a237113698110c355">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1951\" data-max=\"2005\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"202\" data-max=\"219\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"242\" data-max=\"250\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"193\" data-max=\"220\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"259\" data-max=\"269\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-20\" data-max=\"0\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"38\" data-max=\"51\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.034\" data-max=\"0.137\" data-scale=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.08\" data-max=\"15.38\" data-scale=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55"],[1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005],[214,null,212,null,null,null,215,null,209,null,null,207,211,209,202,null,null,210,214,null,211,209,211,214,210,208,210,216,216,211,212,210,208,null,209,204,211,210,208,208,215,211,212,211,212,215,216,211,215,210,214,213,207,208,219],[null,null,245,null,null,null,248,null,242,null,null,244,243,242,244,null,null,243,244,null,null,245,245,243,246,242,246,248,247,246,247,250,249,null,243,244,248,244,245,248,249,247,247,246,247,245,247,246,246,248,246,244,248,245,249],[null,null,209,null,null,null,214,null,null,null,null,210,193,213,207,null,null,212,209,null,207,201,215,null,195,198,210,213,213,206,213,212,216,null,208,199,210,213,220,219,215,211,209,215,215,215,214,217,220,208,null,215,null,216,210],[null,null,260,null,null,null,259,null,null,null,null,null,261,null,262,null,null,260,null,null,null,261,268,null,259,262,266,265,265,null,null,null,264,null,260,263,261,263,null,265,null,264,269,262,263,263,null,262,263,261,263,null,264,265,266],[null,-10,null,null,null,-9,null,-13,-3,null,null,-12,-7,-15,null,-7,-9,-17,null,-1,-6,0,0,-7,-7,-15,-1,-5,-9,-11,-5,-20,null,-10,-4,-10,-4,-4,-1,-2,-3,-6,-7,-7,-17,-13,-6,-1,-4,-3,-14,-16,-9,-11,null],[null,46,null,null,null,42,null,44,38,null,null,null,41,43,null,41,38,44,null,46,45,44,50,44,44,44,43,43,43,51,45,46,null,39,42,45,44,46,47,47,47,44,41,41,47,46,42,null,47,43,47,44,43,45,null],[0.086,0.127,0.101,0.109,0.087,0.086,0.072,0.082,0.078,0.078,0.065,0.086,0.137,0.098,0.111,0.098,0.056,0.065,0.082,0.067,0.051,0.064,0.071,0.063,0.106,0.087,0.078,0.064,0.08,0.037,0.054,0.06,0.09,0.088,0.082,0.061,0.096,0.048,0.051,0.034,0.054,0.041,0.056,0.076,0.065,0.054,null,null,null,null,null,null,null,null,null],[15.38,-0.69,-2.28,-6.8,4.08,10.58,10.73,-3.89,-3.2,-0.04,3.83,0.8,5.4,-1.95,6.28,-8.43,-4.24,3.2,3.02,-5.38,3.93,10.95,-7.35,7.28,9.9,13.6,1.11,-9.9,-1.65,-1.91,-3.08,1.8,-13.05,-8.33,-0.11,0.86,-2.38,-13.08,7.82,6.77,-2.19,-8.78,-10.38,-9.47,-11.93,-2.27,5.69,-11.67,-1.08,7.95,7.8,0.53,-6.1,-3.14,-4.82]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Year<\/th>\n      <th>ArrivalAP<\/th>\n      <th>LayingAP<\/th>\n      <th>ArrivalCP<\/th>\n      <th>LayingCP<\/th>\n      <th>ArrivalEP<\/th>\n      <th>LayingEP<\/th>\n      <th>MSA<\/th>\n      <th>SOI<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":20,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><br/></p>
<p>分析では、海氷面積によって産卵日に違いが出るかを調べる。海氷面積の直接的なデータはないので、その近似として海中のメタルスルホン酸(<code>MSA</code>: 海氷が多いと多くなる)を用いる。</p>
<p>産卵日の年変動と、MSAと産卵日の関係は以下のようになる。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="Chapter3.html#cb47-1" tabindex="-1"></a>bird <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="Chapter3.html#cb47-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> LayingAP))<span class="sc">+</span></span>
<span id="cb47-3"><a href="Chapter3.html#cb47-3" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb47-4"><a href="Chapter3.html#cb47-4" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb47-5"><a href="Chapter3.html#cb47-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb47-6"><a href="Chapter3.html#cb47-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb47-7"><a href="Chapter3.html#cb47-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Laying date&quot;</span>) <span class="ot">-&gt;</span> p1</span>
<span id="cb47-8"><a href="Chapter3.html#cb47-8" tabindex="-1"></a></span>
<span id="cb47-9"><a href="Chapter3.html#cb47-9" tabindex="-1"></a>bird <span class="sc">%&gt;%</span> </span>
<span id="cb47-10"><a href="Chapter3.html#cb47-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> MSA, <span class="at">y =</span> LayingAP))<span class="sc">+</span></span>
<span id="cb47-11"><a href="Chapter3.html#cb47-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb47-12"><a href="Chapter3.html#cb47-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb47-13"><a href="Chapter3.html#cb47-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb47-14"><a href="Chapter3.html#cb47-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Laying date&quot;</span>) <span class="ot">-&gt;</span> p2</span>
<span id="cb47-15"><a href="Chapter3.html#cb47-15" tabindex="-1"></a></span>
<span id="cb47-16"><a href="Chapter3.html#cb47-16" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-36-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="do-we-have-dependency" class="section level3 hasAnchor" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> Do we have dependency?<a href="Chapter3.html#do-we-have-dependency" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>産卵日に影響する様々な要因(成熟したメスの数、病気の流行、ホルモンレベル)などは年ごとに独立ではなく、t年のデータがt+1年のデータに影響を及ぼしていると考えられる。よって、各年の産卵日は独立ではないと考えられる。</p>
</div>
<div id="formulation-of-the-linear-regression-model" class="section level3 hasAnchor" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> Formulation of the linear regression model<a href="Chapter3.html#formulation-of-the-linear-regression-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>まずは時系列を考慮しない通常の線形回帰モデルを適用する。モデル式は以下の通り。</p>
<p><span class="math display">\[
\begin{aligned}
LD_t &amp;= \beta_1 + \beta_2 \times MSA_t + \epsilon_t \\
\epsilon_t &amp;\sim N(0,\sigma^2)
\end{aligned}
\]</span></p>
</div>
<div id="application-of-the-linear-regression-model" class="section level3 hasAnchor" number="2.6.4">
<h3><span class="header-section-number">2.6.4</span> Application of the linear regression model<a href="Chapter3.html#application-of-the-linear-regression-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Rでは以下のように実行する。ここでは、<code>nlme</code>パッケージの<code>gls</code>関数を用いる(もちろん、<code>lm</code>関数でも実行できる)。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="Chapter3.html#cb48-1" tabindex="-1"></a>m3_2a <span class="ot">&lt;-</span> <span class="fu">gls</span>(LayingAP <span class="sc">~</span> MSA,</span>
<span id="cb48-2"><a href="Chapter3.html#cb48-2" tabindex="-1"></a>            <span class="at">data =</span> bird,</span>
<span id="cb48-3"><a href="Chapter3.html#cb48-3" tabindex="-1"></a>            <span class="at">na.action =</span> na.omit)</span></code></pre></div>
<p>結果は以下の通り。MSAの効果は弱いことが分かる。</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="Chapter3.html#cb49-1" tabindex="-1"></a><span class="fu">summary</span>(m3_2a)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: LayingAP ~ MSA 
##   Data: bird 
##        AIC      BIC    logLik
##   139.7118 144.0137 -66.85588
## 
## Coefficients:
##                 Value Std.Error   t-value p-value
## (Intercept) 247.91825   1.25111 198.15867  0.0000
## MSA         -33.01513  16.42976  -2.00947  0.0533
## 
##  Correlation: 
##     (Intr)
## MSA -0.956
## 
## Standardized residuals:
##        Min         Q1        Med         Q3        Max 
## -1.5831272 -0.5845941 -0.1200808  0.5813974  1.9238887 
## 
## Residual standard error: 2.111689 
## Degrees of freedom: 33 total; 31 residual</code></pre>
<p>モデルの標準化残差と予測値、MSAとの関連をプロットしたのが以下の図である。数字は観察年の下２桁を表す。明確なパターンは見当たらない。しかし、よく見てみると観察年が近いと似た残差をとる傾向があるように思える。例えば、60年代のデータは全て残差が負の値になっている。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="Chapter3.html#cb51-1" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">resid =</span> <span class="fu">resid</span>(m3_2a, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>),</span>
<span id="cb51-2"><a href="Chapter3.html#cb51-2" tabindex="-1"></a>           <span class="at">Year =</span> bird <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(LayingAP, MSA) <span class="sc">%&gt;%</span> .<span class="sc">$</span>Year,</span>
<span id="cb51-3"><a href="Chapter3.html#cb51-3" tabindex="-1"></a>           <span class="at">fitted =</span> <span class="fu">predict</span>(m3_2a),</span>
<span id="cb51-4"><a href="Chapter3.html#cb51-4" tabindex="-1"></a>           <span class="at">MSA =</span> bird <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(LayingAP, MSA) <span class="sc">%&gt;%</span> .<span class="sc">$</span>Year) <span class="sc">%&gt;%</span> </span>
<span id="cb51-5"><a href="Chapter3.html#cb51-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year2 =</span> <span class="fu">str_sub</span>(Year, <span class="dv">3</span>,<span class="dv">4</span>)) <span class="ot">-&gt;</span> fitted_m3_2a</span>
<span id="cb51-6"><a href="Chapter3.html#cb51-6" tabindex="-1"></a>  </span>
<span id="cb51-7"><a href="Chapter3.html#cb51-7" tabindex="-1"></a>fitted_m3_2a <span class="sc">%&gt;%</span> </span>
<span id="cb51-8"><a href="Chapter3.html#cb51-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb51-9"><a href="Chapter3.html#cb51-9" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb51-10"><a href="Chapter3.html#cb51-10" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> Year2))<span class="sc">+</span></span>
<span id="cb51-11"><a href="Chapter3.html#cb51-11" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb51-12"><a href="Chapter3.html#cb51-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb51-13"><a href="Chapter3.html#cb51-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> p1</span>
<span id="cb51-14"><a href="Chapter3.html#cb51-14" tabindex="-1"></a></span>
<span id="cb51-15"><a href="Chapter3.html#cb51-15" tabindex="-1"></a>fitted_m3_2a <span class="sc">%&gt;%</span> </span>
<span id="cb51-16"><a href="Chapter3.html#cb51-16" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> MSA, <span class="at">y =</span> resid))<span class="sc">+</span></span>
<span id="cb51-17"><a href="Chapter3.html#cb51-17" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb51-18"><a href="Chapter3.html#cb51-18" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> Year2))<span class="sc">+</span></span>
<span id="cb51-19"><a href="Chapter3.html#cb51-19" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb51-20"><a href="Chapter3.html#cb51-20" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb51-21"><a href="Chapter3.html#cb51-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>) <span class="ot">-&gt;</span> p2</span>
<span id="cb51-22"><a href="Chapter3.html#cb51-22" tabindex="-1"></a></span>
<span id="cb51-23"><a href="Chapter3.html#cb51-23" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-39-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>自己相関関数をプロットしてみると、あまり明確にはわからないが有意に自己相関が高いところがあることが分かる。</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="Chapter3.html#cb52-1" tabindex="-1"></a>resid <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(bird))</span>
<span id="cb52-2"><a href="Chapter3.html#cb52-2" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(bird<span class="sc">$</span>LayingAP) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(bird<span class="sc">$</span>MSA)</span>
<span id="cb52-3"><a href="Chapter3.html#cb52-3" tabindex="-1"></a>resid[i] <span class="ot">&lt;-</span> <span class="fu">resid</span>(m3_2a, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb52-4"><a href="Chapter3.html#cb52-4" tabindex="-1"></a></span>
<span id="cb52-5"><a href="Chapter3.html#cb52-5" tabindex="-1"></a>acf <span class="ot">&lt;-</span> <span class="fu">acf</span>(resid,</span>
<span id="cb52-6"><a href="Chapter3.html#cb52-6" tabindex="-1"></a>           <span class="at">lag.max =</span> <span class="dv">20</span>,</span>
<span id="cb52-7"><a href="Chapter3.html#cb52-7" tabindex="-1"></a>           <span class="at">na.action =</span> na.pass,</span>
<span id="cb52-8"><a href="Chapter3.html#cb52-8" tabindex="-1"></a>           <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb52-9"><a href="Chapter3.html#cb52-9" tabindex="-1"></a></span>
<span id="cb52-10"><a href="Chapter3.html#cb52-10" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">lag =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb52-11"><a href="Chapter3.html#cb52-11" tabindex="-1"></a>           <span class="at">acf =</span> acf<span class="sc">$</span>acf,</span>
<span id="cb52-12"><a href="Chapter3.html#cb52-12" tabindex="-1"></a>           <span class="at">SE =</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">/</span><span class="fu">sqrt</span>(acf<span class="sc">$</span>n.used)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-13"><a href="Chapter3.html#cb52-13" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb52-14"><a href="Chapter3.html#cb52-14" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> acf))<span class="sc">+</span></span>
<span id="cb52-15"><a href="Chapter3.html#cb52-15" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span>SE),</span>
<span id="cb52-16"><a href="Chapter3.html#cb52-16" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb52-17"><a href="Chapter3.html#cb52-17" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb52-18"><a href="Chapter3.html#cb52-18" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> SE),</span>
<span id="cb52-19"><a href="Chapter3.html#cb52-19" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb52-20"><a href="Chapter3.html#cb52-20" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>)<span class="sc">+</span></span>
<span id="cb52-21"><a href="Chapter3.html#cb52-21" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb52-22"><a href="Chapter3.html#cb52-22" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;acf&quot;</span>)<span class="sc">+</span></span>
<span id="cb52-23"><a href="Chapter3.html#cb52-23" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb52-24"><a href="Chapter3.html#cb52-24" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">20</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-40-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>欠損値が多いので、バリオグラムで見た方が適切かもしれない。バリオグラムは以下のようになる。バリオグラムは水平にならず、やはり残差に時間的な相関があることが示唆される。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="Chapter3.html#cb53-1" tabindex="-1"></a>vario_3_2a <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">resid =</span> resid,</span>
<span id="cb53-2"><a href="Chapter3.html#cb53-2" tabindex="-1"></a>                         <span class="at">Year =</span> bird<span class="sc">$</span>Year,</span>
<span id="cb53-3"><a href="Chapter3.html#cb53-3" tabindex="-1"></a>                         <span class="at">zero =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="Chapter3.html#cb53-4" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb53-5"><a href="Chapter3.html#cb53-5" tabindex="-1"></a></span>
<span id="cb53-6"><a href="Chapter3.html#cb53-6" tabindex="-1"></a>sp<span class="sc">::</span><span class="fu">coordinates</span>(vario_3_2a) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;zero&quot;</span>)</span>
<span id="cb53-7"><a href="Chapter3.html#cb53-7" tabindex="-1"></a></span>
<span id="cb53-8"><a href="Chapter3.html#cb53-8" tabindex="-1"></a>vario_3_2a <span class="sc">%&gt;%</span> </span>
<span id="cb53-9"><a href="Chapter3.html#cb53-9" tabindex="-1"></a>  <span class="fu">variogram</span>(resid <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> .,</span>
<span id="cb53-10"><a href="Chapter3.html#cb53-10" tabindex="-1"></a>            <span class="at">cutoff =</span> <span class="dv">9</span>,</span>
<span id="cb53-11"><a href="Chapter3.html#cb53-11" tabindex="-1"></a>            <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-12"><a href="Chapter3.html#cb53-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> gamma))<span class="sc">+</span></span>
<span id="cb53-13"><a href="Chapter3.html#cb53-13" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb53-14"><a href="Chapter3.html#cb53-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb53-15"><a href="Chapter3.html#cb53-15" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb53-16"><a href="Chapter3.html#cb53-16" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb53-17"><a href="Chapter3.html#cb53-17" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb53-18"><a href="Chapter3.html#cb53-18" tabindex="-1"></a>             <span class="at">stroke =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb53-19"><a href="Chapter3.html#cb53-19" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>)<span class="sc">+</span></span>
<span id="cb53-20"><a href="Chapter3.html#cb53-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb53-21"><a href="Chapter3.html#cb53-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;semivariogram&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Time lag&quot;</span>)<span class="sc">+</span></span>
<span id="cb53-22"><a href="Chapter3.html#cb53-22" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.4</span>))<span class="sc">+</span></span>
<span id="cb53-23"><a href="Chapter3.html#cb53-23" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">9</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb53-24"><a href="Chapter3.html#cb53-24" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">1.4</span>,<span class="fl">0.2</span>))</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-41-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>こうした時系列相関が問題になりうるかを判断するためには、時系列相関を考慮したモデルを作成し、それを考慮しないモデルと比較する必要がある。</p>
</div>
<div id="formulation-of-the-gls-model" class="section level3 hasAnchor" number="2.6.5">
<h3><span class="header-section-number">2.6.5</span> Formulation of the GLS model<a href="Chapter3.html#formulation-of-the-gls-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>通常の回帰モデルでは異なる残差同士が独立(相関が0)なので、以下のように書くことができる。</p>
<p><span class="math display">\[
\begin{aligned}
LD_t &amp;= \beta_1 + \beta_2 \times MSA_t + \epsilon_t \\
\epsilon_t &amp;\sim N(0,\sigma^2)\\
cor(\epsilon_t, \epsilon_s) &amp;=
\begin{cases}
0 \; \bf{if} \;t \neq s \\
1 \; \bf{if} \;t = s
\end{cases}
\end{aligned}
\]</span></p>
<p>これまでに見てきたように、時系列相関を考慮するためには異なる残差同士の相関が0でないと仮定すればよい。これは、以下のように書ける。なお、<span class="math inline">\(h()\)</span>は残差同士の相関を決める関数で<span class="math inline">\(\phi\)</span>はその関数におけるパラメータである。<br />
<span class="math display">\[
\begin{aligned}
LD_t &amp;= \beta_1 + \beta_2 \times MSA_t + \epsilon_t \\
\epsilon_t &amp;\sim N(0,\sigma^2)\\
cor(\epsilon_t, \epsilon_s) &amp;= h(\phi, \epsilon_t, \epsilon_s)
\end{aligned}
\]</span></p>
<p>時系列相関を考慮したモデルでは、この<span class="math inline">\(h()\)</span>に様々な関数を想定することで、データの非独立性に対応する。最も一般的なものは、AR1過程と呼ばれるもので、以下のように書ける。なお、<span class="math inline">\(\phi\)</span>は0から1の値をとる。</p>
<p><span class="math display">\[
\begin{aligned}
\epsilon_t &amp;= \phi \times \epsilon_{t-1} + \nu_t \\
\nu_t &amp;\sim N(0, \sigma_\nu^2)
\end{aligned}
\]</span></p>
<p>関数<span class="math inline">\(h()\)</span>は以下のように書ける。このとき、残差は<strong>定常性</strong>を持つといわれる。これは、残差の共分散は時間差のみに依存しているということである。<br />
<span class="math display">\[
h(\phi, \epsilon_t, \epsilon_s) = \phi^{|t-s|}
\]</span></p>
<p>AR1で残差の分散共分散行列<span class="math inline">\(\bf{\Sigma}\)</span>は以下のように書ける。行列中のパラメータは$$1つなので、これさえ推定できれば良い。</p>
<p><span class="math display">\[
\bf{\Sigma} = cov(\bf{\epsilon}) = \frac{\sigma_{\nu}^2}{1-\phi^2} \times
\begin{pmatrix}
1 &amp; \phi &amp; \phi^2 &amp; \phi^3 &amp; \cdots &amp; \phi^{54} \\
\phi &amp; 1 &amp; \phi &amp; \phi^2 &amp; \ddots &amp; \vdots\\
\phi^2 &amp; \phi &amp; \ddots &amp; \ddots &amp; \ddots &amp; \phi^3 \\
\phi^3 &amp; \phi^2 &amp; \ddots &amp; \ddots &amp; \ddots &amp; \phi^2 \\
\vdots &amp; \ddots &amp; \ddots &amp; \phi &amp; 1 &amp; \phi \\
\phi^{54} &amp; \cdots &amp; \phi^2 &amp; \phi^2 &amp; \phi &amp; 1
\end{pmatrix}
\]</span></p>
<p>相関行列は以下のように書ける。<br />
<span class="math display">\[
cor(\bf{\epsilon}) =
\begin{pmatrix}
1 &amp; \phi &amp; \phi^2 &amp; \phi^3 &amp; \cdots &amp; \phi^{54} \\
\phi &amp; 1 &amp; \phi &amp; \phi^2 &amp; \ddots &amp; \vdots\\
\phi^2 &amp; \phi &amp; \ddots &amp; \ddots &amp; \ddots &amp; \phi^3 \\
\phi^3 &amp; \phi^2 &amp; \ddots &amp; \ddots &amp; \ddots &amp; \phi^2 \\
\vdots &amp; \ddots &amp; \ddots &amp; \phi &amp; 1 &amp; \phi \\
\phi^{54} &amp; \cdots &amp; \phi^3 &amp; \phi^2 &amp; \phi &amp; 1
\end{pmatrix}
\]</span></p>
<p>AR1では、回帰係数の推定値とその分散共分散行列は以下のようになる。<br />
<span class="math display">\[
\begin{aligned}
\bf{\hat{\beta}} &amp;= (\bf{X^t} \times \bf{\Sigma^{-1}} \times \bf{X})^{-1} \times \bf{X^t} \times \bf{\Sigma^{-1}} \times \bf{y}\\
cov(\hat{\beta}) &amp;= (\bf{X^t} \times \bf{\Sigma^{-1}} \times \bf{X})^{-1}
\end{aligned}
\]</span></p>
<p>AR1過程モデルの代わりに、残差が他の相関構造をもつものを仮定することもできる。例えば、<strong>交換可能(exchangable)</strong>な相関を持つ場合、相関行列は以下のように書ける。これは、時間差に依らず全ての異なる残差が同じ相関<span class="math inline">\(\phi\)</span>を持つことを仮定している。これは、短い時系列を持つデータに対しては有効である場合がある。</p>
<p><span class="math display">\[
cor(\bf{\epsilon}) =
\begin{pmatrix}
1 &amp; \phi &amp; \phi &amp; \phi &amp; \cdots &amp; \phi \\
\phi &amp; 1 &amp; \phi &amp; \phi &amp; \ddots &amp; \vdots\\
\phi &amp; \phi &amp; \ddots &amp; \ddots &amp; \ddots &amp; \phi\\
\phi &amp; \phi &amp; \ddots &amp; \ddots &amp; \ddots &amp; \phi\\
\vdots &amp; \ddots &amp; \ddots &amp; \phi &amp; 1 &amp; \phi \\
\phi &amp; \cdots &amp; \phi &amp; \phi &amp; \phi &amp; 1 \\
\end{pmatrix}
\]</span></p>
</div>
<div id="implementation-using-the-gls-function" class="section level3 hasAnchor" number="2.6.6">
<h3><span class="header-section-number">2.6.6</span> Implementation using the gls function<a href="Chapter3.html#implementation-using-the-gls-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>AR1モデルのGLSのモデル式を書くと以下のようになる。</p>
<p><span class="math display">\[
\begin{aligned}
LD_t &amp;= \beta_1 + \beta_2 \times MSA_t + \epsilon_t \\
\epsilon_t &amp;\sim N(0,\sigma^2)\\
cor(\epsilon_t, \epsilon_s) &amp;= \phi^{|t-s|}
\end{aligned}
\]</span></p>
<p>Rでは以下のように実行できる。<code>gls</code>関数では、<code>correlation =</code>オプションで様々な残差の相関構造をモデリングできる。例えば、交換可能な相関の場合は、<code>correlation = corCompSymm()</code>とする。</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="Chapter3.html#cb54-1" tabindex="-1"></a>m3_2b <span class="ot">&lt;-</span> <span class="fu">gls</span>(LayingAP <span class="sc">~</span> MSA,</span>
<span id="cb54-2"><a href="Chapter3.html#cb54-2" tabindex="-1"></a>             <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span>Year),</span>
<span id="cb54-3"><a href="Chapter3.html#cb54-3" tabindex="-1"></a>             <span class="at">data =</span> bird, <span class="at">na.action =</span> na.omit)</span></code></pre></div>
<p>結果は以下の通り。推定された<span class="math inline">\(phi\)</span>は0.523である。驚くべきことに、時系列相関を考慮しない場合にはMSAの係数が負の値だったのに対して、今回は正の値になっている。</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="Chapter3.html#cb55-1" tabindex="-1"></a><span class="fu">summary</span>(m3_2b)</span></code></pre></div>
<pre><code>## Generalized least squares fit by REML
##   Model: LayingAP ~ MSA 
##   Data: bird 
##        AIC      BIC    logLik
##   138.8594 144.5953 -65.42968
## 
## Correlation Structure: ARMA(1,0)
##  Formula: ~Year 
##  Parameter estimate(s):
##      Phi1 
## 0.5236874 
## 
## Coefficients:
##                 Value Std.Error   t-value p-value
## (Intercept) 244.57591  1.443356 169.44949   0.000
## MSA          10.33068 17.311974   0.59674   0.555
## 
##  Correlation: 
##     (Intr)
## MSA -0.896
## 
## Standardized residuals:
##        Min         Q1        Med         Q3        Max 
## -1.5300255 -0.6243847 -0.0438220  0.7957452  2.0484887 
## 
## Residual standard error: 2.345265 
## Degrees of freedom: 33 total; 31 residual</code></pre>
<p>モデルの予測値を図示したのが下図である。AR1モデルでは傾きが正になり、MSAと産卵日の関連はより小さなものと推定されている。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="Chapter3.html#cb57-1" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">MSA =</span><span class="fu">seq</span>(<span class="fl">0.03</span>,<span class="fl">0.14</span>,<span class="at">length =</span> <span class="dv">100</span>))</span>
<span id="cb57-2"><a href="Chapter3.html#cb57-2" tabindex="-1"></a></span>
<span id="cb57-3"><a href="Chapter3.html#cb57-3" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">m3_2a =</span> <span class="fu">predict</span>(m3_2a, <span class="at">newdata =</span> nd),</span>
<span id="cb57-4"><a href="Chapter3.html#cb57-4" tabindex="-1"></a>           <span class="at">m3_2b =</span> <span class="fu">predict</span>(m3_2b, <span class="at">newdata =</span> nd),</span>
<span id="cb57-5"><a href="Chapter3.html#cb57-5" tabindex="-1"></a>           <span class="at">MSA =</span> nd<span class="sc">$</span>MSA) <span class="sc">%&gt;%</span> </span>
<span id="cb57-6"><a href="Chapter3.html#cb57-6" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb57-7"><a href="Chapter3.html#cb57-7" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;model&quot;</span>,</span>
<span id="cb57-8"><a href="Chapter3.html#cb57-8" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;fitted&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-9"><a href="Chapter3.html#cb57-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> MSA, <span class="at">y =</span> fitted))<span class="sc">+</span></span>
<span id="cb57-10"><a href="Chapter3.html#cb57-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> model),</span>
<span id="cb57-11"><a href="Chapter3.html#cb57-11" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb57-12"><a href="Chapter3.html#cb57-12" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_sub</span>(bird<span class="sc">$</span>Year, <span class="dv">3</span>,<span class="dv">4</span>), <span class="at">y =</span> LayingAP),</span>
<span id="cb57-13"><a href="Chapter3.html#cb57-13" tabindex="-1"></a>            <span class="at">data =</span> bird)<span class="sc">+</span></span>
<span id="cb57-14"><a href="Chapter3.html#cb57-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb57-15"><a href="Chapter3.html#cb57-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.9</span>)<span class="sc">+</span></span>
<span id="cb57-16"><a href="Chapter3.html#cb57-16" tabindex="-1"></a>  <span class="fu">scale_color_nejm</span>()<span class="sc">+</span></span>
<span id="cb57-17"><a href="Chapter3.html#cb57-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Laying date&quot;</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-44-1.png" width="672" style="display: block; margin: auto;" />
<br/></p>
<p>AICを比較しても、AR1モデルの方がわずかに予測がよいことが分かる。</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="Chapter3.html#cb58-1" tabindex="-1"></a><span class="fu">AIC</span>(m3_2a, m3_2b)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"3","2":"139.7118","_rn_":"m3_2a"},{"1":"4","2":"138.8594","_rn_":"m3_2b"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="multiple-time-series" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Multiple time series<a href="Chapter3.html#multiple-time-series" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>第<a href="Chapter2.html#s2-2">1.3</a>節でみた積雪量と雪下温度の関連を調べた　<span class="citation">Petty et al. (<a href="#ref-Petty2015">2015</a>)</span>　のデータについてもう一度考える。式@ref(eq:m2.4)のモデルでは、各時系列の残差が自己相関を持っていた。そこで、以下のモデルを考える(回帰係数は省略)。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;T_{it} = \alpha + f_j(date\_num_t) + Type_i + a_i + \epsilon_{it}\\
&amp;a_i \sim N(0, \sigma_{Logger}^2)\\
&amp;\epsilon_{it} \sim N(0, \sigma^2)\\
&amp;cor(\epsilon_{it}, \epsilon_{is}) = \phi^{|t-s|}
\end{aligned}
(\#eq:m3.3)
\]</span></p>
<p>Rでは、以下のように実行できる。ランダム切片を含む場合、自己相関は自動的にそれぞれのロガーに対して適用されるため、<code>correlation = corAR1(form =~date_num)</code>としても同じ結果が得られる。Rのgamm関数では全てのロガーについて同じ<span class="math inline">\(\phi\)</span>しか推定できない。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="Chapter3.html#cb59-1" tabindex="-1"></a>m3_3 <span class="ot">&lt;-</span> <span class="fu">gamm</span>(Temp <span class="sc">~</span> <span class="fu">s</span>(date_num, <span class="at">by =</span> Type) <span class="sc">+</span> Type,</span>
<span id="cb59-2"><a href="Chapter3.html#cb59-2" tabindex="-1"></a>             <span class="at">random =</span> <span class="fu">list</span>(<span class="at">Logger =</span><span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb59-3"><a href="Chapter3.html#cb59-3" tabindex="-1"></a>             <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span>date_num<span class="sc">|</span>Logger),</span>
<span id="cb59-4"><a href="Chapter3.html#cb59-4" tabindex="-1"></a>             <span class="at">data =</span> sn2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Type =</span> <span class="fu">as.factor</span>(Type)))</span></code></pre></div>
<p>例えば、ロガー1の残差の相関行列は以下のように書ける。<br />
<span class="math display">\[
\bf{\Sigma_1} = cor
\begin{pmatrix}
\epsilon_{1,1}\\
\epsilon_{1,2}\\
\vdots\\
\epsilon_{1,88}\\
\epsilon_{1,89}
\end{pmatrix} =
\begin{pmatrix}
1 &amp; \phi &amp; \phi^2 &amp; \phi^3 &amp; \cdots &amp; \phi^{89} \\
\phi &amp; 1 &amp; \phi &amp; \phi^2 &amp; \ddots &amp; \vdots\\
\phi^2 &amp; \phi &amp; \ddots &amp; \ddots &amp; \ddots &amp; \phi^3 \\
\phi^3 &amp; \phi^2 &amp; \ddots &amp; \ddots &amp; \ddots &amp; \phi^2 \\
\vdots &amp; \ddots &amp; \ddots &amp; \phi &amp; 1 &amp; \phi \\
\phi^{89} &amp; \cdots &amp; \phi^3 &amp; \phi^2 &amp; \phi &amp; 1
\end{pmatrix}
\]</span></p>
<p>gamm関数で推定した場合、全てのロガーで同じ<span class="math inline">\(\phi\)</span>が推定されるので、どのロガーの残差の相関行列も<span class="math inline">\(\bf{\Sigma_1}\)</span>となる。よって、すべてのロガーの残差の相関行列は以下のように書ける。対角成分以外が0なのは、異なるロガーの残差の相関は0である(= 独立である)ことを表している。</p>
<p><span class="math display">\[
\begin{aligned}
cor \begin{pmatrix}
\begin{pmatrix}
\epsilon_{1,1}\\
\vdots\\
\epsilon_{1,89}
\end{pmatrix}\\
\begin{pmatrix}
\epsilon_{2,1}\\
\vdots\\
\epsilon_{2,89}
\end{pmatrix}\\
\vdots \\
\begin{pmatrix}
\epsilon_{12,1}\\
\vdots\\
\epsilon_{12,89}
\end{pmatrix}
\end{pmatrix} =
\begin{pmatrix}
\bf{\Sigma_1} &amp; 0 &amp; \cdots &amp; 0\\
0 &amp; \bf{\Sigma_2} &amp; \cdots &amp; 0\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; \cdots &amp; \bf{\Sigma_{12}} \\
\end{pmatrix} =
\begin{pmatrix}
\bf{\Sigma_1} &amp; 0 &amp; \cdots &amp; 0\\
0 &amp; \bf{\Sigma_1} &amp; \cdots &amp; 0\\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; \cdots &amp; \bf{\Sigma_{1}} \\
\end{pmatrix}
\end{aligned}
\]</span></p>
<p>結果は以下の通り。<span class="math inline">\(\phi\)</span>は0.504と推定されている。</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="Chapter3.html#cb60-1" tabindex="-1"></a><span class="fu">summary</span>(m3_3<span class="sc">$</span>lme)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: strip.offset(mf) 
##        AIC      BIC    logLik
##   2587.526 2645.432 -1281.763
## 
## Random effects:
##  Formula: ~Xr - 1 | g
##  Structure: pdIdnot
##              Xr1      Xr2      Xr3      Xr4      Xr5      Xr6      Xr7      Xr8
## StdDev: 16.80172 16.80172 16.80172 16.80172 16.80172 16.80172 16.80172 16.80172
## 
##  Formula: ~Xr.0 - 1 | g.0 %in% g
##  Structure: pdIdnot
##            Xr.01    Xr.02    Xr.03    Xr.04    Xr.05    Xr.06    Xr.07    Xr.08
## StdDev: 12.99064 12.99064 12.99064 12.99064 12.99064 12.99064 12.99064 12.99064
## 
##  Formula: ~Xr.1 - 1 | g.1 %in% g.0 %in% g
##  Structure: pdIdnot
##            Xr.11    Xr.12    Xr.13    Xr.14    Xr.15    Xr.16    Xr.17    Xr.18
## StdDev: 10.23867 10.23867 10.23867 10.23867 10.23867 10.23867 10.23867 10.23867
## 
##  Formula: ~1 | Logger %in% g.1 %in% g.0 %in% g
##         (Intercept) Residual
## StdDev:   0.2900993 1.070964
## 
## Correlation Structure: ARMA(1,0)
##  Formula: ~date_num | g/g.0/g.1/Logger 
##  Parameter estimate(s):
##      Phi1 
## 0.5039287 
## Fixed effects:  y ~ X - 1 
##                                     Value Std.Error  DF   t-value p-value
## X(Intercept)                   -1.7091286 0.1769862 906 -9.656845  0.0000
## XTypeDeciduous                 -0.1055758 0.2601888   9 -0.405766  0.6944
## XTypePrairie                    0.5034402 0.2537067   9  1.984339  0.0785
## Xs(date_num):TypeConiferousFx1 -1.2565046 1.4583432 906 -0.861597  0.3891
## Xs(date_num):TypeDeciduousFx1   3.0138336 1.7648757 906  1.707675  0.0880
## Xs(date_num):TypePrairieFx1     0.4391241 1.4170564 906  0.309885  0.7567
##  Correlation: 
##                                X(Int) XTypDc XTypPr X(_):TC X(_):TD
## XTypeDeciduous                 -0.680                              
## XTypePrairie                   -0.698  0.475                       
## Xs(date_num):TypeConiferousFx1  0.006 -0.004 -0.004                
## Xs(date_num):TypeDeciduousFx1   0.000 -0.004  0.000  0.000         
## Xs(date_num):TypePrairieFx1     0.000  0.000  0.001  0.000   0.000 
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -5.4057668 -0.4121370  0.1026576  0.5351727  2.4662264 
## 
## Number of Observations: 921
## Number of Groups: 
##                               g                      g.0 %in% g 
##                               1                               1 
##             g.1 %in% g.0 %in% g Logger %in% g.1 %in% g.0 %in% g 
##                               1                              12</code></pre>
<p>最後に、モデルの残差の自己相関関数(acf)を図示する。</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="Chapter3.html#cb62-1" tabindex="-1"></a>sn2 <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="Chapter3.html#cb62-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resid =</span> <span class="fu">resid</span>(m3_3<span class="sc">$</span>lme, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="Chapter3.html#cb62-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Logger) <span class="sc">%&gt;%</span> </span>
<span id="cb62-4"><a href="Chapter3.html#cb62-4" tabindex="-1"></a>  <span class="fu">arrange</span>(date_num, <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="ot">-&gt;</span> sn3</span>
<span id="cb62-5"><a href="Chapter3.html#cb62-5" tabindex="-1"></a></span>
<span id="cb62-6"><a href="Chapter3.html#cb62-6" tabindex="-1"></a>Loggerid <span class="ot">&lt;-</span> <span class="fu">unique</span>(sn3<span class="sc">$</span>Logger)</span>
<span id="cb62-7"><a href="Chapter3.html#cb62-7" tabindex="-1"></a>all.out <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-8"><a href="Chapter3.html#cb62-8" tabindex="-1"></a></span>
<span id="cb62-9"><a href="Chapter3.html#cb62-9" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(Loggerid)){</span>
<span id="cb62-10"><a href="Chapter3.html#cb62-10" tabindex="-1"></a>  data <span class="ot">&lt;-</span> sn3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Logger <span class="sc">==</span> Loggerid[i])</span>
<span id="cb62-11"><a href="Chapter3.html#cb62-11" tabindex="-1"></a>  </span>
<span id="cb62-12"><a href="Chapter3.html#cb62-12" tabindex="-1"></a>  <span class="do">## 各ロガーについて時系列相関を算出  </span></span>
<span id="cb62-13"><a href="Chapter3.html#cb62-13" tabindex="-1"></a>  out.acf <span class="ot">&lt;-</span> <span class="fu">acf</span>(data<span class="sc">$</span>resid, </span>
<span id="cb62-14"><a href="Chapter3.html#cb62-14" tabindex="-1"></a>                 <span class="at">lag.max =</span> <span class="dv">15</span>,</span>
<span id="cb62-15"><a href="Chapter3.html#cb62-15" tabindex="-1"></a>                 <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-16"><a href="Chapter3.html#cb62-16" tabindex="-1"></a>  </span>
<span id="cb62-17"><a href="Chapter3.html#cb62-17" tabindex="-1"></a>  <span class="do">## 出力をデータフレームに</span></span>
<span id="cb62-18"><a href="Chapter3.html#cb62-18" tabindex="-1"></a>  out.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Timelag =</span> out.acf<span class="sc">$</span>lag,</span>
<span id="cb62-19"><a href="Chapter3.html#cb62-19" tabindex="-1"></a>                       <span class="at">Acf =</span> out.acf<span class="sc">$</span>acf,</span>
<span id="cb62-20"><a href="Chapter3.html#cb62-20" tabindex="-1"></a>                       <span class="at">SE =</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">/</span><span class="fu">sqrt</span>(out.acf<span class="sc">$</span>n.used),</span>
<span id="cb62-21"><a href="Chapter3.html#cb62-21" tabindex="-1"></a>                       <span class="at">ID =</span> Loggerid[i])</span>
<span id="cb62-22"><a href="Chapter3.html#cb62-22" tabindex="-1"></a>  </span>
<span id="cb62-23"><a href="Chapter3.html#cb62-23" tabindex="-1"></a>  <span class="do">## 全て結合  </span></span>
<span id="cb62-24"><a href="Chapter3.html#cb62-24" tabindex="-1"></a>  all.out <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all.out, out.df)</span>
<span id="cb62-25"><a href="Chapter3.html#cb62-25" tabindex="-1"></a>}</span></code></pre></div>
<p>図示したのが下図である。図からは、依然として多くのロガーでは時系列相関があることが分かる。よって、単にAR1モデルを適用するだけでは問題は解決できていない。</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="Chapter3.html#cb63-1" tabindex="-1"></a>all.out <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="Chapter3.html#cb63-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Timelag, <span class="at">y =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb63-3"><a href="Chapter3.html#cb63-3" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> Timelag, <span class="at">yend =</span> Acf))<span class="sc">+</span></span>
<span id="cb63-4"><a href="Chapter3.html#cb63-4" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymax =</span> SE, <span class="at">ymin =</span> <span class="sc">-</span>SE),</span>
<span id="cb63-5"><a href="Chapter3.html#cb63-5" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb63-6"><a href="Chapter3.html#cb63-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb63-7"><a href="Chapter3.html#cb63-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb63-8"><a href="Chapter3.html#cb63-8" tabindex="-1"></a>  <span class="fu">facet_rep_wrap</span>(<span class="sc">~</span>ID, <span class="at">repeat.tick.labels =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb63-9"><a href="Chapter3.html#cb63-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Auto-correlation&quot;</span>)</span></code></pre></div>
<p><img src="Introduction-to-Spatial-temporal-analysis-in-R_files/figure-html/unnamed-chunk-49-1.png" width="672" style="display: block; margin: auto;" />
<br /></p>
<p>また、他の問題としてGAMMに時間のsmootherとAR1過程の両方が含まれている場合、これらが競合してしまう場合があることもある。この場合、どちらかのみを適用した方がよい。</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Barbraud2006" class="csl-entry">
Barbraud C, Weimerskirch H (2006) Antarctic birds breed later in response to climate change. Proc Natl Acad Sci U S A 103:6248–6251
</div>
<div id="ref-Petty2015" class="csl-entry">
Petty SK, Zuckerberg B, Pauli JN (2015) Winter conditions and land cover structure the subnivium, a seasonal refuge beneath the snow. PLoS One 10:e0127613
</div>
<div id="ref-Steidl1991" class="csl-entry">
Steidl RJ, Griffin CR, Niles LJ (1991) Contaminant levels of osprey eggs and prey reflect regional differences in reproductive success. J Wildl Manage 55:601–608
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Chapter2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Chapter4.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
